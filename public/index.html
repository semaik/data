<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
<meta property="og:type" content="website">
<meta property="og:title" content="Semaik.">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Semaik.">
<meta property="og:description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Semaik.">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Semaik.</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Semaik." type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Semaik.</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">技术博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/03/Keepalived/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123.jpg">
      <meta itemprop="name" content="Semaik.">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Semaik.">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/03/Keepalived/" class="post-title-link" itemprop="url">Keepalived</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-03 15:49:00" itemprop="dateCreated datePublished" datetime="2020-11-03T15:49:00+08:00">2020-11-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-04 09:58:37" itemprop="dateModified" datetime="2020-11-04T09:58:37+08:00">2020-11-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

     # 
     #
          <p>Keepalived：最初给LVS负载均衡集群中的服务节点提供健康检查功能，后来因为集成了VRRP协议，可以实现解决服务节点的单点故障，提高服务的可靠性，支持高可用集群的部署</p>
<p>VRRP协议</p>
<p>VRRP（虚拟路由冗余协议）：由多台物理路由器组成一台高性能的虚拟路由器，多个物理路由器之间通过优先级举出主节点，其它节点为从节点，从节点不工作只接收主节点发来的VRRP通告，主节点管理虚拟IP并对外提供服务，主节点定时给从节点发送VRRP通告，通告中包含着主节点的优先级，当从节点在计时器的时间到了之后接收不到主机点发送的VRRP通告时，就认为主节点不可用，此时，从节点就会根据优先级选举出新的主节点并接管虚拟IP对外提供服务，这个切换过程对于客户端来说是透明的，这样解决了单点故障，保证了服务的可用性</p>
<p>无故ARP（免费ARP）：特点是arp广播包中源IP目的IP源MAC目的MAC都是发送方的，也就是都是虚拟IP和虚拟MAC，</p>
<p>作用：</p>
<p>1.可以检测是否有地址冲突</p>
<p>2.可以更新终端设备的ARP缓存表</p>
<h5 id="实验环境："><a href="#实验环境：" class="headerlink" title="实验环境："></a>实验环境：</h5><table>
<thead>
<tr>
<th align="center">系统</th>
<th align="center">IP</th>
<th align="center">服务</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Centos7.4</td>
<td align="center">1.1.1.1</td>
<td align="center">keepalived主</td>
</tr>
<tr>
<td align="center">Centos7.4</td>
<td align="center">1.1.1.2</td>
<td align="center">keepalived备</td>
</tr>
<tr>
<td align="center">Centos7.4</td>
<td align="center">1.1.1.3</td>
<td align="center">Nginx</td>
</tr>
<tr>
<td align="center">Centos7.4</td>
<td align="center">1.1.1.4</td>
<td align="center">Nginx</td>
</tr>
<tr>
<td align="center">*</td>
<td align="center">1.1.1.111</td>
<td align="center">VIP</td>
</tr>
<tr>
<td align="center">Centos7.4</td>
<td align="center">1.1.1.10</td>
<td align="center">Client</td>
</tr>
</tbody></table>
<h5 id="配置keepalived主"><a href="#配置keepalived主" class="headerlink" title="配置keepalived主"></a>配置keepalived主</h5><h6 id="使用yum安装keepalived服务"><a href="#使用yum安装keepalived服务" class="headerlink" title="使用yum安装keepalived服务"></a>使用yum安装keepalived服务</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum -y install keepalived</span><br></pre></td></tr></table></figure>
<h6 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/keepalived/keepalived.conf</span><br><span class="line">global_defs &#123;			<span class="comment">//默认全局配置</span></span><br><span class="line">   notification_email &#123;		<span class="comment">//指定该keepalived节点故障时接收邮件的收信人</span></span><br><span class="line">     acassen<span class="meta">@firewall</span>.loc	</span><br><span class="line">     failover<span class="meta">@firewall</span>.loc	</span><br><span class="line">     sysadmin<span class="meta">@firewall</span>.loc	</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from Alexandre.Cassen<span class="meta">@firewall</span>.loc		<span class="comment">//keepalived故障时发送邮件的发信人</span></span><br><span class="line">   smtp_server <span class="number">192.168</span>.<span class="number">200.1</span>		<span class="comment">//指定邮件服务器的IP，stmp简单邮件传输协议，使用端口25</span></span><br><span class="line">   smtp_connect_timeout <span class="number">30</span>		<span class="comment">//与邮件服务器的连接超时时间，单位s，可以自定义</span></span><br><span class="line">   router_id master		<span class="comment">//该节点的唯一表示，用于发邮件时表示该节点，可以是主机名，也可以是自己指定的名字</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;		<span class="comment">//定义一个VRRP实例，处于同一个组中的节点使用的实例名字应该一致，默认使用名字VI_1</span></span><br><span class="line">    state MASTER		<span class="comment">//该节点的状态，MASTER为主，BACKUP为备，必须大写，但是只是用来标识节点状态，节点主备是由优先级决定的</span></span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">ens33</span>		//指定主节点从那块网卡发送<span class="title">VRRP</span>通告</span></span><br><span class="line"><span class="class">    <span class="title">virtual_router_id</span> 51		//指定该实例所属的虚拟路由组的<span class="title">id</span>，属于同一个组的节点使用的<span class="title">id</span>应该相同，<span class="title">id</span>取值范围为0-255</span></span><br><span class="line"><span class="class">    <span class="title">priority</span> 100		//指定该节点的优先级，属于同一个组的节点优先级最高为主节点，取值范围为1-255，配置超过取值范围的值都默认视为100</span></span><br><span class="line"><span class="class">添加：<span class="title">nopreempt</span>		//将该节点设置为非抢占模式</span></span><br><span class="line"><span class="class">    <span class="title">advert_int</span> 1		//主节点每隔1<span class="title">s</span>发送一次<span class="title">VRRP</span>通告，时间可以自定义</span></span><br><span class="line"><span class="class">    <span class="title">authentication</span> </span>&#123;		<span class="comment">//配置主备节点之间的认证方式以及密码</span></span><br><span class="line">        auth_type PASS		<span class="comment">//认证类型，主备必须一致，有PASS和HA两种，PASS密码是明文的，HA是密文的</span></span><br><span class="line">        auth_pass <span class="number">1111</span>		<span class="comment">//认证密钥，主备必须一致，只识别前八位</span></span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;		<span class="comment">//配置虚拟IP，只有主节点才会拥有该地址，只能通过ip add查看，ifconfig是查看不到的</span></span><br><span class="line">        <span class="number">1.1</span>.<span class="number">1.111</span>/<span class="number">8</span>		<span class="comment">//与物理机IP同网段</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server <span class="number">1.1</span>.<span class="number">1.111</span> <span class="number">80</span> &#123;		<span class="comment">//指定LVS集群使用的虚拟IP以及端口</span></span><br><span class="line">    delay_loop <span class="number">6</span>		<span class="comment">//指定对服务节点进行健康检查的间隔时间</span></span><br><span class="line">    lb_algo rr 		<span class="comment">//该集群的使用的调度算法</span></span><br><span class="line">    lb_kind DR		<span class="comment">//该集群的调度模式</span></span><br><span class="line">    persistence_timeout <span class="number">0</span>		<span class="comment">//服务节点的连接时间，0表示为短链接</span></span><br><span class="line">    protocol TCP		<span class="comment">//集群中节点之间通过TCP协议通信</span></span><br><span class="line">    netmask <span class="number">255.0</span>.<span class="number">0.0</span>	<span class="comment">//VIP掩码</span></span><br><span class="line"></span><br><span class="line">	real_server <span class="number">1.1</span>.<span class="number">1.3</span> <span class="number">80</span> &#123;		<span class="comment">//向集群中添加服务节点</span></span><br><span class="line">   	weight <span class="number">1</span>		<span class="comment">//设置节点的权重，默认为1，如果权重为0则表示该节点不可用</span></span><br><span class="line">	   TCP_CHECK &#123;	<span class="comment">//启用TCP健康检查</span></span><br><span class="line">            connect_timeout <span class="number">1</span>		<span class="comment">//对服务节点做健康检查的连接超时时间，1s可以自定义</span></span><br><span class="line">            nb_get_retry <span class="number">3</span>		<span class="comment">//所健康检查的重试次数，可自定义</span></span><br><span class="line">            delay_before_retry <span class="number">1</span>		<span class="comment">//每次健康检查之间间隔时间，可自定义</span></span><br><span class="line">            connect_port <span class="number">80</span>		<span class="comment">//针对哪个端口进行TCP检查</span></span><br><span class="line">            &#125;</span><br><span class="line">	 &#125;</span><br><span class="line">	real_server <span class="number">1.1</span>.<span class="number">1.4</span> <span class="number">80</span> &#123;		</span><br><span class="line">   	weight <span class="number">1</span></span><br><span class="line">	   TCP_CHECK &#123;</span><br><span class="line">            connect_timeout <span class="number">3</span>	</span><br><span class="line">            nb_get_retry <span class="number">3</span>	</span><br><span class="line">            delay_before_retry <span class="number">3</span></span><br><span class="line">            connect_port <span class="number">80</span></span><br><span class="line">            &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="将配置文件拷贝给keepalived备"><a href="#将配置文件拷贝给keepalived备" class="headerlink" title="将配置文件拷贝给keepalived备"></a>将配置文件拷贝给keepalived备</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># scp /etc/keepalived/keepalived.conf root@1.1.1.2:/etc/keepalived/keepalived.conf</span><br></pre></td></tr></table></figure>
<h6 id="修改备的配置文件"><a href="#修改备的配置文件" class="headerlink" title="修改备的配置文件"></a>修改备的配置文件</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># vi /etc/keepalived/keepalived.conf</span><br><span class="line">router_id backup</span><br><span class="line">state BACKUP</span><br><span class="line">priority <span class="number">90</span></span><br></pre></td></tr></table></figure>
<h6 id="启动主从的keepalived服务"><a href="#启动主从的keepalived服务" class="headerlink" title="启动主从的keepalived服务"></a>启动主从的keepalived服务</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl restart keepalived</span><br></pre></td></tr></table></figure>
<h6 id="配置Nginx（两台同样步骤）"><a href="#配置Nginx（两台同样步骤）" class="headerlink" title="配置Nginx（两台同样步骤）"></a>配置Nginx（两台同样步骤）</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 配置虚拟IP</span><br><span class="line"># cd /etc/sysconfig/network-scripts/</span><br><span class="line"># cp ifcfg-lo ifcfg-lo:1</span><br><span class="line"># vi ifcfg-lo:1</span><br><span class="line">DEVICE=lo:<span class="number">1</span></span><br><span class="line">IPADDR=<span class="number">1.1</span>.<span class="number">1.111</span>	<span class="comment">//虚拟IP</span></span><br><span class="line">NETMASK=<span class="number">255.255</span>.<span class="number">255.255</span></span><br><span class="line">NAME=lo:<span class="number">1</span></span><br><span class="line"># 多余的删除</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以通过ifconfig命令来配置不过是临时IP重启失效</p>
</blockquote>
<blockquote>
<p>ifconfig lo:1 1.1.1.111 netmask 255.255.255.255</p>
</blockquote>
<h6 id="重启网卡"><a href="#重启网卡" class="headerlink" title="重启网卡"></a>重启网卡</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure>
<h6 id="修改系统内核文件"><a href="#修改系统内核文件" class="headerlink" title="修改系统内核文件"></a>修改系统内核文件</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/sysctl.conf</span><br><span class="line">net.ipv4.conf.lo.arp_ignore=<span class="number">1</span></span><br><span class="line">net.ipv4.conf.<span class="keyword">default</span>.arp_ignore=<span class="number">1</span>	</span><br><span class="line">net.ipv4.conf.all.arp_ignore=<span class="number">1</span></span><br><span class="line">net.ipv4.conf.lo.arp_announce=<span class="number">2</span></span><br><span class="line">net.ipv4.conf.<span class="keyword">default</span>.arp_announce=<span class="number">2</span></span><br><span class="line">net.ipv4.conf.all.arp_announce=<span class="number">2</span></span><br><span class="line"># sysctl -p</span><br></pre></td></tr></table></figure>
<h6 id="修改web首页文件（第二台web改成NO-2）"><a href="#修改web首页文件（第二台web改成NO-2）" class="headerlink" title="修改web首页文件（第二台web改成NO.2）"></a>修改web首页文件（第二台web改成NO.2）</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># echo &quot;Wecom to nginx NO.1&quot; &gt; /usr/local/nginx/html/index.html</span><br></pre></td></tr></table></figure>
<h6 id="放行防护墙"><a href="#放行防护墙" class="headerlink" title="放行防护墙"></a>放行防护墙</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># firewall-cmd --add-port=80/tcp --permanent</span><br><span class="line"># firewall-cmd --add-service=nginx --permanent</span><br><span class="line"># firewall-cmd --reload</span><br><span class="line"># setenforce 0</span><br></pre></td></tr></table></figure>
<h6 id="客户端验证"><a href="#客户端验证" class="headerlink" title="客户端验证"></a>客户端验证</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># curl 1.1.1.111</span><br><span class="line">wecom to nginx NO.<span class="number">1</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/03/Linux%E7%8E%AF%E5%A2%83%E6%9B%B4%E6%96%B0Python3-8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123.jpg">
      <meta itemprop="name" content="Semaik.">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Semaik.">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/03/Linux%E7%8E%AF%E5%A2%83%E6%9B%B4%E6%96%B0Python3-8/" class="post-title-link" itemprop="url">Linux环境更新Python3.8</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-03 12:41:00 / 修改时间：13:13:26" itemprop="dateCreated datePublished" datetime="2020-11-03T12:41:00+08:00">2020-11-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

     # 
     #
          <h4 id="进入Python官网下载软件包：https-www-python-org-downloads"><a href="#进入Python官网下载软件包：https-www-python-org-downloads" class="headerlink" title="进入Python官网下载软件包：https://www.python.org/downloads/"></a>进入Python官网下载软件包：<a target="_blank" rel="noopener" href="https://www.python.org/downloads/">https://www.python.org/downloads/</a></h4><p><img src="/images/pasted-101.png" alt="upload successful"></p>
<blockquote>
<p>下载需要更新的软件包</p>
</blockquote>
<p><img src="/images/pasted-102.png" alt="upload successful"></p>
<h4 id="我就拿3-8-5软件包举例"><a href="#我就拿3-8-5软件包举例" class="headerlink" title="我就拿3.8.5软件包举例"></a>我就拿3.8.5软件包举例</h4><h6 id="创建一个存储目录"><a href="#创建一个存储目录" class="headerlink" title="创建一个存储目录"></a>创建一个存储目录</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@one /]# mkdir /usr/local/python3-8</span><br></pre></td></tr></table></figure>
<h6 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@one /]# yum install gcc libffi-devel zlib* openssl-devel</span><br></pre></td></tr></table></figure>
<h6 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@one /]# unzip Python-3.8.5.zip</span><br><span class="line">[root@one /]# cd Python-3.8.5/</span><br><span class="line">[root@one Python-3.8.5]# ./configure --prefix=/usr/local/python3-8 &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h6 id="给予权限"><a href="#给予权限" class="headerlink" title="给予权限"></a>给予权限</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@one /]# chmod 777 /usr/local/python3-8/</span><br></pre></td></tr></table></figure>
<h6 id="备份Python2的文件"><a href="#备份Python2的文件" class="headerlink" title="备份Python2的文件"></a>备份Python2的文件</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@one /]# cp /usr/bin/python /usr/bin/python2.bak</span><br><span class="line">[root@one /]# rm -rf /usr/bin/python</span><br></pre></td></tr></table></figure>
<h6 id="将Python3的文件链接到-usr-bin-下"><a href="#将Python3的文件链接到-usr-bin-下" class="headerlink" title="将Python3的文件链接到/usr/bin/下"></a>将Python3的文件链接到/usr/bin/下</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@one /]# ln -s /usr/local/python3-8/bin/python3.8 /usr/bin/pyhton</span><br></pre></td></tr></table></figure>
<h6 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h6><p><img src="/images/pasted-103.png" alt="upload successful"></p>
<p><img src="/images/pasted-104.png" alt="upload successful"></p>
<blockquote>
<p>如果pip的版本未更换成3.8就需要手动操作了</p>
</blockquote>
<h6 id="如果Yum出现以下错误"><a href="#如果Yum出现以下错误" class="headerlink" title="如果Yum出现以下错误"></a>如果Yum出现以下错误</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@one /]# yum -y install openssl*</span><br><span class="line">  File <span class="string">&quot;/usr/bin/yum&quot;</span>, line <span class="number">30</span></span><br><span class="line">    except KeyboardInterrupt, e:</span><br><span class="line">                            ^</span><br><span class="line">SyntaxError: invalid syntax</span><br><span class="line"></span><br><span class="line">或</span><br><span class="line"></span><br><span class="line">总下载量：<span class="number">3.9</span> M</span><br><span class="line">Downloading packages:</span><br><span class="line">  File <span class="string">&quot;/usr/libexec/urlgrabber-ext-down&quot;</span>, line <span class="number">28</span></span><br><span class="line">    except OSError, e:</span><br><span class="line">                  ^</span><br></pre></td></tr></table></figure>
<h6 id="以上报错需要修改yum解释器"><a href="#以上报错需要修改yum解释器" class="headerlink" title="以上报错需要修改yum解释器"></a>以上报错需要修改yum解释器</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@one /]# vi /usr/bin/yum</span><br><span class="line">[root@one /]# vi /usr/libexec/urlgrabber-ext-down</span><br><span class="line"># 都修改成同样的python2.7</span><br></pre></td></tr></table></figure>
<p><img src="/images/pasted-105.png" alt="upload successful"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/13/Centos7%E9%83%A8%E7%BD%B2%E8%BD%BB%E9%87%8F%E7%BA%A7%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7pssh/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123.jpg">
      <meta itemprop="name" content="Semaik.">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Semaik.">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/13/Centos7%E9%83%A8%E7%BD%B2%E8%BD%BB%E9%87%8F%E7%BA%A7%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7pssh/" class="post-title-link" itemprop="url">Centos7部署轻量级自动化运维工具pssh</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-10-13 15:31:00 / 修改时间：15:50:56" itemprop="dateCreated datePublished" datetime="2020-10-13T15:31:00+08:00">2020-10-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

     # 
     #
          <blockquote>
<p>pssh是由python编写，可以在多台服务器执行命令的工具。在服务器越来越多的企业这种自动化运维工具越来越火。</p>
</blockquote>
<h5 id="下载pssh安装包"><a href="#下载pssh安装包" class="headerlink" title="下载pssh安装包"></a>下载pssh安装包</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# wget https://files.pythonhosted.org/packages/60/9a/8035af3a7d3d1617ae2c7c174efa4f154e5bf9c24b36b623413b38be8e4a/pssh-2.3.1.tar.gz</span><br></pre></td></tr></table></figure>
<h5 id="配置免密登录"><a href="#配置免密登录" class="headerlink" title="配置免密登录"></a>配置免密登录</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ssh-keygen</span><br><span class="line">Generating <span class="keyword">public</span>/<span class="keyword">private</span> rsa key pair.</span><br><span class="line"><span class="function">Enter file in which to save the <span class="title">key</span> <span class="params">(/root/.ssh/id_rsa)</span>: </span></span><br><span class="line"><span class="function">Enter <span class="title">passphrase</span> <span class="params">(empty <span class="keyword">for</span> no passphrase)</span>: </span></span><br><span class="line"><span class="function">Enter same passphrase again: </span></span><br><span class="line"><span class="function">Your identification has been saved in /root/.ssh/id_rsa.</span></span><br><span class="line"><span class="function">Your <span class="keyword">public</span> key has been saved in /root/.ssh/id_rsa.pub.</span></span><br><span class="line"><span class="function">The key fingerprint is:</span></span><br><span class="line"><span class="function">SHA256:3antaxjGw+hdgfSlrXLYhUe5vgHe9b0ehh/gUY9E8Eg root@localhost.localdomain</span></span><br><span class="line"><span class="function">The key&#x27;s randomart image is:</span></span><br><span class="line"><span class="function">+---[RSA 2048]----+</span></span><br><span class="line"><span class="function">|            E... |</span></span><br><span class="line"><span class="function">|          .. ++  |</span></span><br><span class="line"><span class="function">|         . o.*oo |</span></span><br><span class="line"><span class="function">|         ...*o*.o|</span></span><br><span class="line"><span class="function">|        S+.+o@..+|</span></span><br><span class="line"><span class="function">|        . OoB B o|</span></span><br><span class="line"><span class="function">|       . o.B.o *.|</span></span><br><span class="line"><span class="function">|        . o.. +.o|</span></span><br><span class="line"><span class="function">|           .o..o |</span></span><br><span class="line"><span class="function">+----[SHA256]-----+</span></span><br><span class="line"><span class="function">[root@localhost ~]# cd /root/.ssh/</span></span><br><span class="line"><span class="function">[root@localhost .ssh]# ls</span></span><br><span class="line"><span class="function">id_rsa  id_rsa.pub</span></span><br><span class="line"><span class="function">[root@localhost .ssh]# ssh-copy-id 172.16.1.112</span></span><br><span class="line"><span class="function">/usr/bin/ssh-copy-id: INFO: Source of <span class="title">key</span><span class="params">(s)</span> to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span></span><br><span class="line"><span class="function">The authenticity of host &#x27;172.16.1.112 <span class="params">(<span class="number">172.16</span><span class="number">.1</span><span class="number">.112</span>)</span>&#x27; can&#x27;t be established.</span></span><br><span class="line"><span class="function">ECDSA key fingerprint is SHA256:yFvaxR1x5YDhhe+6xR/Ou6Sm+YPYvPAoiLVKt9mAnXA.</span></span><br><span class="line"><span class="function">ECDSA key fingerprint is MD5:0d:c4:79:bc:36:7a:a4:82:95:4f:d5:d0:a3:c8:7d:2e.</span></span><br><span class="line"><span class="function">Are you sure you want to <span class="keyword">continue</span> <span class="title">connecting</span> <span class="params">(yes/no)</span>? yes</span></span><br><span class="line"><span class="function">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new <span class="title">key</span><span class="params">(s)</span>, to filter out any that are already installed</span></span><br><span class="line"><span class="function">/usr/bin/ssh-copy-id: INFO: 1 <span class="title">key</span><span class="params">(s)</span> remain to be installed -- <span class="keyword">if</span> you are prompted now it is to install the new keys</span></span><br><span class="line"><span class="function">root@172.16.1.112&#x27;s password: </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">Number of <span class="title">key</span><span class="params">(s)</span> added: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">Now <span class="keyword">try</span> logging into the machine, with:   &quot;ssh &#x27;172.16.1.112&#x27;&quot;</span></span><br><span class="line"><span class="function">and check to make sure that only the <span class="title">key</span><span class="params">(s)</span> you wanted were added.</span></span><br><span class="line"><span class="function">[root@localhost .ssh]# ssh-copy-id 172.16.1.16</span></span><br><span class="line"><span class="function">/usr/bin/ssh-copy-id: INFO: Source of <span class="title">key</span><span class="params">(s)</span> to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span></span><br><span class="line"><span class="function">The authenticity of host &#x27;172.16.1.16 <span class="params">(<span class="number">172.16</span><span class="number">.1</span><span class="number">.16</span>)</span>&#x27; can&#x27;t be established.</span></span><br><span class="line"><span class="function">ECDSA key fingerprint is SHA256:ANzlXzrGA87YLI2vzkPJ/iNPiSQ5JStJc95948jE8aw.</span></span><br><span class="line"><span class="function">ECDSA key fingerprint is MD5:f9:f1:1b:5a:99:64:d8:d8:e9:9b:e6:bb:c3:d5:bd:e7.</span></span><br><span class="line"><span class="function">Are you sure you want to <span class="keyword">continue</span> <span class="title">connecting</span> <span class="params">(yes/no)</span>? yes</span></span><br><span class="line"><span class="function">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new <span class="title">key</span><span class="params">(s)</span>, to filter out any that are already installed</span></span><br><span class="line"><span class="function">/usr/bin/ssh-copy-id: INFO: 1 <span class="title">key</span><span class="params">(s)</span> remain to be installed -- <span class="keyword">if</span> you are prompted now it is to install the new keys</span></span><br><span class="line"><span class="function">root@172.16.1.16&#x27;s password: </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">Number of <span class="title">key</span><span class="params">(s)</span> added: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">Now <span class="keyword">try</span> logging into the machine, with:   &quot;ssh &#x27;172.16.1.16&#x27;&quot;</span></span><br><span class="line"><span class="function">and check to make sure that only the <span class="title">key</span><span class="params">(s)</span> you wanted were added.</span></span><br></pre></td></tr></table></figure>
<h5 id="测试免密登录"><a href="#测试免密登录" class="headerlink" title="测试免密登录"></a>测试免密登录</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ssh 172.16.1.112</span><br><span class="line">Last login: Tue Jun  <span class="number">2</span> <span class="number">09</span>:<span class="number">44</span>:<span class="number">24</span> <span class="number">2020</span> from <span class="number">172.16</span>.<span class="number">1.16</span></span><br><span class="line">[root@localhost ~]# ssh 172.16.1.16</span><br><span class="line">Last login: Tue Jun  <span class="number">2</span> <span class="number">09</span>:<span class="number">30</span>:<span class="number">47</span> <span class="number">2020</span> from <span class="number">172.16</span>.<span class="number">1.100</span></span><br></pre></td></tr></table></figure>

<h5 id="测试pssh"><a href="#测试pssh" class="headerlink" title="测试pssh"></a>测试pssh</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># 将IP写入到文件中</span><br><span class="line">[root@localhost ~]# echo &quot;172.16.1.112&quot; &gt;&gt; aaa</span><br><span class="line">[root@localhost ~]# echo &quot;172.16.1.16&quot; &gt;&gt; aaa</span><br><span class="line">[root@localhost ~]# cat aaa</span><br><span class="line"><span class="number">172.16</span>.<span class="number">1.112</span></span><br><span class="line"><span class="number">172.16</span>.<span class="number">1.16</span></span><br><span class="line"># 批量执行date命令</span><br><span class="line">[root@localhost ~]# pssh -h aaa -l root -P &quot;date&quot;</span><br><span class="line"><span class="number">172.16</span>.<span class="number">1.16</span>: <span class="number">2020</span>年 <span class="number">06</span>月 <span class="number">02</span>日 星期二 <span class="number">09</span>:<span class="number">59</span>:<span class="number">48</span> CST</span><br><span class="line">[<span class="number">1</span>] <span class="number">09</span>:<span class="number">59</span>:<span class="number">48</span> [SUCCESS] <span class="number">172.16</span>.<span class="number">1.16</span></span><br><span class="line"><span class="number">172.16</span>.<span class="number">1.112</span>: <span class="number">2020</span>年 <span class="number">06</span>月 <span class="number">02</span>日 星期二 <span class="number">09</span>:<span class="number">59</span>:<span class="number">48</span> CST</span><br><span class="line">[<span class="number">2</span>] <span class="number">09</span>:<span class="number">59</span>:<span class="number">48</span> [SUCCESS] <span class="number">172.16</span>.<span class="number">1.112</span></span><br><span class="line"># 查看磁盘</span><br><span class="line">[root@localhost ~]# pssh -h aaa -l root -P &quot;lsblk&quot;</span><br><span class="line"><span class="number">172.16</span>.<span class="number">1.16</span>: NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda               <span class="number">8</span>:<span class="number">0</span>    <span class="number">0</span>   <span class="number">20</span>G  <span class="number">0</span> disk </span><br><span class="line">├─sda1            <span class="number">8</span>:<span class="number">1</span>    <span class="number">0</span>    <span class="number">1</span>G  <span class="number">0</span> part /boot</span><br><span class="line">└─sda2            <span class="number">8</span>:<span class="number">2</span>    <span class="number">0</span>   <span class="number">19</span>G  <span class="number">0</span> part </span><br><span class="line">  ├─centos-root <span class="number">253</span>:<span class="number">0</span>    <span class="number">0</span>   <span class="number">17</span>G  <span class="number">0</span> lvm  /</span><br><span class="line">  └─centos-swap <span class="number">253</span>:<span class="number">1</span>    <span class="number">0</span>    <span class="number">2</span>G  <span class="number">0</span> lvm  [SWAP]</span><br><span class="line">sr0              <span class="number">11</span>:<span class="number">0</span>    <span class="number">1</span>  <span class="number">4.2</span>G  <span class="number">0</span> rom  </span><br><span class="line">[<span class="number">1</span>] <span class="number">10</span>:<span class="number">13</span>:<span class="number">02</span> [SUCCESS] <span class="number">172.16</span>.<span class="number">1.16</span></span><br><span class="line"><span class="number">172.16</span>.<span class="number">1.112</span>: NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda               <span class="number">8</span>:<span class="number">0</span>    <span class="number">0</span>   <span class="number">20</span>G  <span class="number">0</span> disk </span><br><span class="line">├─sda1            <span class="number">8</span>:<span class="number">1</span>    <span class="number">0</span>    <span class="number">1</span>G  <span class="number">0</span> part /boot</span><br><span class="line">└─sda2            <span class="number">8</span>:<span class="number">2</span>    <span class="number">0</span>   <span class="number">19</span>G  <span class="number">0</span> part </span><br><span class="line">  ├─centos-root <span class="number">253</span>:<span class="number">0</span>    <span class="number">0</span>   <span class="number">17</span>G  <span class="number">0</span> lvm  /</span><br><span class="line">  └─centos-swap <span class="number">253</span>:<span class="number">1</span>    <span class="number">0</span>    <span class="number">2</span>G  <span class="number">0</span> lvm  [SWAP]</span><br><span class="line">sr0              <span class="number">11</span>:<span class="number">0</span>    <span class="number">1</span>  <span class="number">4.2</span>G  <span class="number">0</span> rom  </span><br><span class="line">[<span class="number">2</span>] <span class="number">10</span>:<span class="number">13</span>:<span class="number">03</span> [SUCCESS] <span class="number">172.16</span>.<span class="number">1.112</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/13/HTTP%E6%96%B9%E5%BC%8F%E5%85%B1%E4%BA%ABYUM%E8%BD%AF%E4%BB%B6%E4%BB%93%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123.jpg">
      <meta itemprop="name" content="Semaik.">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Semaik.">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/13/HTTP%E6%96%B9%E5%BC%8F%E5%85%B1%E4%BA%ABYUM%E8%BD%AF%E4%BB%B6%E4%BB%93%E5%BA%93/" class="post-title-link" itemprop="url">HTTP方式共享YUM软件仓库</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-10-13 15:04:00 / 修改时间：15:28:04" itemprop="dateCreated datePublished" datetime="2020-10-13T15:04:00+08:00">2020-10-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

     # 
     #
          <h5 id="两台机器"><a href="#两台机器" class="headerlink" title="两台机器"></a>两台机器</h5><table>
<thead>
<tr>
<th>IP</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>1.1.1.5</td>
<td>YUM仓库</td>
</tr>
<tr>
<td>1.1.1.3</td>
<td>测试机器</td>
</tr>
</tbody></table>
<p><strong>1.1.1.5通过apache镜像目录共享</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum install -y httpd</span><br></pre></td></tr></table></figure>
<p>在/var/www/html下面创建centos目录</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir /var/www/html/centos</span><br></pre></td></tr></table></figure>

<p>挂载镜像到/var/www/html/aaa下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mount CentOS-7-x86_64-DVD-1611.iso /var/www/html/centos/</span><br><span class="line">[root@localhost ~]# ls /var/www/html/centos/</span><br><span class="line">CentOS_BuildTag  EULA  images    LiveOS    repodata              RPM-GPG-KEY-CentOS-Testing-<span class="number">7</span></span><br><span class="line">EFI              GPL   isolinux  Packages  RPM-GPG-KEY-CentOS-<span class="number">7</span>  TRANS.TBL</span><br></pre></td></tr></table></figure>

<p>测试浏览器访问</p>
<p><img src="/images/pasted-99.png" alt="upload successful"></p>
<p>在1.1.1.3配置yum</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vi /etc/yum.repos.d/yum.repo</span><br><span class="line">[yum]</span><br><span class="line">name=yum</span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">gpgcheck=<span class="number">0</span></span><br><span class="line">baseurl=http:<span class="comment">//1.1.1.5/centos                       </span></span><br></pre></td></tr></table></figure>
<p>测试安装软件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum install vsftpd -y</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">正在解决依赖关系</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">总下载量：<span class="number">169</span> k</span><br><span class="line">安装大小：<span class="number">348</span> k</span><br><span class="line">Downloading packages:</span><br><span class="line">vsftpd-<span class="number">3.0</span>.<span class="number">2</span>-<span class="number">22.</span>el7.x86_64.rpm | <span class="number">169</span> kB <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">正在安装 : vsftpd-<span class="number">3.0</span>.<span class="number">2</span>-<span class="number">22.</span>el7.x86_64 <span class="number">1</span>/<span class="number">1</span></span><br><span class="line">验证中 : vsftpd-<span class="number">3.0</span>.<span class="number">2</span>-<span class="number">22.</span>el7.x86_64 <span class="number">1</span>/<span class="number">1</span></span><br><span class="line"></span><br><span class="line">已安装:</span><br><span class="line">vsftpd.x86_64 <span class="number">0</span>:<span class="number">3.0</span>.<span class="number">2</span>-<span class="number">22.</span>el7</span><br><span class="line"></span><br><span class="line">完毕！</span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/27/%E5%AE%9E%E7%8E%B0%E5%AE%B9%E5%99%A8%E7%9A%84%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123.jpg">
      <meta itemprop="name" content="Semaik.">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Semaik.">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/27/%E5%AE%9E%E7%8E%B0%E5%AE%B9%E5%99%A8%E7%9A%84%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF/" class="post-title-link" itemprop="url">实现容器的底层技术</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-27 15:04:00 / 修改时间：15:12:50" itemprop="dateCreated datePublished" datetime="2020-09-27T15:04:00+08:00">2020-09-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

     # 
     #
          <p><img src="/images/pasted-90.png" alt="upload successful"></p>
<p>通讯的前提：<br>一个网段=一个vlan=一个广播域</p>
<h5 id="实现容器的底层技术："><a href="#实现容器的底层技术：" class="headerlink" title="实现容器的底层技术："></a>实现容器的底层技术：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cgroup是实现资源的限制</span><br><span class="line">namespace是实现资源的隔离（六项内容）：</span><br><span class="line">  mount：容器内目录可以任意mount互相是不影响的</span><br><span class="line">  uts：使容器拥有自己的主机名</span><br><span class="line">  ipc：使容器拥有自己的共享内存和信号量不和host主机混在一起</span><br><span class="line">  network：让每个容器拥有独立的ip、网卡、路由等资源</span><br><span class="line">  user：让容器能自己管理用户，host不能看到容器内的用户</span><br><span class="line">  pid：容器内的pid不同于host中对应进程的pid，容器中的pid=<span class="number">1</span>的进程也不是host的init 进程。也就是说，容器拥有自己独立的一套pid</span><br><span class="line">   重要的问题：因为container的pid=<span class="number">1</span>的进程部署init，导致container无法使用systemd 管理程序</span><br><span class="line">  解决方法：<span class="number">1</span>、提权使<span class="number">1</span>号进程是init/systemd； <span class="number">2</span>、通过启动命令启动程序，不通过systemd <span class="number">1</span>、提权：   管理程序</span><br><span class="line">      docker run -it --restart always -d --name web  --privileged [需要提权的容器] /sbin/init</span><br><span class="line">      <span class="number">2</span>、通过启动命令来启动程序，不要通过systemd管理程序。每个systemd在启动程序 的时候都是用XXXX.sersvice文件内的Execstart文件</span><br></pre></td></tr></table></figure>

<p>查询网桥信息：</p>
<p>brctl show</p>
<p><img src="/images/pasted-91.png" alt="upload successful"><br>docker的原生网络</p>
<p>查看：docker network ls</p>
<p>容器的原生网络</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">none：封闭意味着隔离，生成随机码，生成二维码等，对安全性要求高，并不需要联网用</span><br><span class="line">host：容器和物理机使用完全相同的网络栈</span><br><span class="line">joined：容器使用另一个容器的网络栈 </span><br><span class="line"># docker run -it --rm --name test --network container:web busybox sh</span><br><span class="line">bridge：应用最广泛和默认的网络，必须要懂</span><br><span class="line"># 当创建一个容器并运行会在物理机和容器内上出现一对网卡，物理机网卡没有ip是用 来链接创建容器内的网卡，当容器内要访问外部网络的时候   比如ping百度  数据从 容器内的网卡转到容器外的veth pair，然后这个网段由</span><br><span class="line">docker0去与外界练习通信</span><br></pre></td></tr></table></figure>
<h5 id="docker网络是怎么实现隔离的呢？"><a href="#docker网络是怎么实现隔离的呢？" class="headerlink" title="docker网络是怎么实现隔离的呢？"></a>docker网络是怎么实现隔离的呢？</h5><p>采用iptables防火墙进行隔离</p>
<h5 id="嵌套旧容器运行新容器"><a href="#嵌套旧容器运行新容器" class="headerlink" title="嵌套旧容器运行新容器"></a>嵌套旧容器运行新容器</h5><p>运行一个基于http镜像的web容器</p>
<p><img src="/images/pasted-92.png" alt="upload successful"><br>进入容器后查看IP（这里是查看不了的，因为httpd只是一个服务镜像，没有其他使用命令，属于纯净的服务镜像）</p>
<p><img src="/images/pasted-93.png" alt="upload successful"><br>这时，我们应该怎样查看这个容器的IP地址呢？</p>
<p>再次运行一个基于busybox镜像的web容器（busybox镜像所有基础命令可以使用）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm --network container:web busybox</span><br></pre></td></tr></table></figure>

<p><img src="/images/pasted-94.png" alt="upload successful"></p>
<p>参数：</p>
<blockquote>
<p>–rm：容器停止后自动删除</p>
</blockquote>
<blockquote>
<p>–network container:</p>
</blockquote>
<blockquote>
<p>用于连接某台容器，使得两台容器使用同一个网络，也就是使用同一个IP<br>这时我们查看到的IP地址和web容器里的IP地址是相同的。</p>
</blockquote>
<p><img src="/images/pasted-95.png" alt="upload successful"></p>
<h5 id="我们应该怎么样去查看容器和宿主机之间的网络连接呢？"><a href="#我们应该怎么样去查看容器和宿主机之间的网络连接呢？" class="headerlink" title="我们应该怎么样去查看容器和宿主机之间的网络连接呢？"></a>我们应该怎么样去查看容器和宿主机之间的网络连接呢？</h5><p>首先查看桥接信息</p>
<p><img src="/images/pasted-96.png" alt="upload successful"></p>
<p>进去容器内敲ip a（会有网卡信息标识）</p>
<p><img src="/images/pasted-97.png" alt="upload successful"></p>
<p>退出容器在宿主机敲ip a（找到21对应20的标识）</p>
<p><img src="/images/pasted-98.png" alt="upload successful"></p>
<h5 id="实现一个容器连接多个网卡的命令"><a href="#实现一个容器连接多个网卡的命令" class="headerlink" title="实现一个容器连接多个网卡的命令"></a>实现一个容器连接多个网卡的命令</h5><p>docker network connect 网卡名称 连接到哪个容器的名称</p>
<p>例：<code>docker network connect my_net nginx</code></p>
<p>作用：可以实现不同网络间通信</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/27/%E8%A7%A3%E5%86%B3%E5%9C%A8Docker%E5%AE%B9%E5%99%A8%E4%B8%AD%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8system%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123.jpg">
      <meta itemprop="name" content="Semaik.">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Semaik.">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/27/%E8%A7%A3%E5%86%B3%E5%9C%A8Docker%E5%AE%B9%E5%99%A8%E4%B8%AD%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8system%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">解决在Docker容器中不能使用system管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-27 15:00:00 / 修改时间：15:02:51" itemprop="dateCreated datePublished" datetime="2020-09-27T15:00:00+08:00">2020-09-27</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

     # 
     #
          <p><strong>例：httpd服务</strong></p>
<p><img src="/images/pasted-85.png" alt="upload successful"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@a4120181b4d3 /]# systemctl start httpd</span><br><span class="line">报错：Failed to get D-Bus connection: Operation not permitted</span><br></pre></td></tr></table></figure>

<p><strong>解决方法一：</strong></p>
<p>运行容器时提权</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -tid --name centos_1 --privileged=<span class="keyword">true</span> centos:latest /sbin/init</span><br></pre></td></tr></table></figure>
<blockquote>
<p>-privileged：提权操作</p>
</blockquote>
<p><strong>解决方法二：</strong><br>进入配置文件</p>
<p>vi /usr/lib/systemd/system/httpd.service</p>
<p><img src="/images/pasted-86.png" alt="upload successful"><br>复制/usr/sbin/httpd</p>
<p>启动httpd服务</p>
<p><img src="/images/pasted-87.png" alt="upload successful"></p>
<p><img src="/images/pasted-88.png" alt="upload successful"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/27/%E4%BD%BF%E7%94%A8SSH%E8%BF%9E%E6%8E%A5Docker%E5%AE%B9%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123.jpg">
      <meta itemprop="name" content="Semaik.">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Semaik.">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/27/%E4%BD%BF%E7%94%A8SSH%E8%BF%9E%E6%8E%A5Docker%E5%AE%B9%E5%99%A8/" class="post-title-link" itemprop="url">使用SSH连接Docker容器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-27 14:54:00 / 修改时间：14:59:17" itemprop="dateCreated datePublished" datetime="2020-09-27T14:54:00+08:00">2020-09-27</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

     # 
     #
          <p><strong>实验：使用ssh管理docker的容器</strong></p>
<p><strong>实验要求：</strong></p>
<blockquote>
<p>1、ssh可以登录容器<br>2、在容器内yum 安装httpd并且启动</p>
</blockquote>
<p><strong>实验步骤</strong></p>
<p>将docker的centos镜像实例化名为sshd的容器<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -itd --name sshd centos /bin/bash</span><br><span class="line">cd3c512d6cd959263b1c94e19781d7213831aad714a2e962ade7c0adc28c510e</span><br></pre></td></tr></table></figure><br>进入容器，并进行安装sshd和启动sshd的相应操作<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker exec -it sshd /bin/bash</span><br><span class="line">[root@cd3c512d6cd9 /]# yum -y install openssh-server openssh-clients password iproute net-tools</span><br><span class="line">[root@cd3c512d6cd9 /]# passwd root   # 设置root密码</span><br><span class="line">[root@cd3c512d6cd9 /]# cat /usr/lib/systemd/system/sshd.service</span><br><span class="line"> 找到以下</span><br><span class="line">ExecStart=/usr/sbin/sshd -D $OPTIONS</span><br><span class="line"> /usr/sbin/sshd -D这个用来启动yum安装的服务，几乎所有yum安装的都有这个</span><br><span class="line">[root@5c46b791e8d2 /]# /usr/sbin/sshd -D</span><br><span class="line"> 执行之后发现报错，找不到<span class="number">3</span>个密钥文件</span><br><span class="line">Could not load host key: /etc/ssh/ssh_host_rsa_key</span><br><span class="line">Could not load host key: /etc/ssh/ssh_host_ecdsa_key</span><br><span class="line">Could not load host key: /etc/ssh/ssh_host_ed25519_key</span><br><span class="line">sshd: no hostkeys available -- exiting.</span><br><span class="line"> 生成密钥，分别存放到它要找到三个路径中</span><br><span class="line">[root@cd3c512d6cd9 /]# ssh-keygen -q -t rsa -b 2048 -f /etc/ssh/ssh_host_rsa_key -N &#x27;&#x27;</span><br><span class="line">[root@cd3c512d6cd9 /]# ssh-keygen -q -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key -N &#x27;&#x27;</span><br><span class="line">[root@cd3c512d6cd9 /]# ssh-keygen -q -t dsa -f /etc/ssh/ssh_host_ed25519_key -N &#x27;&#x27;</span><br><span class="line"> </span><br><span class="line">keygen参数：</span><br><span class="line">    -q：不在终端显示密钥</span><br><span class="line">    -b：字节长度</span><br><span class="line">    -f：指定密钥文件路径</span><br><span class="line"> </span><br><span class="line"> 可以通过cat去查看这三个密钥</span><br><span class="line">[root@cd3c512d6cd9 /]# vi /etc/ssh/sshd_config </span><br><span class="line"> 修此文件是得ssh以进程方式运行</span><br><span class="line"> 这是pam模块使用sshd，容器中没有这个模块，所以需要注释</span><br><span class="line">UsePAM no  </span><br><span class="line"> 解开以下注释并修改值为no</span><br><span class="line">UsePrivilegeSeparation sandbox  <span class="comment">//将sandbox改为no</span></span><br><span class="line"> 以下解开注释，允许超级用户登录</span><br><span class="line">PermitRootLogin yes</span><br></pre></td></tr></table></figure><br>启动sshd服务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@5c46b791e8d2 /]# /usr/sbin/sshd -D &amp;</span><br><span class="line">[root@5c46b791e8d2 /]# exit</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
<p>然后就可以通过ssh来使用物理机连接docker容器sshd<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# ssh root@172.17.0.2</span><br><span class="line">The authenticity of host <span class="string">&#x27;172.17.0.2 (172.17.0.2)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:8M08usrRzTfDZjM9cfZhM+DAMn8d4O6/xW3ULlpM17o.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is MD5:8b:72:3b:0f:15:ac:f4:8f:24:f0:ed:fa:40:12:c3:ae.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span><span class="number">172.17</span>.<span class="number">0.2</span><span class="string">&#x27; (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">root@172.17.0.2&#x27;</span>s password:</span><br></pre></td></tr></table></figure><br>安装httpd并启动</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@5c46b791e8d2 ~]# yum -y install httpd</span><br><span class="line">[root@5c46b791e8d2 ~]# find / -name httpd.service</span><br><span class="line">/usr/lib/systemd/system/httpd.service</span><br><span class="line">[root@5c46b791e8d2 ~]# cat /usr/lib/systemd/system/httpd.service</span><br><span class="line">ExecStart=/usr/sbin/httpd $OPTIONS -DFOREGROUND</span><br><span class="line">[root@5c46b791e8d2 ~]# /usr/sbin/httpd  &amp;</span><br><span class="line">AH00558: httpd: Could not reliably determine the server<span class="string">&#x27;s fully qualified</span></span><br><span class="line"><span class="string">domain name, using 172.17.0.2. Set the &#x27;</span>ServerName<span class="string">&#x27; directive globally to suppress this message</span></span><br><span class="line"><span class="string">[root@5c46b791e8d2 ~]# netstat -anpt | grep 80</span></span><br><span class="line"><span class="string">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      191/httpd </span></span><br><span class="line"><span class="string">[root@5c46b791e8d2 ~]# curl 172.17.0.2</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/27/%E5%AF%B9%E5%AE%B9%E5%99%A8%E8%BF%9B%E8%A1%8Ccpu%E7%9A%84%E4%BD%BF%E7%94%A8%E6%8E%A7%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123.jpg">
      <meta itemprop="name" content="Semaik.">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Semaik.">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/27/%E5%AF%B9%E5%AE%B9%E5%99%A8%E8%BF%9B%E8%A1%8Ccpu%E7%9A%84%E4%BD%BF%E7%94%A8%E6%8E%A7%E5%88%B6/" class="post-title-link" itemprop="url">对容器进行cpu的使用控制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-27 14:50:00 / 修改时间：14:54:14" itemprop="dateCreated datePublished" datetime="2020-09-27T14:50:00+08:00">2020-09-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

     # 
     #
          <h5 id="控制容器中cpu使用的优先级"><a href="#控制容器中cpu使用的优先级" class="headerlink" title="控制容器中cpu使用的优先级"></a>控制容器中cpu使用的优先级</h5><p>默认情况下所有的容器都平等的使用cpu，并没有限制，Docker可以通过内容进行限制</p>
<p><strong>关键词</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-c/--cpu-shares:控制cpu优先级</span><br><span class="line">--cpuset-cpus:指定使用哪块cpu</span><br></pre></td></tr></table></figure>
<p><strong>实验环境</strong></p>
<p>将计算机调整为单核cpu，内存4G</p>
<p><strong>实验目的</strong></p>
<p>启动多个容器，指定容器使用cpu的优先级</p>
<p><strong>实验步骤</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl start docker</span><br></pre></td></tr></table></figure>
<p>启动一个名为aa的容器，并指定cpu优先级为1024</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -itd --name aa --cpu-shares 1024 centos /bin/bash</span><br><span class="line"><span class="number">196380</span>b6bbb7a044e2aafec7059b37db573f9612f3705d93aa1d8975e94ffad7</span><br></pre></td></tr></table></figure>
<p>在启动一个名为bb的容器，并指定cpu优先级为512</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -itd --name bb --cpu-shares 512 centos /bin/bash</span><br><span class="line"><span class="number">03d</span>ad75a9447768480e758e044857d6306bd73b89bccb2725594ead830d38e28</span><br></pre></td></tr></table></figure>
<p>我们可以在物理机的cgroup目录中看到限制容器使用cpu的优先级，需要用到以上启动容器时返回的容器id</p>
<p>查看aa容器的CPU优先级</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cd /sys/fs/cgroup/cpu/docker/196...ad7</span><br><span class="line"> 可以看到该目录中存放了，docker程序中，aa容器的所有cpu资源的控制项</span><br><span class="line">[root@localhost 196...ad7]# ls</span><br><span class="line">cgroup.clone_children  cpuacct.usage         cpu.rt_period_us   notify_on_release</span><br><span class="line">cgroup.event_control   cpuacct.usage_percpu  cpu.rt_runtime_us  tasks</span><br><span class="line">cgroup.procs           cpu.cfs_period_us     cpu.shares</span><br><span class="line">cpuacct.stat           cpu.cfs_quota_us      cpu.stat</span><br><span class="line">[root@localhost 196...ad7]# cat tasks</span><br><span class="line">3750  # 这个文件里面存放了这个容器在物理机运行的pid号</span><br><span class="line">[root@localhost 196...ad7]# ps aux | grep 3750</span><br><span class="line">root   <span class="number">3750</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">11828</span>  <span class="number">1656</span> pts/<span class="number">0</span>  Ss+  <span class="number">08</span>:<span class="number">29</span>  <span class="number">0</span>:<span class="number">00</span> /bin/bash</span><br><span class="line">root   <span class="number">4369</span>  <span class="number">0.0</span>  <span class="number">0.0</span> <span class="number">112712</span>   <span class="number">956</span> pts/<span class="number">2</span>  R+   <span class="number">08</span>:<span class="number">37</span>  <span class="number">0</span>:<span class="number">00</span> grep --color=auto <span class="number">3750</span></span><br><span class="line"> 查看该容器的cpu优先级</span><br><span class="line"></span><br><span class="line">[root@localhost 196...ad7]# cat cpu.shares</span><br><span class="line"><span class="number">1024</span></span><br></pre></td></tr></table></figure>
<p>查看bb容器的cpu优先级</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">同样是docker目录下的另一个容器</span><br><span class="line">[root@localhost 196...ad7]# cd ../03d...e28/</span><br><span class="line">[root@localhost 03d...e28]# cat cpu.shares</span><br><span class="line"><span class="number">512</span></span><br></pre></td></tr></table></figure>
<p>docker程序的cpu优先级</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost 03d...e28]# cd ..</span><br><span class="line">[root@localhost docker]# cat cpu.shares </span><br><span class="line">1024  # docker在主机内的cpu优先级</span><br><span class="line">[root@localhost docker]# cat tasks</span><br></pre></td></tr></table></figure>
<p><strong>注意目录结构</strong></p>
<p>下载一个docker用来测试的镜像</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker pull progrium/stress</span><br></pre></td></tr></table></figure>
<p>使用测试镜像启动容器，用来测试查看cpu优先级</p>
<p><code>--cpu用来限制cpu工作线程的数量</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -itd --name cc -c 512 progrium/stress --cpu 1</span><br><span class="line"><span class="number">6</span>cff87f45ac88f0a27a250f099dc46d4a2dcdc191f2599a73b3e649a5ed91e80</span><br><span class="line">[root@localhost ~]# docker run -itd --name dd -c 1024 progrium/stress --cpu 1</span><br><span class="line"><span class="number">2</span>a3f49cccb8addc69684bf96d3d95fc438768d98d942c60cd6a5df05b435068a</span><br></pre></td></tr></table></figure>
<p>使用top查看两个测试线程（stress ）的cpu使用率，也就是谁优先使用多少</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# top</span><br><span class="line"> 关键信息如下，一个<span class="number">66.8</span>%，一个<span class="number">32.9</span>%，两个加起来几乎等于<span class="number">100</span></span><br><span class="line">   PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND</span><br><span class="line">  <span class="number">4842</span> root      <span class="number">20</span>   <span class="number">0</span>    <span class="number">7304</span>    <span class="number">100</span>      <span class="number">0</span> R <span class="number">66.8</span>  <span class="number">0.0</span>   <span class="number">1</span>:<span class="number">25.19</span> stress </span><br><span class="line">  <span class="number">4789</span> root      <span class="number">20</span>   <span class="number">0</span>    <span class="number">7304</span>     <span class="number">96</span>      <span class="number">0</span> R <span class="number">32.9</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">58.09</span> stress</span><br></pre></td></tr></table></figure>
<p>cpu的优先级只有在多个容器使用时才生效，说明他俩会抢占cpu资源，如果只有一个容器，即使设置了cpu优先级，它也会把cpu资源尽可能多的去使用</p>
<p>控制容器使用某块cpu<br>分配第一个和第二个cpu给容器（–cpuset只适用于多核cpu时使用）</p>
<p>第一个cpu从0起计算</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name cpu --cpuset-cpus=<span class="string">&quot;0,1&quot;</span> centos /bin/bash</span><br><span class="line">[root@8cb4e22abd77 /]# cat /sys/fs/cgroup/cpuset/cpuset.cpus</span><br><span class="line"><span class="number">0</span>-<span class="number">1</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/27/%E5%AF%B9%E5%AE%B9%E5%99%A8%E8%BF%9B%E8%A1%8C%E5%86%85%E5%AD%98%E5%AE%B9%E9%87%8F%E6%8E%A7%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123.jpg">
      <meta itemprop="name" content="Semaik.">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Semaik.">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/27/%E5%AF%B9%E5%AE%B9%E5%99%A8%E8%BF%9B%E8%A1%8C%E5%86%85%E5%AD%98%E5%AE%B9%E9%87%8F%E6%8E%A7%E5%88%B6/" class="post-title-link" itemprop="url">对容器进行内存容量控制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-27 14:47:00 / 修改时间：14:49:49" itemprop="dateCreated datePublished" datetime="2020-09-27T14:47:00+08:00">2020-09-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

     # 
     #
          <h5 id="对容器内存的限制"><a href="#对容器内存的限制" class="headerlink" title="对容器内存的限制"></a>对容器内存的限制</h5><p>内存分为：物理内存和swap内存</p>
<p><strong>关键词</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--memory：限制内存的使用容量</span><br><span class="line">--memory-swap：限制内存+swap的大小</span><br></pre></td></tr></table></figure>
<p>启动一个限制内存使用的容器testa，如果不指定–memory-swap的话，默认它的大小和内存一样大</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -itd --name testa -m 200M --memory-swap 300M centos /bin/bash</span><br><span class="line">aa90dc55398b2f927c1111bcfa3090502a3b42c3eb538895a1ddadbe556fdf9d</span><br></pre></td></tr></table></figure>
<p>进入容器testa中查看内存和swap大小，在容器中看到的其实也还是物理机的内存大小</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker exec -it testa /bin/bash</span><br><span class="line">[root@aa90dc55398b /]# free -m</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           <span class="number">3770</span>        <span class="number">1051</span>         <span class="number">992</span>          <span class="number">33</span>        <span class="number">1726</span>        <span class="number">2431</span></span><br><span class="line">Swap:          <span class="number">2047</span>           <span class="number">0</span>        <span class="number">2047</span></span><br></pre></td></tr></table></figure>
<p>第二种查看，最为准确，在宿主机的cgroup中查看，内存大小为200M</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /sys/fs/cgroup/memory/docker/aa9...f9d/memory.limit_in_bytes </span><br><span class="line"><span class="number">209715200</span></span><br></pre></td></tr></table></figure>
<p>还可以通过测试也能够测出来</p>
<p>内存+swap总量是300M，内存占200M，所以swap是100M，启动容器运行</p>
<p>测试使用280M是否可以正常运行，一直在输出说明正常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -it -m 200M --memory-swap 300M progrium/stress --vm 1 --vm-bytes 280M</span><br><span class="line">stress: info: [<span class="number">1</span>] dispatching hogs: <span class="number">0</span> cpu, <span class="number">0</span> io, <span class="number">1</span> vm, <span class="number">0</span> hdd</span><br><span class="line">stress: dbug: [<span class="number">1</span>] using backoff sleep of <span class="number">3000</span>us</span><br><span class="line">stress: dbug: [<span class="number">1</span>] --&gt; hogvm worker <span class="number">1</span> [<span class="number">6</span>] forked</span><br><span class="line">stress: dbug: [<span class="number">6</span>] allocating <span class="number">293601280</span> bytes ...</span><br><span class="line">stress: dbug: [<span class="number">6</span>] touching bytes in strides of <span class="number">4096</span> bytes ...</span><br><span class="line">stress: dbug: [<span class="number">6</span>] freed <span class="number">293601280</span> bytes</span><br><span class="line">stress: dbug: [<span class="number">6</span>] allocating <span class="number">293601280</span> bytes ...</span><br><span class="line">stress: dbug: [<span class="number">6</span>] touching bytes in strides of <span class="number">4096</span> bytes ...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>测试使用380M是否可以正常运行，自动跳出，则不能运行，说明380M超出了内存范围</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -it -m 200M --memory-swap 300M progrium/stress --vm 1 --vm-bytes </span><br><span class="line"><span class="number">380</span>M</span><br><span class="line">stress: info: [<span class="number">1</span>] dispatching hogs: <span class="number">0</span> cpu, <span class="number">0</span> io, <span class="number">1</span> vm, <span class="number">0</span> hdd</span><br><span class="line">stress: dbug: [<span class="number">1</span>] using backoff sleep of <span class="number">3000</span>us</span><br><span class="line">stress: dbug: [<span class="number">1</span>] --&gt; hogvm worker <span class="number">1</span> [<span class="number">6</span>] forked</span><br><span class="line">stress: dbug: [<span class="number">6</span>] allocating <span class="number">398458880</span> bytes ...</span><br><span class="line">stress: dbug: [<span class="number">6</span>] touching bytes in strides of <span class="number">4096</span> bytes ...</span><br><span class="line">stress: FAIL: [<span class="number">1</span>] (<span class="number">416</span>) &lt;-- worker <span class="number">6</span> got signal <span class="number">9</span></span><br><span class="line">stress: WARN: [<span class="number">1</span>] (<span class="number">418</span>) now reaping child worker processes</span><br><span class="line">stress: FAIL: [<span class="number">1</span>] (<span class="number">422</span>) kill error: No such process</span><br><span class="line">stress: FAIL: [<span class="number">1</span>] (<span class="number">452</span>) failed run completed in <span class="number">1</span>s</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/27/%E5%AF%B9%E5%AE%B9%E5%99%A8%E8%BF%9B%E8%A1%8C%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99%E9%80%9F%E7%8E%87%E6%8E%A7%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123.jpg">
      <meta itemprop="name" content="Semaik.">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Semaik.">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/27/%E5%AF%B9%E5%AE%B9%E5%99%A8%E8%BF%9B%E8%A1%8C%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99%E9%80%9F%E7%8E%87%E6%8E%A7%E5%88%B6/" class="post-title-link" itemprop="url">对容器进行磁盘读写速率控制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-27 14:45:00 / 修改时间：14:46:43" itemprop="dateCreated datePublished" datetime="2020-09-27T14:45:00+08:00">2020-09-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

     # 
     #
          <h5 id="对容器磁盘读写进行控制"><a href="#对容器磁盘读写进行控制" class="headerlink" title="对容器磁盘读写进行控制"></a>对容器磁盘读写进行控制</h5><p><strong>关键词</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--blkil-weight：硬盘优先级，谁先使用硬盘</span><br><span class="line">bps/iops：bps是每秒读写的数据量，iops是每秒的io次数</span><br><span class="line">都有利于提升数据读取的速度，要么单次读取数据大，要么读取数据小但是次数多</span><br><span class="line">--device-read-bps：磁盘每秒读取速度</span><br><span class="line">--device-write-bps：磁盘每秒写入速度</span><br><span class="line">--device-read-iops：磁盘每秒io读取速度</span><br><span class="line">--device-write-iops：磁盘每秒io写入速度</span><br></pre></td></tr></table></figure>
<h6 id="控制一"><a href="#控制一" class="headerlink" title="控制一"></a>控制一</h6><p>启动一个容器，并限制该容器在磁盘的写入速度为30MB/s</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -it --device-write-bps /dev/sda:30MB centos /bin/bash</span><br></pre></td></tr></table></figure>
<p>使用dd命令测试，发现写入速率为29.9MB/s</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@34b03090013e /]# time dd if=dev/zero of=test.out bs=1M count=800 oflag=direct </span><br><span class="line"> 测试硬盘性能，读取<span class="number">1</span>M的数据，读取<span class="number">800</span>次</span><br><span class="line"><span class="number">800</span>+<span class="number">0</span> records in</span><br><span class="line"><span class="number">800</span>+<span class="number">0</span> records out</span><br><span class="line"><span class="number">838860800</span> bytes (<span class="number">839</span> MB) copied, <span class="number">28.0896</span> s, <span class="number">29.9</span> MB/s</span><br><span class="line"> </span><br><span class="line">real	<span class="number">0</span>m28.<span class="number">217</span>s</span><br><span class="line">user	<span class="number">0</span>m0.<span class="number">006</span>s</span><br><span class="line">sys	<span class="number">0</span>m1.<span class="number">566</span>s</span><br></pre></td></tr></table></figure>
<p>启动一个没有限制磁盘写入的容器，进行相同的测试，写入速率为1.2GB/s，这是正常的写入速率</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@54e235363474 /]# time dd if=dev/zero of=test.out bs=1M count=800 oflag=direct </span><br><span class="line"><span class="number">800</span>+<span class="number">0</span> records in</span><br><span class="line"><span class="number">800</span>+<span class="number">0</span> records out</span><br><span class="line"><span class="number">838860800</span> bytes (<span class="number">839</span> MB) copied, <span class="number">0.715951</span> s, <span class="number">1.2</span> GB/s</span><br><span class="line"> </span><br><span class="line">real	<span class="number">0</span>m0.<span class="number">718</span>s</span><br><span class="line">user	<span class="number">0</span>m0.<span class="number">000</span>s</span><br><span class="line">sys	<span class="number">0</span>m0.<span class="number">633</span>s</span><br></pre></td></tr></table></figure>
<h6 id="控制二"><a href="#控制二" class="headerlink" title="控制二"></a>控制二</h6><p>创建并允许一个容器，使它对硬盘的每秒读写速度不超过100MB</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -it --device-read-bps /dev/sda:100MB --device-write-bps /dev/sda:100MB centos /bin/bash</span><br><span class="line">[root@5e5f92eb145e /]# time dd if=/dev/zero of=test.out bs=1M count=800 oflag=direct </span><br><span class="line"><span class="number">800</span>+<span class="number">0</span> records in</span><br><span class="line"><span class="number">800</span>+<span class="number">0</span> records out</span><br><span class="line"><span class="number">838860800</span> bytes (<span class="number">839</span> MB) copied, <span class="number">7.9597</span> s, <span class="number">105</span> MB/s</span><br><span class="line"> </span><br><span class="line">real	<span class="number">0</span>m7.<span class="number">963</span>s</span><br><span class="line">user	<span class="number">0</span>m0.<span class="number">005</span>s</span><br><span class="line">sys	<span class="number">0</span>m1.<span class="number">966</span>s</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Semaik."
      src="/images/123.jpg">
  <p class="site-author-name" itemprop="name">Semaik.</p>
  <div class="site-description" itemprop="description">直到这一刻微笑着说话为止，我至少留下了一公升眼泪</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">30</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/semaik" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;semaik" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zuxuan8@aliyun.com" title="E-Mail → mailto:zuxuan8@aliyun.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Semaik.</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>
