{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"themes/hexo-theme-next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/images/123.jpg","path":"images/123.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/js/algolia-search.js","path":"js/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/js/bookmark.js","path":"js/bookmark.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/js/local-search.js","path":"js/local-search.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/js/motion.js","path":"js/motion.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/js/next-boot.js","path":"js/next-boot.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/lib/anime.min.js","path":"lib/anime.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/js/schemes/pisces.js","path":"js/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/js/src/clicklove.js","path":"js/src/clicklove.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/lib/font-awesome/css/all.min.css","path":"lib/font-awesome/css/all.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/lib/font-awesome/webfonts/fa-brands-400.woff2","path":"lib/font-awesome/webfonts/fa-brands-400.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/lib/font-awesome/webfonts/fa-regular-400.woff2","path":"lib/font-awesome/webfonts/fa-regular-400.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next/source/lib/font-awesome/webfonts/fa-solid-900.woff2","path":"lib/font-awesome/webfonts/fa-solid-900.woff2","modified":0,"renderable":1},{"_id":"source/images/docker核心组件.png","path":"images/docker核心组件.png","modified":0,"renderable":0},{"_id":"source/images/pasted-0.png","path":"images/pasted-0.png","modified":0,"renderable":0},{"_id":"source/images/pasted-1.png","path":"images/pasted-1.png","modified":0,"renderable":0},{"_id":"source/images/pasted-10.png","path":"images/pasted-10.png","modified":0,"renderable":0},{"_id":"source/images/pasted-100.png","path":"images/pasted-100.png","modified":0,"renderable":0},{"_id":"source/images/pasted-101.png","path":"images/pasted-101.png","modified":0,"renderable":0},{"_id":"source/images/pasted-102.png","path":"images/pasted-102.png","modified":0,"renderable":0},{"_id":"source/images/pasted-103.png","path":"images/pasted-103.png","modified":0,"renderable":0},{"_id":"source/images/pasted-104.png","path":"images/pasted-104.png","modified":0,"renderable":0},{"_id":"source/images/pasted-105.png","path":"images/pasted-105.png","modified":0,"renderable":0},{"_id":"source/images/pasted-11.png","path":"images/pasted-11.png","modified":0,"renderable":0},{"_id":"source/images/pasted-12.png","path":"images/pasted-12.png","modified":0,"renderable":0},{"_id":"source/images/pasted-13.png","path":"images/pasted-13.png","modified":0,"renderable":0},{"_id":"source/images/pasted-14.png","path":"images/pasted-14.png","modified":0,"renderable":0},{"_id":"source/images/pasted-15.png","path":"images/pasted-15.png","modified":0,"renderable":0},{"_id":"source/images/pasted-16.png","path":"images/pasted-16.png","modified":0,"renderable":0},{"_id":"source/images/pasted-17.png","path":"images/pasted-17.png","modified":0,"renderable":0},{"_id":"source/images/pasted-18.png","path":"images/pasted-18.png","modified":0,"renderable":0},{"_id":"source/images/pasted-19.png","path":"images/pasted-19.png","modified":0,"renderable":0},{"_id":"source/images/pasted-2.png","path":"images/pasted-2.png","modified":0,"renderable":0},{"_id":"source/images/pasted-20.png","path":"images/pasted-20.png","modified":0,"renderable":0},{"_id":"source/images/pasted-21.png","path":"images/pasted-21.png","modified":0,"renderable":0},{"_id":"source/images/pasted-22.png","path":"images/pasted-22.png","modified":0,"renderable":0},{"_id":"source/images/pasted-23.png","path":"images/pasted-23.png","modified":0,"renderable":0},{"_id":"source/images/pasted-24.png","path":"images/pasted-24.png","modified":0,"renderable":0},{"_id":"source/images/pasted-25.png","path":"images/pasted-25.png","modified":0,"renderable":0},{"_id":"source/images/pasted-26.png","path":"images/pasted-26.png","modified":0,"renderable":0},{"_id":"source/images/pasted-27.png","path":"images/pasted-27.png","modified":0,"renderable":0},{"_id":"source/images/pasted-28.png","path":"images/pasted-28.png","modified":0,"renderable":0},{"_id":"source/images/pasted-29.png","path":"images/pasted-29.png","modified":0,"renderable":0},{"_id":"source/images/pasted-3.png","path":"images/pasted-3.png","modified":0,"renderable":0},{"_id":"source/images/pasted-30.png","path":"images/pasted-30.png","modified":0,"renderable":0},{"_id":"source/images/pasted-31.png","path":"images/pasted-31.png","modified":0,"renderable":0},{"_id":"source/images/pasted-32.png","path":"images/pasted-32.png","modified":0,"renderable":0},{"_id":"source/images/pasted-33.png","path":"images/pasted-33.png","modified":0,"renderable":0},{"_id":"source/images/pasted-34.png","path":"images/pasted-34.png","modified":0,"renderable":0},{"_id":"source/images/pasted-35.png","path":"images/pasted-35.png","modified":0,"renderable":0},{"_id":"source/images/pasted-36.png","path":"images/pasted-36.png","modified":0,"renderable":0},{"_id":"source/images/pasted-37.png","path":"images/pasted-37.png","modified":0,"renderable":0},{"_id":"source/images/pasted-38.png","path":"images/pasted-38.png","modified":0,"renderable":0},{"_id":"source/images/pasted-39.png","path":"images/pasted-39.png","modified":0,"renderable":0},{"_id":"source/images/pasted-4.png","path":"images/pasted-4.png","modified":0,"renderable":0},{"_id":"source/images/pasted-40.png","path":"images/pasted-40.png","modified":0,"renderable":0},{"_id":"source/images/pasted-41.png","path":"images/pasted-41.png","modified":0,"renderable":0},{"_id":"source/images/pasted-42.png","path":"images/pasted-42.png","modified":0,"renderable":0},{"_id":"source/images/pasted-43.png","path":"images/pasted-43.png","modified":0,"renderable":0},{"_id":"source/images/pasted-44.png","path":"images/pasted-44.png","modified":0,"renderable":0},{"_id":"source/images/pasted-45.png","path":"images/pasted-45.png","modified":0,"renderable":0},{"_id":"source/images/pasted-46.png","path":"images/pasted-46.png","modified":0,"renderable":0},{"_id":"source/images/pasted-47.png","path":"images/pasted-47.png","modified":0,"renderable":0},{"_id":"source/images/pasted-48.png","path":"images/pasted-48.png","modified":0,"renderable":0},{"_id":"source/images/pasted-49.png","path":"images/pasted-49.png","modified":0,"renderable":0},{"_id":"source/images/pasted-5.png","path":"images/pasted-5.png","modified":0,"renderable":0},{"_id":"source/images/pasted-50.png","path":"images/pasted-50.png","modified":0,"renderable":0},{"_id":"source/images/pasted-51.png","path":"images/pasted-51.png","modified":0,"renderable":0},{"_id":"source/images/pasted-52.png","path":"images/pasted-52.png","modified":0,"renderable":0},{"_id":"source/images/pasted-53.png","path":"images/pasted-53.png","modified":0,"renderable":0},{"_id":"source/images/pasted-54.png","path":"images/pasted-54.png","modified":0,"renderable":0},{"_id":"source/images/pasted-55.png","path":"images/pasted-55.png","modified":0,"renderable":0},{"_id":"source/images/pasted-56.png","path":"images/pasted-56.png","modified":0,"renderable":0},{"_id":"source/images/pasted-57.png","path":"images/pasted-57.png","modified":0,"renderable":0},{"_id":"source/images/pasted-58.png","path":"images/pasted-58.png","modified":0,"renderable":0},{"_id":"source/images/pasted-59.png","path":"images/pasted-59.png","modified":0,"renderable":0},{"_id":"source/images/pasted-6.png","path":"images/pasted-6.png","modified":0,"renderable":0},{"_id":"source/images/pasted-60.png","path":"images/pasted-60.png","modified":0,"renderable":0},{"_id":"source/images/pasted-61.png","path":"images/pasted-61.png","modified":0,"renderable":0},{"_id":"source/images/pasted-62.png","path":"images/pasted-62.png","modified":0,"renderable":0},{"_id":"source/images/pasted-63.png","path":"images/pasted-63.png","modified":0,"renderable":0},{"_id":"source/images/pasted-64.png","path":"images/pasted-64.png","modified":0,"renderable":0},{"_id":"source/images/pasted-65.png","path":"images/pasted-65.png","modified":0,"renderable":0},{"_id":"source/images/pasted-66.png","path":"images/pasted-66.png","modified":0,"renderable":0},{"_id":"source/images/pasted-67.png","path":"images/pasted-67.png","modified":0,"renderable":0},{"_id":"source/images/pasted-68.png","path":"images/pasted-68.png","modified":0,"renderable":0},{"_id":"source/images/pasted-69.png","path":"images/pasted-69.png","modified":0,"renderable":0},{"_id":"source/images/pasted-7.png","path":"images/pasted-7.png","modified":0,"renderable":0},{"_id":"source/images/pasted-70.png","path":"images/pasted-70.png","modified":0,"renderable":0},{"_id":"source/images/pasted-71.png","path":"images/pasted-71.png","modified":0,"renderable":0},{"_id":"source/images/pasted-72.png","path":"images/pasted-72.png","modified":0,"renderable":0},{"_id":"source/images/pasted-73.png","path":"images/pasted-73.png","modified":0,"renderable":0},{"_id":"source/images/pasted-74.png","path":"images/pasted-74.png","modified":0,"renderable":0},{"_id":"source/images/pasted-75.png","path":"images/pasted-75.png","modified":0,"renderable":0},{"_id":"source/images/pasted-76.png","path":"images/pasted-76.png","modified":0,"renderable":0},{"_id":"source/images/pasted-77.png","path":"images/pasted-77.png","modified":0,"renderable":0},{"_id":"source/images/pasted-78.png","path":"images/pasted-78.png","modified":0,"renderable":0},{"_id":"source/images/pasted-79.png","path":"images/pasted-79.png","modified":0,"renderable":0},{"_id":"source/images/pasted-8.png","path":"images/pasted-8.png","modified":0,"renderable":0},{"_id":"source/images/pasted-80.png","path":"images/pasted-80.png","modified":0,"renderable":0},{"_id":"source/images/pasted-81.png","path":"images/pasted-81.png","modified":0,"renderable":0},{"_id":"source/images/pasted-82.png","path":"images/pasted-82.png","modified":0,"renderable":0},{"_id":"source/images/pasted-83.png","path":"images/pasted-83.png","modified":0,"renderable":0},{"_id":"source/images/pasted-84.png","path":"images/pasted-84.png","modified":0,"renderable":0},{"_id":"source/images/pasted-85.png","path":"images/pasted-85.png","modified":0,"renderable":0},{"_id":"source/images/pasted-86.png","path":"images/pasted-86.png","modified":0,"renderable":0},{"_id":"source/images/pasted-87.png","path":"images/pasted-87.png","modified":0,"renderable":0},{"_id":"source/images/pasted-88.png","path":"images/pasted-88.png","modified":0,"renderable":0},{"_id":"source/images/pasted-89.png","path":"images/pasted-89.png","modified":0,"renderable":0},{"_id":"source/images/pasted-9.png","path":"images/pasted-9.png","modified":0,"renderable":0},{"_id":"source/images/pasted-90.png","path":"images/pasted-90.png","modified":0,"renderable":0},{"_id":"source/images/pasted-91.png","path":"images/pasted-91.png","modified":0,"renderable":0},{"_id":"source/images/pasted-92.png","path":"images/pasted-92.png","modified":0,"renderable":0},{"_id":"source/images/pasted-93.png","path":"images/pasted-93.png","modified":0,"renderable":0},{"_id":"source/images/pasted-94.png","path":"images/pasted-94.png","modified":0,"renderable":0},{"_id":"source/images/pasted-95.png","path":"images/pasted-95.png","modified":0,"renderable":0},{"_id":"source/images/pasted-96.png","path":"images/pasted-96.png","modified":0,"renderable":0},{"_id":"source/images/pasted-97.png","path":"images/pasted-97.png","modified":0,"renderable":0},{"_id":"source/images/pasted-98.png","path":"images/pasted-98.png","modified":0,"renderable":0},{"_id":"source/images/pasted-99.png","path":"images/pasted-99.png","modified":0,"renderable":0},{"_id":"source/images/test0.png","path":"images/test0.png","modified":0,"renderable":0},{"_id":"source/images/test1.png","path":"images/test1.png","modified":0,"renderable":0},{"_id":"source/images/test2.png","path":"images/test2.png","modified":0,"renderable":0},{"_id":"source/images/timg.jpg","path":"images/timg.jpg","modified":0,"renderable":0},{"_id":"source/images/timg2.png","path":"images/timg2.png","modified":0,"renderable":0}],"Cache":[{"_id":"source/_drafts/Haproxy-Keepalived高可用负载均衡构建.md","hash":"42f0002b87d0d30d9c5822ff5376169a37e05f95","modified":1600774105414},{"_id":"source/_posts/Centos7部署轻量级自动化运维工具pssh.md","hash":"0b1f28bb11f044bf0cd70cf2b9d7248d945f16ef","modified":1602575456522},{"_id":"source/_posts/Ansible常用模块.md","hash":"1956f2a808657c043d3183b4b2a2f592e7c17592","modified":1600433168419},{"_id":"source/_posts/Dockerfile构建Ngxin镜像.md","hash":"9e11beef4b92f387cfe087bb8e6b2780542d3afa","modified":1604387037433},{"_id":"source/_drafts/Samba文件共享服务.md","hash":"75ae20aa46f40d19d03d72a875ab66b38466d473","modified":1601002496646},{"_id":"source/_posts/Docker基础操作逻辑命令.md","hash":"13ce0a7b142bab541b956cacaaa06b53cc18a47c","modified":1599730109395},{"_id":"source/_posts/Docker的安装-镜像加速及理论.md","hash":"8c8e9aa4bb000b11e301ab77b531d963505386e4","modified":1599728821969},{"_id":"source/_posts/Ansible自动化运维工具.md","hash":"e464fe9c6e7a8873d6e3e9a0821ac5d1b3953789","modified":1600421530828},{"_id":"source/_posts/Dockerfile文件.md","hash":"ebc6dd02056452a0e1edae51c3f2310e1e66e885","modified":1601189034931},{"_id":"source/_posts/HTTP方式共享YUM软件仓库.md","hash":"35570eca4ff5380b77075889592452cd494c3976","modified":1602574084042},{"_id":"source/_posts/Hexo如何发布文章.md","hash":"36768eca85f40bc224198629e838a9f18f77c4c8","modified":1599714738081},{"_id":"source/_posts/Keepalived.md","hash":"820065fe797d8f8925ae47d9f46808c53a6684e9","modified":1604455117148},{"_id":"source/_posts/Docker部署nginx及web集群.md","hash":"d7bf7d536e6f6dfb7bce8cbe3c723a76f4901a68","modified":1599731232176},{"_id":"source/_posts/Docker私有仓库.md","hash":"2c281ea2caf689e21b0224f5df3756da7ae4179c","modified":1599730780097},{"_id":"source/_posts/Linux权限管理之ACL权限.md","hash":"0e2b0174038c71410b861d83afef7efcb22d0143","modified":1600918004838},{"_id":"source/_posts/Linux-双网卡绑定.md","hash":"ede135829bd8e08a36f7a804bce0524cb88a74eb","modified":1600767225616},{"_id":"source/_posts/Linux环境更新Python3-8.md","hash":"330364ea237ca91571f8d3b828ed15ab2cb57f36","modified":1604380406097},{"_id":"source/_posts/commit构建镜像.md","hash":"1a6c0df3a228a57f15d746773ea6511c3a42eb4a","modified":1599730909692},{"_id":"source/_posts/Tomcat.md","hash":"115cbd3b2fc07674f2fba04d49be0a3a9f5aeb76","modified":1601002333964},{"_id":"source/_posts/Linux高效文件处理三剑客.md","hash":"e67918e2d055caf3fdd5f3155468d9a50c94e63c","modified":1600689210235},{"_id":"source/_posts/使用SSH连接Docker容器.md","hash":"ace9f9998835cf32ebf7a1130ac630b4ad020cf7","modified":1601189957978},{"_id":"source/_posts/k8s重新生成Tocken并加入集群.md","hash":"c81a27453163f17a487aa03cbeecac9c0a8932fe","modified":1599719193006},{"_id":"source/_posts/Hexo添加分类和标签.md","hash":"38830f610aa7e2d0c1a5ae0b36fdd2d7a0ec4800","modified":1599715617702},{"_id":"source/_posts/实现容器的底层技术.md","hash":"0762210cfdcb817d93b2ce04071d864448fe1e5a","modified":1601190770780},{"_id":"source/_posts/对容器进行cpu的使用控制.md","hash":"188717ed9014d4ecd9f709e45b43e4455c57dc5a","modified":1601189654057},{"_id":"source/_posts/对容器进行内存容量控制.md","hash":"6a99a57a2a1954688af9186cc2bfa8e87096f908","modified":1601189389677},{"_id":"source/_posts/对容器进行磁盘读写速率控制.md","hash":"01737ef05befba8770be42f0f977e20f26f953f9","modified":1601189203594},{"_id":"source/_posts/强制修改Linux系统的Root密码的办法.md","hash":"f2b45002388ef344a0fade3cbb607628dcc514fd","modified":1600433146610},{"_id":"source/_posts/本地MySQL数据库迁移到阿里云RDS.md","hash":"44a52acda05755b41e52a91476782559f4acb29e","modified":1599809604994},{"_id":"source/_posts/解决在Docker容器中不能使用system管理.md","hash":"062568985a6dfc3656824a9ff179048e69b19c5e","modified":1601190171353},{"_id":"source/_posts/升级Openssh详细步骤.md","hash":"c87a58cb168a00c2e9203943831746d2da487830","modified":1599961522787},{"_id":"source/about/index.md","hash":"f150052f33309992559adc2718b960b073bcc623","modified":1599715069607},{"_id":"source/categories/index.md","hash":"543f89dd65e32d1b8e5738dc085f94bb77ce414e","modified":1599714957431},{"_id":"source/images/pasted-10.png","hash":"15f23d3c3e3fb61063e8e2c3e1b15236fe503582","modified":1599727544363},{"_id":"source/images/pasted-1.png","hash":"0fa8fe4c58350c00a4c91bd462592629ad98483a","modified":1599725575105},{"_id":"source/images/pasted-100.png","hash":"c63d85255c5a2b200e5cf108abda90e03183eb31","modified":1602573862047},{"_id":"source/images/pasted-103.png","hash":"1fe7086da5619b9a9888be4c1e4a1d2023bfa4ac","modified":1604379238987},{"_id":"source/images/pasted-104.png","hash":"c65b1d44677dc76cd93c49799ef9d5234b98b82f","modified":1604379288457},{"_id":"source/images/pasted-105.png","hash":"b5d799cdfa76c41ffa59d99c268bfab597ff2f4a","modified":1604379825598},{"_id":"source/_posts/hello-world.md","hash":"7d98d6592de80fdcd2949bd7401cec12afd98cdf","modified":1599701468375},{"_id":"source/images/pasted-14.png","hash":"d943a03bce0cb802075089b910ad4bee23780019","modified":1599728712965},{"_id":"source/images/pasted-16.png","hash":"bcbc29e25a28ec81efadba07da61623e48ec9c47","modified":1599729891800},{"_id":"source/images/pasted-17.png","hash":"0a097efa6d08d27bd503f2ff5e6930fd6aa48744","modified":1599729918707},{"_id":"source/images/pasted-20.png","hash":"01a61fb7702f724fe4690e557bb17d3d8c319c2c","modified":1599730977512},{"_id":"source/images/pasted-18.png","hash":"322f56c1ca6737656963b9c4a44469e6a753675e","modified":1599729927705},{"_id":"source/images/pasted-19.png","hash":"a6e07bff091b09ebd29abed7c4a877eff1a94197","modified":1599729935473},{"_id":"source/images/pasted-21.png","hash":"e727787ef9737f1c887e2cb6eb65bc65a97db1dc","modified":1599731020397},{"_id":"source/images/pasted-23.png","hash":"d9719ed89df46f9c326a6093c4870f750d245f6c","modified":1599731068559},{"_id":"source/images/pasted-22.png","hash":"8ac9d954173e8a04d93e1c77829851ade1332cce","modified":1599731036074},{"_id":"source/images/pasted-24.png","hash":"a4f237623924564bd598921226719f266f31dfdb","modified":1599731089049},{"_id":"source/images/pasted-2.png","hash":"eac273d7354e2f486fe7377a4549d3c0edbf7f24","modified":1599726856760},{"_id":"source/images/pasted-25.png","hash":"6df800c6ce15eb7bbe15bf18e21f48f9c488ca38","modified":1599731092474},{"_id":"source/images/pasted-26.png","hash":"406b0e845577a6381fc70357676f9c0d40db1527","modified":1599731112196},{"_id":"source/images/pasted-27.png","hash":"bea8fe3b887b43fc4274032c6057fcf5d8731e31","modified":1599731114857},{"_id":"source/images/pasted-28.png","hash":"43f8473ab279478e1d001d31b3bc5eb3ad8f2afb","modified":1599731118285},{"_id":"source/images/pasted-29.png","hash":"b202dfbff12c77ee9dc8870f4de1ec6c9b45cf62","modified":1599731129088},{"_id":"source/images/pasted-31.png","hash":"7b8d5fbe68763a4aad9dd514600c55213996a886","modified":1599731136899},{"_id":"source/images/pasted-32.png","hash":"dede4107ca872397d683a36729013e93c158edb9","modified":1599731140287},{"_id":"source/images/pasted-33.png","hash":"89fc1551139b035ebfacfff19f6d1ec34032775f","modified":1599731146940},{"_id":"source/images/pasted-30.png","hash":"02685a6fb75eb36ec04f02543c7ceddaa1deecca","modified":1599731133321},{"_id":"source/images/pasted-35.png","hash":"1e0b8ef74adfd48e604a9bde094eb2268af54a17","modified":1599731155287},{"_id":"source/images/pasted-34.png","hash":"443ae0674c516e9d6479df195756b7131d49b6f8","modified":1599731151350},{"_id":"source/images/pasted-36.png","hash":"59237f14cc10fa3542b9e9671470b993130d72de","modified":1599731166663},{"_id":"source/images/pasted-37.png","hash":"3a0395f3677f7a498787be74a5e19a0777097e8a","modified":1599731170603},{"_id":"source/images/pasted-38.png","hash":"5d26f27ab4d8558ffefb6ebf8b2e14818633e7b8","modified":1599731194522},{"_id":"source/images/pasted-39.png","hash":"dd1385917785e360d1007e2e0e9a98c6468ae7d4","modified":1599731199035},{"_id":"source/images/pasted-40.png","hash":"de2f7acce6f9793da64769210f1881b51b970388","modified":1599731204240},{"_id":"source/images/pasted-4.png","hash":"e711e02eafcde7329c3eac80b9c2517f9008bb2d","modified":1599726999112},{"_id":"source/images/pasted-41.png","hash":"f8c5bb33a120bac9db34a1e441e93efa2b088734","modified":1600999937040},{"_id":"source/images/pasted-42.png","hash":"874b4650c51d934a0f4a4746e8c4cc6db1ede6ea","modified":1600999981628},{"_id":"source/images/pasted-44.png","hash":"1aa48b167c1b0561736e99172068fe994ab2bd71","modified":1601000449221},{"_id":"source/images/pasted-43.png","hash":"85c00fd5e57d7f0f21683947a91d4acfa58b1346","modified":1601000294853},{"_id":"source/images/pasted-45.png","hash":"781993dbb3af13a1462864ae4ab5ba894653e913","modified":1601000698080},{"_id":"source/images/pasted-46.png","hash":"fd39f33c32520fbc4cb7de4a9c45d29ea348299f","modified":1601000759107},{"_id":"source/images/pasted-5.png","hash":"55ff9b3ad23709179c1f45cfa72d95c2de0882d9","modified":1599727033794},{"_id":"source/images/pasted-47.png","hash":"eeb1360f1fe1e56b77131dd806ea10a95d18199d","modified":1601000930651},{"_id":"source/images/pasted-54.png","hash":"b20ed4df178da12a446551860f4a62de0b305e48","modified":1601001175757},{"_id":"source/images/pasted-52.png","hash":"9d290888dfb9c5c349a32c5592d75e49395e162b","modified":1601001026357},{"_id":"source/images/pasted-55.png","hash":"97535bf000b64f52f42d72409c84b76722175203","modified":1601001289719},{"_id":"source/images/pasted-51.png","hash":"3523936fbccaeebf8c0cd0147d22ce844feca568","modified":1601001004110},{"_id":"source/images/pasted-58.png","hash":"931fe52e406707eb54818b775c94cbc405e28451","modified":1601001439479},{"_id":"source/images/pasted-57.png","hash":"cb95f88a8479d5ddedc5e3059aee19b33cc0496a","modified":1601001436276},{"_id":"source/images/pasted-6.png","hash":"feca501c50aad73ee1f3d7cde25f2eb5c068bafd","modified":1599727042902},{"_id":"source/images/pasted-60.png","hash":"49e263ec44ebaa4a11fdd7dbd1a6dc11e0627a3e","modified":1601001593174},{"_id":"source/images/pasted-63.png","hash":"a786fd8a3c92aa73a8dde4c21083aec607148112","modified":1601001886376},{"_id":"source/images/pasted-59.png","hash":"db67e1f607ee28adf6112b505cc771d626d5e058","modified":1601001543736},{"_id":"source/images/pasted-62.png","hash":"ff2838d81b72ac2046f76917ad4190f42e482f43","modified":1601001860295},{"_id":"source/images/pasted-68.png","hash":"2ed887aed03ca52c8dc5cdd1449eda06d94eb44d","modified":1601001934223},{"_id":"source/images/pasted-69.png","hash":"99d4a4e8356eb7c187323fbfae4387b02822b86c","modified":1601001968647},{"_id":"source/images/pasted-7.png","hash":"d45a144dc69af087657793709971f320a312713a","modified":1599727065521},{"_id":"source/images/pasted-71.png","hash":"084776b38e96b2f7e9c5af1de15f272e9d5d6f6d","modified":1601001996803},{"_id":"source/images/pasted-72.png","hash":"3c607bbefe56313ab88e291450bd992a90e7e995","modified":1601002018109},{"_id":"source/images/pasted-75.png","hash":"22b37a85ac0c8de3b470335274fb61d9a1b41f7d","modified":1601002146730},{"_id":"source/images/pasted-70.png","hash":"ab5ff4cd3610b9bfbea9b2361dca7dd62500c723","modified":1601001979809},{"_id":"source/images/pasted-76.png","hash":"e44d987a1ef9ed6df22610c64deafb00de4c3286","modified":1601002194059},{"_id":"source/images/pasted-73.png","hash":"680318d462ea5460db53d56a769e58ad12926fe1","modified":1601002027515},{"_id":"source/images/pasted-74.png","hash":"de39c8a94b87e29cee5ced7f87ec9f515484fc66","modified":1601002048427},{"_id":"source/images/pasted-8.png","hash":"3d21e6fe4d73107bd8d111be4c795979c69c75a9","modified":1599727099598},{"_id":"source/images/pasted-78.png","hash":"ef8e7566326e9552cbad011cc78c00383fa826bb","modified":1601002267430},{"_id":"source/images/pasted-86.png","hash":"80408c92a3f45e738b52445d1caa8995ba631a8e","modified":1601190120808},{"_id":"source/images/pasted-85.png","hash":"30c0d3326bbf106f85846dfc91423290b40c2c85","modified":1601190028667},{"_id":"source/images/pasted-88.png","hash":"ef5d9c98d19d3e4efd80d3078218ccfe3ae6f3e5","modified":1601190163103},{"_id":"source/images/pasted-9.png","hash":"95ac60dda409ebac267be11c4b551ca4d9dcbdfb","modified":1599727132241},{"_id":"source/images/pasted-89.png","hash":"ef5d9c98d19d3e4efd80d3078218ccfe3ae6f3e5","modified":1601190250709},{"_id":"source/images/pasted-87.png","hash":"c2d5c1eba09e31d2ca5ab2d851ba4ccc0f21a6e0","modified":1601190131323},{"_id":"source/images/pasted-91.png","hash":"cda74229eca708c3e57051645353dedc0ed8aa04","modified":1601190325430},{"_id":"source/images/pasted-92.png","hash":"a5999e3810591d215b300b8634953ad1a04e2f04","modified":1601190569953},{"_id":"source/images/pasted-93.png","hash":"b4e52799052765da3df20421a735a824f068f54c","modified":1601190581564},{"_id":"source/images/pasted-94.png","hash":"e6775b52c0e1288910a571091e1ae4fc37b5aa3c","modified":1601190611112},{"_id":"source/images/pasted-95.png","hash":"d01a34b4e250ab716b090b0c11862e177485be27","modified":1601190655123},{"_id":"source/images/pasted-96.png","hash":"6e945296149944137bcdb9631b2b4aa3bd71fd7a","modified":1601190677350},{"_id":"source/images/pasted-97.png","hash":"a6fa1ba623821d769f8210e3c176b6b97bcd39e1","modified":1601190688509},{"_id":"source/images/pasted-98.png","hash":"c6a8c88555ae4654de9841bc4cfb9bf609b9876a","modified":1601190698730},{"_id":"source/images/test2.png","hash":"5fb82c42590c92d6d42033149ff96043e616fd99","modified":1600417335689},{"_id":"source/images/pasted-99.png","hash":"c63d85255c5a2b200e5cf108abda90e03183eb31","modified":1602573861938},{"_id":"source/images/timg.jpg","hash":"4a277e3710912cf0b991fe39e2cc8e46e95912e2","modified":1600420516436},{"_id":"source/images/test0.png","hash":"b9342f8bd45cc2170225f5f0b203bae775301294","modified":1600417320318},{"_id":"source/images/test1.png","hash":"457c9a778fd6a9fba7f29f21d92dffec7f1f8b74","modified":1600417147986},{"_id":"source/images/pasted-101.png","hash":"0dc28ee82a773386fa1530b99d0315860bcdb7fb","modified":1604378707673},{"_id":"source/images/pasted-0.png","hash":"1eaf2b5cedfca83da876952ec91ad0adfcd71091","modified":1599725203012},{"_id":"source/images/pasted-102.png","hash":"bf7898cc2a64680c847dc2c69100c9eb5b574de4","modified":1604378769335},{"_id":"source/images/pasted-12.png","hash":"cfbe82c4e6dafb6a0336b70fa168006f29b039e1","modified":1599727615159},{"_id":"source/images/pasted-3.png","hash":"41a868f5e506958e684cc60e2d62a229f0e2ebf8","modified":1599726954961},{"_id":"source/images/pasted-48.png","hash":"ab86459a06644503b1cb9e1f7404e7d465714fa7","modified":1601000978148},{"_id":"source/images/pasted-49.png","hash":"5565696564c8239c3de54c145c2263141ab78b84","modified":1601000981461},{"_id":"source/images/pasted-56.png","hash":"73c190d8eabf935b73cd40ae770f68baa0c2fea6","modified":1601001422788},{"_id":"source/images/pasted-50.png","hash":"f936f2e1c4aa79b6d19d0bb6fbc211fc9b1acd91","modified":1601000983902},{"_id":"source/images/pasted-61.png","hash":"8f9d510d762400c5cb8d992f8fd1f3601f012dda","modified":1601001597717},{"_id":"source/images/pasted-64.png","hash":"e85e05b21c7331484c993dd94db59932fd2dd59c","modified":1601001895939},{"_id":"source/images/pasted-77.png","hash":"1cea5bf2c46af32ea7ebc9fc7d3773e5039c8c27","modified":1601002197873},{"_id":"source/images/pasted-79.png","hash":"b957a36cf77cde051b16cf13ea46d4265c3fd905","modified":1601002272113},{"_id":"source/images/pasted-82.png","hash":"3281a39bae0e6aa24b5a69ced392dddda8da0256","modified":1601188190065},{"_id":"source/tags/index.md","hash":"6dc8da96feb4c93654afd97b03a8b571fb3995e4","modified":1599714947122},{"_id":"source/images/timg2.png","hash":"a8463df09371ab0342881ae37f4f024e6bb3c6bb","modified":1600429753802},{"_id":"source/images/pasted-11.png","hash":"627c7f40319d111221a2bf42a7a85e7dd57ece37","modified":1599727559524},{"_id":"source/images/pasted-13.png","hash":"1e8b0da1b5a3b6faf102fe1f4d4a16867b5e903c","modified":1599727646142},{"_id":"source/images/pasted-65.png","hash":"743fd0abfa44b7e2bf44da8247d59552bbccde00","modified":1601001901422},{"_id":"source/images/pasted-66.png","hash":"743fd0abfa44b7e2bf44da8247d59552bbccde00","modified":1601001902657},{"_id":"source/images/pasted-81.png","hash":"37f46e60409c2c2209b43bb882978e2a2e83bd0b","modified":1601188137427},{"_id":"source/images/pasted-67.png","hash":"743fd0abfa44b7e2bf44da8247d59552bbccde00","modified":1601001912450},{"_id":"source/images/pasted-53.png","hash":"6fcb8414f72a42cc506dea206d8333bb3cd51938","modified":1601001168861},{"_id":"source/images/docker核心组件.png","hash":"f86df71319e63584a47e3fbb9e6b864610356271","modified":1599721942000},{"_id":"themes/hexo-theme-next/.eslintrc.json","hash":"cc5f297f0322672fe3f684f823bc4659e4a54c41","modified":1599706741062},{"_id":"themes/hexo-theme-next/.gitattributes","hash":"a54f902957d49356376b59287b894b1a3d7a003f","modified":1599706741062},{"_id":"themes/hexo-theme-next/.gitignore","hash":"56f3470755c20311ddd30d421b377697a6e5e68b","modified":1599706741063},{"_id":"themes/hexo-theme-next/.stylintrc","hash":"2cf4d637b56d8eb423f59656a11f6403aa90f550","modified":1599706741063},{"_id":"themes/hexo-theme-next/README.md","hash":"9b4b7d66aca47f9c65d6321b14eef48d95c4dff1","modified":1599706741063},{"_id":"themes/hexo-theme-next/_config.yml","hash":"6e67e918a87992f7f451efc18ba62965787a39fd","modified":1601187001575},{"_id":"themes/hexo-theme-next/.editorconfig","hash":"8570735a8d8d034a3a175afd1dd40b39140b3e6a","modified":1599706741062},{"_id":"themes/hexo-theme-next/.travis.yml","hash":"ecca3b919a5b15886e3eca58aa84aafc395590da","modified":1599706741063},{"_id":"themes/hexo-theme-next/LICENSE.md","hash":"18144d8ed58c75af66cb419d54f3f63374cd5c5b","modified":1599706741063},{"_id":"themes/hexo-theme-next/package.json","hash":"62fad6de02adbbba9fb096cbe2dcc15fe25f2435","modified":1599706741070},{"_id":"themes/hexo-theme-next/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1599706741063},{"_id":"themes/hexo-theme-next/.github/CODE_OF_CONDUCT.md","hash":"aa4cb7aff595ca628cb58160ee1eee117989ec4e","modified":1599706741062},{"_id":"themes/hexo-theme-next/_config.yml.bak","hash":"fdfbc4b21b3cc151d9cdbad54e00c326f1410d1b","modified":1599717164853},{"_id":"themes/hexo-theme-next/.github/PULL_REQUEST_TEMPLATE.md","hash":"1a435c20ae8fa183d49bbf96ac956f7c6c25c8af","modified":1599706741062},{"_id":"themes/hexo-theme-next/.github/issue-close-app.yml","hash":"7cba457eec47dbfcfd4086acd1c69eaafca2f0cd","modified":1599706741062},{"_id":"themes/hexo-theme-next/gulpfile.js","hash":"1b4fc262b89948937b9e3794de812a7c1f2f3592","modified":1599706741065},{"_id":"themes/hexo-theme-next/.github/lock.yml","hash":"61173b9522ebac13db2c544e138808295624f7fd","modified":1599706741062},{"_id":"themes/hexo-theme-next/.github/config.yml","hash":"1d3f4e8794986817c0fead095c74f756d45f91ed","modified":1599706741062},{"_id":"themes/hexo-theme-next/.github/mergeable.yml","hash":"0ee56e23bbc71e1e76427d2bd255a9879bd36e22","modified":1599706741063},{"_id":"themes/hexo-theme-next/.github/issue_label_bot.yaml","hash":"fca600ddef6f80c5e61aeed21722d191e5606e5b","modified":1599706741062},{"_id":"themes/hexo-theme-next/.github/release-drafter.yml","hash":"3cc10ce75ecc03a5ce86b00363e2a17eb65d15ea","modified":1599706741063},{"_id":"themes/hexo-theme-next/.github/support.yml","hash":"d75db6ffa7b4ca3b865a925f9de9aef3fc51925c","modified":1599706741063},{"_id":"themes/hexo-theme-next/.github/stale.yml","hash":"fdf82de9284f8bc8e0b0712b4cc1cb081a94de59","modified":1599706741063},{"_id":"themes/hexo-theme-next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1599706741063},{"_id":"themes/hexo-theme-next/docs/ALGOLIA-SEARCH.md","hash":"c7a994b9542040317d8f99affa1405c143a94a38","modified":1599706741063},{"_id":"themes/hexo-theme-next/docs/AUTHORS.md","hash":"10135a2f78ac40e9f46b3add3e360c025400752f","modified":1599706741064},{"_id":"themes/hexo-theme-next/docs/DATA-FILES.md","hash":"cddbdc91ee9e65c37a50bec12194f93d36161616","modified":1599706741064},{"_id":"themes/hexo-theme-next/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"94dc3404ccb0e5f663af2aa883c1af1d6eae553d","modified":1599706741064},{"_id":"themes/hexo-theme-next/docs/INSTALLATION.md","hash":"af88bcce035780aaa061261ed9d0d6c697678618","modified":1599706741064},{"_id":"themes/hexo-theme-next/docs/LICENSE.txt","hash":"368bf2c29d70f27d8726dd914f1b3211cae4bbab","modified":1599706741064},{"_id":"themes/hexo-theme-next/languages/ar.yml","hash":"9815e84e53d750c8bcbd9193c2d44d8d910e3444","modified":1599706741065},{"_id":"themes/hexo-theme-next/languages/en.yml","hash":"45bc5118828bdc72dcaa25282cd367c8622758cb","modified":1599706741065},{"_id":"themes/hexo-theme-next/languages/default.yml","hash":"45bc5118828bdc72dcaa25282cd367c8622758cb","modified":1599706741065},{"_id":"themes/hexo-theme-next/languages/de.yml","hash":"74c59f2744217003b717b59d96e275b54635abf5","modified":1599706741065},{"_id":"themes/hexo-theme-next/languages/es.yml","hash":"c64cf05f356096f1464b4b1439da3c6c9b941062","modified":1599706741065},{"_id":"themes/hexo-theme-next/languages/fr.yml","hash":"752bf309f46a2cd43890b82300b342d7218d625f","modified":1599706741065},{"_id":"themes/hexo-theme-next/languages/fa.yml","hash":"3676b32fda37e122f3c1a655085a1868fb6ad66b","modified":1599706741065},{"_id":"themes/hexo-theme-next/languages/hu.yml","hash":"b1ebb77a5fd101195b79f94de293bcf9001d996f","modified":1599706741065},{"_id":"themes/hexo-theme-next/languages/it.yml","hash":"44759f779ce9c260b895532de1d209ad4bd144bf","modified":1599706741066},{"_id":"themes/hexo-theme-next/languages/ja.yml","hash":"0cf0baa663d530f22ff380a051881216d6adcdd8","modified":1599706741066},{"_id":"themes/hexo-theme-next/languages/ko.yml","hash":"0feea9e43cd399f3610b94d755a39fff1d371e97","modified":1599706741066},{"_id":"themes/hexo-theme-next/languages/nl.yml","hash":"5af3473d9f22897204afabc08bb984b247493330","modified":1599706741066},{"_id":"themes/hexo-theme-next/languages/id.yml","hash":"572ed855d47aafe26f58c73b1394530754881ec2","modified":1599706741066},{"_id":"themes/hexo-theme-next/languages/pt-BR.yml","hash":"67555b1ba31a0242b12fc6ce3add28531160e35b","modified":1599706741066},{"_id":"themes/hexo-theme-next/languages/ru.yml","hash":"e993d5ca072f7f6887e30fc0c19b4da791ca7a88","modified":1599706741066},{"_id":"themes/hexo-theme-next/languages/tr.yml","hash":"fe793f4c2608e3f85f0b872fd0ac1fb93e6155e2","modified":1599706741066},{"_id":"themes/hexo-theme-next/languages/pt.yml","hash":"718d131f42f214842337776e1eaddd1e9a584054","modified":1599706741066},{"_id":"themes/hexo-theme-next/languages/uk.yml","hash":"3a6d635b1035423b22fc86d9455dba9003724de9","modified":1599706741066},{"_id":"themes/hexo-theme-next/languages/vi.yml","hash":"93393b01df148dcbf0863f6eee8e404e2d94ef9e","modified":1599706741066},{"_id":"themes/hexo-theme-next/languages/zh-HK.yml","hash":"3789f94010f948e9f23e21235ef422a191753c65","modified":1599706741066},{"_id":"themes/hexo-theme-next/languages/zh-TW.yml","hash":"8c09da7c4ec3fca2c6ee897b2eea260596a2baa1","modified":1599706741066},{"_id":"themes/hexo-theme-next/layout/_layout.swig","hash":"91e949e8cf234b255f2c0cf913e5df9aa48376ff","modified":1599717939537},{"_id":"themes/hexo-theme-next/layout/archive.swig","hash":"e4e31317a8df68f23156cfc49e9b1aa9a12ad2ed","modified":1599706741069},{"_id":"themes/hexo-theme-next/languages/zh-CN.yml","hash":"a1f15571ee7e1e84e3cc0985c3ec4ba1a113f6f8","modified":1599706741066},{"_id":"themes/hexo-theme-next/layout/category.swig","hash":"1bde61cf4d2d171647311a0ac2c5c7933f6a53b0","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/page.swig","hash":"db581bdeac5c75fabb0f17d7c5e746e47f2a9168","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/post.swig","hash":"2f6d992ced7e067521fdce05ffe4fd75481f41c5","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/tag.swig","hash":"0dfb653bd5de980426d55a0606d1ab122bd8c017","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/index.swig","hash":"7f403a18a68e6d662ae3e154b2c1d3bbe0801a23","modified":1599706741069},{"_id":"themes/hexo-theme-next/scripts/renderer.js","hash":"49a65df2028a1bc24814dc72fa50d52231ca4f05","modified":1599706741070},{"_id":"themes/hexo-theme-next/docs/MATH.md","hash":"d645b025ec7fb9fbf799b9bb76af33b9f5b9ed93","modified":1599706741064},{"_id":"themes/hexo-theme-next/docs/UPDATE-FROM-5.1.X.md","hash":"8b6e4b2c9cfcb969833092bdeaed78534082e3e6","modified":1599706741064},{"_id":"themes/hexo-theme-next/.github/ISSUE_TEMPLATE/other.md","hash":"d3efc0df0275c98440e69476f733097916a2d579","modified":1599706741062},{"_id":"themes/hexo-theme-next/.github/ISSUE_TEMPLATE/question.md","hash":"53df7d537e26aaf062d70d86835c5fd8f81412f3","modified":1599706741062},{"_id":"themes/hexo-theme-next/docs/ru/DATA-FILES.md","hash":"0bd2d696f62a997a11a7d84fec0130122234174e","modified":1599706741064},{"_id":"themes/hexo-theme-next/docs/ru/INSTALLATION.md","hash":"9c4fe2873123bf9ceacab5c50d17d8a0f1baef27","modified":1599706741064},{"_id":"themes/hexo-theme-next/.github/ISSUE_TEMPLATE/bug-report.md","hash":"c3e6b8196c983c40fd140bdeca012d03e6e86967","modified":1599706741062},{"_id":"themes/hexo-theme-next/.github/ISSUE_TEMPLATE/feature-request.md","hash":"12d99fb8b62bd9e34d9672f306c9ae4ace7e053e","modified":1599706741062},{"_id":"themes/hexo-theme-next/docs/ru/README.md","hash":"85dd68ed1250897a8e4a444a53a68c1d49eb7e11","modified":1599706741064},{"_id":"themes/hexo-theme-next/docs/ru/UPDATE-FROM-5.1.X.md","hash":"5237a368ab99123749d724b6c379415f2c142a96","modified":1599706741064},{"_id":"themes/hexo-theme-next/docs/zh-CN/DATA-FILES.md","hash":"ca1030efdfca5e20f9db2e7a428998e66a24c0d0","modified":1599706741065},{"_id":"themes/hexo-theme-next/docs/zh-CN/INSTALLATION.md","hash":"579c7bd8341873fb8be4732476d412814f1a3df7","modified":1599706741065},{"_id":"themes/hexo-theme-next/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"8b18f84503a361fc712b0fe4d4568e2f086ca97d","modified":1599706741065},{"_id":"themes/hexo-theme-next/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"34b88784ec120dfdc20fa82aadeb5f64ef614d14","modified":1599706741064},{"_id":"themes/hexo-theme-next/docs/zh-CN/MATH.md","hash":"b92585d251f1f9ebe401abb5d932cb920f9b8b10","modified":1599706741065},{"_id":"themes/hexo-theme-next/docs/zh-CN/README.md","hash":"c038629ff8f3f24e8593c4c8ecf0bef3a35c750d","modified":1599706741065},{"_id":"themes/hexo-theme-next/layout/_macro/passage-end-tag.swig","hash":"8b77c4ce34f16c711b5c0b98a64be7a714bfe27f","modified":1599708007230},{"_id":"themes/hexo-theme-next/layout/_macro/post-collapse.swig","hash":"9c8dc0b8170679cdc1ee9ee8dbcbaebf3f42897b","modified":1599706741066},{"_id":"themes/hexo-theme-next/layout/_macro/post.swig","hash":"972e1a48d7a6c512552a8a413eb36374fef5197a","modified":1599708175535},{"_id":"themes/hexo-theme-next/layout/_macro/sidebar.swig","hash":"71655ca21907e9061b6e8ac52d0d8fbf54d0062b","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/comments.swig","hash":"db6ab5421b5f4b7cb32ac73ad0e053fdf065f83e","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/footer.swig","hash":"4369b313cbbeae742cb35f86d23d99d4285f7359","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/languages.swig","hash":"ba9e272f1065b8f0e8848648caa7dea3f02c6be1","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/pagination.swig","hash":"9876dbfc15713c7a47d4bcaa301f4757bd978269","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/widgets.swig","hash":"83a40ce83dfd5cada417444fb2d6f5470aae6bb0","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_scripts/index.swig","hash":"cea942b450bcb0f352da78d76dc6d6f1d23d5029","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_scripts/noscript.swig","hash":"d1f2bfde6f1da51a2b35a7ab9e7e8eb6eefd1c6b","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_scripts/pjax.swig","hash":"4d2c93c66e069852bb0e3ea2e268d213d07bfa3f","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_scripts/three.swig","hash":"a4f42f2301866bd25a784a2281069d8b66836d0b","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_scripts/vendors.swig","hash":"ef38c213679e7b6d2a4116f56c9e55d678446069","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_third-party/baidu-push.swig","hash":"b782eb2e34c0c15440837040b5d65b093ab6ec04","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_third-party/index.swig","hash":"70c3c01dd181de81270c57f3d99b6d8f4c723404","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/quicklink.swig","hash":"311e5eceec9e949f1ea8d623b083cec0b8700ff2","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/rating.swig","hash":"2731e262a6b88eaee2a3ca61e6a3583a7f594702","modified":1599706741069},{"_id":"themes/hexo-theme-next/scripts/events/index.js","hash":"5743cde07f3d2aa11532a168a652e52ec28514fd","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/filters/default-injects.js","hash":"aec50ed57b9d5d3faf2db3c88374f107203617e0","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/filters/locals.js","hash":"b193a936ee63451f09f8886343dcfdca577c0141","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/filters/front-matter.js","hash":"703bdd142a671b4b67d3d9dfb4a19d1dd7e7e8f7","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/filters/minify.js","hash":"19985723b9f677ff775f3b17dcebf314819a76ac","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/filters/post.js","hash":"44ba9b1c0bdda57590b53141306bb90adf0678db","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/helpers/engine.js","hash":"bdb424c3cc0d145bd0c6015bb1d2443c8a9c6cda","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/helpers/font.js","hash":"40cf00e9f2b7aa6e5f33d412e03ed10304b15fd7","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/helpers/next-config.js","hash":"5e11f30ddb5093a88a687446617a46b048fa02e5","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/helpers/next-url.js","hash":"958e86b2bd24e4fdfcbf9ce73e998efe3491a71f","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/tags/button.js","hash":"8c6b45f36e324820c919a822674703769e6da32c","modified":1599706741071},{"_id":"themes/hexo-theme-next/scripts/tags/caniuse.js","hash":"94e0bbc7999b359baa42fa3731bdcf89c79ae2b3","modified":1599706741071},{"_id":"themes/hexo-theme-next/scripts/tags/center-quote.js","hash":"f1826ade2d135e2f60e2d95cb035383685b3370c","modified":1599706741071},{"_id":"themes/hexo-theme-next/scripts/tags/group-pictures.js","hash":"d902fd313e8d35c3cc36f237607c2a0536c9edf1","modified":1599706741071},{"_id":"themes/hexo-theme-next/scripts/tags/label.js","hash":"fc5b267d903facb7a35001792db28b801cccb1f8","modified":1599706741071},{"_id":"themes/hexo-theme-next/scripts/tags/mermaid.js","hash":"983c6c4adea86160ecc0ba2204bc312aa338121d","modified":1599706741071},{"_id":"themes/hexo-theme-next/scripts/tags/note.js","hash":"0a02bb4c15aec41f6d5f1271cdb5c65889e265d9","modified":1599706741071},{"_id":"themes/hexo-theme-next/scripts/tags/pdf.js","hash":"8c613b39e7bff735473e35244b5629d02ee20618","modified":1599706741071},{"_id":"themes/hexo-theme-next/scripts/tags/tabs.js","hash":"93d8a734a3035c1d3f04933167b500517557ba3e","modified":1599706741071},{"_id":"themes/hexo-theme-next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"fb23b85db6f7d8279d73ae1f41631f92f64fc864","modified":1599706741065},{"_id":"themes/hexo-theme-next/scripts/tags/video.js","hash":"e5ff4c44faee604dd3ea9db6b222828c4750c227","modified":1599706741071},{"_id":"themes/hexo-theme-next/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"d9ce7331c1236bbe0a551d56cef2405e47e65325","modified":1599706741065},{"_id":"themes/hexo-theme-next/docs/zh-CN/CONTRIBUTING.md","hash":"d3f03be036b75dc71cf3c366cd75aee7c127c874","modified":1599706741065},{"_id":"themes/hexo-theme-next/source/css/_colors.styl","hash":"a8442520f719d3d7a19811cb3b85bcfd4a596e1f","modified":1599706741071},{"_id":"themes/hexo-theme-next/source/css/_mixins.styl","hash":"e31a557f8879c2f4d8d5567ee1800b3e03f91f6e","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/css/main.styl","hash":"a3a3bbb5a973052f0186b3523911cb2539ff7b88","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1599706741076},{"_id":"themes/hexo-theme-next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1599706741076},{"_id":"themes/hexo-theme-next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1599706741076},{"_id":"themes/hexo-theme-next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1599706741076},{"_id":"themes/hexo-theme-next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1599706741076},{"_id":"themes/hexo-theme-next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1599706741076},{"_id":"themes/hexo-theme-next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1599706741076},{"_id":"themes/hexo-theme-next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1599706741076},{"_id":"themes/hexo-theme-next/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1599706741076},{"_id":"themes/hexo-theme-next/source/js/bookmark.js","hash":"9734ebcb9b83489686f5c2da67dc9e6157e988ad","modified":1599706741076},{"_id":"themes/hexo-theme-next/source/js/algolia-search.js","hash":"498d233eb5c7af6940baf94c1a1c36fdf1dd2636","modified":1599706741076},{"_id":"themes/hexo-theme-next/source/js/local-search.js","hash":"35ccf100d8f9c0fd6bfbb7fa88c2a76c42a69110","modified":1599706741076},{"_id":"themes/hexo-theme-next/source/js/motion.js","hash":"72df86f6dfa29cce22abeff9d814c9dddfcf13a9","modified":1599706741076},{"_id":"themes/hexo-theme-next/source/js/next-boot.js","hash":"a1b0636423009d4a4e4cea97bcbf1842bfab582c","modified":1599706741076},{"_id":"themes/hexo-theme-next/layout/_partials/head/head-unique.swig","hash":"000bad572d76ee95d9c0a78f9ccdc8d97cc7d4b4","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/head/head.swig","hash":"810d544019e4a8651b756dd23e5592ee851eda71","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/header/brand.swig","hash":"c70f8e71e026e878a4e9d5ab3bbbf9b0b23c240c","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/header/index.swig","hash":"7dbe93b8297b746afb89700b4d29289556e85267","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/header/menu.swig","hash":"d31f896680a6c2f2c3f5128b4d4dd46c87ce2130","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/header/sub-menu.swig","hash":"ae2261bea836581918a1c2b0d1028a78718434e0","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/page/breadcrumb.swig","hash":"c851717497ca64789f2176c9ecd1dedab237b752","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/header/menu-item.swig","hash":"9440d8a3a181698b80e1fa47f5104f4565d8cdf3","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/page/page-header.swig","hash":"9b7a66791d7822c52117fe167612265356512477","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/post/post-copyright.swig","hash":"954ad71536b6eb08bd1f30ac6e2f5493b69d1c04","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/post/post-followme.swig","hash":"ceba16b9bd3a0c5c8811af7e7e49d0f9dcb2f41e","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/post/post-footer.swig","hash":"8f14f3f8a1b2998d5114cc56b680fb5c419a6b07","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/post/post-related.swig","hash":"f79c44692451db26efce704813f7a8872b7e63a0","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/post/post-reward.swig","hash":"2b1a73556595c37951e39574df5a3f20b2edeaef","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/search/algolia-search.swig","hash":"48430bd03b8f19c9b8cdb2642005ed67d56c6e0b","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/search/index.swig","hash":"2be50f9bfb1c56b85b3b6910a7df27f51143632c","modified":1599706741067},{"_id":"themes/hexo-theme-next/layout/_partials/search/localsearch.swig","hash":"f48a6a8eba04eb962470ce76dd731e13074d4c45","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_partials/sidebar/site-overview.swig","hash":"c46849e0af8f8fb78baccd40d2af14df04a074af","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_scripts/pages/schedule.swig","hash":"077b5d66f6309f2e7dcf08645058ff2e03143e6c","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_scripts/schemes/gemini.swig","hash":"1c910fc066c06d5fbbe9f2b0c47447539e029af7","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_scripts/schemes/muse.swig","hash":"7f14ef43d9e82bc1efc204c5adf0b1dbfc919a9f","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_scripts/schemes/mist.swig","hash":"7f14ef43d9e82bc1efc204c5adf0b1dbfc919a9f","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_scripts/schemes/pisces.swig","hash":"1c910fc066c06d5fbbe9f2b0c47447539e029af7","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_third-party/analytics/google-analytics.swig","hash":"2fa2b51d56bfac6a1ea76d651c93b9c20b01c09b","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_third-party/analytics/baidu-analytics.swig","hash":"4790058691b7d36cf6d2d6b4e93795a7b8d608ad","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_third-party/analytics/growingio.swig","hash":"5adea065641e8c55994dd2328ddae53215604928","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_third-party/analytics/index.swig","hash":"1472cabb0181f60a6a0b7fec8899a4d03dfb2040","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_third-party/chat/tidio.swig","hash":"cba0e6e0fad08568a9e74ba9a5bee5341cfc04c1","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_third-party/chat/chatra.swig","hash":"f910618292c63871ca2e6c6e66c491f344fa7b1f","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_third-party/comments/changyan.swig","hash":"f39a5bf3ce9ee9adad282501235e0c588e4356ec","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_third-party/comments/disqusjs.swig","hash":"82f5b6822aa5ec958aa987b101ef860494c6cf1f","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/comments/disqus.swig","hash":"b14908644225d78c864cd0a9b60c52407de56183","modified":1599706741068},{"_id":"themes/hexo-theme-next/layout/_third-party/comments/gitalk.swig","hash":"d6ceb70648555338a80ae5724b778c8c58d7060d","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/comments/valine.swig","hash":"be0a8eccf1f6dc21154af297fc79555343031277","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/comments/livere.swig","hash":"f7a9eca599a682479e8ca863db59be7c9c7508c8","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/math/index.swig","hash":"6c5976621efd5db5f7c4c6b4f11bc79d6554885f","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/math/katex.swig","hash":"4791c977a730f29c846efcf6c9c15131b9400ead","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/math/mathjax.swig","hash":"ecf751321e799f0fb3bf94d049e535130e2547aa","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/search/algolia-search.swig","hash":"d35a999d67f4c302f76fdf13744ceef3c6506481","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/search/swiftype.swig","hash":"ba0dbc06b9d244073a1c681ff7a722dcbf920b51","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/search/localsearch.swig","hash":"767b6c714c22588bcd26ba70b0fc19b6810cbacd","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/statistics/busuanzi-counter.swig","hash":"4b1986e43d6abce13450d2b41a736dd6a5620a10","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/statistics/cnzz-analytics.swig","hash":"a17ace37876822327a2f9306a472974442c9005d","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/statistics/firestore.swig","hash":"b26ac2bfbe91dd88267f8b96aee6bb222b265b7a","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/statistics/index.swig","hash":"5f6a966c509680dbfa70433f9d658cee59c304d7","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/statistics/lean-analytics.swig","hash":"d56d5af427cdfecc33a0f62ee62c056b4e33d095","modified":1599706741069},{"_id":"themes/hexo-theme-next/layout/_third-party/tags/mermaid.swig","hash":"f3c43664a071ff3c0b28bd7e59b5523446829576","modified":1599706741069},{"_id":"themes/hexo-theme-next/scripts/events/lib/config.js","hash":"d34c6040b13649714939f59be5175e137de65ede","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/events/lib/injects-point.js","hash":"6661c1c91c7cbdefc6a5e6a034b443b8811235a1","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/events/lib/injects.js","hash":"f233d8d0103ae7f9b861344aa65c1a3c1de8a845","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/filters/comment/common.js","hash":"2486f3e0150c753e5f3af1a3665d074704b8ee2c","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/filters/comment/changyan.js","hash":"a54708fd9309b4357c423a3730eb67f395344a5e","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/filters/comment/default-config.js","hash":"7f2d93af012c1e14b8596fecbfc7febb43d9b7f5","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/filters/comment/disqus.js","hash":"4c0c99c7e0f00849003dfce02a131104fb671137","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/filters/comment/disqusjs.js","hash":"7f8b92913d21070b489457fa5ed996d2a55f2c32","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/filters/comment/livere.js","hash":"d5fefc31fba4ab0188305b1af1feb61da49fdeb0","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/filters/comment/gitalk.js","hash":"e51dc3072c1ba0ea3008f09ecae8b46242ec6021","modified":1599706741070},{"_id":"themes/hexo-theme-next/scripts/filters/comment/valine.js","hash":"6cbd85f9433c06bae22225ccf75ac55e04f2d106","modified":1599706741070},{"_id":"themes/hexo-theme-next/layout/_third-party/tags/pdf.swig","hash":"d30b0e255a8092043bac46441243f943ed6fb09b","modified":1599706741069},{"_id":"themes/hexo-theme-next/source/lib/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1599706741077},{"_id":"themes/hexo-theme-next/source/css/_variables/Mist.styl","hash":"f70be8e229da7e1715c11dd0e975a2e71e453ac8","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/css/_variables/Muse.styl","hash":"62df49459d552bbf73841753da8011a1f5e875c8","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/css/_variables/Gemini.styl","hash":"f4e694e5db81e57442c7e34505a416d818b3044a","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/css/_variables/Pisces.styl","hash":"612ec843372dae709acb17112c1145a53450cc59","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/js/utils.js","hash":"730cca7f164eaf258661a61ff3f769851ff1e5da","modified":1599706741077},{"_id":"themes/hexo-theme-next/source/css/_variables/base.styl","hash":"818508748b7a62e02035e87fe58e75b603ed56dc","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/js/schemes/muse.js","hash":"1eb9b88103ddcf8827b1a7cbc56471a9c5592d53","modified":1599706741076},{"_id":"themes/hexo-theme-next/source/js/schemes/pisces.js","hash":"0ac5ce155bc58c972fe21c4c447f85e6f8755c62","modified":1599706741076},{"_id":"themes/hexo-theme-next/source/js/src/clicklove.js","hash":"effa770d8085f7e7fb903de217ce521dff163780","modified":1599717907680},{"_id":"themes/hexo-theme-next/source/css/_common/components/back-to-top-sidebar.styl","hash":"ca5e70662dcfb261c25191cc5db5084dcf661c76","modified":1599706741071},{"_id":"themes/hexo-theme-next/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1599706741078},{"_id":"themes/hexo-theme-next/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1599706741078},{"_id":"themes/hexo-theme-next/source/css/_common/components/back-to-top.styl","hash":"a47725574e1bee3bc3b63b0ff2039cc982b17eff","modified":1599706741071},{"_id":"themes/hexo-theme-next/source/css/_common/components/components.styl","hash":"8e7b57a72e757cf95278239641726bb2d5b869d1","modified":1599706741071},{"_id":"themes/hexo-theme-next/source/css/_common/outline/mobile.styl","hash":"681d33e3bc85bdca407d93b134c089264837378c","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/outline/outline.styl","hash":"a1690e035b505d28bdef2b4424c13fc6312ab049","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/components/reading-progress.styl","hash":"2e3bf7baf383c9073ec5e67f157d3cb3823c0957","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/base.styl","hash":"0b2c4b78eead410020d7c4ded59c75592a648df8","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/comments.styl","hash":"b1f0fab7344a20ed6748b04065b141ad423cf4d9","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/buttons.styl","hash":"a2e9e00962e43e98ec2614d6d248ef1773bb9b78","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/normalize.styl","hash":"b56367ea676ea8e8783ea89cd4ab150c7da7a060","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/scaffolding.styl","hash":"523fb7b653b87ae37fc91fc8813e4ffad87b0d7e","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/tables.styl","hash":"18ce72d90459c9aa66910ac64eae115f2dde3767","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/pagination.styl","hash":"8f58570a1bbc34c4989a47a1b7d42a8030f38b06","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_schemes/Gemini/index.styl","hash":"7785bd756e0c4acede3a47fec1ed7b55988385a5","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_schemes/Mist/_header.styl","hash":"f6516d0f7d89dc7b6c6e143a5af54b926f585d82","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/toggles.styl","hash":"179e33b8ac7f4d8a8e76736a7e4f965fe9ab8b42","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_schemes/Mist/_layout.styl","hash":"bb7ace23345364eb14983e860a7172e1683a4c94","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_schemes/Mist/_menu.styl","hash":"7104b9cef90ca3b140d7a7afcf15540a250218fc","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_schemes/Mist/_posts-expand.styl","hash":"6136da4bbb7e70cec99f5c7ae8c7e74f5e7c261a","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_schemes/Mist/index.styl","hash":"a717969829fa6ef88225095737df3f8ee86c286b","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_schemes/Muse/_layout.styl","hash":"4d1c17345d2d39ef7698f7acf82dfc0f59308c34","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_schemes/Muse/_menu.styl","hash":"93db5dafe9294542a6b5f647643cb9deaced8e06","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_schemes/Muse/_header.styl","hash":"f0131db6275ceaecae7e1a6a3798b8f89f6c850d","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_schemes/Muse/_sidebar.styl","hash":"2b2e7b5cea7783c9c8bb92655e26a67c266886f0","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_schemes/Muse/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/css/_schemes/Muse/_sub-menu.styl","hash":"c48ccd8d6651fe1a01faff8f01179456d39ba9b1","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/css/_schemes/Pisces/_header.styl","hash":"e282df938bd029f391c466168d0e68389978f120","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/css/_schemes/Pisces/_layout.styl","hash":"70a4324b70501132855b5e59029acfc5d3da1ebd","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/css/_schemes/Pisces/_menu.styl","hash":"85da2f3006f4bef9a2199416ecfab4d288f848c4","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/css/_schemes/Pisces/_sidebar.styl","hash":"44f47c88c06d89d06f220f102649057118715828","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/css/_schemes/Pisces/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"e740deadcfc4f29c5cb01e40f9df6277262ba4e3","modified":1599706741075},{"_id":"themes/hexo-theme-next/source/css/_common/components/pages/breadcrumb.styl","hash":"fafc96c86926b22afba8bb9418c05e6afbc05a57","modified":1599706741071},{"_id":"themes/hexo-theme-next/source/lib/font-awesome/css/all.min.css","hash":"0038dc97c79451578b7bd48af60ba62282b4082b","modified":1599706741077},{"_id":"themes/hexo-theme-next/source/css/_common/components/pages/categories.styl","hash":"2bd0eb1512415325653b26d62a4463e6de83c5ac","modified":1599706741071},{"_id":"themes/hexo-theme-next/source/lib/font-awesome/webfonts/fa-regular-400.woff2","hash":"260bb01acd44d88dcb7f501a238ab968f86bef9e","modified":1599706741077},{"_id":"themes/hexo-theme-next/source/css/_common/components/pages/pages.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":1599706741071},{"_id":"themes/hexo-theme-next/source/css/_common/components/pages/schedule.styl","hash":"e771dcb0b4673e063c0f3e2d73e7336ac05bcd57","modified":1599706741071},{"_id":"themes/hexo-theme-next/source/css/_common/components/pages/tag-cloud.styl","hash":"d21d4ac1982c13d02f125a67c065412085a92ff2","modified":1599706741071},{"_id":"themes/hexo-theme-next/source/css/_common/components/post/post-collapse.styl","hash":"e75693f33dbc92afc55489438267869ae2f3db54","modified":1599706741071},{"_id":"themes/hexo-theme-next/source/css/_common/components/post/post-eof.styl","hash":"902569a9dea90548bec21a823dd3efd94ff7c133","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/components/post/post-copyright.styl","hash":"f49ca072b5a800f735e8f01fc3518f885951dd8e","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/components/post/post-followme.styl","hash":"1e4190c10c9e0c9ce92653b0dbcec21754b0b69d","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/components/post/post-expand.styl","hash":"ded41fd9d20a5e8db66aaff7cc50f105f5ef2952","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/components/post/post-header.styl","hash":"65cb6edb69e94e70e3291e9132408361148d41d5","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/components/post/post-gallery.styl","hash":"72d495a88f7d6515af425c12cbc67308a57d88ea","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/components/post/post-nav.styl","hash":"6a97bcfa635d637dc59005be3b931109e0d1ead5","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/components/post/post-reward.styl","hash":"d114b2a531129e739a27ba6271cfe6857aa9a865","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/components/post/post-rtl.styl","hash":"f5c2788a78790aca1a2f37f7149d6058afb539e0","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/components/post/post-tags.styl","hash":"99e12c9ce3d14d4837e3d3f12fc867ba9c565317","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/components/post/post-widgets.styl","hash":"5b5649b9749e3fd8b63aef22ceeece0a6e1df605","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/components/post/post.styl","hash":"a760ee83ba6216871a9f14c5e56dc9bd0d9e2103","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/components/third-party/third-party.styl","hash":"9a878d0119785a2316f42aebcceaa05a120b9a7a","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/components/third-party/search.styl","hash":"9f0b93d109c9aec79450c8a0cf4a4eab717d674d","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/outline/footer/footer.styl","hash":"454a4aebfabb4469b92a8cbb49f46c49ac9bf165","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/components/third-party/gitalk.styl","hash":"8a7fc03a568b95be8d3337195e38bc7ec5ba2b23","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/components/third-party/math.styl","hash":"b49e9fbd3c182b8fc066b8c2caf248e3eb748619","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/outline/header/bookmark.styl","hash":"e2d606f1ac343e9be4f15dbbaf3464bc4df8bf81","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/outline/header/header.styl","hash":"a793cfff86ad4af818faef04c18013077873f8f0","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/outline/header/github-banner.styl","hash":"e7a9fdb6478b8674b1cdf94de4f8052843fb71d9","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/outline/header/headerband.styl","hash":"0caf32492692ba8e854da43697a2ec8a41612194","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/outline/header/menu.styl","hash":"5f432a6ed9ca80a413c68b00e93d4a411abf280a","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/components/third-party/related-posts.styl","hash":"e2992846b39bf3857b5104675af02ba73e72eed5","modified":1599706741072},{"_id":"themes/hexo-theme-next/source/css/_common/outline/header/site-meta.styl","hash":"45a239edca44acecf971d99b04f30a1aafbf6906","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"2cb1876e9e0c9ac32160888af27b1178dbcb0616","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"fa0222197b5eee47e18ac864cdc6eac75678b8fe","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/outline/header/site-nav.styl","hash":"b2fc519828fe89a1f8f03ff7b809ad68cd46f3d7","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"1f0e7fbe80956f47087c2458ea880acf7a83078b","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"44487d9ab290dc97871fa8dd4487016deb56e123","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-dimmer.styl","hash":"9b479c2f9a9bfed77885e5093b8245cc5d768ec7","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"a05a4031e799bc864a4536f9ef61fe643cd421af","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"a960a2dd587b15d3b3fe1b59525d6fa971c6a6ec","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/outline/sidebar/sidebar.styl","hash":"a9cd93c36bae5af9223e7804963096274e8a4f03","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"b3220db827e1adbca7880c2bb23e78fa7cbe95cb","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/outline/sidebar/site-state.styl","hash":"2a47f8a6bb589c2fb635e6c1e4a2563c7f63c407","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"f71a3e86c05ea668b008cf05a81f67d92b6d65e4","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/highlight/highlight.styl","hash":"35c871a809afa8306c8cde13651010e282548bc6","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/highlight/diff.styl","hash":"d3f73688bb7423e3ab0de1efdf6db46db5e34f80","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/highlight/theme.styl","hash":"3b3acc5caa0b95a2598bef4eeacb21bab21bea56","modified":1599706741073},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"1d2778ca5aeeeafaa690dc2766b01b352ab76a02","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"709d10f763e357e1472d6471f8be384ec9e2d983","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/tags/label.styl","hash":"d7fce4b51b5f4b7c31d93a9edb6c6ce740aa0d6b","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/tags/note.styl","hash":"e4d9a77ffe98e851c1202676940097ba28253313","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/tags/pdf.styl","hash":"b49c64f8e9a6ca1c45c0ba98febf1974fdd03616","modified":1599706741074},{"_id":"themes/hexo-theme-next/.github/CONTRIBUTING.md","hash":"e554931b98f251fd49ff1d2443006d9ea2c20461","modified":1599706741062},{"_id":"themes/hexo-theme-next/source/images/123.jpg","hash":"f070cc4dd7c1d47dffa9d9073f17a55105d59ea2","modified":1566650207249},{"_id":"themes/hexo-theme-next/source/lib/font-awesome/webfonts/fa-brands-400.woff2","hash":"509988477da79c146cb93fb728405f18e923c2de","modified":1599706741077},{"_id":"themes/hexo-theme-next/source/lib/font-awesome/webfonts/fa-solid-900.woff2","hash":"75a88815c47a249eadb5f0edc1675957f860cca7","modified":1599706741077},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/tags/tabs.styl","hash":"f23670f1d8e749f3e83766d446790d8fd9620278","modified":1599706741074},{"_id":"themes/hexo-theme-next/source/css/_common/scaffolding/tags/tags.styl","hash":"9e4c0653cfd3cc6908fa0d97581bcf80861fb1e7","modified":1599706741074},{"_id":"source/images/pasted-15.png","hash":"11787a89633ff0004614828d9ead707877b0c891","modified":1599728909093},{"_id":"source/images/pasted-84.png","hash":"cb4922f5d69975d9f57b2e33550a7292393ab8a0","modified":1601188207045},{"_id":"source/images/pasted-83.png","hash":"29a50f273f91c463b158b72a6d640c6184fb3960","modified":1601188194190},{"_id":"source/images/pasted-80.png","hash":"b1d577b99876f9cecc4011da95207484223082ee","modified":1601188069501},{"_id":"source/images/pasted-90.png","hash":"0453a9f366c69cd85fa792568789664fe5567403","modified":1601190262130},{"_id":"public/atom.xml","hash":"fd120ee673943d92373bb9f93c821df9f433f37d","modified":1604455192191},{"_id":"public/about/index.html","hash":"0515285fe5ca79672c21f8067719fbbaf2ced2ce","modified":1604455192191},{"_id":"public/categories/index.html","hash":"855f30c997f19a26675099e59e041fcd86ad8f67","modified":1604455192191},{"_id":"public/tags/index.html","hash":"99de3a4a21908f3fc67e142544a55f1e4431ebae","modified":1604455192191},{"_id":"public/2020/09/27/解决在Docker容器中不能使用system管理/index.html","hash":"90556b1720c14eab97dcd6c75a24a8198b6e5f1f","modified":1604455192191},{"_id":"public/2020/09/10/commit构建镜像/index.html","hash":"bcc388c98aed3daf2ec05001c481554fad23077a","modified":1604455192191},{"_id":"public/2020/09/10/Hexo如何发布文章/index.html","hash":"e53082b9e4fa050c15b1c95d75e7b0b30e56ff62","modified":1604455192191},{"_id":"public/2020/09/10/hello-world/index.html","hash":"e7177982dac2e462eb779262491d2e0b6dc55677","modified":1604455192191},{"_id":"public/archives/page/2/index.html","hash":"a5a7d051dbdf57c81768a7c680087083d61bc2ea","modified":1604455192191},{"_id":"public/archives/page/3/index.html","hash":"8eb29ec13dc1007bf4e2e89ce65ccd3f70f8d86a","modified":1604455192191},{"_id":"public/archives/2020/page/2/index.html","hash":"2b7eaffe769d267b79972a6411d4409a6ea6f959","modified":1604455192191},{"_id":"public/archives/2020/page/3/index.html","hash":"b59b9484c3055e719394b1706d86196bab6df0ff","modified":1604455192191},{"_id":"public/archives/2020/09/page/2/index.html","hash":"44ba1ed9706255fabd895b0ba3083d381f2ca476","modified":1604455192191},{"_id":"public/archives/2020/09/page/3/index.html","hash":"f3d294dbc27e398c9a46ce748507fe0967674759","modified":1604455192191},{"_id":"public/archives/2020/10/index.html","hash":"78f8c9814f1c3fe877af49f66f0448cdfbd0735d","modified":1604455192191},{"_id":"public/archives/2020/11/index.html","hash":"c94198db7e2c0080996b4f8f44674c750433b3ae","modified":1604455192191},{"_id":"public/categories/Ansible/index.html","hash":"f923866664842e1afbdbf576c1432ec55119aa38","modified":1604455192191},{"_id":"public/categories/Linux/index.html","hash":"e52a60697477e870105b0930db826c9799ca6817","modified":1604455192191},{"_id":"public/categories/Docker/index.html","hash":"6e46ee775ae294e5e47ffc617ed8ce9e84debfda","modified":1604455192191},{"_id":"public/categories/Hexo/index.html","hash":"4c40ccf96c43cb0e74277c9c13e2f895aff688a9","modified":1604455192191},{"_id":"public/categories/Kubernetes/index.html","hash":"fc1489d048566d819f5cee6e486b176b0aa20e58","modified":1604455192191},{"_id":"public/categories/微服务/index.html","hash":"fe415c706d72c7938a8a29f1fb5a1be14cfa4c81","modified":1604455192191},{"_id":"public/tags/Ansible/index.html","hash":"ad21dd5abfda646b6355c12c299a892894eea3c0","modified":1604455192191},{"_id":"public/tags/Linux/index.html","hash":"036013cd793f131388347e61381871bc6289ef74","modified":1604455192191},{"_id":"public/tags/Docker/index.html","hash":"a81b5f2870c8ce81e87f541c45c7488a49efec1a","modified":1604455192191},{"_id":"public/tags/Docker/page/2/index.html","hash":"2121ca2771fd1b44644a59bc47edf33da5fc519c","modified":1604455192191},{"_id":"public/tags/Hexo/index.html","hash":"7d8f8bf329768a304211fe5cf73cf7fd54cf2f54","modified":1604455192191},{"_id":"public/tags/Kubetnetes/index.html","hash":"024f1621dba67373bfa5b685db6ef97a1f3a4038","modified":1604455192191},{"_id":"public/tags/微服务/index.html","hash":"f52a400fe1bc6e247f5ee0ce60b7b1b61c773691","modified":1604455192191},{"_id":"public/2020/11/03/Keepalived/index.html","hash":"97e9fd1a5327dabf888c8e78d8fa4d7de215bcee","modified":1604455192191},{"_id":"public/2020/11/03/Linux环境更新Python3-8/index.html","hash":"384c5f6fb323d83a51390023954eaa4c38fa972f","modified":1604455192191},{"_id":"public/2020/10/13/Centos7部署轻量级自动化运维工具pssh/index.html","hash":"bc185d01685397d23b1cf02cc7d36b55ed8b3660","modified":1604455192191},{"_id":"public/2020/10/13/HTTP方式共享YUM软件仓库/index.html","hash":"ceb105127d46c21b52c868dcf6c8832d6b39b3c1","modified":1604455192191},{"_id":"public/2020/09/27/实现容器的底层技术/index.html","hash":"ef5a8c6fb5d0678255642ec3fe108021d1985d37","modified":1604455192191},{"_id":"public/2020/09/27/使用SSH连接Docker容器/index.html","hash":"06e99fb198e1715f2003596a354a587437053ac0","modified":1604455192191},{"_id":"public/2020/09/27/对容器进行cpu的使用控制/index.html","hash":"f15a06a5de279d92eb7aa8c5f9e3864cd4c5851e","modified":1604455192191},{"_id":"public/2020/09/27/对容器进行内存容量控制/index.html","hash":"af59610c08b319b445887defe0f50faa46ea82ca","modified":1604455192191},{"_id":"public/2020/09/27/对容器进行磁盘读写速率控制/index.html","hash":"4537fa4dcbb9369933b71fff56b820af6aa8bdac","modified":1604455192191},{"_id":"public/2020/09/27/Dockerfile构建Ngxin镜像/index.html","hash":"5cc083208ba017bcbca70787fdde47db930e91a3","modified":1604455192191},{"_id":"public/2020/09/27/Dockerfile文件/index.html","hash":"3cc4f55773b7c0d52173702c25c838dc2f2d9c07","modified":1604455192191},{"_id":"public/2020/09/24/Linux权限管理之ACL权限/index.html","hash":"c1d4b44f3e017f0c8e9c98fd7937d58c79f4da2b","modified":1604455192191},{"_id":"public/2020/09/22/Linux-双网卡绑定/index.html","hash":"1e83788d6aee92ebd584bf64e8bee92a4afb02a8","modified":1604455192191},{"_id":"public/2020/09/18/Tomcat/index.html","hash":"84becefd745d69da797370ef2b1ed723bbe666b9","modified":1604455192191},{"_id":"public/2020/09/18/Ansible常用模块/index.html","hash":"371350f204127b508dc130ad07a330fc1327c3ad","modified":1604455192191},{"_id":"public/2020/09/18/Ansible自动化运维工具/index.html","hash":"828b3de24a851dbaa597aaf8a71f849cb44082fc","modified":1604455192191},{"_id":"public/2020/09/18/强制修改Linux系统的Root密码的办法/index.html","hash":"2a24d81cf3421e5e6526945a22dc033e747ed02e","modified":1604455192191},{"_id":"public/2020/09/11/升级Openssh详细步骤/index.html","hash":"daa240e493bff7e5a50b62a04c4c170513326d5a","modified":1604455192191},{"_id":"public/2020/09/11/本地MySQL数据库迁移到阿里云RDS/index.html","hash":"6b5237b68d12be5f96f0f07c50943bb5db2ab3c5","modified":1604455192191},{"_id":"public/2020/09/10/Docker部署nginx及web集群/index.html","hash":"89a51f704b7325b2bfee382c1ece3ec423fcd105","modified":1604455192191},{"_id":"public/2020/09/10/Docker私有仓库/index.html","hash":"73f36ff5013195422d59bc8cd47eb9805dfa2f3d","modified":1604455192191},{"_id":"public/2020/09/10/Docker基础操作逻辑命令/index.html","hash":"d3e86a6dfc589947663d9579c68e2ee941e5f2ad","modified":1604455192191},{"_id":"public/2020/09/10/Docker的安装-镜像加速及理论/index.html","hash":"074b0e35eb6cc085090ff18c032f0e3907a39abc","modified":1604455192191},{"_id":"public/2020/09/10/Linux高效文件处理三剑客/index.html","hash":"e4c3364d6a333aa506679ae30329125b7f7c192e","modified":1604455192191},{"_id":"public/2020/09/10/k8s重新生成Tocken并加入集群/index.html","hash":"977a69f125e50a1702b700102b7b32581d6d1ed5","modified":1604455192191},{"_id":"public/2020/09/10/Hexo添加分类和标签/index.html","hash":"dbc090a8d37768dd03cc9f55fee808f2c79e9c66","modified":1604455192191},{"_id":"public/archives/index.html","hash":"a42d69bc06ef59ee009ef7302d13c579a66ea3a0","modified":1604455192191},{"_id":"public/archives/2020/index.html","hash":"b5ebb040227ce677f51bbabb2b7efc7c24dc0f8f","modified":1604455192191},{"_id":"public/archives/2020/09/index.html","hash":"9a916da733d3bff7841bb54d3036a61bdce17288","modified":1604455192191},{"_id":"public/index.html","hash":"b860305f3223decfd37ed23ecdc0558f3a5d9a5b","modified":1604455192191},{"_id":"public/page/2/index.html","hash":"05896f5a47766513872a9d4e03ff3c24a5e53b97","modified":1604455192191},{"_id":"public/page/3/index.html","hash":"547f609505a1ada5ed3847c150e9b8b81abe84df","modified":1604455192191},{"_id":"public/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1604455192191},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1604455192191},{"_id":"public/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1604455192191},{"_id":"public/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1604455192191},{"_id":"public/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1604455192191},{"_id":"public/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1604455192191},{"_id":"public/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1604455192191},{"_id":"public/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1604455192191},{"_id":"public/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1604455192191},{"_id":"public/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1604455192191},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1604455192191},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1604455192191},{"_id":"public/lib/font-awesome/webfonts/fa-regular-400.woff2","hash":"260bb01acd44d88dcb7f501a238ab968f86bef9e","modified":1604455192191},{"_id":"public/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1604455192191},{"_id":"public/images/pasted-1.png","hash":"0fa8fe4c58350c00a4c91bd462592629ad98483a","modified":1604455192191},{"_id":"public/images/pasted-10.png","hash":"15f23d3c3e3fb61063e8e2c3e1b15236fe503582","modified":1604455192191},{"_id":"public/images/pasted-100.png","hash":"c63d85255c5a2b200e5cf108abda90e03183eb31","modified":1604455192191},{"_id":"public/images/pasted-103.png","hash":"1fe7086da5619b9a9888be4c1e4a1d2023bfa4ac","modified":1604455192191},{"_id":"public/images/pasted-105.png","hash":"b5d799cdfa76c41ffa59d99c268bfab597ff2f4a","modified":1604455192191},{"_id":"public/images/pasted-104.png","hash":"c65b1d44677dc76cd93c49799ef9d5234b98b82f","modified":1604455192191},{"_id":"public/images/pasted-14.png","hash":"d943a03bce0cb802075089b910ad4bee23780019","modified":1604455192191},{"_id":"public/images/pasted-16.png","hash":"bcbc29e25a28ec81efadba07da61623e48ec9c47","modified":1604455192191},{"_id":"public/images/pasted-17.png","hash":"0a097efa6d08d27bd503f2ff5e6930fd6aa48744","modified":1604455192191},{"_id":"public/images/pasted-18.png","hash":"322f56c1ca6737656963b9c4a44469e6a753675e","modified":1604455192191},{"_id":"public/images/pasted-19.png","hash":"a6e07bff091b09ebd29abed7c4a877eff1a94197","modified":1604455192191},{"_id":"public/images/pasted-2.png","hash":"eac273d7354e2f486fe7377a4549d3c0edbf7f24","modified":1604455192191},{"_id":"public/images/pasted-22.png","hash":"8ac9d954173e8a04d93e1c77829851ade1332cce","modified":1604455192191},{"_id":"public/images/pasted-20.png","hash":"01a61fb7702f724fe4690e557bb17d3d8c319c2c","modified":1604455192191},{"_id":"public/images/pasted-24.png","hash":"a4f237623924564bd598921226719f266f31dfdb","modified":1604455192191},{"_id":"public/images/pasted-23.png","hash":"d9719ed89df46f9c326a6093c4870f750d245f6c","modified":1604455192191},{"_id":"public/images/pasted-21.png","hash":"e727787ef9737f1c887e2cb6eb65bc65a97db1dc","modified":1604455192191},{"_id":"public/images/pasted-26.png","hash":"406b0e845577a6381fc70357676f9c0d40db1527","modified":1604455192191},{"_id":"public/images/pasted-27.png","hash":"bea8fe3b887b43fc4274032c6057fcf5d8731e31","modified":1604455192191},{"_id":"public/images/pasted-25.png","hash":"6df800c6ce15eb7bbe15bf18e21f48f9c488ca38","modified":1604455192191},{"_id":"public/images/pasted-29.png","hash":"b202dfbff12c77ee9dc8870f4de1ec6c9b45cf62","modified":1604455192191},{"_id":"public/images/pasted-28.png","hash":"43f8473ab279478e1d001d31b3bc5eb3ad8f2afb","modified":1604455192191},{"_id":"public/images/pasted-30.png","hash":"02685a6fb75eb36ec04f02543c7ceddaa1deecca","modified":1604455192191},{"_id":"public/images/pasted-32.png","hash":"dede4107ca872397d683a36729013e93c158edb9","modified":1604455192191},{"_id":"public/images/pasted-33.png","hash":"89fc1551139b035ebfacfff19f6d1ec34032775f","modified":1604455192191},{"_id":"public/images/pasted-31.png","hash":"7b8d5fbe68763a4aad9dd514600c55213996a886","modified":1604455192191},{"_id":"public/images/pasted-34.png","hash":"443ae0674c516e9d6479df195756b7131d49b6f8","modified":1604455192191},{"_id":"public/images/pasted-35.png","hash":"1e0b8ef74adfd48e604a9bde094eb2268af54a17","modified":1604455192191},{"_id":"public/images/pasted-36.png","hash":"59237f14cc10fa3542b9e9671470b993130d72de","modified":1604455192191},{"_id":"public/images/pasted-38.png","hash":"5d26f27ab4d8558ffefb6ebf8b2e14818633e7b8","modified":1604455192191},{"_id":"public/images/pasted-39.png","hash":"dd1385917785e360d1007e2e0e9a98c6468ae7d4","modified":1604455192191},{"_id":"public/images/pasted-37.png","hash":"3a0395f3677f7a498787be74a5e19a0777097e8a","modified":1604455192191},{"_id":"public/images/pasted-40.png","hash":"de2f7acce6f9793da64769210f1881b51b970388","modified":1604455192191},{"_id":"public/images/pasted-42.png","hash":"874b4650c51d934a0f4a4746e8c4cc6db1ede6ea","modified":1604455192191},{"_id":"public/images/pasted-41.png","hash":"f8c5bb33a120bac9db34a1e441e93efa2b088734","modified":1604455192191},{"_id":"public/images/pasted-45.png","hash":"781993dbb3af13a1462864ae4ab5ba894653e913","modified":1604455192191},{"_id":"public/images/pasted-4.png","hash":"e711e02eafcde7329c3eac80b9c2517f9008bb2d","modified":1604455192191},{"_id":"public/images/pasted-44.png","hash":"1aa48b167c1b0561736e99172068fe994ab2bd71","modified":1604455192191},{"_id":"public/images/pasted-43.png","hash":"85c00fd5e57d7f0f21683947a91d4acfa58b1346","modified":1604455192191},{"_id":"public/images/pasted-47.png","hash":"eeb1360f1fe1e56b77131dd806ea10a95d18199d","modified":1604455192191},{"_id":"public/images/pasted-46.png","hash":"fd39f33c32520fbc4cb7de4a9c45d29ea348299f","modified":1604455192191},{"_id":"public/images/pasted-51.png","hash":"3523936fbccaeebf8c0cd0147d22ce844feca568","modified":1604455192191},{"_id":"public/images/pasted-52.png","hash":"9d290888dfb9c5c349a32c5592d75e49395e162b","modified":1604455192191},{"_id":"public/images/pasted-5.png","hash":"55ff9b3ad23709179c1f45cfa72d95c2de0882d9","modified":1604455192191},{"_id":"public/images/pasted-54.png","hash":"b20ed4df178da12a446551860f4a62de0b305e48","modified":1604455192191},{"_id":"public/images/pasted-55.png","hash":"97535bf000b64f52f42d72409c84b76722175203","modified":1604455192191},{"_id":"public/images/pasted-57.png","hash":"cb95f88a8479d5ddedc5e3059aee19b33cc0496a","modified":1604455192191},{"_id":"public/images/pasted-58.png","hash":"931fe52e406707eb54818b775c94cbc405e28451","modified":1604455192191},{"_id":"public/images/pasted-59.png","hash":"db67e1f607ee28adf6112b505cc771d626d5e058","modified":1604455192191},{"_id":"public/images/pasted-6.png","hash":"feca501c50aad73ee1f3d7cde25f2eb5c068bafd","modified":1604455192191},{"_id":"public/images/pasted-63.png","hash":"a786fd8a3c92aa73a8dde4c21083aec607148112","modified":1604455192191},{"_id":"public/images/pasted-62.png","hash":"ff2838d81b72ac2046f76917ad4190f42e482f43","modified":1604455192191},{"_id":"public/images/pasted-68.png","hash":"2ed887aed03ca52c8dc5cdd1449eda06d94eb44d","modified":1604455192191},{"_id":"public/images/pasted-69.png","hash":"99d4a4e8356eb7c187323fbfae4387b02822b86c","modified":1604455192191},{"_id":"public/images/pasted-70.png","hash":"ab5ff4cd3610b9bfbea9b2361dca7dd62500c723","modified":1604455192191},{"_id":"public/images/pasted-7.png","hash":"d45a144dc69af087657793709971f320a312713a","modified":1604455192191},{"_id":"public/images/pasted-71.png","hash":"084776b38e96b2f7e9c5af1de15f272e9d5d6f6d","modified":1604455192191},{"_id":"public/images/pasted-73.png","hash":"680318d462ea5460db53d56a769e58ad12926fe1","modified":1604455192191},{"_id":"public/images/pasted-74.png","hash":"de39c8a94b87e29cee5ced7f87ec9f515484fc66","modified":1604455192191},{"_id":"public/images/pasted-72.png","hash":"3c607bbefe56313ab88e291450bd992a90e7e995","modified":1604455192191},{"_id":"public/images/pasted-75.png","hash":"22b37a85ac0c8de3b470335274fb61d9a1b41f7d","modified":1604455192191},{"_id":"public/images/pasted-76.png","hash":"e44d987a1ef9ed6df22610c64deafb00de4c3286","modified":1604455192191},{"_id":"public/images/pasted-8.png","hash":"3d21e6fe4d73107bd8d111be4c795979c69c75a9","modified":1604455192191},{"_id":"public/images/pasted-78.png","hash":"ef8e7566326e9552cbad011cc78c00383fa826bb","modified":1604455192191},{"_id":"public/images/pasted-85.png","hash":"30c0d3326bbf106f85846dfc91423290b40c2c85","modified":1604455192191},{"_id":"public/images/pasted-86.png","hash":"80408c92a3f45e738b52445d1caa8995ba631a8e","modified":1604455192191},{"_id":"public/images/pasted-89.png","hash":"ef5d9c98d19d3e4efd80d3078218ccfe3ae6f3e5","modified":1604455192191},{"_id":"public/images/pasted-88.png","hash":"ef5d9c98d19d3e4efd80d3078218ccfe3ae6f3e5","modified":1604455192191},{"_id":"public/images/pasted-91.png","hash":"cda74229eca708c3e57051645353dedc0ed8aa04","modified":1604455192191},{"_id":"public/images/pasted-87.png","hash":"c2d5c1eba09e31d2ca5ab2d851ba4ccc0f21a6e0","modified":1604455192191},{"_id":"public/images/pasted-9.png","hash":"95ac60dda409ebac267be11c4b551ca4d9dcbdfb","modified":1604455192191},{"_id":"public/images/pasted-93.png","hash":"b4e52799052765da3df20421a735a824f068f54c","modified":1604455192191},{"_id":"public/images/pasted-92.png","hash":"a5999e3810591d215b300b8634953ad1a04e2f04","modified":1604455192191},{"_id":"public/images/pasted-95.png","hash":"d01a34b4e250ab716b090b0c11862e177485be27","modified":1604455192191},{"_id":"public/images/pasted-94.png","hash":"e6775b52c0e1288910a571091e1ae4fc37b5aa3c","modified":1604455192191},{"_id":"public/images/pasted-97.png","hash":"a6fa1ba623821d769f8210e3c176b6b97bcd39e1","modified":1604455192191},{"_id":"public/images/pasted-96.png","hash":"6e945296149944137bcdb9631b2b4aa3bd71fd7a","modified":1604455192191},{"_id":"public/images/pasted-98.png","hash":"c6a8c88555ae4654de9841bc4cfb9bf609b9876a","modified":1604455192191},{"_id":"public/images/test0.png","hash":"b9342f8bd45cc2170225f5f0b203bae775301294","modified":1604455192191},{"_id":"public/images/pasted-99.png","hash":"c63d85255c5a2b200e5cf108abda90e03183eb31","modified":1604455192191},{"_id":"public/images/test2.png","hash":"5fb82c42590c92d6d42033149ff96043e616fd99","modified":1604455192191},{"_id":"public/images/test1.png","hash":"457c9a778fd6a9fba7f29f21d92dffec7f1f8b74","modified":1604455192191},{"_id":"public/images/timg.jpg","hash":"4a277e3710912cf0b991fe39e2cc8e46e95912e2","modified":1604455192191},{"_id":"public/images/timg2.png","hash":"a8463df09371ab0342881ae37f4f024e6bb3c6bb","modified":1604455192191},{"_id":"public/images/123.jpg","hash":"f070cc4dd7c1d47dffa9d9073f17a55105d59ea2","modified":1604455192191},{"_id":"public/lib/font-awesome/webfonts/fa-solid-900.woff2","hash":"75a88815c47a249eadb5f0edc1675957f860cca7","modified":1604455192191},{"_id":"public/lib/font-awesome/webfonts/fa-brands-400.woff2","hash":"509988477da79c146cb93fb728405f18e923c2de","modified":1604455192191},{"_id":"public/images/pasted-0.png","hash":"1eaf2b5cedfca83da876952ec91ad0adfcd71091","modified":1604455192191},{"_id":"public/images/pasted-102.png","hash":"bf7898cc2a64680c847dc2c69100c9eb5b574de4","modified":1604455192191},{"_id":"public/images/pasted-101.png","hash":"0dc28ee82a773386fa1530b99d0315860bcdb7fb","modified":1604455192191},{"_id":"public/images/pasted-12.png","hash":"cfbe82c4e6dafb6a0336b70fa168006f29b039e1","modified":1604455192191},{"_id":"public/images/pasted-3.png","hash":"41a868f5e506958e684cc60e2d62a229f0e2ebf8","modified":1604455192191},{"_id":"public/images/pasted-48.png","hash":"ab86459a06644503b1cb9e1f7404e7d465714fa7","modified":1604455192191},{"_id":"public/images/pasted-49.png","hash":"5565696564c8239c3de54c145c2263141ab78b84","modified":1604455192191},{"_id":"public/images/pasted-50.png","hash":"f936f2e1c4aa79b6d19d0bb6fbc211fc9b1acd91","modified":1604455192191},{"_id":"public/images/pasted-56.png","hash":"73c190d8eabf935b73cd40ae770f68baa0c2fea6","modified":1604455192191},{"_id":"public/images/pasted-60.png","hash":"49e263ec44ebaa4a11fdd7dbd1a6dc11e0627a3e","modified":1604455192191},{"_id":"public/images/pasted-61.png","hash":"8f9d510d762400c5cb8d992f8fd1f3601f012dda","modified":1604455192191},{"_id":"public/images/pasted-64.png","hash":"e85e05b21c7331484c993dd94db59932fd2dd59c","modified":1604455192191},{"_id":"public/images/pasted-77.png","hash":"1cea5bf2c46af32ea7ebc9fc7d3773e5039c8c27","modified":1604455192191},{"_id":"public/images/pasted-79.png","hash":"b957a36cf77cde051b16cf13ea46d4265c3fd905","modified":1604455192191},{"_id":"public/images/pasted-82.png","hash":"3281a39bae0e6aa24b5a69ced392dddda8da0256","modified":1604455192191},{"_id":"public/images/pasted-13.png","hash":"1e8b0da1b5a3b6faf102fe1f4d4a16867b5e903c","modified":1604455192191},{"_id":"public/images/pasted-11.png","hash":"627c7f40319d111221a2bf42a7a85e7dd57ece37","modified":1604455192191},{"_id":"public/images/pasted-65.png","hash":"743fd0abfa44b7e2bf44da8247d59552bbccde00","modified":1604455192191},{"_id":"public/images/pasted-66.png","hash":"743fd0abfa44b7e2bf44da8247d59552bbccde00","modified":1604455192191},{"_id":"public/images/pasted-81.png","hash":"37f46e60409c2c2209b43bb882978e2a2e83bd0b","modified":1604455192191},{"_id":"public/js/bookmark.js","hash":"9734ebcb9b83489686f5c2da67dc9e6157e988ad","modified":1604455192191},{"_id":"public/js/next-boot.js","hash":"a1b0636423009d4a4e4cea97bcbf1842bfab582c","modified":1604455192191},{"_id":"public/js/algolia-search.js","hash":"498d233eb5c7af6940baf94c1a1c36fdf1dd2636","modified":1604455192191},{"_id":"public/js/local-search.js","hash":"35ccf100d8f9c0fd6bfbb7fa88c2a76c42a69110","modified":1604455192191},{"_id":"public/js/utils.js","hash":"730cca7f164eaf258661a61ff3f769851ff1e5da","modified":1604455192191},{"_id":"public/js/schemes/muse.js","hash":"1eb9b88103ddcf8827b1a7cbc56471a9c5592d53","modified":1604455192191},{"_id":"public/js/src/clicklove.js","hash":"effa770d8085f7e7fb903de217ce521dff163780","modified":1604455192191},{"_id":"public/js/schemes/pisces.js","hash":"0ac5ce155bc58c972fe21c4c447f85e6f8755c62","modified":1604455192191},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1604455192191},{"_id":"public/js/motion.js","hash":"72df86f6dfa29cce22abeff9d814c9dddfcf13a9","modified":1604455192191},{"_id":"public/css/main.css","hash":"bc3b056c504148752124409f5da02e840b010529","modified":1604455192191},{"_id":"public/lib/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1604455192191},{"_id":"public/images/docker核心组件.png","hash":"f86df71319e63584a47e3fbb9e6b864610356271","modified":1604455192191},{"_id":"public/images/pasted-67.png","hash":"743fd0abfa44b7e2bf44da8247d59552bbccde00","modified":1604455192191},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1604455192191},{"_id":"public/images/pasted-53.png","hash":"6fcb8414f72a42cc506dea206d8333bb3cd51938","modified":1604455192191},{"_id":"public/lib/font-awesome/css/all.min.css","hash":"0038dc97c79451578b7bd48af60ba62282b4082b","modified":1604455192191},{"_id":"public/images/pasted-15.png","hash":"11787a89633ff0004614828d9ead707877b0c891","modified":1604455192191},{"_id":"public/images/pasted-84.png","hash":"cb4922f5d69975d9f57b2e33550a7292393ab8a0","modified":1604455192191},{"_id":"public/images/pasted-83.png","hash":"29a50f273f91c463b158b72a6d640c6184fb3960","modified":1604455192191},{"_id":"public/images/pasted-80.png","hash":"b1d577b99876f9cecc4011da95207484223082ee","modified":1604455192191},{"_id":"public/images/pasted-90.png","hash":"0453a9f366c69cd85fa792568789664fe5567403","modified":1604455192191}],"Category":[{"name":"高可用","_id":"ckh2r736t0004m3pv0jykckfh"},{"name":"Ansible","_id":"ckh2r736x000am3pvbeym20c4"},{"name":"Linux","_id":"ckh2r7373000lm3pvh3jtagzl"},{"name":"Docker","_id":"ckh2r7375000sm3pv8e3s1hrf"},{"name":"Hexo","_id":"ckh2r737g001sm3pv7rh2ce7e"},{"name":"Kubernetes","_id":"ckh2r737n0029m3pv0a2396zs"},{"name":"微服务","_id":"ckh2r737y0034m3pv4bp8eet5"}],"Data":[],"Page":[{"title":"关于","date":"2020-09-10T03:17:21.000Z","_content":"\t\t\t\t#### 开启博客生涯\n","source":"about/index.md","raw":"---\ntitle: 关于\ndate: 2020-09-10 11:17:21\n---\n\t\t\t\t#### 开启博客生涯\n","updated":"2020-09-10T05:17:49.607Z","path":"about/index.html","comments":1,"layout":"page","_id":"ckh2r736k0000m3pv1lko75xx","content":"<pre><code>            #### 开启博客生涯</code></pre>\n","site":{"data":{}},"excerpt":"","more":"<pre><code>            #### 开启博客生涯</code></pre>\n"},{"title":"分类","date":"2020-09-10T03:17:13.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2020-09-10 11:17:13\ntype: categories\n---\n","updated":"2020-09-10T05:15:57.431Z","path":"categories/index.html","comments":1,"layout":"page","_id":"ckh2r736r0002m3pv1mgidlm4","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"标签","date":"2020-09-10T03:16:44.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2020-09-10 11:16:44\ntype: tags\n---\n","updated":"2020-09-10T05:15:47.122Z","path":"tags/index.html","comments":1,"layout":"page","_id":"ckh2r736u0006m3pv35m326ab","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Haproxy","author":"Semaik.","date":"2020-09-22T11:25:00.000Z","_content":"","source":"_drafts/Haproxy-Keepalived高可用负载均衡构建.md","raw":"title: Haproxy\nauthor: Semaik.\ntags:\n  - 高可用\ncategories:\n  - 高可用\ndate: 2020-09-22 19:25:00\n---\n","slug":"Haproxy-Keepalived高可用负载均衡构建","published":0,"updated":"2020-09-22T11:28:25.414Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r736p0001m3pv368p54pv","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Samba文件共享服务","author":"Semaik.","_content":"","source":"_drafts/Samba文件共享服务.md","raw":"---\ntitle: Samba文件共享服务\nauthor: Semaik.\ntags:\n---\n","slug":"Samba文件共享服务","published":0,"date":"2020-09-25T02:54:56.646Z","updated":"2020-09-25T02:54:56.646Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r736s0003m3pv57eo6ahc","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Ansible常用模块","author":"Semaik.","date":"2020-09-18T09:32:00.000Z","_content":"###### ping模块：\n检测各主机之间的连接状况\n\n如：\n```sh\n[root@localhost ~]# ansible all -m ping\n```\n###### command模块：\n主要用于执行简单的shell命令：单个命令\n\n如：ls、cat等类似简单命令，不带有管道符类似操作的使用shell模块\n\n例：\n```sh\n[root@localhost ~]# ansible dbserver -m command -a 'ls /root'\n# 配置主机清单时dbserver中，只写入了1.4，所以结果只有1.4主机运行ls /root\n192.168.1.4 | CHANGED | rc=0 >>\nanaconda-ks.cfg\ninitial-setup-ks.cfg\n公共\n模板\n视频\n图片\n文档\n下载\n音乐\n桌面\n```\n###### shell模块\n执行linux复杂命令\n```sh\n[root@localhost ~]# ansible dbserver -m shell -a 'ls /root/ | wc -l'\n192.168.1.4 | CHANGED | rc=0 >>\n10\n```\n###### args\n如果在编译安装包时，需要进入目录进行配置，使用以下\n```sh\n\n- shell: ./configure && make && make install\n  args:\n    chdir: 解压包路径\n```\n###### cron模块\n执行计划任务，用于为被控制端设置自动化任务\n```sh\n\n# 设置任务\n[root@localhost ~]# ansible dbserver -m cron -a 'minute=\"*/2\" job=\"date >> /tmp/date.txt\" name=\"show date\" state=present'\nstate=persent:一般表示新增\n# 删除任务，只需要指定name即可\n[root@localhost ~]# ansible dbserver -m cron -a ' name=\"show date\" state=absent'\nstate=absent：一般表示移除，可以用来删除计划任务\n# cron的其他关键字参考\n[root@localhost ~]# ansible-doc -s cron\n```\n###### user模块\n常用操作\n```sh\nuseradd 用户名\t\t# 创建普通用户\npasswd 用户名\t\t# 设置用户密码\nuseradd -M -s /sbin/nologin 用户名\t\t# 创建的用户没有家目录，不能登录\nuseradd -u 用户id -g gid 用户名   # 创建用户时指定uid和gid\nuserdel -r 用户\t\t\t# 连同用户家目录一起删除用户\n```\n以上操作通过ansible来完成\n```sh\nansible 操作对象 -m user -a 'name=用户名 state=present'\t# 创建用户\n# openssl passwd \"123.com\"用来获取加密后的密码\nansible 操作对象 -m user -a 'name=用户名 password=\"加密密码\" state=present'   # 创建用户并设置密码\nansible 操作对象 -m shell -a 'echo \"123.com\" | passwd --stdin 用户名'   # 设置用户密码\n# 创建无家目录，不能登录的用户\nansible 操作对象 -m user -a 'name=用户名 create_home=no shell=/sbin/nologin state=present'  \n# 创建用户是指定uid和基本组\nansible 操作对象 -m user -a 'name=用户名 uid=id号 group=组名 state=present'\n# 连同用户家目录一同删除\nansible 操作对象 -m user -a 'name=用户名 remove=yes state=absent'\n```\n###### group模块\n```sh\n添加组\nansible 操作对象 -m group -a 'name=组名 system=yes state=present gid=ID号'\nsystem=yes：是否是公共组\n删除组\nansible 操作对象 -m group -a 'name=组名 state=absent'\n```\n###### copy模块\n1、从主控端复制文件到被控端（类似scp）\n```sh\nansible all -m copy -a 'src=主控端文件路径 dest=被控端保存路径'\n# 在被控端查看是否复制文件成功\nansible all -m shell -a 'ls 被控端保存文件路径'\n```\n2、主控端控制被控端复制和粘贴被控端的文件\n```sh\nansible 操作对象 -m copy -a 'src=被控端源文件路径 dest=被控端目标位置 remote_src=yes'\n# 验证ansible的幂等性，remote_src=yes，当发现同文件名时，不执行此命令\nansible 操作对象 -m copy -a 'src=被控端源文件路径 dest=被控端目标位置 remote_src=yes backup=yes'\n# 修改被控端/root/resolv.conf的内容，使其可以发生文件覆盖，此时在加上backup进行文件覆盖前的备份\n```\n###### file模块\n1、修改文件属性（owner（属主） group（属组） mode（权限） 对应linux命令 chown chmod\n\n```sh\n# 改变属主属组\nansible 操作对象 -m file -a 'path=被控端都存在的要修改属主属组的文件路径 owner=被控端都存在的用户 group=被控端都存在的组 recurse=yes'\n recurse=yes：表示递归设置属主属组\n# 修改文件权限\nansible 操作对象 -m file -a 'path=被控端存在的文件路径 mode=7777 recurse=yes'\n 使用mnnn样式的四位8进制数表示，recurse=yes：对当前目录中的所有内容递归权限\n``` \n\n2、软链接、硬链接\n\n```sh\n# 软链接\nansible 操作对象 -m file -a 'src=被控端源文件 dest=软链接文件路径 state=link'\n# 硬链接\nansible 操作对象 -m file -a 'src=被控端源文件 dest=硬链接文件路径 state=hard'\n```\n3、创建文件和目录\n```sh\n# 创建文件\nansible 操作对象 -m file -a 'path=文件路径及文件名 state=touch'\n# 创建目录\nansible 操作对象 -m file -a 'path=目录路径及目录名 state=directory'\n# 删除文件或者目录\nansible 操作对象 -m file -a 'path=被控端删除文件或目录路径 state=absent'\n```\n###### yum模块\n主控端控制被控端，使其使用yum安装rpm包\n\n前提：被控端的yum可用\n```sh\n# 安装rpm某包\nansible 操作对象 -m yum -a 'name=包名,包名1... state=installed/present    # 默认不写state是installed/present\n# 卸载rpm包\nansible 操作对象 -m yum -a 'name=包名,包名1... state=removed/absent\n```\n###### service模块\n操控被控端开启、关闭、重启、重载（视具体服务而定）\n\nnotice：service可用管理rpm包安装的服务，源码安装的服务建议使用shell模块直接打命令\n\n服务状态：started/stopped/restarted/reloaded\n```sh\nansible 操作对象 -m service -a 'name=服务名 state=服务状态'\n```\n###### hostname模块\n修改主机名操作\n\nhostname 主机名 临时\n\nhostnamectl set-hostname 主机名 永久\n\nvim /etc/hosts 修改配置文件\n```sh\nansible 操作对象 -m hostname -a 'name=主机名'\n```\n\n###### script模块\n用于将主控端的脚本在被控端执行，shell脚本和python脚本\n\n写一个简单创建用户的脚本\n```sh\n!/bin/bash\nfor i in {1..10}\n    do\n        useradd user$i\n        echo '123.com' | passwd --stdin user$i\n    done\n```\n添加脚本可执行权限\n\n`chmod +x users.sh\n`\n使用script模块执行脚本\n```sh\n# 执行脚本\nansible 操作对象 -m script -a '脚本文件在主控端的路径'\n# 验证\nansible 操作对象 -m shell -a 'tail /etc/passwd'\n```\n###### setup模块\n用于获取被控端的ansible变量值，主要用于模板剧本中，可以利用变量，实现对被控端的快速配置和差异化配置\n\nansible变量：用于记录所有主控端和被控端的连接信息\n\nansible dbserver -m setup 查看所有的变量值\n\n常用选项：ansible 操作对象 -m setup -a 'filter=\"*变量关键字*\"' filter用于筛选变量\n\n如：\n```sh\n# 关于cpu的变量\nansible dbserver -m setup -a 'filter=\"*cpu*\"'\n```\n###### fetch模块\n拿取被控端文件\n```sh\n# 存放时，会将每台被控端创建一个ip目录\nansible 操作对象 -m fetch -a 'src=被控端文件路径 dest=主控端存放路径'\n```\n###### replace模块\n可以实现对文件内容的替换\n```sh\n# 替换文件中所有匹配的字符\nansible dbserver -m replace -a 'path=被控端文件路径 regexp='匹配要替换的字符' replace='替换后的字符''\n# 替换指定行\n```\n###### template模块\n主要用于主控端使用模板配置被控端配置文件的场景\n\n需要用到模板文件，文件必须以.j2结尾\n\n以web应用apache为例\n\n主控端和被控端都通过yum模块按照了httpd，在主控端更改配置文件，并重命名.j2结尾\n```sh\nansible webserver -m template -a 'src=.j2文件路径 dest=被控端主配置文件路径'\n如：\nansible webserver -m template -a 'src=httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf'\n```\n也可以在主控端配置文件中引用变量，在主机清单文件中修改\n```sh\n[root@localhost ~]# vim /etc/ansible/hosts\n[webserver]\n192.168.1.5 http_port=88\n192.168.1.6 http_port=90\n```\n修改.j2文件\n```sh\n[root@localhost ~]# vim httpd.conf.j2 \n {{http_port}} 引用变量\nServerName www.example.com {{http_port}}\n```\n将.j2文件传送\n```sh\nansible webserver -m template -a 'src=httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf'\n```\n这个时候查看被控端的配置文件中，发现1.5的端口为88,16的端口为90\n\n###### unarchive模块\n将主控端的压缩文件，解压后放在被控端\n\n在主控端有一个nginx安装包，执行以下操作直接解压到被控端\n```sh\nansible 操作对象 -m unarchive -a 'src=主控端安装包路径 dest=解压后的被控端存放路径'\n```\n###### lineinfile模块\n修改配置文件时，修改指定行的内容，或者添加到指定行前和指定行后\n\n可以实现在文件加入内容\n\n命令参数说明：\n\n| 参数 | 含义 |\n| :---: | :---: |\n| path | 指定要操作的文件对象 |\n|egexp\t|匹配条件|\n|insertbefore\t|在指定行前插入|\n|insertafter\t|在指定行后插入|\n|line\t|要写入的文件内容|\n|state\t|present（添加）absent（删除）|\n\ninsertbefore和insertafter的特殊值\n\nBOF：begin of file（文件起始位置）\nEOF：end of file （文件结束位置）\n\n使用insertbefore和insertafter，还有regexp时，需要指定state，其他不需要\n\n在文件开头插入内容 \n```sh\nansible 操作对象 -m lineinfile -a 'path=文件路径 insertbefore=BOF line=\"插入的内容\"'\n如：\nansible dbserver -m lineinfile -a 'path=/root/nginx.conf insertbefore=BOF line=\"# nihao a\"'\n 在nginx.conf文件开头添\"# nihao a\"\n```\n在文件结束插入内容\n```sh\nansible 操作对象 -m lineinfile -a 'path=文件路径 insertbefore=EOF line=\"插入的内容\"'\n如：\nansible dbserver -m lineinfile -a 'path=/root/nginx.conf insertbefore=EOF line=\"# nihao a\"'\n 在nginx.conf文件的末尾添加# nihao a\n```\n在文件指定位置加入内容\n```sh\nansible 操作对象 -m lineinfile -a 'path=文件路径 insertbefore=\"指定位置的内容\" line=\"插入的内容\" state=present\n如：\nansible dbserver -m lineinfile -a 'path=/root/nginx.conf insertbefore=\"  server {\" line=\"root html\" state=present'\n 在nginx.conf的server {的上一行添加root html\n```\n删除文件中的指定内容\n```sh\nansible 操作对象 -m lineinfile -a 'path=文件路径 regexp=\"要删除的内容\" line=\"插入的内容\" state=absent\n如：\nansible dbserver -m lineinfile -a 'path=/root/nginx.conf regexp=\" server {\" state=absent'\n 删除nginx.conf的server { 这一行\n```","source":"_posts/Ansible常用模块.md","raw":"title: Ansible常用模块\nauthor: Semaik.\ntags:\n  - Ansible\ncategories:\n  - Ansible\ndate: 2020-09-18 17:32:00\n---\n###### ping模块：\n检测各主机之间的连接状况\n\n如：\n```sh\n[root@localhost ~]# ansible all -m ping\n```\n###### command模块：\n主要用于执行简单的shell命令：单个命令\n\n如：ls、cat等类似简单命令，不带有管道符类似操作的使用shell模块\n\n例：\n```sh\n[root@localhost ~]# ansible dbserver -m command -a 'ls /root'\n# 配置主机清单时dbserver中，只写入了1.4，所以结果只有1.4主机运行ls /root\n192.168.1.4 | CHANGED | rc=0 >>\nanaconda-ks.cfg\ninitial-setup-ks.cfg\n公共\n模板\n视频\n图片\n文档\n下载\n音乐\n桌面\n```\n###### shell模块\n执行linux复杂命令\n```sh\n[root@localhost ~]# ansible dbserver -m shell -a 'ls /root/ | wc -l'\n192.168.1.4 | CHANGED | rc=0 >>\n10\n```\n###### args\n如果在编译安装包时，需要进入目录进行配置，使用以下\n```sh\n\n- shell: ./configure && make && make install\n  args:\n    chdir: 解压包路径\n```\n###### cron模块\n执行计划任务，用于为被控制端设置自动化任务\n```sh\n\n# 设置任务\n[root@localhost ~]# ansible dbserver -m cron -a 'minute=\"*/2\" job=\"date >> /tmp/date.txt\" name=\"show date\" state=present'\nstate=persent:一般表示新增\n# 删除任务，只需要指定name即可\n[root@localhost ~]# ansible dbserver -m cron -a ' name=\"show date\" state=absent'\nstate=absent：一般表示移除，可以用来删除计划任务\n# cron的其他关键字参考\n[root@localhost ~]# ansible-doc -s cron\n```\n###### user模块\n常用操作\n```sh\nuseradd 用户名\t\t# 创建普通用户\npasswd 用户名\t\t# 设置用户密码\nuseradd -M -s /sbin/nologin 用户名\t\t# 创建的用户没有家目录，不能登录\nuseradd -u 用户id -g gid 用户名   # 创建用户时指定uid和gid\nuserdel -r 用户\t\t\t# 连同用户家目录一起删除用户\n```\n以上操作通过ansible来完成\n```sh\nansible 操作对象 -m user -a 'name=用户名 state=present'\t# 创建用户\n# openssl passwd \"123.com\"用来获取加密后的密码\nansible 操作对象 -m user -a 'name=用户名 password=\"加密密码\" state=present'   # 创建用户并设置密码\nansible 操作对象 -m shell -a 'echo \"123.com\" | passwd --stdin 用户名'   # 设置用户密码\n# 创建无家目录，不能登录的用户\nansible 操作对象 -m user -a 'name=用户名 create_home=no shell=/sbin/nologin state=present'  \n# 创建用户是指定uid和基本组\nansible 操作对象 -m user -a 'name=用户名 uid=id号 group=组名 state=present'\n# 连同用户家目录一同删除\nansible 操作对象 -m user -a 'name=用户名 remove=yes state=absent'\n```\n###### group模块\n```sh\n添加组\nansible 操作对象 -m group -a 'name=组名 system=yes state=present gid=ID号'\nsystem=yes：是否是公共组\n删除组\nansible 操作对象 -m group -a 'name=组名 state=absent'\n```\n###### copy模块\n1、从主控端复制文件到被控端（类似scp）\n```sh\nansible all -m copy -a 'src=主控端文件路径 dest=被控端保存路径'\n# 在被控端查看是否复制文件成功\nansible all -m shell -a 'ls 被控端保存文件路径'\n```\n2、主控端控制被控端复制和粘贴被控端的文件\n```sh\nansible 操作对象 -m copy -a 'src=被控端源文件路径 dest=被控端目标位置 remote_src=yes'\n# 验证ansible的幂等性，remote_src=yes，当发现同文件名时，不执行此命令\nansible 操作对象 -m copy -a 'src=被控端源文件路径 dest=被控端目标位置 remote_src=yes backup=yes'\n# 修改被控端/root/resolv.conf的内容，使其可以发生文件覆盖，此时在加上backup进行文件覆盖前的备份\n```\n###### file模块\n1、修改文件属性（owner（属主） group（属组） mode（权限） 对应linux命令 chown chmod\n\n```sh\n# 改变属主属组\nansible 操作对象 -m file -a 'path=被控端都存在的要修改属主属组的文件路径 owner=被控端都存在的用户 group=被控端都存在的组 recurse=yes'\n recurse=yes：表示递归设置属主属组\n# 修改文件权限\nansible 操作对象 -m file -a 'path=被控端存在的文件路径 mode=7777 recurse=yes'\n 使用mnnn样式的四位8进制数表示，recurse=yes：对当前目录中的所有内容递归权限\n``` \n\n2、软链接、硬链接\n\n```sh\n# 软链接\nansible 操作对象 -m file -a 'src=被控端源文件 dest=软链接文件路径 state=link'\n# 硬链接\nansible 操作对象 -m file -a 'src=被控端源文件 dest=硬链接文件路径 state=hard'\n```\n3、创建文件和目录\n```sh\n# 创建文件\nansible 操作对象 -m file -a 'path=文件路径及文件名 state=touch'\n# 创建目录\nansible 操作对象 -m file -a 'path=目录路径及目录名 state=directory'\n# 删除文件或者目录\nansible 操作对象 -m file -a 'path=被控端删除文件或目录路径 state=absent'\n```\n###### yum模块\n主控端控制被控端，使其使用yum安装rpm包\n\n前提：被控端的yum可用\n```sh\n# 安装rpm某包\nansible 操作对象 -m yum -a 'name=包名,包名1... state=installed/present    # 默认不写state是installed/present\n# 卸载rpm包\nansible 操作对象 -m yum -a 'name=包名,包名1... state=removed/absent\n```\n###### service模块\n操控被控端开启、关闭、重启、重载（视具体服务而定）\n\nnotice：service可用管理rpm包安装的服务，源码安装的服务建议使用shell模块直接打命令\n\n服务状态：started/stopped/restarted/reloaded\n```sh\nansible 操作对象 -m service -a 'name=服务名 state=服务状态'\n```\n###### hostname模块\n修改主机名操作\n\nhostname 主机名 临时\n\nhostnamectl set-hostname 主机名 永久\n\nvim /etc/hosts 修改配置文件\n```sh\nansible 操作对象 -m hostname -a 'name=主机名'\n```\n\n###### script模块\n用于将主控端的脚本在被控端执行，shell脚本和python脚本\n\n写一个简单创建用户的脚本\n```sh\n!/bin/bash\nfor i in {1..10}\n    do\n        useradd user$i\n        echo '123.com' | passwd --stdin user$i\n    done\n```\n添加脚本可执行权限\n\n`chmod +x users.sh\n`\n使用script模块执行脚本\n```sh\n# 执行脚本\nansible 操作对象 -m script -a '脚本文件在主控端的路径'\n# 验证\nansible 操作对象 -m shell -a 'tail /etc/passwd'\n```\n###### setup模块\n用于获取被控端的ansible变量值，主要用于模板剧本中，可以利用变量，实现对被控端的快速配置和差异化配置\n\nansible变量：用于记录所有主控端和被控端的连接信息\n\nansible dbserver -m setup 查看所有的变量值\n\n常用选项：ansible 操作对象 -m setup -a 'filter=\"*变量关键字*\"' filter用于筛选变量\n\n如：\n```sh\n# 关于cpu的变量\nansible dbserver -m setup -a 'filter=\"*cpu*\"'\n```\n###### fetch模块\n拿取被控端文件\n```sh\n# 存放时，会将每台被控端创建一个ip目录\nansible 操作对象 -m fetch -a 'src=被控端文件路径 dest=主控端存放路径'\n```\n###### replace模块\n可以实现对文件内容的替换\n```sh\n# 替换文件中所有匹配的字符\nansible dbserver -m replace -a 'path=被控端文件路径 regexp='匹配要替换的字符' replace='替换后的字符''\n# 替换指定行\n```\n###### template模块\n主要用于主控端使用模板配置被控端配置文件的场景\n\n需要用到模板文件，文件必须以.j2结尾\n\n以web应用apache为例\n\n主控端和被控端都通过yum模块按照了httpd，在主控端更改配置文件，并重命名.j2结尾\n```sh\nansible webserver -m template -a 'src=.j2文件路径 dest=被控端主配置文件路径'\n如：\nansible webserver -m template -a 'src=httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf'\n```\n也可以在主控端配置文件中引用变量，在主机清单文件中修改\n```sh\n[root@localhost ~]# vim /etc/ansible/hosts\n[webserver]\n192.168.1.5 http_port=88\n192.168.1.6 http_port=90\n```\n修改.j2文件\n```sh\n[root@localhost ~]# vim httpd.conf.j2 \n {{http_port}} 引用变量\nServerName www.example.com {{http_port}}\n```\n将.j2文件传送\n```sh\nansible webserver -m template -a 'src=httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf'\n```\n这个时候查看被控端的配置文件中，发现1.5的端口为88,16的端口为90\n\n###### unarchive模块\n将主控端的压缩文件，解压后放在被控端\n\n在主控端有一个nginx安装包，执行以下操作直接解压到被控端\n```sh\nansible 操作对象 -m unarchive -a 'src=主控端安装包路径 dest=解压后的被控端存放路径'\n```\n###### lineinfile模块\n修改配置文件时，修改指定行的内容，或者添加到指定行前和指定行后\n\n可以实现在文件加入内容\n\n命令参数说明：\n\n| 参数 | 含义 |\n| :---: | :---: |\n| path | 指定要操作的文件对象 |\n|egexp\t|匹配条件|\n|insertbefore\t|在指定行前插入|\n|insertafter\t|在指定行后插入|\n|line\t|要写入的文件内容|\n|state\t|present（添加）absent（删除）|\n\ninsertbefore和insertafter的特殊值\n\nBOF：begin of file（文件起始位置）\nEOF：end of file （文件结束位置）\n\n使用insertbefore和insertafter，还有regexp时，需要指定state，其他不需要\n\n在文件开头插入内容 \n```sh\nansible 操作对象 -m lineinfile -a 'path=文件路径 insertbefore=BOF line=\"插入的内容\"'\n如：\nansible dbserver -m lineinfile -a 'path=/root/nginx.conf insertbefore=BOF line=\"# nihao a\"'\n 在nginx.conf文件开头添\"# nihao a\"\n```\n在文件结束插入内容\n```sh\nansible 操作对象 -m lineinfile -a 'path=文件路径 insertbefore=EOF line=\"插入的内容\"'\n如：\nansible dbserver -m lineinfile -a 'path=/root/nginx.conf insertbefore=EOF line=\"# nihao a\"'\n 在nginx.conf文件的末尾添加# nihao a\n```\n在文件指定位置加入内容\n```sh\nansible 操作对象 -m lineinfile -a 'path=文件路径 insertbefore=\"指定位置的内容\" line=\"插入的内容\" state=present\n如：\nansible dbserver -m lineinfile -a 'path=/root/nginx.conf insertbefore=\"  server {\" line=\"root html\" state=present'\n 在nginx.conf的server {的上一行添加root html\n```\n删除文件中的指定内容\n```sh\nansible 操作对象 -m lineinfile -a 'path=文件路径 regexp=\"要删除的内容\" line=\"插入的内容\" state=absent\n如：\nansible dbserver -m lineinfile -a 'path=/root/nginx.conf regexp=\" server {\" state=absent'\n 删除nginx.conf的server { 这一行\n```","slug":"Ansible常用模块","published":1,"updated":"2020-09-18T12:46:08.419Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r736u0007m3pv711bfuzl","content":"<h6 id=\"ping模块：\"><a href=\"#ping模块：\" class=\"headerlink\" title=\"ping模块：\"></a>ping模块：</h6><p>检测各主机之间的连接状况</p>\n<p>如：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># ansible all -m ping</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"command模块：\"><a href=\"#command模块：\" class=\"headerlink\" title=\"command模块：\"></a>command模块：</h6><p>主要用于执行简单的shell命令：单个命令</p>\n<p>如：ls、cat等类似简单命令，不带有管道符类似操作的使用shell模块</p>\n<p>例：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># ansible dbserver -m command -a &#x27;ls /root&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 配置主机清单时dbserver中，只写入了1.4，所以结果只有1.4主机运行ls /root</span></span><br><span class=\"line\">192.168.1.4 | CHANGED | rc=0 &gt;&gt;</span><br><span class=\"line\">anaconda-ks.cfg</span><br><span class=\"line\">initial-setup-ks.cfg</span><br><span class=\"line\">公共</span><br><span class=\"line\">模板</span><br><span class=\"line\">视频</span><br><span class=\"line\">图片</span><br><span class=\"line\">文档</span><br><span class=\"line\">下载</span><br><span class=\"line\">音乐</span><br><span class=\"line\">桌面</span><br></pre></td></tr></table></figure>\n<h6 id=\"shell模块\"><a href=\"#shell模块\" class=\"headerlink\" title=\"shell模块\"></a>shell模块</h6><p>执行linux复杂命令</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># ansible dbserver -m shell -a &#x27;ls /root/ | wc -l&#x27;</span></span><br><span class=\"line\">192.168.1.4 | CHANGED | rc=0 &gt;&gt;</span><br><span class=\"line\">10</span><br></pre></td></tr></table></figure>\n<h6 id=\"args\"><a href=\"#args\" class=\"headerlink\" title=\"args\"></a>args</h6><p>如果在编译安装包时，需要进入目录进行配置，使用以下</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- shell: ./configure &amp;&amp; make &amp;&amp; make install</span><br><span class=\"line\">  args:</span><br><span class=\"line\">    <span class=\"built_in\">chdir</span>: 解压包路径</span><br></pre></td></tr></table></figure>\n<h6 id=\"cron模块\"><a href=\"#cron模块\" class=\"headerlink\" title=\"cron模块\"></a>cron模块</h6><p>执行计划任务，用于为被控制端设置自动化任务</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置任务</span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># ansible dbserver -m cron -a &#x27;minute=&quot;*/2&quot; job=&quot;date &gt;&gt; /tmp/date.txt&quot; name=&quot;show date&quot; state=present&#x27;</span></span><br><span class=\"line\">state=persent:一般表示新增</span><br><span class=\"line\"><span class=\"comment\"># 删除任务，只需要指定name即可</span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># ansible dbserver -m cron -a &#x27; name=&quot;show date&quot; state=absent&#x27;</span></span><br><span class=\"line\">state=absent：一般表示移除，可以用来删除计划任务</span><br><span class=\"line\"><span class=\"comment\"># cron的其他关键字参考</span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># ansible-doc -s cron</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"user模块\"><a href=\"#user模块\" class=\"headerlink\" title=\"user模块\"></a>user模块</h6><p>常用操作</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd 用户名\t\t<span class=\"comment\"># 创建普通用户</span></span><br><span class=\"line\">passwd 用户名\t\t<span class=\"comment\"># 设置用户密码</span></span><br><span class=\"line\">useradd -M -s /sbin/nologin 用户名\t\t<span class=\"comment\"># 创建的用户没有家目录，不能登录</span></span><br><span class=\"line\">useradd -u 用户id -g gid 用户名   <span class=\"comment\"># 创建用户时指定uid和gid</span></span><br><span class=\"line\">userdel -r 用户\t\t\t<span class=\"comment\"># 连同用户家目录一起删除用户</span></span><br></pre></td></tr></table></figure>\n<p>以上操作通过ansible来完成</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m user -a <span class=\"string\">&#x27;name=用户名 state=present&#x27;</span>\t<span class=\"comment\"># 创建用户</span></span><br><span class=\"line\"><span class=\"comment\"># openssl passwd &quot;123.com&quot;用来获取加密后的密码</span></span><br><span class=\"line\">ansible 操作对象 -m user -a <span class=\"string\">&#x27;name=用户名 password=&quot;加密密码&quot; state=present&#x27;</span>   <span class=\"comment\"># 创建用户并设置密码</span></span><br><span class=\"line\">ansible 操作对象 -m shell -a <span class=\"string\">&#x27;echo &quot;123.com&quot; | passwd --stdin 用户名&#x27;</span>   <span class=\"comment\"># 设置用户密码</span></span><br><span class=\"line\"><span class=\"comment\"># 创建无家目录，不能登录的用户</span></span><br><span class=\"line\">ansible 操作对象 -m user -a <span class=\"string\">&#x27;name=用户名 create_home=no shell=/sbin/nologin state=present&#x27;</span>  </span><br><span class=\"line\"><span class=\"comment\"># 创建用户是指定uid和基本组</span></span><br><span class=\"line\">ansible 操作对象 -m user -a <span class=\"string\">&#x27;name=用户名 uid=id号 group=组名 state=present&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 连同用户家目录一同删除</span></span><br><span class=\"line\">ansible 操作对象 -m user -a <span class=\"string\">&#x27;name=用户名 remove=yes state=absent&#x27;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"group模块\"><a href=\"#group模块\" class=\"headerlink\" title=\"group模块\"></a>group模块</h6><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">添加组</span><br><span class=\"line\">ansible 操作对象 -m group -a <span class=\"string\">&#x27;name=组名 system=yes state=present gid=ID号&#x27;</span></span><br><span class=\"line\">system=yes：是否是公共组</span><br><span class=\"line\">删除组</span><br><span class=\"line\">ansible 操作对象 -m group -a <span class=\"string\">&#x27;name=组名 state=absent&#x27;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"copy模块\"><a href=\"#copy模块\" class=\"headerlink\" title=\"copy模块\"></a>copy模块</h6><p>1、从主控端复制文件到被控端（类似scp）</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible all -m copy -a <span class=\"string\">&#x27;src=主控端文件路径 dest=被控端保存路径&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 在被控端查看是否复制文件成功</span></span><br><span class=\"line\">ansible all -m shell -a <span class=\"string\">&#x27;ls 被控端保存文件路径&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>2、主控端控制被控端复制和粘贴被控端的文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m copy -a <span class=\"string\">&#x27;src=被控端源文件路径 dest=被控端目标位置 remote_src=yes&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 验证ansible的幂等性，remote_src=yes，当发现同文件名时，不执行此命令</span></span><br><span class=\"line\">ansible 操作对象 -m copy -a <span class=\"string\">&#x27;src=被控端源文件路径 dest=被控端目标位置 remote_src=yes backup=yes&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 修改被控端/root/resolv.conf的内容，使其可以发生文件覆盖，此时在加上backup进行文件覆盖前的备份</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"file模块\"><a href=\"#file模块\" class=\"headerlink\" title=\"file模块\"></a>file模块</h6><p>1、修改文件属性（owner（属主） group（属组） mode（权限） 对应linux命令 chown chmod</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 改变属主属组</span></span><br><span class=\"line\">ansible 操作对象 -m file -a <span class=\"string\">&#x27;path=被控端都存在的要修改属主属组的文件路径 owner=被控端都存在的用户 group=被控端都存在的组 recurse=yes&#x27;</span></span><br><span class=\"line\"> recurse=yes：表示递归设置属主属组</span><br><span class=\"line\"><span class=\"comment\"># 修改文件权限</span></span><br><span class=\"line\">ansible 操作对象 -m file -a <span class=\"string\">&#x27;path=被控端存在的文件路径 mode=7777 recurse=yes&#x27;</span></span><br><span class=\"line\"> 使用mnnn样式的四位8进制数表示，recurse=yes：对当前目录中的所有内容递归权限</span><br><span class=\"line\">``` </span><br><span class=\"line\"></span><br><span class=\"line\">2、软链接、硬链接</span><br><span class=\"line\"></span><br><span class=\"line\">```sh</span><br><span class=\"line\"><span class=\"comment\"># 软链接</span></span><br><span class=\"line\">ansible 操作对象 -m file -a <span class=\"string\">&#x27;src=被控端源文件 dest=软链接文件路径 state=link&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 硬链接</span></span><br><span class=\"line\">ansible 操作对象 -m file -a <span class=\"string\">&#x27;src=被控端源文件 dest=硬链接文件路径 state=hard&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>3、创建文件和目录</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建文件</span></span><br><span class=\"line\">ansible 操作对象 -m file -a <span class=\"string\">&#x27;path=文件路径及文件名 state=touch&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 创建目录</span></span><br><span class=\"line\">ansible 操作对象 -m file -a <span class=\"string\">&#x27;path=目录路径及目录名 state=directory&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 删除文件或者目录</span></span><br><span class=\"line\">ansible 操作对象 -m file -a <span class=\"string\">&#x27;path=被控端删除文件或目录路径 state=absent&#x27;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"yum模块\"><a href=\"#yum模块\" class=\"headerlink\" title=\"yum模块\"></a>yum模块</h6><p>主控端控制被控端，使其使用yum安装rpm包</p>\n<p>前提：被控端的yum可用</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装rpm某包</span></span><br><span class=\"line\">ansible 操作对象 -m yum -a <span class=\"string\">&#x27;name=包名,包名1... state=installed/present    # 默认不写state是installed/present</span></span><br><span class=\"line\"><span class=\"string\"># 卸载rpm包</span></span><br><span class=\"line\"><span class=\"string\">ansible 操作对象 -m yum -a &#x27;</span>name=包名,包名1... state=removed/absent</span><br></pre></td></tr></table></figure>\n<h6 id=\"service模块\"><a href=\"#service模块\" class=\"headerlink\" title=\"service模块\"></a>service模块</h6><p>操控被控端开启、关闭、重启、重载（视具体服务而定）</p>\n<p>notice：service可用管理rpm包安装的服务，源码安装的服务建议使用shell模块直接打命令</p>\n<p>服务状态：started/stopped/restarted/reloaded</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m service -a <span class=\"string\">&#x27;name=服务名 state=服务状态&#x27;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"hostname模块\"><a href=\"#hostname模块\" class=\"headerlink\" title=\"hostname模块\"></a>hostname模块</h6><p>修改主机名操作</p>\n<p>hostname 主机名 临时</p>\n<p>hostnamectl set-hostname 主机名 永久</p>\n<p>vim /etc/hosts 修改配置文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m hostname -a <span class=\"string\">&#x27;name=主机名&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"script模块\"><a href=\"#script模块\" class=\"headerlink\" title=\"script模块\"></a>script模块</h6><p>用于将主控端的脚本在被控端执行，shell脚本和python脚本</p>\n<p>写一个简单创建用户的脚本</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">!/bin/bash</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> &#123;1..10&#125;</span><br><span class=\"line\">    <span class=\"keyword\">do</span></span><br><span class=\"line\">        useradd user<span class=\"variable\">$i</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;123.com&#x27;</span> | passwd --stdin user<span class=\"variable\">$i</span></span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n<p>添加脚本可执行权限</p>\n<p><code>chmod +x users.sh </code><br>使用script模块执行脚本</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 执行脚本</span></span><br><span class=\"line\">ansible 操作对象 -m script -a <span class=\"string\">&#x27;脚本文件在主控端的路径&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 验证</span></span><br><span class=\"line\">ansible 操作对象 -m shell -a <span class=\"string\">&#x27;tail /etc/passwd&#x27;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"setup模块\"><a href=\"#setup模块\" class=\"headerlink\" title=\"setup模块\"></a>setup模块</h6><p>用于获取被控端的ansible变量值，主要用于模板剧本中，可以利用变量，实现对被控端的快速配置和差异化配置</p>\n<p>ansible变量：用于记录所有主控端和被控端的连接信息</p>\n<p>ansible dbserver -m setup 查看所有的变量值</p>\n<p>常用选项：ansible 操作对象 -m setup -a ‘filter=”<em>变量关键字</em>“‘ filter用于筛选变量</p>\n<p>如：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 关于cpu的变量</span></span><br><span class=\"line\">ansible dbserver -m setup -a <span class=\"string\">&#x27;filter=&quot;*cpu*&quot;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"fetch模块\"><a href=\"#fetch模块\" class=\"headerlink\" title=\"fetch模块\"></a>fetch模块</h6><p>拿取被控端文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 存放时，会将每台被控端创建一个ip目录</span></span><br><span class=\"line\">ansible 操作对象 -m fetch -a <span class=\"string\">&#x27;src=被控端文件路径 dest=主控端存放路径&#x27;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"replace模块\"><a href=\"#replace模块\" class=\"headerlink\" title=\"replace模块\"></a>replace模块</h6><p>可以实现对文件内容的替换</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 替换文件中所有匹配的字符</span></span><br><span class=\"line\">ansible dbserver -m replace -a <span class=\"string\">&#x27;path=被控端文件路径 regexp=&#x27;</span>匹配要替换的字符<span class=\"string\">&#x27; replace=&#x27;</span>替换后的字符<span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 替换指定行</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"template模块\"><a href=\"#template模块\" class=\"headerlink\" title=\"template模块\"></a>template模块</h6><p>主要用于主控端使用模板配置被控端配置文件的场景</p>\n<p>需要用到模板文件，文件必须以.j2结尾</p>\n<p>以web应用apache为例</p>\n<p>主控端和被控端都通过yum模块按照了httpd，在主控端更改配置文件，并重命名.j2结尾</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webserver -m template -a <span class=\"string\">&#x27;src=.j2文件路径 dest=被控端主配置文件路径&#x27;</span></span><br><span class=\"line\">如：</span><br><span class=\"line\">ansible webserver -m template -a <span class=\"string\">&#x27;src=httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>也可以在主控端配置文件中引用变量，在主机清单文件中修改</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># vim /etc/ansible/hosts</span></span><br><span class=\"line\">[webserver]</span><br><span class=\"line\">192.168.1.5 http_port=88</span><br><span class=\"line\">192.168.1.6 http_port=90</span><br></pre></td></tr></table></figure>\n<p>修改.j2文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># vim httpd.conf.j2 </span></span><br><span class=\"line\"> &#123;&#123;http_port&#125;&#125; 引用变量</span><br><span class=\"line\">ServerName www.example.com &#123;&#123;http_port&#125;&#125;</span><br></pre></td></tr></table></figure>\n<p>将.j2文件传送</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webserver -m template -a <span class=\"string\">&#x27;src=httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>这个时候查看被控端的配置文件中，发现1.5的端口为88,16的端口为90</p>\n<h6 id=\"unarchive模块\"><a href=\"#unarchive模块\" class=\"headerlink\" title=\"unarchive模块\"></a>unarchive模块</h6><p>将主控端的压缩文件，解压后放在被控端</p>\n<p>在主控端有一个nginx安装包，执行以下操作直接解压到被控端</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m unarchive -a <span class=\"string\">&#x27;src=主控端安装包路径 dest=解压后的被控端存放路径&#x27;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"lineinfile模块\"><a href=\"#lineinfile模块\" class=\"headerlink\" title=\"lineinfile模块\"></a>lineinfile模块</h6><p>修改配置文件时，修改指定行的内容，或者添加到指定行前和指定行后</p>\n<p>可以实现在文件加入内容</p>\n<p>命令参数说明：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">参数</th>\n<th align=\"center\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">path</td>\n<td align=\"center\">指定要操作的文件对象</td>\n</tr>\n<tr>\n<td align=\"center\">egexp</td>\n<td align=\"center\">匹配条件</td>\n</tr>\n<tr>\n<td align=\"center\">insertbefore</td>\n<td align=\"center\">在指定行前插入</td>\n</tr>\n<tr>\n<td align=\"center\">insertafter</td>\n<td align=\"center\">在指定行后插入</td>\n</tr>\n<tr>\n<td align=\"center\">line</td>\n<td align=\"center\">要写入的文件内容</td>\n</tr>\n<tr>\n<td align=\"center\">state</td>\n<td align=\"center\">present（添加）absent（删除）</td>\n</tr>\n</tbody></table>\n<p>insertbefore和insertafter的特殊值</p>\n<p>BOF：begin of file（文件起始位置）<br>EOF：end of file （文件结束位置）</p>\n<p>使用insertbefore和insertafter，还有regexp时，需要指定state，其他不需要</p>\n<p>在文件开头插入内容 </p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m lineinfile -a <span class=\"string\">&#x27;path=文件路径 insertbefore=BOF line=&quot;插入的内容&quot;&#x27;</span></span><br><span class=\"line\">如：</span><br><span class=\"line\">ansible dbserver -m lineinfile -a <span class=\"string\">&#x27;path=/root/nginx.conf insertbefore=BOF line=&quot;# nihao a&quot;&#x27;</span></span><br><span class=\"line\"> 在nginx.conf文件开头添<span class=\"string\">&quot;# nihao a&quot;</span></span><br></pre></td></tr></table></figure>\n<p>在文件结束插入内容</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m lineinfile -a <span class=\"string\">&#x27;path=文件路径 insertbefore=EOF line=&quot;插入的内容&quot;&#x27;</span></span><br><span class=\"line\">如：</span><br><span class=\"line\">ansible dbserver -m lineinfile -a <span class=\"string\">&#x27;path=/root/nginx.conf insertbefore=EOF line=&quot;# nihao a&quot;&#x27;</span></span><br><span class=\"line\"> 在nginx.conf文件的末尾添加<span class=\"comment\"># nihao a</span></span><br></pre></td></tr></table></figure>\n<p>在文件指定位置加入内容</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m lineinfile -a <span class=\"string\">&#x27;path=文件路径 insertbefore=&quot;指定位置的内容&quot; line=&quot;插入的内容&quot; state=present</span></span><br><span class=\"line\"><span class=\"string\">如：</span></span><br><span class=\"line\"><span class=\"string\">ansible dbserver -m lineinfile -a &#x27;</span>path=/root/nginx.conf insertbefore=<span class=\"string\">&quot;  server &#123;&quot;</span> line=<span class=\"string\">&quot;root html&quot;</span> state=present<span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\"> 在nginx.conf的server &#123;的上一行添加root html</span></span><br></pre></td></tr></table></figure>\n<p>删除文件中的指定内容</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m lineinfile -a <span class=\"string\">&#x27;path=文件路径 regexp=&quot;要删除的内容&quot; line=&quot;插入的内容&quot; state=absent</span></span><br><span class=\"line\"><span class=\"string\">如：</span></span><br><span class=\"line\"><span class=\"string\">ansible dbserver -m lineinfile -a &#x27;</span>path=/root/nginx.conf regexp=<span class=\"string\">&quot; server &#123;&quot;</span> state=absent<span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\"> 删除nginx.conf的server &#123; 这一行</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h6 id=\"ping模块：\"><a href=\"#ping模块：\" class=\"headerlink\" title=\"ping模块：\"></a>ping模块：</h6><p>检测各主机之间的连接状况</p>\n<p>如：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># ansible all -m ping</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"command模块：\"><a href=\"#command模块：\" class=\"headerlink\" title=\"command模块：\"></a>command模块：</h6><p>主要用于执行简单的shell命令：单个命令</p>\n<p>如：ls、cat等类似简单命令，不带有管道符类似操作的使用shell模块</p>\n<p>例：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># ansible dbserver -m command -a &#x27;ls /root&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 配置主机清单时dbserver中，只写入了1.4，所以结果只有1.4主机运行ls /root</span></span><br><span class=\"line\">192.168.1.4 | CHANGED | rc=0 &gt;&gt;</span><br><span class=\"line\">anaconda-ks.cfg</span><br><span class=\"line\">initial-setup-ks.cfg</span><br><span class=\"line\">公共</span><br><span class=\"line\">模板</span><br><span class=\"line\">视频</span><br><span class=\"line\">图片</span><br><span class=\"line\">文档</span><br><span class=\"line\">下载</span><br><span class=\"line\">音乐</span><br><span class=\"line\">桌面</span><br></pre></td></tr></table></figure>\n<h6 id=\"shell模块\"><a href=\"#shell模块\" class=\"headerlink\" title=\"shell模块\"></a>shell模块</h6><p>执行linux复杂命令</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># ansible dbserver -m shell -a &#x27;ls /root/ | wc -l&#x27;</span></span><br><span class=\"line\">192.168.1.4 | CHANGED | rc=0 &gt;&gt;</span><br><span class=\"line\">10</span><br></pre></td></tr></table></figure>\n<h6 id=\"args\"><a href=\"#args\" class=\"headerlink\" title=\"args\"></a>args</h6><p>如果在编译安装包时，需要进入目录进行配置，使用以下</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- shell: ./configure &amp;&amp; make &amp;&amp; make install</span><br><span class=\"line\">  args:</span><br><span class=\"line\">    <span class=\"built_in\">chdir</span>: 解压包路径</span><br></pre></td></tr></table></figure>\n<h6 id=\"cron模块\"><a href=\"#cron模块\" class=\"headerlink\" title=\"cron模块\"></a>cron模块</h6><p>执行计划任务，用于为被控制端设置自动化任务</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置任务</span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># ansible dbserver -m cron -a &#x27;minute=&quot;*/2&quot; job=&quot;date &gt;&gt; /tmp/date.txt&quot; name=&quot;show date&quot; state=present&#x27;</span></span><br><span class=\"line\">state=persent:一般表示新增</span><br><span class=\"line\"><span class=\"comment\"># 删除任务，只需要指定name即可</span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># ansible dbserver -m cron -a &#x27; name=&quot;show date&quot; state=absent&#x27;</span></span><br><span class=\"line\">state=absent：一般表示移除，可以用来删除计划任务</span><br><span class=\"line\"><span class=\"comment\"># cron的其他关键字参考</span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># ansible-doc -s cron</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"user模块\"><a href=\"#user模块\" class=\"headerlink\" title=\"user模块\"></a>user模块</h6><p>常用操作</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd 用户名\t\t<span class=\"comment\"># 创建普通用户</span></span><br><span class=\"line\">passwd 用户名\t\t<span class=\"comment\"># 设置用户密码</span></span><br><span class=\"line\">useradd -M -s /sbin/nologin 用户名\t\t<span class=\"comment\"># 创建的用户没有家目录，不能登录</span></span><br><span class=\"line\">useradd -u 用户id -g gid 用户名   <span class=\"comment\"># 创建用户时指定uid和gid</span></span><br><span class=\"line\">userdel -r 用户\t\t\t<span class=\"comment\"># 连同用户家目录一起删除用户</span></span><br></pre></td></tr></table></figure>\n<p>以上操作通过ansible来完成</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m user -a <span class=\"string\">&#x27;name=用户名 state=present&#x27;</span>\t<span class=\"comment\"># 创建用户</span></span><br><span class=\"line\"><span class=\"comment\"># openssl passwd &quot;123.com&quot;用来获取加密后的密码</span></span><br><span class=\"line\">ansible 操作对象 -m user -a <span class=\"string\">&#x27;name=用户名 password=&quot;加密密码&quot; state=present&#x27;</span>   <span class=\"comment\"># 创建用户并设置密码</span></span><br><span class=\"line\">ansible 操作对象 -m shell -a <span class=\"string\">&#x27;echo &quot;123.com&quot; | passwd --stdin 用户名&#x27;</span>   <span class=\"comment\"># 设置用户密码</span></span><br><span class=\"line\"><span class=\"comment\"># 创建无家目录，不能登录的用户</span></span><br><span class=\"line\">ansible 操作对象 -m user -a <span class=\"string\">&#x27;name=用户名 create_home=no shell=/sbin/nologin state=present&#x27;</span>  </span><br><span class=\"line\"><span class=\"comment\"># 创建用户是指定uid和基本组</span></span><br><span class=\"line\">ansible 操作对象 -m user -a <span class=\"string\">&#x27;name=用户名 uid=id号 group=组名 state=present&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 连同用户家目录一同删除</span></span><br><span class=\"line\">ansible 操作对象 -m user -a <span class=\"string\">&#x27;name=用户名 remove=yes state=absent&#x27;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"group模块\"><a href=\"#group模块\" class=\"headerlink\" title=\"group模块\"></a>group模块</h6><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">添加组</span><br><span class=\"line\">ansible 操作对象 -m group -a <span class=\"string\">&#x27;name=组名 system=yes state=present gid=ID号&#x27;</span></span><br><span class=\"line\">system=yes：是否是公共组</span><br><span class=\"line\">删除组</span><br><span class=\"line\">ansible 操作对象 -m group -a <span class=\"string\">&#x27;name=组名 state=absent&#x27;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"copy模块\"><a href=\"#copy模块\" class=\"headerlink\" title=\"copy模块\"></a>copy模块</h6><p>1、从主控端复制文件到被控端（类似scp）</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible all -m copy -a <span class=\"string\">&#x27;src=主控端文件路径 dest=被控端保存路径&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 在被控端查看是否复制文件成功</span></span><br><span class=\"line\">ansible all -m shell -a <span class=\"string\">&#x27;ls 被控端保存文件路径&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>2、主控端控制被控端复制和粘贴被控端的文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m copy -a <span class=\"string\">&#x27;src=被控端源文件路径 dest=被控端目标位置 remote_src=yes&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 验证ansible的幂等性，remote_src=yes，当发现同文件名时，不执行此命令</span></span><br><span class=\"line\">ansible 操作对象 -m copy -a <span class=\"string\">&#x27;src=被控端源文件路径 dest=被控端目标位置 remote_src=yes backup=yes&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 修改被控端/root/resolv.conf的内容，使其可以发生文件覆盖，此时在加上backup进行文件覆盖前的备份</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"file模块\"><a href=\"#file模块\" class=\"headerlink\" title=\"file模块\"></a>file模块</h6><p>1、修改文件属性（owner（属主） group（属组） mode（权限） 对应linux命令 chown chmod</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 改变属主属组</span></span><br><span class=\"line\">ansible 操作对象 -m file -a <span class=\"string\">&#x27;path=被控端都存在的要修改属主属组的文件路径 owner=被控端都存在的用户 group=被控端都存在的组 recurse=yes&#x27;</span></span><br><span class=\"line\"> recurse=yes：表示递归设置属主属组</span><br><span class=\"line\"><span class=\"comment\"># 修改文件权限</span></span><br><span class=\"line\">ansible 操作对象 -m file -a <span class=\"string\">&#x27;path=被控端存在的文件路径 mode=7777 recurse=yes&#x27;</span></span><br><span class=\"line\"> 使用mnnn样式的四位8进制数表示，recurse=yes：对当前目录中的所有内容递归权限</span><br><span class=\"line\">``` </span><br><span class=\"line\"></span><br><span class=\"line\">2、软链接、硬链接</span><br><span class=\"line\"></span><br><span class=\"line\">```sh</span><br><span class=\"line\"><span class=\"comment\"># 软链接</span></span><br><span class=\"line\">ansible 操作对象 -m file -a <span class=\"string\">&#x27;src=被控端源文件 dest=软链接文件路径 state=link&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 硬链接</span></span><br><span class=\"line\">ansible 操作对象 -m file -a <span class=\"string\">&#x27;src=被控端源文件 dest=硬链接文件路径 state=hard&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>3、创建文件和目录</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建文件</span></span><br><span class=\"line\">ansible 操作对象 -m file -a <span class=\"string\">&#x27;path=文件路径及文件名 state=touch&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 创建目录</span></span><br><span class=\"line\">ansible 操作对象 -m file -a <span class=\"string\">&#x27;path=目录路径及目录名 state=directory&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 删除文件或者目录</span></span><br><span class=\"line\">ansible 操作对象 -m file -a <span class=\"string\">&#x27;path=被控端删除文件或目录路径 state=absent&#x27;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"yum模块\"><a href=\"#yum模块\" class=\"headerlink\" title=\"yum模块\"></a>yum模块</h6><p>主控端控制被控端，使其使用yum安装rpm包</p>\n<p>前提：被控端的yum可用</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装rpm某包</span></span><br><span class=\"line\">ansible 操作对象 -m yum -a <span class=\"string\">&#x27;name=包名,包名1... state=installed/present    # 默认不写state是installed/present</span></span><br><span class=\"line\"><span class=\"string\"># 卸载rpm包</span></span><br><span class=\"line\"><span class=\"string\">ansible 操作对象 -m yum -a &#x27;</span>name=包名,包名1... state=removed/absent</span><br></pre></td></tr></table></figure>\n<h6 id=\"service模块\"><a href=\"#service模块\" class=\"headerlink\" title=\"service模块\"></a>service模块</h6><p>操控被控端开启、关闭、重启、重载（视具体服务而定）</p>\n<p>notice：service可用管理rpm包安装的服务，源码安装的服务建议使用shell模块直接打命令</p>\n<p>服务状态：started/stopped/restarted/reloaded</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m service -a <span class=\"string\">&#x27;name=服务名 state=服务状态&#x27;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"hostname模块\"><a href=\"#hostname模块\" class=\"headerlink\" title=\"hostname模块\"></a>hostname模块</h6><p>修改主机名操作</p>\n<p>hostname 主机名 临时</p>\n<p>hostnamectl set-hostname 主机名 永久</p>\n<p>vim /etc/hosts 修改配置文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m hostname -a <span class=\"string\">&#x27;name=主机名&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"script模块\"><a href=\"#script模块\" class=\"headerlink\" title=\"script模块\"></a>script模块</h6><p>用于将主控端的脚本在被控端执行，shell脚本和python脚本</p>\n<p>写一个简单创建用户的脚本</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">!/bin/bash</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> &#123;1..10&#125;</span><br><span class=\"line\">    <span class=\"keyword\">do</span></span><br><span class=\"line\">        useradd user<span class=\"variable\">$i</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;123.com&#x27;</span> | passwd --stdin user<span class=\"variable\">$i</span></span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n<p>添加脚本可执行权限</p>\n<p><code>chmod +x users.sh </code><br>使用script模块执行脚本</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 执行脚本</span></span><br><span class=\"line\">ansible 操作对象 -m script -a <span class=\"string\">&#x27;脚本文件在主控端的路径&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 验证</span></span><br><span class=\"line\">ansible 操作对象 -m shell -a <span class=\"string\">&#x27;tail /etc/passwd&#x27;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"setup模块\"><a href=\"#setup模块\" class=\"headerlink\" title=\"setup模块\"></a>setup模块</h6><p>用于获取被控端的ansible变量值，主要用于模板剧本中，可以利用变量，实现对被控端的快速配置和差异化配置</p>\n<p>ansible变量：用于记录所有主控端和被控端的连接信息</p>\n<p>ansible dbserver -m setup 查看所有的变量值</p>\n<p>常用选项：ansible 操作对象 -m setup -a ‘filter=”<em>变量关键字</em>“‘ filter用于筛选变量</p>\n<p>如：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 关于cpu的变量</span></span><br><span class=\"line\">ansible dbserver -m setup -a <span class=\"string\">&#x27;filter=&quot;*cpu*&quot;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"fetch模块\"><a href=\"#fetch模块\" class=\"headerlink\" title=\"fetch模块\"></a>fetch模块</h6><p>拿取被控端文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 存放时，会将每台被控端创建一个ip目录</span></span><br><span class=\"line\">ansible 操作对象 -m fetch -a <span class=\"string\">&#x27;src=被控端文件路径 dest=主控端存放路径&#x27;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"replace模块\"><a href=\"#replace模块\" class=\"headerlink\" title=\"replace模块\"></a>replace模块</h6><p>可以实现对文件内容的替换</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 替换文件中所有匹配的字符</span></span><br><span class=\"line\">ansible dbserver -m replace -a <span class=\"string\">&#x27;path=被控端文件路径 regexp=&#x27;</span>匹配要替换的字符<span class=\"string\">&#x27; replace=&#x27;</span>替换后的字符<span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 替换指定行</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"template模块\"><a href=\"#template模块\" class=\"headerlink\" title=\"template模块\"></a>template模块</h6><p>主要用于主控端使用模板配置被控端配置文件的场景</p>\n<p>需要用到模板文件，文件必须以.j2结尾</p>\n<p>以web应用apache为例</p>\n<p>主控端和被控端都通过yum模块按照了httpd，在主控端更改配置文件，并重命名.j2结尾</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webserver -m template -a <span class=\"string\">&#x27;src=.j2文件路径 dest=被控端主配置文件路径&#x27;</span></span><br><span class=\"line\">如：</span><br><span class=\"line\">ansible webserver -m template -a <span class=\"string\">&#x27;src=httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>也可以在主控端配置文件中引用变量，在主机清单文件中修改</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># vim /etc/ansible/hosts</span></span><br><span class=\"line\">[webserver]</span><br><span class=\"line\">192.168.1.5 http_port=88</span><br><span class=\"line\">192.168.1.6 http_port=90</span><br></pre></td></tr></table></figure>\n<p>修改.j2文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># vim httpd.conf.j2 </span></span><br><span class=\"line\"> &#123;&#123;http_port&#125;&#125; 引用变量</span><br><span class=\"line\">ServerName www.example.com &#123;&#123;http_port&#125;&#125;</span><br></pre></td></tr></table></figure>\n<p>将.j2文件传送</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible webserver -m template -a <span class=\"string\">&#x27;src=httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>这个时候查看被控端的配置文件中，发现1.5的端口为88,16的端口为90</p>\n<h6 id=\"unarchive模块\"><a href=\"#unarchive模块\" class=\"headerlink\" title=\"unarchive模块\"></a>unarchive模块</h6><p>将主控端的压缩文件，解压后放在被控端</p>\n<p>在主控端有一个nginx安装包，执行以下操作直接解压到被控端</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m unarchive -a <span class=\"string\">&#x27;src=主控端安装包路径 dest=解压后的被控端存放路径&#x27;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"lineinfile模块\"><a href=\"#lineinfile模块\" class=\"headerlink\" title=\"lineinfile模块\"></a>lineinfile模块</h6><p>修改配置文件时，修改指定行的内容，或者添加到指定行前和指定行后</p>\n<p>可以实现在文件加入内容</p>\n<p>命令参数说明：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">参数</th>\n<th align=\"center\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">path</td>\n<td align=\"center\">指定要操作的文件对象</td>\n</tr>\n<tr>\n<td align=\"center\">egexp</td>\n<td align=\"center\">匹配条件</td>\n</tr>\n<tr>\n<td align=\"center\">insertbefore</td>\n<td align=\"center\">在指定行前插入</td>\n</tr>\n<tr>\n<td align=\"center\">insertafter</td>\n<td align=\"center\">在指定行后插入</td>\n</tr>\n<tr>\n<td align=\"center\">line</td>\n<td align=\"center\">要写入的文件内容</td>\n</tr>\n<tr>\n<td align=\"center\">state</td>\n<td align=\"center\">present（添加）absent（删除）</td>\n</tr>\n</tbody></table>\n<p>insertbefore和insertafter的特殊值</p>\n<p>BOF：begin of file（文件起始位置）<br>EOF：end of file （文件结束位置）</p>\n<p>使用insertbefore和insertafter，还有regexp时，需要指定state，其他不需要</p>\n<p>在文件开头插入内容 </p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m lineinfile -a <span class=\"string\">&#x27;path=文件路径 insertbefore=BOF line=&quot;插入的内容&quot;&#x27;</span></span><br><span class=\"line\">如：</span><br><span class=\"line\">ansible dbserver -m lineinfile -a <span class=\"string\">&#x27;path=/root/nginx.conf insertbefore=BOF line=&quot;# nihao a&quot;&#x27;</span></span><br><span class=\"line\"> 在nginx.conf文件开头添<span class=\"string\">&quot;# nihao a&quot;</span></span><br></pre></td></tr></table></figure>\n<p>在文件结束插入内容</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m lineinfile -a <span class=\"string\">&#x27;path=文件路径 insertbefore=EOF line=&quot;插入的内容&quot;&#x27;</span></span><br><span class=\"line\">如：</span><br><span class=\"line\">ansible dbserver -m lineinfile -a <span class=\"string\">&#x27;path=/root/nginx.conf insertbefore=EOF line=&quot;# nihao a&quot;&#x27;</span></span><br><span class=\"line\"> 在nginx.conf文件的末尾添加<span class=\"comment\"># nihao a</span></span><br></pre></td></tr></table></figure>\n<p>在文件指定位置加入内容</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m lineinfile -a <span class=\"string\">&#x27;path=文件路径 insertbefore=&quot;指定位置的内容&quot; line=&quot;插入的内容&quot; state=present</span></span><br><span class=\"line\"><span class=\"string\">如：</span></span><br><span class=\"line\"><span class=\"string\">ansible dbserver -m lineinfile -a &#x27;</span>path=/root/nginx.conf insertbefore=<span class=\"string\">&quot;  server &#123;&quot;</span> line=<span class=\"string\">&quot;root html&quot;</span> state=present<span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\"> 在nginx.conf的server &#123;的上一行添加root html</span></span><br></pre></td></tr></table></figure>\n<p>删除文件中的指定内容</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 操作对象 -m lineinfile -a <span class=\"string\">&#x27;path=文件路径 regexp=&quot;要删除的内容&quot; line=&quot;插入的内容&quot; state=absent</span></span><br><span class=\"line\"><span class=\"string\">如：</span></span><br><span class=\"line\"><span class=\"string\">ansible dbserver -m lineinfile -a &#x27;</span>path=/root/nginx.conf regexp=<span class=\"string\">&quot; server &#123;&quot;</span> state=absent<span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\"> 删除nginx.conf的server &#123; 这一行</span></span><br></pre></td></tr></table></figure>"},{"title":"Ansible自动化运维工具","author":"Semaik.","date":"2020-09-18T09:16:00.000Z","_content":"![upload successful](/images/timg.jpg)\n\n##### Ansible及自动化介绍\nansible：提高效率的工具，实现自动化运维\n\n自动化：系统自动化（PXE+KS/PXE+COBBLER)\n程序自动化（Ansible/Saltstack/Puppet）\n代码自动化（Jenkins）\n\n程序自动化工具分为两类：\n\n（1）C/S架构：Saltstack /Puppet\n\n（2）无客户端模式：Ansible（主控端/被控端）\n\n区别：\n\nAnsible：基于python开发，使用ssh协议，没有客户端，200-300台，适用于中小型应用环境，一个系统控制多台主机，有两个角色：主控端和被控端\n\nSaltstack ：基于python开发，支持统一管理，比较轻量级 支持管理500台服务器，python编写，需要部署agent，主控端通过安装在被控端的代理来对被控端进行操作\n\nPuppet：Ruby语言编写，重型程序，适合大型环境，谷歌公司在用，软件过于复杂，国内一般不到1000+\n\n##### Ansible特性\n* 模块化：调用特定的模块，完成特定的任务，约3000模块，每个模块功能不同\n* 有paramiko（基于ssh开发，主要做远程控制）PyYAML（可以实现剧本）Jinja2（模板语言），这三个模块是Ansible的核心\n* 支持自定义模块（python）\n* 安全，基于openssh\n* 支持playbook编排任务（PyYAML)\n* 幂等性：一个任务执行一遍和n变效果一样，不会因为重复执行而带来意外情况（如：复制文件时，执行两次会报是否覆盖，而使用Ansible可以避免这种情况，后面copy模块会讲到）\n\n##### 部署Ansible环境\n------------------------------------------\n\n实验环境：四台linux服务器\n\n\n* 192.168.1.1（用作Ansible服务器）\n\n* 192.168.1.4（被控端）\n\n* 192.168.1.5（被控端）\n\n* 192.168.1.6（被控端）\n\n实验目的：使用控制端来控制3个被控端工作\n\n实验步骤：\n控制端部署\n在控制端（192.168.1.1）安装epel-release和Ansible（使用网络yum）\n\nepel-release：Extra Packages for Enterprise Linux（企业版linux扩展包）\n```java\n创建yum缓存，加快yum安装速度\n[root@localhost ~]# yum makecache fast\nepel是一个系统扩展yum源\n[root@localhost ~]# yum -y install epel-release\n[root@localhost ~]# yum -y install ansible\n```\n##### 设置控制端免密登录被控端\n通过ssh密钥对实现\n```java\n[root@localhost ~]# ssh-keygen\t\t\t\t# 生成私钥和公钥，一直回车即可\nGenerating public/private rsa key pair.\nEnter file in which to save the key (/root/.ssh/id_rsa): \nCreated directory '/root/.ssh'.\nEnter passphrase (empty for no passphrase): \nEnter same passphrase again: \nYour identification has been saved in /root/.ssh/id_rsa.\nYour public key has been saved in /root/.ssh/id_rsa.pub.\nThe key fingerprint is:\nSHA256:2puXlUxjnsxKrVhnGbNahVhbZLJrMr9q/8B9uDr144Y root\nThe key's randomart image is:\n+---[RSA 2048]----+\n|            ..o  |\n|            .+.  |\n|           o.+   |\n|          . O..  |\n|        S oOoX   |\n|       o  o*/... |\n|      . .+ X+.+..|\n|        .oB .E =.|\n|        oo.o++=..|\n+----[SHA256]-----+\n \n# 默认生成在当前用户的.ssh/目录下\n[root@localhost ~]# ls /root/.ssh\nid_rsa  id_rsa.pub\n \n# 将生成的公钥文件发送到指定的控制端，需要用到root密码\n[root@localhost ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.4\n[root@localhost ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.5\n[root@localhost ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.6\n# 此时在1.4的被控端的用户目录下的.ssh目录下会生成一个authorized_keys文件\n[root@localhost ~]# ls /root/.ssh\nauthorized_keys\n# 在控制端使用ssh登录到1.4，发现不使用密码即可\n[root@localhost ~]# ssh root@192.168.1.4\n```\n##### 配置Ansible的配置文件\nansible.cfg Ansible主配置文件\n\nhosts 被控端的主机清单\n\nroles 角色\n\n修改主机清单：将被控端写入\n\n在使用ansible操作时，可以通过分组名对，组中所有主机进行相同操作\n\n格式为：\n```sh\n[分组名]\n被控端ip1\n被控端ip2\n...\n```\n例：\n\n```sh\n在文件末尾添加，如果有DNS，直接写域名也可以\n[root@localhost ~]# vim /etc/ansible/hosts \n添加：\n[dbserver]\n192.168.1.4\t\t\t# 被控端\n \n[webserver]\n192.168.1.5\t\t\t# 被控端\n192.168.1.6\t\t\t# 被控端\n```\n##### Ansible简单操作\n```sh\nansible --version\t\t\t# 查看ansible版本\nansible-doc -l\t\t# 查看ansible支持模块\nansible-doc -s 模块名\t\t# 关于模块的帮助信息\n如：ansible-doc -s ping\nansible-doc -h   \t# 帮助信息\n \n-------关于模块操作的语法-------\nansible 操作对象 -m 模块名 -a '模块参数'\n\t-a：在某些模块中可以省略\nansible 操作对象 -m 模块名 -a '模块参数' --limit x.x.x.x\n    --limit：可以指定操作对象中的某个ip来执行该模块\n```","source":"_posts/Ansible自动化运维工具.md","raw":"title: Ansible自动化运维工具\nauthor: Semaik.\ntags:\n  - Ansible\ncategories:\n  - Ansible\ndate: 2020-09-18 17:16:00\n---\n![upload successful](/images/timg.jpg)\n\n##### Ansible及自动化介绍\nansible：提高效率的工具，实现自动化运维\n\n自动化：系统自动化（PXE+KS/PXE+COBBLER)\n程序自动化（Ansible/Saltstack/Puppet）\n代码自动化（Jenkins）\n\n程序自动化工具分为两类：\n\n（1）C/S架构：Saltstack /Puppet\n\n（2）无客户端模式：Ansible（主控端/被控端）\n\n区别：\n\nAnsible：基于python开发，使用ssh协议，没有客户端，200-300台，适用于中小型应用环境，一个系统控制多台主机，有两个角色：主控端和被控端\n\nSaltstack ：基于python开发，支持统一管理，比较轻量级 支持管理500台服务器，python编写，需要部署agent，主控端通过安装在被控端的代理来对被控端进行操作\n\nPuppet：Ruby语言编写，重型程序，适合大型环境，谷歌公司在用，软件过于复杂，国内一般不到1000+\n\n##### Ansible特性\n* 模块化：调用特定的模块，完成特定的任务，约3000模块，每个模块功能不同\n* 有paramiko（基于ssh开发，主要做远程控制）PyYAML（可以实现剧本）Jinja2（模板语言），这三个模块是Ansible的核心\n* 支持自定义模块（python）\n* 安全，基于openssh\n* 支持playbook编排任务（PyYAML)\n* 幂等性：一个任务执行一遍和n变效果一样，不会因为重复执行而带来意外情况（如：复制文件时，执行两次会报是否覆盖，而使用Ansible可以避免这种情况，后面copy模块会讲到）\n\n##### 部署Ansible环境\n------------------------------------------\n\n实验环境：四台linux服务器\n\n\n* 192.168.1.1（用作Ansible服务器）\n\n* 192.168.1.4（被控端）\n\n* 192.168.1.5（被控端）\n\n* 192.168.1.6（被控端）\n\n实验目的：使用控制端来控制3个被控端工作\n\n实验步骤：\n控制端部署\n在控制端（192.168.1.1）安装epel-release和Ansible（使用网络yum）\n\nepel-release：Extra Packages for Enterprise Linux（企业版linux扩展包）\n```java\n创建yum缓存，加快yum安装速度\n[root@localhost ~]# yum makecache fast\nepel是一个系统扩展yum源\n[root@localhost ~]# yum -y install epel-release\n[root@localhost ~]# yum -y install ansible\n```\n##### 设置控制端免密登录被控端\n通过ssh密钥对实现\n```java\n[root@localhost ~]# ssh-keygen\t\t\t\t# 生成私钥和公钥，一直回车即可\nGenerating public/private rsa key pair.\nEnter file in which to save the key (/root/.ssh/id_rsa): \nCreated directory '/root/.ssh'.\nEnter passphrase (empty for no passphrase): \nEnter same passphrase again: \nYour identification has been saved in /root/.ssh/id_rsa.\nYour public key has been saved in /root/.ssh/id_rsa.pub.\nThe key fingerprint is:\nSHA256:2puXlUxjnsxKrVhnGbNahVhbZLJrMr9q/8B9uDr144Y root\nThe key's randomart image is:\n+---[RSA 2048]----+\n|            ..o  |\n|            .+.  |\n|           o.+   |\n|          . O..  |\n|        S oOoX   |\n|       o  o*/... |\n|      . .+ X+.+..|\n|        .oB .E =.|\n|        oo.o++=..|\n+----[SHA256]-----+\n \n# 默认生成在当前用户的.ssh/目录下\n[root@localhost ~]# ls /root/.ssh\nid_rsa  id_rsa.pub\n \n# 将生成的公钥文件发送到指定的控制端，需要用到root密码\n[root@localhost ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.4\n[root@localhost ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.5\n[root@localhost ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.6\n# 此时在1.4的被控端的用户目录下的.ssh目录下会生成一个authorized_keys文件\n[root@localhost ~]# ls /root/.ssh\nauthorized_keys\n# 在控制端使用ssh登录到1.4，发现不使用密码即可\n[root@localhost ~]# ssh root@192.168.1.4\n```\n##### 配置Ansible的配置文件\nansible.cfg Ansible主配置文件\n\nhosts 被控端的主机清单\n\nroles 角色\n\n修改主机清单：将被控端写入\n\n在使用ansible操作时，可以通过分组名对，组中所有主机进行相同操作\n\n格式为：\n```sh\n[分组名]\n被控端ip1\n被控端ip2\n...\n```\n例：\n\n```sh\n在文件末尾添加，如果有DNS，直接写域名也可以\n[root@localhost ~]# vim /etc/ansible/hosts \n添加：\n[dbserver]\n192.168.1.4\t\t\t# 被控端\n \n[webserver]\n192.168.1.5\t\t\t# 被控端\n192.168.1.6\t\t\t# 被控端\n```\n##### Ansible简单操作\n```sh\nansible --version\t\t\t# 查看ansible版本\nansible-doc -l\t\t# 查看ansible支持模块\nansible-doc -s 模块名\t\t# 关于模块的帮助信息\n如：ansible-doc -s ping\nansible-doc -h   \t# 帮助信息\n \n-------关于模块操作的语法-------\nansible 操作对象 -m 模块名 -a '模块参数'\n\t-a：在某些模块中可以省略\nansible 操作对象 -m 模块名 -a '模块参数' --limit x.x.x.x\n    --limit：可以指定操作对象中的某个ip来执行该模块\n```","slug":"Ansible自动化运维工具","published":1,"updated":"2020-09-18T09:32:10.828Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r736v0008m3pv25mw4lxw","content":"<p><img src=\"/images/timg.jpg\" alt=\"upload successful\"></p>\n<h5 id=\"Ansible及自动化介绍\"><a href=\"#Ansible及自动化介绍\" class=\"headerlink\" title=\"Ansible及自动化介绍\"></a>Ansible及自动化介绍</h5><p>ansible：提高效率的工具，实现自动化运维</p>\n<p>自动化：系统自动化（PXE+KS/PXE+COBBLER)<br>程序自动化（Ansible/Saltstack/Puppet）<br>代码自动化（Jenkins）</p>\n<p>程序自动化工具分为两类：</p>\n<p>（1）C/S架构：Saltstack /Puppet</p>\n<p>（2）无客户端模式：Ansible（主控端/被控端）</p>\n<p>区别：</p>\n<p>Ansible：基于python开发，使用ssh协议，没有客户端，200-300台，适用于中小型应用环境，一个系统控制多台主机，有两个角色：主控端和被控端</p>\n<p>Saltstack ：基于python开发，支持统一管理，比较轻量级 支持管理500台服务器，python编写，需要部署agent，主控端通过安装在被控端的代理来对被控端进行操作</p>\n<p>Puppet：Ruby语言编写，重型程序，适合大型环境，谷歌公司在用，软件过于复杂，国内一般不到1000+</p>\n<h5 id=\"Ansible特性\"><a href=\"#Ansible特性\" class=\"headerlink\" title=\"Ansible特性\"></a>Ansible特性</h5><ul>\n<li>模块化：调用特定的模块，完成特定的任务，约3000模块，每个模块功能不同</li>\n<li>有paramiko（基于ssh开发，主要做远程控制）PyYAML（可以实现剧本）Jinja2（模板语言），这三个模块是Ansible的核心</li>\n<li>支持自定义模块（python）</li>\n<li>安全，基于openssh</li>\n<li>支持playbook编排任务（PyYAML)</li>\n<li>幂等性：一个任务执行一遍和n变效果一样，不会因为重复执行而带来意外情况（如：复制文件时，执行两次会报是否覆盖，而使用Ansible可以避免这种情况，后面copy模块会讲到）</li>\n</ul>\n<h5 id=\"部署Ansible环境\"><a href=\"#部署Ansible环境\" class=\"headerlink\" title=\"部署Ansible环境\"></a>部署Ansible环境</h5><hr>\n<p>实验环境：四台linux服务器</p>\n<ul>\n<li><p>192.168.1.1（用作Ansible服务器）</p>\n</li>\n<li><p>192.168.1.4（被控端）</p>\n</li>\n<li><p>192.168.1.5（被控端）</p>\n</li>\n<li><p>192.168.1.6（被控端）</p>\n</li>\n</ul>\n<p>实验目的：使用控制端来控制3个被控端工作</p>\n<p>实验步骤：<br>控制端部署<br>在控制端（192.168.1.1）安装epel-release和Ansible（使用网络yum）</p>\n<p>epel-release：Extra Packages for Enterprise Linux（企业版linux扩展包）</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">创建yum缓存，加快yum安装速度</span><br><span class=\"line\">[root@localhost ~]# yum makecache fast</span><br><span class=\"line\">epel是一个系统扩展yum源</span><br><span class=\"line\">[root@localhost ~]# yum -y install epel-release</span><br><span class=\"line\">[root@localhost ~]# yum -y install ansible</span><br></pre></td></tr></table></figure>\n<h5 id=\"设置控制端免密登录被控端\"><a href=\"#设置控制端免密登录被控端\" class=\"headerlink\" title=\"设置控制端免密登录被控端\"></a>设置控制端免密登录被控端</h5><p>通过ssh密钥对实现</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# ssh-keygen\t\t\t\t# 生成私钥和公钥，一直回车即可</span><br><span class=\"line\">Generating <span class=\"keyword\">public</span>/<span class=\"keyword\">private</span> rsa key pair.</span><br><span class=\"line\"><span class=\"function\">Enter file in which to save the <span class=\"title\">key</span> <span class=\"params\">(/root/.ssh/id_rsa)</span>: </span></span><br><span class=\"line\"><span class=\"function\">Created directory &#x27;/root/.ssh&#x27;.</span></span><br><span class=\"line\"><span class=\"function\">Enter <span class=\"title\">passphrase</span> <span class=\"params\">(empty <span class=\"keyword\">for</span> no passphrase)</span>: </span></span><br><span class=\"line\"><span class=\"function\">Enter same passphrase again: </span></span><br><span class=\"line\"><span class=\"function\">Your identification has been saved in /root/.ssh/id_rsa.</span></span><br><span class=\"line\"><span class=\"function\">Your <span class=\"keyword\">public</span> key has been saved in /root/.ssh/id_rsa.pub.</span></span><br><span class=\"line\"><span class=\"function\">The key fingerprint is:</span></span><br><span class=\"line\"><span class=\"function\">SHA256:2puXlUxjnsxKrVhnGbNahVhbZLJrMr9q/8B9uDr144Y root</span></span><br><span class=\"line\"><span class=\"function\">The key&#x27;s randomart image is:</span></span><br><span class=\"line\"><span class=\"function\">+---[RSA 2048]----+</span></span><br><span class=\"line\"><span class=\"function\">|            ..o  |</span></span><br><span class=\"line\"><span class=\"function\">|            .+.  |</span></span><br><span class=\"line\"><span class=\"function\">|           o.+   |</span></span><br><span class=\"line\"><span class=\"function\">|          . O..  |</span></span><br><span class=\"line\"><span class=\"function\">|        S oOoX   |</span></span><br><span class=\"line\"><span class=\"function\">|       o  o*/... |</span></span><br><span class=\"line\"><span class=\"function\">|      . .+ X+.+..|</span></span><br><span class=\"line\"><span class=\"function\">|        .oB .E </span>=.|</span><br><span class=\"line\">|        oo.o++=..|</span><br><span class=\"line\">+----[SHA256]-----+</span><br><span class=\"line\"> </span><br><span class=\"line\"># 默认生成在当前用户的.ssh/目录下</span><br><span class=\"line\">[root@localhost ~]# ls /root/.ssh</span><br><span class=\"line\">id_rsa  id_rsa.pub</span><br><span class=\"line\"> </span><br><span class=\"line\"># 将生成的公钥文件发送到指定的控制端，需要用到root密码</span><br><span class=\"line\">[root@localhost ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.4</span><br><span class=\"line\">[root@localhost ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.5</span><br><span class=\"line\">[root@localhost ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.6</span><br><span class=\"line\"># 此时在1.4的被控端的用户目录下的.ssh目录下会生成一个authorized_keys文件</span><br><span class=\"line\">[root@localhost ~]# ls /root/.ssh</span><br><span class=\"line\">authorized_keys</span><br><span class=\"line\"># 在控制端使用ssh登录到1.4，发现不使用密码即可</span><br><span class=\"line\">[root@localhost ~]# ssh root@192.168.1.4</span><br></pre></td></tr></table></figure>\n<h5 id=\"配置Ansible的配置文件\"><a href=\"#配置Ansible的配置文件\" class=\"headerlink\" title=\"配置Ansible的配置文件\"></a>配置Ansible的配置文件</h5><p>ansible.cfg Ansible主配置文件</p>\n<p>hosts 被控端的主机清单</p>\n<p>roles 角色</p>\n<p>修改主机清单：将被控端写入</p>\n<p>在使用ansible操作时，可以通过分组名对，组中所有主机进行相同操作</p>\n<p>格式为：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[分组名]</span><br><span class=\"line\">被控端ip1</span><br><span class=\"line\">被控端ip2</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>例：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">在文件末尾添加，如果有DNS，直接写域名也可以</span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># vim /etc/ansible/hosts </span></span><br><span class=\"line\">添加：</span><br><span class=\"line\">[dbserver]</span><br><span class=\"line\">192.168.1.4\t\t\t<span class=\"comment\"># 被控端</span></span><br><span class=\"line\"> </span><br><span class=\"line\">[webserver]</span><br><span class=\"line\">192.168.1.5\t\t\t<span class=\"comment\"># 被控端</span></span><br><span class=\"line\">192.168.1.6\t\t\t<span class=\"comment\"># 被控端</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"Ansible简单操作\"><a href=\"#Ansible简单操作\" class=\"headerlink\" title=\"Ansible简单操作\"></a>Ansible简单操作</h5><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible --version\t\t\t<span class=\"comment\"># 查看ansible版本</span></span><br><span class=\"line\">ansible-doc -l\t\t<span class=\"comment\"># 查看ansible支持模块</span></span><br><span class=\"line\">ansible-doc -s 模块名\t\t<span class=\"comment\"># 关于模块的帮助信息</span></span><br><span class=\"line\">如：ansible-doc -s ping</span><br><span class=\"line\">ansible-doc -h   \t<span class=\"comment\"># 帮助信息</span></span><br><span class=\"line\"> </span><br><span class=\"line\">-------关于模块操作的语法-------</span><br><span class=\"line\">ansible 操作对象 -m 模块名 -a <span class=\"string\">&#x27;模块参数&#x27;</span></span><br><span class=\"line\">\t-a：在某些模块中可以省略</span><br><span class=\"line\">ansible 操作对象 -m 模块名 -a <span class=\"string\">&#x27;模块参数&#x27;</span> --<span class=\"built_in\">limit</span> x.x.x.x</span><br><span class=\"line\">    --<span class=\"built_in\">limit</span>：可以指定操作对象中的某个ip来执行该模块</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/images/timg.jpg\" alt=\"upload successful\"></p>\n<h5 id=\"Ansible及自动化介绍\"><a href=\"#Ansible及自动化介绍\" class=\"headerlink\" title=\"Ansible及自动化介绍\"></a>Ansible及自动化介绍</h5><p>ansible：提高效率的工具，实现自动化运维</p>\n<p>自动化：系统自动化（PXE+KS/PXE+COBBLER)<br>程序自动化（Ansible/Saltstack/Puppet）<br>代码自动化（Jenkins）</p>\n<p>程序自动化工具分为两类：</p>\n<p>（1）C/S架构：Saltstack /Puppet</p>\n<p>（2）无客户端模式：Ansible（主控端/被控端）</p>\n<p>区别：</p>\n<p>Ansible：基于python开发，使用ssh协议，没有客户端，200-300台，适用于中小型应用环境，一个系统控制多台主机，有两个角色：主控端和被控端</p>\n<p>Saltstack ：基于python开发，支持统一管理，比较轻量级 支持管理500台服务器，python编写，需要部署agent，主控端通过安装在被控端的代理来对被控端进行操作</p>\n<p>Puppet：Ruby语言编写，重型程序，适合大型环境，谷歌公司在用，软件过于复杂，国内一般不到1000+</p>\n<h5 id=\"Ansible特性\"><a href=\"#Ansible特性\" class=\"headerlink\" title=\"Ansible特性\"></a>Ansible特性</h5><ul>\n<li>模块化：调用特定的模块，完成特定的任务，约3000模块，每个模块功能不同</li>\n<li>有paramiko（基于ssh开发，主要做远程控制）PyYAML（可以实现剧本）Jinja2（模板语言），这三个模块是Ansible的核心</li>\n<li>支持自定义模块（python）</li>\n<li>安全，基于openssh</li>\n<li>支持playbook编排任务（PyYAML)</li>\n<li>幂等性：一个任务执行一遍和n变效果一样，不会因为重复执行而带来意外情况（如：复制文件时，执行两次会报是否覆盖，而使用Ansible可以避免这种情况，后面copy模块会讲到）</li>\n</ul>\n<h5 id=\"部署Ansible环境\"><a href=\"#部署Ansible环境\" class=\"headerlink\" title=\"部署Ansible环境\"></a>部署Ansible环境</h5><hr>\n<p>实验环境：四台linux服务器</p>\n<ul>\n<li><p>192.168.1.1（用作Ansible服务器）</p>\n</li>\n<li><p>192.168.1.4（被控端）</p>\n</li>\n<li><p>192.168.1.5（被控端）</p>\n</li>\n<li><p>192.168.1.6（被控端）</p>\n</li>\n</ul>\n<p>实验目的：使用控制端来控制3个被控端工作</p>\n<p>实验步骤：<br>控制端部署<br>在控制端（192.168.1.1）安装epel-release和Ansible（使用网络yum）</p>\n<p>epel-release：Extra Packages for Enterprise Linux（企业版linux扩展包）</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">创建yum缓存，加快yum安装速度</span><br><span class=\"line\">[root@localhost ~]# yum makecache fast</span><br><span class=\"line\">epel是一个系统扩展yum源</span><br><span class=\"line\">[root@localhost ~]# yum -y install epel-release</span><br><span class=\"line\">[root@localhost ~]# yum -y install ansible</span><br></pre></td></tr></table></figure>\n<h5 id=\"设置控制端免密登录被控端\"><a href=\"#设置控制端免密登录被控端\" class=\"headerlink\" title=\"设置控制端免密登录被控端\"></a>设置控制端免密登录被控端</h5><p>通过ssh密钥对实现</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# ssh-keygen\t\t\t\t# 生成私钥和公钥，一直回车即可</span><br><span class=\"line\">Generating <span class=\"keyword\">public</span>/<span class=\"keyword\">private</span> rsa key pair.</span><br><span class=\"line\"><span class=\"function\">Enter file in which to save the <span class=\"title\">key</span> <span class=\"params\">(/root/.ssh/id_rsa)</span>: </span></span><br><span class=\"line\"><span class=\"function\">Created directory &#x27;/root/.ssh&#x27;.</span></span><br><span class=\"line\"><span class=\"function\">Enter <span class=\"title\">passphrase</span> <span class=\"params\">(empty <span class=\"keyword\">for</span> no passphrase)</span>: </span></span><br><span class=\"line\"><span class=\"function\">Enter same passphrase again: </span></span><br><span class=\"line\"><span class=\"function\">Your identification has been saved in /root/.ssh/id_rsa.</span></span><br><span class=\"line\"><span class=\"function\">Your <span class=\"keyword\">public</span> key has been saved in /root/.ssh/id_rsa.pub.</span></span><br><span class=\"line\"><span class=\"function\">The key fingerprint is:</span></span><br><span class=\"line\"><span class=\"function\">SHA256:2puXlUxjnsxKrVhnGbNahVhbZLJrMr9q/8B9uDr144Y root</span></span><br><span class=\"line\"><span class=\"function\">The key&#x27;s randomart image is:</span></span><br><span class=\"line\"><span class=\"function\">+---[RSA 2048]----+</span></span><br><span class=\"line\"><span class=\"function\">|            ..o  |</span></span><br><span class=\"line\"><span class=\"function\">|            .+.  |</span></span><br><span class=\"line\"><span class=\"function\">|           o.+   |</span></span><br><span class=\"line\"><span class=\"function\">|          . O..  |</span></span><br><span class=\"line\"><span class=\"function\">|        S oOoX   |</span></span><br><span class=\"line\"><span class=\"function\">|       o  o*/... |</span></span><br><span class=\"line\"><span class=\"function\">|      . .+ X+.+..|</span></span><br><span class=\"line\"><span class=\"function\">|        .oB .E </span>=.|</span><br><span class=\"line\">|        oo.o++=..|</span><br><span class=\"line\">+----[SHA256]-----+</span><br><span class=\"line\"> </span><br><span class=\"line\"># 默认生成在当前用户的.ssh/目录下</span><br><span class=\"line\">[root@localhost ~]# ls /root/.ssh</span><br><span class=\"line\">id_rsa  id_rsa.pub</span><br><span class=\"line\"> </span><br><span class=\"line\"># 将生成的公钥文件发送到指定的控制端，需要用到root密码</span><br><span class=\"line\">[root@localhost ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.4</span><br><span class=\"line\">[root@localhost ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.5</span><br><span class=\"line\">[root@localhost ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.6</span><br><span class=\"line\"># 此时在1.4的被控端的用户目录下的.ssh目录下会生成一个authorized_keys文件</span><br><span class=\"line\">[root@localhost ~]# ls /root/.ssh</span><br><span class=\"line\">authorized_keys</span><br><span class=\"line\"># 在控制端使用ssh登录到1.4，发现不使用密码即可</span><br><span class=\"line\">[root@localhost ~]# ssh root@192.168.1.4</span><br></pre></td></tr></table></figure>\n<h5 id=\"配置Ansible的配置文件\"><a href=\"#配置Ansible的配置文件\" class=\"headerlink\" title=\"配置Ansible的配置文件\"></a>配置Ansible的配置文件</h5><p>ansible.cfg Ansible主配置文件</p>\n<p>hosts 被控端的主机清单</p>\n<p>roles 角色</p>\n<p>修改主机清单：将被控端写入</p>\n<p>在使用ansible操作时，可以通过分组名对，组中所有主机进行相同操作</p>\n<p>格式为：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[分组名]</span><br><span class=\"line\">被控端ip1</span><br><span class=\"line\">被控端ip2</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>例：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">在文件末尾添加，如果有DNS，直接写域名也可以</span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># vim /etc/ansible/hosts </span></span><br><span class=\"line\">添加：</span><br><span class=\"line\">[dbserver]</span><br><span class=\"line\">192.168.1.4\t\t\t<span class=\"comment\"># 被控端</span></span><br><span class=\"line\"> </span><br><span class=\"line\">[webserver]</span><br><span class=\"line\">192.168.1.5\t\t\t<span class=\"comment\"># 被控端</span></span><br><span class=\"line\">192.168.1.6\t\t\t<span class=\"comment\"># 被控端</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"Ansible简单操作\"><a href=\"#Ansible简单操作\" class=\"headerlink\" title=\"Ansible简单操作\"></a>Ansible简单操作</h5><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible --version\t\t\t<span class=\"comment\"># 查看ansible版本</span></span><br><span class=\"line\">ansible-doc -l\t\t<span class=\"comment\"># 查看ansible支持模块</span></span><br><span class=\"line\">ansible-doc -s 模块名\t\t<span class=\"comment\"># 关于模块的帮助信息</span></span><br><span class=\"line\">如：ansible-doc -s ping</span><br><span class=\"line\">ansible-doc -h   \t<span class=\"comment\"># 帮助信息</span></span><br><span class=\"line\"> </span><br><span class=\"line\">-------关于模块操作的语法-------</span><br><span class=\"line\">ansible 操作对象 -m 模块名 -a <span class=\"string\">&#x27;模块参数&#x27;</span></span><br><span class=\"line\">\t-a：在某些模块中可以省略</span><br><span class=\"line\">ansible 操作对象 -m 模块名 -a <span class=\"string\">&#x27;模块参数&#x27;</span> --<span class=\"built_in\">limit</span> x.x.x.x</span><br><span class=\"line\">    --<span class=\"built_in\">limit</span>：可以指定操作对象中的某个ip来执行该模块</span><br></pre></td></tr></table></figure>"},{"title":"Centos7部署轻量级自动化运维工具pssh","author":"Semaik.","date":"2020-10-13T07:31:00.000Z","_content":"> pssh是由python编写，可以在多台服务器执行命令的工具。在服务器越来越多的企业这种自动化运维工具越来越火。\n\n##### 下载pssh安装包\n```java\n[root@localhost ~]# wget https://files.pythonhosted.org/packages/60/9a/8035af3a7d3d1617ae2c7c174efa4f154e5bf9c24b36b623413b38be8e4a/pssh-2.3.1.tar.gz\n```\n##### 配置免密登录\n```java\n[root@localhost ~]# ssh-keygen\nGenerating public/private rsa key pair.\nEnter file in which to save the key (/root/.ssh/id_rsa): \nEnter passphrase (empty for no passphrase): \nEnter same passphrase again: \nYour identification has been saved in /root/.ssh/id_rsa.\nYour public key has been saved in /root/.ssh/id_rsa.pub.\nThe key fingerprint is:\nSHA256:3antaxjGw+hdgfSlrXLYhUe5vgHe9b0ehh/gUY9E8Eg root@localhost.localdomain\nThe key's randomart image is:\n+---[RSA 2048]----+\n|            E... |\n|          .. ++  |\n|         . o.*oo |\n|         ...*o*.o|\n|        S+.+o@..+|\n|        . OoB B o|\n|       . o.B.o *.|\n|        . o.. +.o|\n|           .o..o |\n+----[SHA256]-----+\n[root@localhost ~]# cd /root/.ssh/\n[root@localhost .ssh]# ls\nid_rsa  id_rsa.pub\n[root@localhost .ssh]# ssh-copy-id 172.16.1.112\n/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: \"/root/.ssh/id_rsa.pub\"\nThe authenticity of host '172.16.1.112 (172.16.1.112)' can't be established.\nECDSA key fingerprint is SHA256:yFvaxR1x5YDhhe+6xR/Ou6Sm+YPYvPAoiLVKt9mAnXA.\nECDSA key fingerprint is MD5:0d:c4:79:bc:36:7a:a4:82:95:4f:d5:d0:a3:c8:7d:2e.\nAre you sure you want to continue connecting (yes/no)? yes\n/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed\n/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys\nroot@172.16.1.112's password: \n\nNumber of key(s) added: 1\n\nNow try logging into the machine, with:   \"ssh '172.16.1.112'\"\nand check to make sure that only the key(s) you wanted were added.\n[root@localhost .ssh]# ssh-copy-id 172.16.1.16\n/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: \"/root/.ssh/id_rsa.pub\"\nThe authenticity of host '172.16.1.16 (172.16.1.16)' can't be established.\nECDSA key fingerprint is SHA256:ANzlXzrGA87YLI2vzkPJ/iNPiSQ5JStJc95948jE8aw.\nECDSA key fingerprint is MD5:f9:f1:1b:5a:99:64:d8:d8:e9:9b:e6:bb:c3:d5:bd:e7.\nAre you sure you want to continue connecting (yes/no)? yes\n/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed\n/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys\nroot@172.16.1.16's password: \n\nNumber of key(s) added: 1\n\nNow try logging into the machine, with:   \"ssh '172.16.1.16'\"\nand check to make sure that only the key(s) you wanted were added.\n```\n##### 测试免密登录\n```java\n[root@localhost ~]# ssh 172.16.1.112\nLast login: Tue Jun  2 09:44:24 2020 from 172.16.1.16\n[root@localhost ~]# ssh 172.16.1.16\nLast login: Tue Jun  2 09:30:47 2020 from 172.16.1.100\n```\n\n##### 测试pssh\n```java\n# 将IP写入到文件中\n[root@localhost ~]# echo \"172.16.1.112\" >> aaa\n[root@localhost ~]# echo \"172.16.1.16\" >> aaa\n[root@localhost ~]# cat aaa\n172.16.1.112\n172.16.1.16\n# 批量执行date命令\n[root@localhost ~]# pssh -h aaa -l root -P \"date\"\n172.16.1.16: 2020年 06月 02日 星期二 09:59:48 CST\n[1] 09:59:48 [SUCCESS] 172.16.1.16\n172.16.1.112: 2020年 06月 02日 星期二 09:59:48 CST\n[2] 09:59:48 [SUCCESS] 172.16.1.112\n# 查看磁盘\n[root@localhost ~]# pssh -h aaa -l root -P \"lsblk\"\n172.16.1.16: NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda               8:0    0   20G  0 disk \n├─sda1            8:1    0    1G  0 part /boot\n└─sda2            8:2    0   19G  0 part \n  ├─centos-root 253:0    0   17G  0 lvm  /\n  └─centos-swap 253:1    0    2G  0 lvm  [SWAP]\nsr0              11:0    1  4.2G  0 rom  \n[1] 10:13:02 [SUCCESS] 172.16.1.16\n172.16.1.112: NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda               8:0    0   20G  0 disk \n├─sda1            8:1    0    1G  0 part /boot\n└─sda2            8:2    0   19G  0 part \n  ├─centos-root 253:0    0   17G  0 lvm  /\n  └─centos-swap 253:1    0    2G  0 lvm  [SWAP]\nsr0              11:0    1  4.2G  0 rom  \n[2] 10:13:03 [SUCCESS] 172.16.1.112\n\n```","source":"_posts/Centos7部署轻量级自动化运维工具pssh.md","raw":"title: Centos7部署轻量级自动化运维工具pssh\nauthor: Semaik.\ntags:\n  - Linux\ncategories:\n  - Linux\ndate: 2020-10-13 15:31:00\n---\n> pssh是由python编写，可以在多台服务器执行命令的工具。在服务器越来越多的企业这种自动化运维工具越来越火。\n\n##### 下载pssh安装包\n```java\n[root@localhost ~]# wget https://files.pythonhosted.org/packages/60/9a/8035af3a7d3d1617ae2c7c174efa4f154e5bf9c24b36b623413b38be8e4a/pssh-2.3.1.tar.gz\n```\n##### 配置免密登录\n```java\n[root@localhost ~]# ssh-keygen\nGenerating public/private rsa key pair.\nEnter file in which to save the key (/root/.ssh/id_rsa): \nEnter passphrase (empty for no passphrase): \nEnter same passphrase again: \nYour identification has been saved in /root/.ssh/id_rsa.\nYour public key has been saved in /root/.ssh/id_rsa.pub.\nThe key fingerprint is:\nSHA256:3antaxjGw+hdgfSlrXLYhUe5vgHe9b0ehh/gUY9E8Eg root@localhost.localdomain\nThe key's randomart image is:\n+---[RSA 2048]----+\n|            E... |\n|          .. ++  |\n|         . o.*oo |\n|         ...*o*.o|\n|        S+.+o@..+|\n|        . OoB B o|\n|       . o.B.o *.|\n|        . o.. +.o|\n|           .o..o |\n+----[SHA256]-----+\n[root@localhost ~]# cd /root/.ssh/\n[root@localhost .ssh]# ls\nid_rsa  id_rsa.pub\n[root@localhost .ssh]# ssh-copy-id 172.16.1.112\n/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: \"/root/.ssh/id_rsa.pub\"\nThe authenticity of host '172.16.1.112 (172.16.1.112)' can't be established.\nECDSA key fingerprint is SHA256:yFvaxR1x5YDhhe+6xR/Ou6Sm+YPYvPAoiLVKt9mAnXA.\nECDSA key fingerprint is MD5:0d:c4:79:bc:36:7a:a4:82:95:4f:d5:d0:a3:c8:7d:2e.\nAre you sure you want to continue connecting (yes/no)? yes\n/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed\n/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys\nroot@172.16.1.112's password: \n\nNumber of key(s) added: 1\n\nNow try logging into the machine, with:   \"ssh '172.16.1.112'\"\nand check to make sure that only the key(s) you wanted were added.\n[root@localhost .ssh]# ssh-copy-id 172.16.1.16\n/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: \"/root/.ssh/id_rsa.pub\"\nThe authenticity of host '172.16.1.16 (172.16.1.16)' can't be established.\nECDSA key fingerprint is SHA256:ANzlXzrGA87YLI2vzkPJ/iNPiSQ5JStJc95948jE8aw.\nECDSA key fingerprint is MD5:f9:f1:1b:5a:99:64:d8:d8:e9:9b:e6:bb:c3:d5:bd:e7.\nAre you sure you want to continue connecting (yes/no)? yes\n/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed\n/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys\nroot@172.16.1.16's password: \n\nNumber of key(s) added: 1\n\nNow try logging into the machine, with:   \"ssh '172.16.1.16'\"\nand check to make sure that only the key(s) you wanted were added.\n```\n##### 测试免密登录\n```java\n[root@localhost ~]# ssh 172.16.1.112\nLast login: Tue Jun  2 09:44:24 2020 from 172.16.1.16\n[root@localhost ~]# ssh 172.16.1.16\nLast login: Tue Jun  2 09:30:47 2020 from 172.16.1.100\n```\n\n##### 测试pssh\n```java\n# 将IP写入到文件中\n[root@localhost ~]# echo \"172.16.1.112\" >> aaa\n[root@localhost ~]# echo \"172.16.1.16\" >> aaa\n[root@localhost ~]# cat aaa\n172.16.1.112\n172.16.1.16\n# 批量执行date命令\n[root@localhost ~]# pssh -h aaa -l root -P \"date\"\n172.16.1.16: 2020年 06月 02日 星期二 09:59:48 CST\n[1] 09:59:48 [SUCCESS] 172.16.1.16\n172.16.1.112: 2020年 06月 02日 星期二 09:59:48 CST\n[2] 09:59:48 [SUCCESS] 172.16.1.112\n# 查看磁盘\n[root@localhost ~]# pssh -h aaa -l root -P \"lsblk\"\n172.16.1.16: NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda               8:0    0   20G  0 disk \n├─sda1            8:1    0    1G  0 part /boot\n└─sda2            8:2    0   19G  0 part \n  ├─centos-root 253:0    0   17G  0 lvm  /\n  └─centos-swap 253:1    0    2G  0 lvm  [SWAP]\nsr0              11:0    1  4.2G  0 rom  \n[1] 10:13:02 [SUCCESS] 172.16.1.16\n172.16.1.112: NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda               8:0    0   20G  0 disk \n├─sda1            8:1    0    1G  0 part /boot\n└─sda2            8:2    0   19G  0 part \n  ├─centos-root 253:0    0   17G  0 lvm  /\n  └─centos-swap 253:1    0    2G  0 lvm  [SWAP]\nsr0              11:0    1  4.2G  0 rom  \n[2] 10:13:03 [SUCCESS] 172.16.1.112\n\n```","slug":"Centos7部署轻量级自动化运维工具pssh","published":1,"updated":"2020-10-13T07:50:56.522Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r736w0009m3pv6zzh3x1z","content":"<blockquote>\n<p>pssh是由python编写，可以在多台服务器执行命令的工具。在服务器越来越多的企业这种自动化运维工具越来越火。</p>\n</blockquote>\n<h5 id=\"下载pssh安装包\"><a href=\"#下载pssh安装包\" class=\"headerlink\" title=\"下载pssh安装包\"></a>下载pssh安装包</h5><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# wget https://files.pythonhosted.org/packages/60/9a/8035af3a7d3d1617ae2c7c174efa4f154e5bf9c24b36b623413b38be8e4a/pssh-2.3.1.tar.gz</span><br></pre></td></tr></table></figure>\n<h5 id=\"配置免密登录\"><a href=\"#配置免密登录\" class=\"headerlink\" title=\"配置免密登录\"></a>配置免密登录</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# ssh-keygen</span><br><span class=\"line\">Generating <span class=\"keyword\">public</span>/<span class=\"keyword\">private</span> rsa key pair.</span><br><span class=\"line\"><span class=\"function\">Enter file in which to save the <span class=\"title\">key</span> <span class=\"params\">(/root/.ssh/id_rsa)</span>: </span></span><br><span class=\"line\"><span class=\"function\">Enter <span class=\"title\">passphrase</span> <span class=\"params\">(empty <span class=\"keyword\">for</span> no passphrase)</span>: </span></span><br><span class=\"line\"><span class=\"function\">Enter same passphrase again: </span></span><br><span class=\"line\"><span class=\"function\">Your identification has been saved in /root/.ssh/id_rsa.</span></span><br><span class=\"line\"><span class=\"function\">Your <span class=\"keyword\">public</span> key has been saved in /root/.ssh/id_rsa.pub.</span></span><br><span class=\"line\"><span class=\"function\">The key fingerprint is:</span></span><br><span class=\"line\"><span class=\"function\">SHA256:3antaxjGw+hdgfSlrXLYhUe5vgHe9b0ehh/gUY9E8Eg root@localhost.localdomain</span></span><br><span class=\"line\"><span class=\"function\">The key&#x27;s randomart image is:</span></span><br><span class=\"line\"><span class=\"function\">+---[RSA 2048]----+</span></span><br><span class=\"line\"><span class=\"function\">|            E... |</span></span><br><span class=\"line\"><span class=\"function\">|          .. ++  |</span></span><br><span class=\"line\"><span class=\"function\">|         . o.*oo |</span></span><br><span class=\"line\"><span class=\"function\">|         ...*o*.o|</span></span><br><span class=\"line\"><span class=\"function\">|        S+.+o@..+|</span></span><br><span class=\"line\"><span class=\"function\">|        . OoB B o|</span></span><br><span class=\"line\"><span class=\"function\">|       . o.B.o *.|</span></span><br><span class=\"line\"><span class=\"function\">|        . o.. +.o|</span></span><br><span class=\"line\"><span class=\"function\">|           .o..o |</span></span><br><span class=\"line\"><span class=\"function\">+----[SHA256]-----+</span></span><br><span class=\"line\"><span class=\"function\">[root@localhost ~]# cd /root/.ssh/</span></span><br><span class=\"line\"><span class=\"function\">[root@localhost .ssh]# ls</span></span><br><span class=\"line\"><span class=\"function\">id_rsa  id_rsa.pub</span></span><br><span class=\"line\"><span class=\"function\">[root@localhost .ssh]# ssh-copy-id 172.16.1.112</span></span><br><span class=\"line\"><span class=\"function\">/usr/bin/ssh-copy-id: INFO: Source of <span class=\"title\">key</span><span class=\"params\">(s)</span> to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span></span><br><span class=\"line\"><span class=\"function\">The authenticity of host &#x27;172.16.1.112 <span class=\"params\">(<span class=\"number\">172.16</span><span class=\"number\">.1</span><span class=\"number\">.112</span>)</span>&#x27; can&#x27;t be established.</span></span><br><span class=\"line\"><span class=\"function\">ECDSA key fingerprint is SHA256:yFvaxR1x5YDhhe+6xR/Ou6Sm+YPYvPAoiLVKt9mAnXA.</span></span><br><span class=\"line\"><span class=\"function\">ECDSA key fingerprint is MD5:0d:c4:79:bc:36:7a:a4:82:95:4f:d5:d0:a3:c8:7d:2e.</span></span><br><span class=\"line\"><span class=\"function\">Are you sure you want to <span class=\"keyword\">continue</span> <span class=\"title\">connecting</span> <span class=\"params\">(yes/no)</span>? yes</span></span><br><span class=\"line\"><span class=\"function\">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new <span class=\"title\">key</span><span class=\"params\">(s)</span>, to filter out any that are already installed</span></span><br><span class=\"line\"><span class=\"function\">/usr/bin/ssh-copy-id: INFO: 1 <span class=\"title\">key</span><span class=\"params\">(s)</span> remain to be installed -- <span class=\"keyword\">if</span> you are prompted now it is to install the new keys</span></span><br><span class=\"line\"><span class=\"function\">root@172.16.1.112&#x27;s password: </span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">Number of <span class=\"title\">key</span><span class=\"params\">(s)</span> added: 1</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">Now <span class=\"keyword\">try</span> logging into the machine, with:   &quot;ssh &#x27;172.16.1.112&#x27;&quot;</span></span><br><span class=\"line\"><span class=\"function\">and check to make sure that only the <span class=\"title\">key</span><span class=\"params\">(s)</span> you wanted were added.</span></span><br><span class=\"line\"><span class=\"function\">[root@localhost .ssh]# ssh-copy-id 172.16.1.16</span></span><br><span class=\"line\"><span class=\"function\">/usr/bin/ssh-copy-id: INFO: Source of <span class=\"title\">key</span><span class=\"params\">(s)</span> to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span></span><br><span class=\"line\"><span class=\"function\">The authenticity of host &#x27;172.16.1.16 <span class=\"params\">(<span class=\"number\">172.16</span><span class=\"number\">.1</span><span class=\"number\">.16</span>)</span>&#x27; can&#x27;t be established.</span></span><br><span class=\"line\"><span class=\"function\">ECDSA key fingerprint is SHA256:ANzlXzrGA87YLI2vzkPJ/iNPiSQ5JStJc95948jE8aw.</span></span><br><span class=\"line\"><span class=\"function\">ECDSA key fingerprint is MD5:f9:f1:1b:5a:99:64:d8:d8:e9:9b:e6:bb:c3:d5:bd:e7.</span></span><br><span class=\"line\"><span class=\"function\">Are you sure you want to <span class=\"keyword\">continue</span> <span class=\"title\">connecting</span> <span class=\"params\">(yes/no)</span>? yes</span></span><br><span class=\"line\"><span class=\"function\">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new <span class=\"title\">key</span><span class=\"params\">(s)</span>, to filter out any that are already installed</span></span><br><span class=\"line\"><span class=\"function\">/usr/bin/ssh-copy-id: INFO: 1 <span class=\"title\">key</span><span class=\"params\">(s)</span> remain to be installed -- <span class=\"keyword\">if</span> you are prompted now it is to install the new keys</span></span><br><span class=\"line\"><span class=\"function\">root@172.16.1.16&#x27;s password: </span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">Number of <span class=\"title\">key</span><span class=\"params\">(s)</span> added: 1</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">Now <span class=\"keyword\">try</span> logging into the machine, with:   &quot;ssh &#x27;172.16.1.16&#x27;&quot;</span></span><br><span class=\"line\"><span class=\"function\">and check to make sure that only the <span class=\"title\">key</span><span class=\"params\">(s)</span> you wanted were added.</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"测试免密登录\"><a href=\"#测试免密登录\" class=\"headerlink\" title=\"测试免密登录\"></a>测试免密登录</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# ssh 172.16.1.112</span><br><span class=\"line\">Last login: Tue Jun  <span class=\"number\">2</span> <span class=\"number\">09</span>:<span class=\"number\">44</span>:<span class=\"number\">24</span> <span class=\"number\">2020</span> from <span class=\"number\">172.16</span>.<span class=\"number\">1.16</span></span><br><span class=\"line\">[root@localhost ~]# ssh 172.16.1.16</span><br><span class=\"line\">Last login: Tue Jun  <span class=\"number\">2</span> <span class=\"number\">09</span>:<span class=\"number\">30</span>:<span class=\"number\">47</span> <span class=\"number\">2020</span> from <span class=\"number\">172.16</span>.<span class=\"number\">1.100</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"测试pssh\"><a href=\"#测试pssh\" class=\"headerlink\" title=\"测试pssh\"></a>测试pssh</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 将IP写入到文件中</span><br><span class=\"line\">[root@localhost ~]# echo &quot;172.16.1.112&quot; &gt;&gt; aaa</span><br><span class=\"line\">[root@localhost ~]# echo &quot;172.16.1.16&quot; &gt;&gt; aaa</span><br><span class=\"line\">[root@localhost ~]# cat aaa</span><br><span class=\"line\"><span class=\"number\">172.16</span>.<span class=\"number\">1.112</span></span><br><span class=\"line\"><span class=\"number\">172.16</span>.<span class=\"number\">1.16</span></span><br><span class=\"line\"># 批量执行date命令</span><br><span class=\"line\">[root@localhost ~]# pssh -h aaa -l root -P &quot;date&quot;</span><br><span class=\"line\"><span class=\"number\">172.16</span>.<span class=\"number\">1.16</span>: <span class=\"number\">2020</span>年 <span class=\"number\">06</span>月 <span class=\"number\">02</span>日 星期二 <span class=\"number\">09</span>:<span class=\"number\">59</span>:<span class=\"number\">48</span> CST</span><br><span class=\"line\">[<span class=\"number\">1</span>] <span class=\"number\">09</span>:<span class=\"number\">59</span>:<span class=\"number\">48</span> [SUCCESS] <span class=\"number\">172.16</span>.<span class=\"number\">1.16</span></span><br><span class=\"line\"><span class=\"number\">172.16</span>.<span class=\"number\">1.112</span>: <span class=\"number\">2020</span>年 <span class=\"number\">06</span>月 <span class=\"number\">02</span>日 星期二 <span class=\"number\">09</span>:<span class=\"number\">59</span>:<span class=\"number\">48</span> CST</span><br><span class=\"line\">[<span class=\"number\">2</span>] <span class=\"number\">09</span>:<span class=\"number\">59</span>:<span class=\"number\">48</span> [SUCCESS] <span class=\"number\">172.16</span>.<span class=\"number\">1.112</span></span><br><span class=\"line\"># 查看磁盘</span><br><span class=\"line\">[root@localhost ~]# pssh -h aaa -l root -P &quot;lsblk&quot;</span><br><span class=\"line\"><span class=\"number\">172.16</span>.<span class=\"number\">1.16</span>: NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class=\"line\">sda               <span class=\"number\">8</span>:<span class=\"number\">0</span>    <span class=\"number\">0</span>   <span class=\"number\">20</span>G  <span class=\"number\">0</span> disk </span><br><span class=\"line\">├─sda1            <span class=\"number\">8</span>:<span class=\"number\">1</span>    <span class=\"number\">0</span>    <span class=\"number\">1</span>G  <span class=\"number\">0</span> part /boot</span><br><span class=\"line\">└─sda2            <span class=\"number\">8</span>:<span class=\"number\">2</span>    <span class=\"number\">0</span>   <span class=\"number\">19</span>G  <span class=\"number\">0</span> part </span><br><span class=\"line\">  ├─centos-root <span class=\"number\">253</span>:<span class=\"number\">0</span>    <span class=\"number\">0</span>   <span class=\"number\">17</span>G  <span class=\"number\">0</span> lvm  /</span><br><span class=\"line\">  └─centos-swap <span class=\"number\">253</span>:<span class=\"number\">1</span>    <span class=\"number\">0</span>    <span class=\"number\">2</span>G  <span class=\"number\">0</span> lvm  [SWAP]</span><br><span class=\"line\">sr0              <span class=\"number\">11</span>:<span class=\"number\">0</span>    <span class=\"number\">1</span>  <span class=\"number\">4.2</span>G  <span class=\"number\">0</span> rom  </span><br><span class=\"line\">[<span class=\"number\">1</span>] <span class=\"number\">10</span>:<span class=\"number\">13</span>:<span class=\"number\">02</span> [SUCCESS] <span class=\"number\">172.16</span>.<span class=\"number\">1.16</span></span><br><span class=\"line\"><span class=\"number\">172.16</span>.<span class=\"number\">1.112</span>: NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class=\"line\">sda               <span class=\"number\">8</span>:<span class=\"number\">0</span>    <span class=\"number\">0</span>   <span class=\"number\">20</span>G  <span class=\"number\">0</span> disk </span><br><span class=\"line\">├─sda1            <span class=\"number\">8</span>:<span class=\"number\">1</span>    <span class=\"number\">0</span>    <span class=\"number\">1</span>G  <span class=\"number\">0</span> part /boot</span><br><span class=\"line\">└─sda2            <span class=\"number\">8</span>:<span class=\"number\">2</span>    <span class=\"number\">0</span>   <span class=\"number\">19</span>G  <span class=\"number\">0</span> part </span><br><span class=\"line\">  ├─centos-root <span class=\"number\">253</span>:<span class=\"number\">0</span>    <span class=\"number\">0</span>   <span class=\"number\">17</span>G  <span class=\"number\">0</span> lvm  /</span><br><span class=\"line\">  └─centos-swap <span class=\"number\">253</span>:<span class=\"number\">1</span>    <span class=\"number\">0</span>    <span class=\"number\">2</span>G  <span class=\"number\">0</span> lvm  [SWAP]</span><br><span class=\"line\">sr0              <span class=\"number\">11</span>:<span class=\"number\">0</span>    <span class=\"number\">1</span>  <span class=\"number\">4.2</span>G  <span class=\"number\">0</span> rom  </span><br><span class=\"line\">[<span class=\"number\">2</span>] <span class=\"number\">10</span>:<span class=\"number\">13</span>:<span class=\"number\">03</span> [SUCCESS] <span class=\"number\">172.16</span>.<span class=\"number\">1.112</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>pssh是由python编写，可以在多台服务器执行命令的工具。在服务器越来越多的企业这种自动化运维工具越来越火。</p>\n</blockquote>\n<h5 id=\"下载pssh安装包\"><a href=\"#下载pssh安装包\" class=\"headerlink\" title=\"下载pssh安装包\"></a>下载pssh安装包</h5><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# wget https://files.pythonhosted.org/packages/60/9a/8035af3a7d3d1617ae2c7c174efa4f154e5bf9c24b36b623413b38be8e4a/pssh-2.3.1.tar.gz</span><br></pre></td></tr></table></figure>\n<h5 id=\"配置免密登录\"><a href=\"#配置免密登录\" class=\"headerlink\" title=\"配置免密登录\"></a>配置免密登录</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# ssh-keygen</span><br><span class=\"line\">Generating <span class=\"keyword\">public</span>/<span class=\"keyword\">private</span> rsa key pair.</span><br><span class=\"line\"><span class=\"function\">Enter file in which to save the <span class=\"title\">key</span> <span class=\"params\">(/root/.ssh/id_rsa)</span>: </span></span><br><span class=\"line\"><span class=\"function\">Enter <span class=\"title\">passphrase</span> <span class=\"params\">(empty <span class=\"keyword\">for</span> no passphrase)</span>: </span></span><br><span class=\"line\"><span class=\"function\">Enter same passphrase again: </span></span><br><span class=\"line\"><span class=\"function\">Your identification has been saved in /root/.ssh/id_rsa.</span></span><br><span class=\"line\"><span class=\"function\">Your <span class=\"keyword\">public</span> key has been saved in /root/.ssh/id_rsa.pub.</span></span><br><span class=\"line\"><span class=\"function\">The key fingerprint is:</span></span><br><span class=\"line\"><span class=\"function\">SHA256:3antaxjGw+hdgfSlrXLYhUe5vgHe9b0ehh/gUY9E8Eg root@localhost.localdomain</span></span><br><span class=\"line\"><span class=\"function\">The key&#x27;s randomart image is:</span></span><br><span class=\"line\"><span class=\"function\">+---[RSA 2048]----+</span></span><br><span class=\"line\"><span class=\"function\">|            E... |</span></span><br><span class=\"line\"><span class=\"function\">|          .. ++  |</span></span><br><span class=\"line\"><span class=\"function\">|         . o.*oo |</span></span><br><span class=\"line\"><span class=\"function\">|         ...*o*.o|</span></span><br><span class=\"line\"><span class=\"function\">|        S+.+o@..+|</span></span><br><span class=\"line\"><span class=\"function\">|        . OoB B o|</span></span><br><span class=\"line\"><span class=\"function\">|       . o.B.o *.|</span></span><br><span class=\"line\"><span class=\"function\">|        . o.. +.o|</span></span><br><span class=\"line\"><span class=\"function\">|           .o..o |</span></span><br><span class=\"line\"><span class=\"function\">+----[SHA256]-----+</span></span><br><span class=\"line\"><span class=\"function\">[root@localhost ~]# cd /root/.ssh/</span></span><br><span class=\"line\"><span class=\"function\">[root@localhost .ssh]# ls</span></span><br><span class=\"line\"><span class=\"function\">id_rsa  id_rsa.pub</span></span><br><span class=\"line\"><span class=\"function\">[root@localhost .ssh]# ssh-copy-id 172.16.1.112</span></span><br><span class=\"line\"><span class=\"function\">/usr/bin/ssh-copy-id: INFO: Source of <span class=\"title\">key</span><span class=\"params\">(s)</span> to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span></span><br><span class=\"line\"><span class=\"function\">The authenticity of host &#x27;172.16.1.112 <span class=\"params\">(<span class=\"number\">172.16</span><span class=\"number\">.1</span><span class=\"number\">.112</span>)</span>&#x27; can&#x27;t be established.</span></span><br><span class=\"line\"><span class=\"function\">ECDSA key fingerprint is SHA256:yFvaxR1x5YDhhe+6xR/Ou6Sm+YPYvPAoiLVKt9mAnXA.</span></span><br><span class=\"line\"><span class=\"function\">ECDSA key fingerprint is MD5:0d:c4:79:bc:36:7a:a4:82:95:4f:d5:d0:a3:c8:7d:2e.</span></span><br><span class=\"line\"><span class=\"function\">Are you sure you want to <span class=\"keyword\">continue</span> <span class=\"title\">connecting</span> <span class=\"params\">(yes/no)</span>? yes</span></span><br><span class=\"line\"><span class=\"function\">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new <span class=\"title\">key</span><span class=\"params\">(s)</span>, to filter out any that are already installed</span></span><br><span class=\"line\"><span class=\"function\">/usr/bin/ssh-copy-id: INFO: 1 <span class=\"title\">key</span><span class=\"params\">(s)</span> remain to be installed -- <span class=\"keyword\">if</span> you are prompted now it is to install the new keys</span></span><br><span class=\"line\"><span class=\"function\">root@172.16.1.112&#x27;s password: </span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">Number of <span class=\"title\">key</span><span class=\"params\">(s)</span> added: 1</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">Now <span class=\"keyword\">try</span> logging into the machine, with:   &quot;ssh &#x27;172.16.1.112&#x27;&quot;</span></span><br><span class=\"line\"><span class=\"function\">and check to make sure that only the <span class=\"title\">key</span><span class=\"params\">(s)</span> you wanted were added.</span></span><br><span class=\"line\"><span class=\"function\">[root@localhost .ssh]# ssh-copy-id 172.16.1.16</span></span><br><span class=\"line\"><span class=\"function\">/usr/bin/ssh-copy-id: INFO: Source of <span class=\"title\">key</span><span class=\"params\">(s)</span> to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span></span><br><span class=\"line\"><span class=\"function\">The authenticity of host &#x27;172.16.1.16 <span class=\"params\">(<span class=\"number\">172.16</span><span class=\"number\">.1</span><span class=\"number\">.16</span>)</span>&#x27; can&#x27;t be established.</span></span><br><span class=\"line\"><span class=\"function\">ECDSA key fingerprint is SHA256:ANzlXzrGA87YLI2vzkPJ/iNPiSQ5JStJc95948jE8aw.</span></span><br><span class=\"line\"><span class=\"function\">ECDSA key fingerprint is MD5:f9:f1:1b:5a:99:64:d8:d8:e9:9b:e6:bb:c3:d5:bd:e7.</span></span><br><span class=\"line\"><span class=\"function\">Are you sure you want to <span class=\"keyword\">continue</span> <span class=\"title\">connecting</span> <span class=\"params\">(yes/no)</span>? yes</span></span><br><span class=\"line\"><span class=\"function\">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new <span class=\"title\">key</span><span class=\"params\">(s)</span>, to filter out any that are already installed</span></span><br><span class=\"line\"><span class=\"function\">/usr/bin/ssh-copy-id: INFO: 1 <span class=\"title\">key</span><span class=\"params\">(s)</span> remain to be installed -- <span class=\"keyword\">if</span> you are prompted now it is to install the new keys</span></span><br><span class=\"line\"><span class=\"function\">root@172.16.1.16&#x27;s password: </span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">Number of <span class=\"title\">key</span><span class=\"params\">(s)</span> added: 1</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">Now <span class=\"keyword\">try</span> logging into the machine, with:   &quot;ssh &#x27;172.16.1.16&#x27;&quot;</span></span><br><span class=\"line\"><span class=\"function\">and check to make sure that only the <span class=\"title\">key</span><span class=\"params\">(s)</span> you wanted were added.</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"测试免密登录\"><a href=\"#测试免密登录\" class=\"headerlink\" title=\"测试免密登录\"></a>测试免密登录</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# ssh 172.16.1.112</span><br><span class=\"line\">Last login: Tue Jun  <span class=\"number\">2</span> <span class=\"number\">09</span>:<span class=\"number\">44</span>:<span class=\"number\">24</span> <span class=\"number\">2020</span> from <span class=\"number\">172.16</span>.<span class=\"number\">1.16</span></span><br><span class=\"line\">[root@localhost ~]# ssh 172.16.1.16</span><br><span class=\"line\">Last login: Tue Jun  <span class=\"number\">2</span> <span class=\"number\">09</span>:<span class=\"number\">30</span>:<span class=\"number\">47</span> <span class=\"number\">2020</span> from <span class=\"number\">172.16</span>.<span class=\"number\">1.100</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"测试pssh\"><a href=\"#测试pssh\" class=\"headerlink\" title=\"测试pssh\"></a>测试pssh</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 将IP写入到文件中</span><br><span class=\"line\">[root@localhost ~]# echo &quot;172.16.1.112&quot; &gt;&gt; aaa</span><br><span class=\"line\">[root@localhost ~]# echo &quot;172.16.1.16&quot; &gt;&gt; aaa</span><br><span class=\"line\">[root@localhost ~]# cat aaa</span><br><span class=\"line\"><span class=\"number\">172.16</span>.<span class=\"number\">1.112</span></span><br><span class=\"line\"><span class=\"number\">172.16</span>.<span class=\"number\">1.16</span></span><br><span class=\"line\"># 批量执行date命令</span><br><span class=\"line\">[root@localhost ~]# pssh -h aaa -l root -P &quot;date&quot;</span><br><span class=\"line\"><span class=\"number\">172.16</span>.<span class=\"number\">1.16</span>: <span class=\"number\">2020</span>年 <span class=\"number\">06</span>月 <span class=\"number\">02</span>日 星期二 <span class=\"number\">09</span>:<span class=\"number\">59</span>:<span class=\"number\">48</span> CST</span><br><span class=\"line\">[<span class=\"number\">1</span>] <span class=\"number\">09</span>:<span class=\"number\">59</span>:<span class=\"number\">48</span> [SUCCESS] <span class=\"number\">172.16</span>.<span class=\"number\">1.16</span></span><br><span class=\"line\"><span class=\"number\">172.16</span>.<span class=\"number\">1.112</span>: <span class=\"number\">2020</span>年 <span class=\"number\">06</span>月 <span class=\"number\">02</span>日 星期二 <span class=\"number\">09</span>:<span class=\"number\">59</span>:<span class=\"number\">48</span> CST</span><br><span class=\"line\">[<span class=\"number\">2</span>] <span class=\"number\">09</span>:<span class=\"number\">59</span>:<span class=\"number\">48</span> [SUCCESS] <span class=\"number\">172.16</span>.<span class=\"number\">1.112</span></span><br><span class=\"line\"># 查看磁盘</span><br><span class=\"line\">[root@localhost ~]# pssh -h aaa -l root -P &quot;lsblk&quot;</span><br><span class=\"line\"><span class=\"number\">172.16</span>.<span class=\"number\">1.16</span>: NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class=\"line\">sda               <span class=\"number\">8</span>:<span class=\"number\">0</span>    <span class=\"number\">0</span>   <span class=\"number\">20</span>G  <span class=\"number\">0</span> disk </span><br><span class=\"line\">├─sda1            <span class=\"number\">8</span>:<span class=\"number\">1</span>    <span class=\"number\">0</span>    <span class=\"number\">1</span>G  <span class=\"number\">0</span> part /boot</span><br><span class=\"line\">└─sda2            <span class=\"number\">8</span>:<span class=\"number\">2</span>    <span class=\"number\">0</span>   <span class=\"number\">19</span>G  <span class=\"number\">0</span> part </span><br><span class=\"line\">  ├─centos-root <span class=\"number\">253</span>:<span class=\"number\">0</span>    <span class=\"number\">0</span>   <span class=\"number\">17</span>G  <span class=\"number\">0</span> lvm  /</span><br><span class=\"line\">  └─centos-swap <span class=\"number\">253</span>:<span class=\"number\">1</span>    <span class=\"number\">0</span>    <span class=\"number\">2</span>G  <span class=\"number\">0</span> lvm  [SWAP]</span><br><span class=\"line\">sr0              <span class=\"number\">11</span>:<span class=\"number\">0</span>    <span class=\"number\">1</span>  <span class=\"number\">4.2</span>G  <span class=\"number\">0</span> rom  </span><br><span class=\"line\">[<span class=\"number\">1</span>] <span class=\"number\">10</span>:<span class=\"number\">13</span>:<span class=\"number\">02</span> [SUCCESS] <span class=\"number\">172.16</span>.<span class=\"number\">1.16</span></span><br><span class=\"line\"><span class=\"number\">172.16</span>.<span class=\"number\">1.112</span>: NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class=\"line\">sda               <span class=\"number\">8</span>:<span class=\"number\">0</span>    <span class=\"number\">0</span>   <span class=\"number\">20</span>G  <span class=\"number\">0</span> disk </span><br><span class=\"line\">├─sda1            <span class=\"number\">8</span>:<span class=\"number\">1</span>    <span class=\"number\">0</span>    <span class=\"number\">1</span>G  <span class=\"number\">0</span> part /boot</span><br><span class=\"line\">└─sda2            <span class=\"number\">8</span>:<span class=\"number\">2</span>    <span class=\"number\">0</span>   <span class=\"number\">19</span>G  <span class=\"number\">0</span> part </span><br><span class=\"line\">  ├─centos-root <span class=\"number\">253</span>:<span class=\"number\">0</span>    <span class=\"number\">0</span>   <span class=\"number\">17</span>G  <span class=\"number\">0</span> lvm  /</span><br><span class=\"line\">  └─centos-swap <span class=\"number\">253</span>:<span class=\"number\">1</span>    <span class=\"number\">0</span>    <span class=\"number\">2</span>G  <span class=\"number\">0</span> lvm  [SWAP]</span><br><span class=\"line\">sr0              <span class=\"number\">11</span>:<span class=\"number\">0</span>    <span class=\"number\">1</span>  <span class=\"number\">4.2</span>G  <span class=\"number\">0</span> rom  </span><br><span class=\"line\">[<span class=\"number\">2</span>] <span class=\"number\">10</span>:<span class=\"number\">13</span>:<span class=\"number\">03</span> [SUCCESS] <span class=\"number\">172.16</span>.<span class=\"number\">1.112</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"Dockerfile文件语法","author":"Semaik.","date":"2020-09-27T06:20:00.000Z","_content":"##### Dockerfile文件编写格式：\n```java\nFROM  # 指定base镜像\nMAINTAINER # 指定镜像作者，后面根任意字符串\nCOPY # 把文件从host复制到镜像内\n  COPY src dest\n  COPY [\"src\",\"dest\"]\n  src:只能是文件\nADD # 用法和COPY一样，唯一不同时src可以是压缩包，表示解压缩到dest位置，src也可以是目录\nENV # 设置环境变量可以被接下来的镜像层引用，并且会加入到镜像中\n  ENV MY_VERSION 1.3\n  RUN yum -y install http-$MY_VERSION\n  # 当进入该镜像的容器中echo $MY_VERSION会输出1.3\nEXPOSE # 指定容器中的进程监听的端口（接口），会在docker ps -a中的ports中显示\n  EXPOSE 80\nVOLUME # 容器卷，后面会讲到，把host的路径mount到容器中\n  VOLUME /root/htdocs /usr/local/apahce2/htdocs\nWORKDIR # 为后续的镜像层设置工作路径\n        # 如果不设置，Dockerfile文件中的每一条命令都会返回到初始状态\n        # 设置一次后，会一直在该路经执行之后的分层，需要WORKDIR /回到根目录\nCMD # 启动容器后默认运行的命令，使用构建完成的镜像实例化为容器时，进入后默认执行的命令\n    # 这个命令会被docker run启动命令替代\n    # 如：docker -it --rm centos echo \"hello\"\n    # echo \"hello\"会替代CMD运行的命令\n  CMD [\"nginx\", \"-g\", \"daemon off\"]  # 该镜像实例化后的容器，进入后运行nginx启动服务\nENTRYPOINT # 容器启动时运行的命令，不会被docker run的启动命令替代\n```\n\n![upload successful](/images/pasted-80.png)\n\n**镜像的命名规则：**\n\nimage name = 镜像站地址+作者命名+服务名称:标签\n\n##### Dockerfile文件排错方法\n当个构建镜像时Dockerfile中报错，先来制作一个错误的Dockerfile\n```java\n[root@localhost ~]# vim Dockerfile\nFROM busybox\nRUN touch tmpfile\nRUN /bin/bash -c echo \"continue to build...\"\nCOPY testfile /\n```\n使用这个Dockerfile去构建镜像\n```java\n[root@localhost ~]# docker build -t testerror /root\nSending build context to Docker daemon  4.336MB\nStep 1/4 : FROM busybox\n ---> 83aa35aa1c79\nStep 2/4 : RUN touch tmpfile\n ---> Running in 41a8dad29cd6\nRemoving intermediate container 41a8dad29cd6\n ---> 8cd5c9a720bb\nStep 3/4 : RUN /bin/bash -c echo \"continue to build...\"\n ---> Running in bc1849fa8144\n/bin/sh: /bin/bash: not found\nThe command '/bin/sh -c /bin/bash -c echo \"continue to build...\"' returned a non-zero code: 127\n```\n发现构建镜像过程中出现了报错`/bin/sh: /bin/bash: not found`\n\n可以看到报错信息是从第三步才开始的，说明前两步是没有问题的，可以通过进入前两步最后结束的镜像id中去查看错误，进入前两层的镜像id是一个正常的容器环境，将第三步无法执行的命令，在容器中运行，将会看到真正的错误是没有`/bin/bash`这个环境\n```java\n[root@localhost ~]# docker run -it  8cd5c9a720bb\n/ # /bin/bash -c echo \"continue to build...\"\nsh: /bin/bash: not found\n```\n因为构建这个镜像使用的是busybox，它使用的环境是`/bin/sh`\n\n修改后，重新构建成功\n```java\n[root@localhost ~]# docker build -t testerror /root\nSuccessfully built ae5870fff063\nSuccessfully tagged testerror:latest\n```\n运行容器后，可以看到创建的tmpfile和复制testfile\n```java\n[root@localhost ~]# docker run -it testerror \n/ # ls\nbin       etc       proc      sys       tmp       usr\ndev       home      root      testfile  tmpfile   var\n```\n##### 镜像构建过程\n在构建命令执行时输出的一大堆信息中，是执行Dockerfile中的每一行，最关键的几行信息如下\n```java\nStep 1/5 : FROM centos  # 调用centos\n 5e35e350aded   # centos镜像id\n  \nStep 2/5 : RUN yum install httpd -y\n Running in a16ddf07c140  # 运行一个临时容器来执行install httpd\nRemoving intermediate container a16ddf07c140  # 完成后删除临时的容器id\n b51207823459  # 生成一个镜像\n  \nStep 3/5 : RUN yum install net-tools -y\n Running in 459c8823018a # 运行一个临时容器执行install net-tools\nRemoving intermediate container 459c8823018a # 完成后删除临时容器id\n 5b6c30a532d4  # 再生成一个镜像\n \nStep 4/5 : RUN yum install elinks -y\n Running in a2cb490f9b2f  # 运行一个临时容器执行install elinks\nRemoving intermediate container a2cb490f9b2f # 完成后删除临时容器id\n 24ba4735814b # 生成一个镜像\n \nStep 5/5 : CMD [\"/bin/bash\"]\n Running in 792333c88ba8  # 运行临时容器，执行/bin/bash\nRemoving intermediate container 792333c88ba8  # 完成后删除临时容器id\n 09266c896243  # 生成镜像\nSuccessfully built 09266c896243  # 最终成功后的镜像id就是最后生成的镜像id\n```\n每一步生成一个镜像，都属于一个`docker commit`的执行结果\n\n在这个过程中一共生成了三个镜像层，都会被存储在graph中，包括层与层之间的关系，查看docker images中生成的镜像id是否为最后生成的镜像id，`FROM`和`CMD`都不算做镜像层\n```java\n[root@localhost ~]# docker images\nREPOSITORY             TAG       IMAGE ID       CREATED          SIZE\nchai/centos-http-net   latest    09266c896243   10 seconds ago   581MB\n```\n通过`docker history`也可以看到简单的构建过程，这几个过程的size容量加起来也就是最终生成镜像的大小，也可将这里的镜像id和上面过程中的id进行对比，我们所看到的是三个yum就是形成的三个镜像层\n```java\n[root@localhost ~]# docker history chai/centos-http-net:latest \nIMAGE         CREATED          CREATED BY                                      SIZE    COMMENT\n09266c896243  17 minutes ago   /bin/sh -c #(nop)  CMD [\"/bin/bash\"]            0B                  \n24ba4735814b  17 minutes ago   /bin/sh -c yum install elinks -y                121MB               \n5b6c30a532d4  18 minutes ago   /bin/sh -c yum install net-tools -y             112MB               \nb51207823459  18 minutes ago   /bin/sh -c yum install httpd -y                 145MB               \n5e35e350aded  4 months ago     /bin/sh -c #(nop)  CMD [\"/bin/bash\"]            0B                  \n<missing>     4 months ago     /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B                  \n<missing>     4 months ago     /bin/sh -c #(nop) ADD file:45a381049c52b5664…   203MB\n```\n![upload successful](/images/pasted-81.png)\n\n![upload successful](/images/pasted-82.png)\n\n![upload successful](/images/pasted-83.png)\n\n![upload successful](/images/pasted-84.png)","source":"_posts/Dockerfile文件.md","raw":"title: Dockerfile文件语法\nauthor: Semaik.\ntags:\n  - Docker\ncategories:\n  - Docker\ndate: 2020-09-27 14:20:00\n---\n##### Dockerfile文件编写格式：\n```java\nFROM  # 指定base镜像\nMAINTAINER # 指定镜像作者，后面根任意字符串\nCOPY # 把文件从host复制到镜像内\n  COPY src dest\n  COPY [\"src\",\"dest\"]\n  src:只能是文件\nADD # 用法和COPY一样，唯一不同时src可以是压缩包，表示解压缩到dest位置，src也可以是目录\nENV # 设置环境变量可以被接下来的镜像层引用，并且会加入到镜像中\n  ENV MY_VERSION 1.3\n  RUN yum -y install http-$MY_VERSION\n  # 当进入该镜像的容器中echo $MY_VERSION会输出1.3\nEXPOSE # 指定容器中的进程监听的端口（接口），会在docker ps -a中的ports中显示\n  EXPOSE 80\nVOLUME # 容器卷，后面会讲到，把host的路径mount到容器中\n  VOLUME /root/htdocs /usr/local/apahce2/htdocs\nWORKDIR # 为后续的镜像层设置工作路径\n        # 如果不设置，Dockerfile文件中的每一条命令都会返回到初始状态\n        # 设置一次后，会一直在该路经执行之后的分层，需要WORKDIR /回到根目录\nCMD # 启动容器后默认运行的命令，使用构建完成的镜像实例化为容器时，进入后默认执行的命令\n    # 这个命令会被docker run启动命令替代\n    # 如：docker -it --rm centos echo \"hello\"\n    # echo \"hello\"会替代CMD运行的命令\n  CMD [\"nginx\", \"-g\", \"daemon off\"]  # 该镜像实例化后的容器，进入后运行nginx启动服务\nENTRYPOINT # 容器启动时运行的命令，不会被docker run的启动命令替代\n```\n\n![upload successful](/images/pasted-80.png)\n\n**镜像的命名规则：**\n\nimage name = 镜像站地址+作者命名+服务名称:标签\n\n##### Dockerfile文件排错方法\n当个构建镜像时Dockerfile中报错，先来制作一个错误的Dockerfile\n```java\n[root@localhost ~]# vim Dockerfile\nFROM busybox\nRUN touch tmpfile\nRUN /bin/bash -c echo \"continue to build...\"\nCOPY testfile /\n```\n使用这个Dockerfile去构建镜像\n```java\n[root@localhost ~]# docker build -t testerror /root\nSending build context to Docker daemon  4.336MB\nStep 1/4 : FROM busybox\n ---> 83aa35aa1c79\nStep 2/4 : RUN touch tmpfile\n ---> Running in 41a8dad29cd6\nRemoving intermediate container 41a8dad29cd6\n ---> 8cd5c9a720bb\nStep 3/4 : RUN /bin/bash -c echo \"continue to build...\"\n ---> Running in bc1849fa8144\n/bin/sh: /bin/bash: not found\nThe command '/bin/sh -c /bin/bash -c echo \"continue to build...\"' returned a non-zero code: 127\n```\n发现构建镜像过程中出现了报错`/bin/sh: /bin/bash: not found`\n\n可以看到报错信息是从第三步才开始的，说明前两步是没有问题的，可以通过进入前两步最后结束的镜像id中去查看错误，进入前两层的镜像id是一个正常的容器环境，将第三步无法执行的命令，在容器中运行，将会看到真正的错误是没有`/bin/bash`这个环境\n```java\n[root@localhost ~]# docker run -it  8cd5c9a720bb\n/ # /bin/bash -c echo \"continue to build...\"\nsh: /bin/bash: not found\n```\n因为构建这个镜像使用的是busybox，它使用的环境是`/bin/sh`\n\n修改后，重新构建成功\n```java\n[root@localhost ~]# docker build -t testerror /root\nSuccessfully built ae5870fff063\nSuccessfully tagged testerror:latest\n```\n运行容器后，可以看到创建的tmpfile和复制testfile\n```java\n[root@localhost ~]# docker run -it testerror \n/ # ls\nbin       etc       proc      sys       tmp       usr\ndev       home      root      testfile  tmpfile   var\n```\n##### 镜像构建过程\n在构建命令执行时输出的一大堆信息中，是执行Dockerfile中的每一行，最关键的几行信息如下\n```java\nStep 1/5 : FROM centos  # 调用centos\n 5e35e350aded   # centos镜像id\n  \nStep 2/5 : RUN yum install httpd -y\n Running in a16ddf07c140  # 运行一个临时容器来执行install httpd\nRemoving intermediate container a16ddf07c140  # 完成后删除临时的容器id\n b51207823459  # 生成一个镜像\n  \nStep 3/5 : RUN yum install net-tools -y\n Running in 459c8823018a # 运行一个临时容器执行install net-tools\nRemoving intermediate container 459c8823018a # 完成后删除临时容器id\n 5b6c30a532d4  # 再生成一个镜像\n \nStep 4/5 : RUN yum install elinks -y\n Running in a2cb490f9b2f  # 运行一个临时容器执行install elinks\nRemoving intermediate container a2cb490f9b2f # 完成后删除临时容器id\n 24ba4735814b # 生成一个镜像\n \nStep 5/5 : CMD [\"/bin/bash\"]\n Running in 792333c88ba8  # 运行临时容器，执行/bin/bash\nRemoving intermediate container 792333c88ba8  # 完成后删除临时容器id\n 09266c896243  # 生成镜像\nSuccessfully built 09266c896243  # 最终成功后的镜像id就是最后生成的镜像id\n```\n每一步生成一个镜像，都属于一个`docker commit`的执行结果\n\n在这个过程中一共生成了三个镜像层，都会被存储在graph中，包括层与层之间的关系，查看docker images中生成的镜像id是否为最后生成的镜像id，`FROM`和`CMD`都不算做镜像层\n```java\n[root@localhost ~]# docker images\nREPOSITORY             TAG       IMAGE ID       CREATED          SIZE\nchai/centos-http-net   latest    09266c896243   10 seconds ago   581MB\n```\n通过`docker history`也可以看到简单的构建过程，这几个过程的size容量加起来也就是最终生成镜像的大小，也可将这里的镜像id和上面过程中的id进行对比，我们所看到的是三个yum就是形成的三个镜像层\n```java\n[root@localhost ~]# docker history chai/centos-http-net:latest \nIMAGE         CREATED          CREATED BY                                      SIZE    COMMENT\n09266c896243  17 minutes ago   /bin/sh -c #(nop)  CMD [\"/bin/bash\"]            0B                  \n24ba4735814b  17 minutes ago   /bin/sh -c yum install elinks -y                121MB               \n5b6c30a532d4  18 minutes ago   /bin/sh -c yum install net-tools -y             112MB               \nb51207823459  18 minutes ago   /bin/sh -c yum install httpd -y                 145MB               \n5e35e350aded  4 months ago     /bin/sh -c #(nop)  CMD [\"/bin/bash\"]            0B                  \n<missing>     4 months ago     /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B                  \n<missing>     4 months ago     /bin/sh -c #(nop) ADD file:45a381049c52b5664…   203MB\n```\n![upload successful](/images/pasted-81.png)\n\n![upload successful](/images/pasted-82.png)\n\n![upload successful](/images/pasted-83.png)\n\n![upload successful](/images/pasted-84.png)","slug":"Dockerfile文件","published":1,"updated":"2020-09-27T06:43:54.931Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r736x000dm3pv3clg43u9","content":"<h5 id=\"Dockerfile文件编写格式：\"><a href=\"#Dockerfile文件编写格式：\" class=\"headerlink\" title=\"Dockerfile文件编写格式：\"></a>Dockerfile文件编写格式：</h5><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FROM  # 指定base镜像</span><br><span class=\"line\">MAINTAINER # 指定镜像作者，后面根任意字符串</span><br><span class=\"line\">COPY # 把文件从host复制到镜像内</span><br><span class=\"line\">  COPY src dest</span><br><span class=\"line\">  COPY [<span class=\"string\">&quot;src&quot;</span>,<span class=\"string\">&quot;dest&quot;</span>]</span><br><span class=\"line\">  src:只能是文件</span><br><span class=\"line\">ADD # 用法和COPY一样，唯一不同时src可以是压缩包，表示解压缩到dest位置，src也可以是目录</span><br><span class=\"line\">ENV # 设置环境变量可以被接下来的镜像层引用，并且会加入到镜像中</span><br><span class=\"line\">  ENV MY_VERSION <span class=\"number\">1.3</span></span><br><span class=\"line\">  RUN yum -y install http-$MY_VERSION</span><br><span class=\"line\">  # 当进入该镜像的容器中echo $MY_VERSION会输出1.3</span><br><span class=\"line\">EXPOSE # 指定容器中的进程监听的端口（接口），会在docker ps -a中的ports中显示</span><br><span class=\"line\">  EXPOSE <span class=\"number\">80</span></span><br><span class=\"line\">VOLUME # 容器卷，后面会讲到，把host的路径mount到容器中</span><br><span class=\"line\">  VOLUME /root/htdocs /usr/local/apahce2/htdocs</span><br><span class=\"line\">WORKDIR # 为后续的镜像层设置工作路径</span><br><span class=\"line\">        # 如果不设置，Dockerfile文件中的每一条命令都会返回到初始状态</span><br><span class=\"line\">        # 设置一次后，会一直在该路经执行之后的分层，需要WORKDIR /回到根目录</span><br><span class=\"line\">CMD # 启动容器后默认运行的命令，使用构建完成的镜像实例化为容器时，进入后默认执行的命令</span><br><span class=\"line\">    # 这个命令会被docker run启动命令替代</span><br><span class=\"line\">    # 如：docker -it --rm centos echo &quot;hello&quot;</span><br><span class=\"line\">    # echo &quot;hello&quot;会替代CMD运行的命令</span><br><span class=\"line\">  CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off&quot;]  # 该镜像实例化后的容器，进入后运行nginx启动服务</span><br><span class=\"line\">ENTRYPOINT # 容器启动时运行的命令，不会被docker run的启动命令替代</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-80.png\" alt=\"upload successful\"></p>\n<p><strong>镜像的命名规则：</strong></p>\n<p>image name = 镜像站地址+作者命名+服务名称:标签</p>\n<h5 id=\"Dockerfile文件排错方法\"><a href=\"#Dockerfile文件排错方法\" class=\"headerlink\" title=\"Dockerfile文件排错方法\"></a>Dockerfile文件排错方法</h5><p>当个构建镜像时Dockerfile中报错，先来制作一个错误的Dockerfile</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# vim Dockerfile</span><br><span class=\"line\">FROM busybox</span><br><span class=\"line\">RUN touch tmpfile</span><br><span class=\"line\">RUN /bin/bash -c echo <span class=\"string\">&quot;continue to build...&quot;</span></span><br><span class=\"line\">COPY testfile /</span><br></pre></td></tr></table></figure>\n<p>使用这个Dockerfile去构建镜像</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker build -t testerror /root</span><br><span class=\"line\">Sending build context to Docker daemon  <span class=\"number\">4.336</span>MB</span><br><span class=\"line\">Step <span class=\"number\">1</span>/<span class=\"number\">4</span> : FROM busybox</span><br><span class=\"line\"> ---&gt; <span class=\"number\">83</span>aa35aa1c79</span><br><span class=\"line\">Step <span class=\"number\">2</span>/<span class=\"number\">4</span> : RUN touch tmpfile</span><br><span class=\"line\"> ---&gt; Running in <span class=\"number\">41</span>a8dad29cd6</span><br><span class=\"line\">Removing intermediate container <span class=\"number\">41</span>a8dad29cd6</span><br><span class=\"line\"> ---&gt; <span class=\"number\">8</span>cd5c9a720bb</span><br><span class=\"line\">Step <span class=\"number\">3</span>/<span class=\"number\">4</span> : RUN /bin/bash -c echo <span class=\"string\">&quot;continue to build...&quot;</span></span><br><span class=\"line\"> ---&gt; Running in bc1849fa8144</span><br><span class=\"line\">/bin/sh: /bin/bash: not found</span><br><span class=\"line\">The command <span class=\"string\">&#x27;/bin/sh -c /bin/bash -c echo &quot;continue to build...&quot;&#x27;</span> returned a non-zero code: <span class=\"number\">127</span></span><br></pre></td></tr></table></figure>\n<p>发现构建镜像过程中出现了报错<code>/bin/sh: /bin/bash: not found</code></p>\n<p>可以看到报错信息是从第三步才开始的，说明前两步是没有问题的，可以通过进入前两步最后结束的镜像id中去查看错误，进入前两层的镜像id是一个正常的容器环境，将第三步无法执行的命令，在容器中运行，将会看到真正的错误是没有<code>/bin/bash</code>这个环境</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -it  8cd5c9a720bb</span><br><span class=\"line\">/ # /bin/bash -c echo &quot;continue to build...&quot;</span><br><span class=\"line\">sh: /bin/bash: not found</span><br></pre></td></tr></table></figure>\n<p>因为构建这个镜像使用的是busybox，它使用的环境是<code>/bin/sh</code></p>\n<p>修改后，重新构建成功</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker build -t testerror /root</span><br><span class=\"line\">Successfully built ae5870fff063</span><br><span class=\"line\">Successfully tagged testerror:latest</span><br></pre></td></tr></table></figure>\n<p>运行容器后，可以看到创建的tmpfile和复制testfile</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -it testerror </span><br><span class=\"line\">/ # ls</span><br><span class=\"line\">bin       etc       proc      sys       tmp       usr</span><br><span class=\"line\">dev       home      root      testfile  tmpfile   <span class=\"keyword\">var</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"镜像构建过程\"><a href=\"#镜像构建过程\" class=\"headerlink\" title=\"镜像构建过程\"></a>镜像构建过程</h5><p>在构建命令执行时输出的一大堆信息中，是执行Dockerfile中的每一行，最关键的几行信息如下</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Step 1/5 : FROM centos  # 调用centos</span><br><span class=\"line\"> 5e35e350aded   # centos镜像id</span><br><span class=\"line\">  </span><br><span class=\"line\">Step <span class=\"number\">2</span>/<span class=\"number\">5</span> : RUN yum install httpd -y</span><br><span class=\"line\"> Running in a16ddf07c140  # 运行一个临时容器来执行install httpd</span><br><span class=\"line\">Removing intermediate container a16ddf07c140  # 完成后删除临时的容器id</span><br><span class=\"line\"> b51207823459  # 生成一个镜像</span><br><span class=\"line\">  </span><br><span class=\"line\">Step <span class=\"number\">3</span>/<span class=\"number\">5</span> : RUN yum install net-tools -y</span><br><span class=\"line\"> Running in 459c8823018a # 运行一个临时容器执行install net-tools</span><br><span class=\"line\">Removing intermediate container 459c8823018a # 完成后删除临时容器id</span><br><span class=\"line\"> 5b6c30a532d4  # 再生成一个镜像</span><br><span class=\"line\"> </span><br><span class=\"line\">Step <span class=\"number\">4</span>/<span class=\"number\">5</span> : RUN yum install elinks -y</span><br><span class=\"line\"> Running in a2cb490f9b2f  # 运行一个临时容器执行install elinks</span><br><span class=\"line\">Removing intermediate container a2cb490f9b2f # 完成后删除临时容器id</span><br><span class=\"line\"> 24ba4735814b # 生成一个镜像</span><br><span class=\"line\"> </span><br><span class=\"line\">Step <span class=\"number\">5</span>/<span class=\"number\">5</span> : CMD [<span class=\"string\">&quot;/bin/bash&quot;</span>]</span><br><span class=\"line\"> Running in 792333c88ba8  # 运行临时容器，执行/bin/bash</span><br><span class=\"line\">Removing intermediate container 792333c88ba8  # 完成后删除临时容器id</span><br><span class=\"line\"> 09266c896243  # 生成镜像</span><br><span class=\"line\">Successfully built 09266c896243  # 最终成功后的镜像id就是最后生成的镜像id</span><br></pre></td></tr></table></figure>\n<p>每一步生成一个镜像，都属于一个<code>docker commit</code>的执行结果</p>\n<p>在这个过程中一共生成了三个镜像层，都会被存储在graph中，包括层与层之间的关系，查看docker images中生成的镜像id是否为最后生成的镜像id，<code>FROM</code>和<code>CMD</code>都不算做镜像层</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker images</span><br><span class=\"line\">REPOSITORY             TAG       IMAGE ID       CREATED          SIZE</span><br><span class=\"line\">chai/centos-http-net   latest    <span class=\"number\">09266</span>c896243   <span class=\"number\">10</span> seconds ago   <span class=\"number\">581</span>MB</span><br></pre></td></tr></table></figure>\n<p>通过<code>docker history</code>也可以看到简单的构建过程，这几个过程的size容量加起来也就是最终生成镜像的大小，也可将这里的镜像id和上面过程中的id进行对比，我们所看到的是三个yum就是形成的三个镜像层</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker history chai/centos-http-net:latest </span><br><span class=\"line\">IMAGE         CREATED          CREATED BY                                      SIZE    COMMENT</span><br><span class=\"line\">09266c896243  17 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B                  </span><br><span class=\"line\"><span class=\"number\">24</span>ba4735814b  <span class=\"number\">17</span> minutes ago   /bin/sh -c yum install elinks -y                <span class=\"number\">121</span>MB               </span><br><span class=\"line\"><span class=\"number\">5</span>b6c30a532d4  <span class=\"number\">18</span> minutes ago   /bin/sh -c yum install net-tools -y             <span class=\"number\">112</span>MB               </span><br><span class=\"line\">b51207823459  <span class=\"number\">18</span> minutes ago   /bin/sh -c yum install httpd -y                 <span class=\"number\">145</span>MB               </span><br><span class=\"line\">5e35e350aded  4 months ago     /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B                  </span><br><span class=\"line\">&lt;missing&gt;     4 months ago     /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B                  </span><br><span class=\"line\">&lt;missing&gt;     4 months ago     /bin/sh -c #(nop) ADD file:45a381049c52b5664…   203MB</span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/pasted-81.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-82.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-83.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-84.png\" alt=\"upload successful\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h5 id=\"Dockerfile文件编写格式：\"><a href=\"#Dockerfile文件编写格式：\" class=\"headerlink\" title=\"Dockerfile文件编写格式：\"></a>Dockerfile文件编写格式：</h5><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FROM  # 指定base镜像</span><br><span class=\"line\">MAINTAINER # 指定镜像作者，后面根任意字符串</span><br><span class=\"line\">COPY # 把文件从host复制到镜像内</span><br><span class=\"line\">  COPY src dest</span><br><span class=\"line\">  COPY [<span class=\"string\">&quot;src&quot;</span>,<span class=\"string\">&quot;dest&quot;</span>]</span><br><span class=\"line\">  src:只能是文件</span><br><span class=\"line\">ADD # 用法和COPY一样，唯一不同时src可以是压缩包，表示解压缩到dest位置，src也可以是目录</span><br><span class=\"line\">ENV # 设置环境变量可以被接下来的镜像层引用，并且会加入到镜像中</span><br><span class=\"line\">  ENV MY_VERSION <span class=\"number\">1.3</span></span><br><span class=\"line\">  RUN yum -y install http-$MY_VERSION</span><br><span class=\"line\">  # 当进入该镜像的容器中echo $MY_VERSION会输出1.3</span><br><span class=\"line\">EXPOSE # 指定容器中的进程监听的端口（接口），会在docker ps -a中的ports中显示</span><br><span class=\"line\">  EXPOSE <span class=\"number\">80</span></span><br><span class=\"line\">VOLUME # 容器卷，后面会讲到，把host的路径mount到容器中</span><br><span class=\"line\">  VOLUME /root/htdocs /usr/local/apahce2/htdocs</span><br><span class=\"line\">WORKDIR # 为后续的镜像层设置工作路径</span><br><span class=\"line\">        # 如果不设置，Dockerfile文件中的每一条命令都会返回到初始状态</span><br><span class=\"line\">        # 设置一次后，会一直在该路经执行之后的分层，需要WORKDIR /回到根目录</span><br><span class=\"line\">CMD # 启动容器后默认运行的命令，使用构建完成的镜像实例化为容器时，进入后默认执行的命令</span><br><span class=\"line\">    # 这个命令会被docker run启动命令替代</span><br><span class=\"line\">    # 如：docker -it --rm centos echo &quot;hello&quot;</span><br><span class=\"line\">    # echo &quot;hello&quot;会替代CMD运行的命令</span><br><span class=\"line\">  CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off&quot;]  # 该镜像实例化后的容器，进入后运行nginx启动服务</span><br><span class=\"line\">ENTRYPOINT # 容器启动时运行的命令，不会被docker run的启动命令替代</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-80.png\" alt=\"upload successful\"></p>\n<p><strong>镜像的命名规则：</strong></p>\n<p>image name = 镜像站地址+作者命名+服务名称:标签</p>\n<h5 id=\"Dockerfile文件排错方法\"><a href=\"#Dockerfile文件排错方法\" class=\"headerlink\" title=\"Dockerfile文件排错方法\"></a>Dockerfile文件排错方法</h5><p>当个构建镜像时Dockerfile中报错，先来制作一个错误的Dockerfile</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# vim Dockerfile</span><br><span class=\"line\">FROM busybox</span><br><span class=\"line\">RUN touch tmpfile</span><br><span class=\"line\">RUN /bin/bash -c echo <span class=\"string\">&quot;continue to build...&quot;</span></span><br><span class=\"line\">COPY testfile /</span><br></pre></td></tr></table></figure>\n<p>使用这个Dockerfile去构建镜像</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker build -t testerror /root</span><br><span class=\"line\">Sending build context to Docker daemon  <span class=\"number\">4.336</span>MB</span><br><span class=\"line\">Step <span class=\"number\">1</span>/<span class=\"number\">4</span> : FROM busybox</span><br><span class=\"line\"> ---&gt; <span class=\"number\">83</span>aa35aa1c79</span><br><span class=\"line\">Step <span class=\"number\">2</span>/<span class=\"number\">4</span> : RUN touch tmpfile</span><br><span class=\"line\"> ---&gt; Running in <span class=\"number\">41</span>a8dad29cd6</span><br><span class=\"line\">Removing intermediate container <span class=\"number\">41</span>a8dad29cd6</span><br><span class=\"line\"> ---&gt; <span class=\"number\">8</span>cd5c9a720bb</span><br><span class=\"line\">Step <span class=\"number\">3</span>/<span class=\"number\">4</span> : RUN /bin/bash -c echo <span class=\"string\">&quot;continue to build...&quot;</span></span><br><span class=\"line\"> ---&gt; Running in bc1849fa8144</span><br><span class=\"line\">/bin/sh: /bin/bash: not found</span><br><span class=\"line\">The command <span class=\"string\">&#x27;/bin/sh -c /bin/bash -c echo &quot;continue to build...&quot;&#x27;</span> returned a non-zero code: <span class=\"number\">127</span></span><br></pre></td></tr></table></figure>\n<p>发现构建镜像过程中出现了报错<code>/bin/sh: /bin/bash: not found</code></p>\n<p>可以看到报错信息是从第三步才开始的，说明前两步是没有问题的，可以通过进入前两步最后结束的镜像id中去查看错误，进入前两层的镜像id是一个正常的容器环境，将第三步无法执行的命令，在容器中运行，将会看到真正的错误是没有<code>/bin/bash</code>这个环境</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -it  8cd5c9a720bb</span><br><span class=\"line\">/ # /bin/bash -c echo &quot;continue to build...&quot;</span><br><span class=\"line\">sh: /bin/bash: not found</span><br></pre></td></tr></table></figure>\n<p>因为构建这个镜像使用的是busybox，它使用的环境是<code>/bin/sh</code></p>\n<p>修改后，重新构建成功</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker build -t testerror /root</span><br><span class=\"line\">Successfully built ae5870fff063</span><br><span class=\"line\">Successfully tagged testerror:latest</span><br></pre></td></tr></table></figure>\n<p>运行容器后，可以看到创建的tmpfile和复制testfile</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -it testerror </span><br><span class=\"line\">/ # ls</span><br><span class=\"line\">bin       etc       proc      sys       tmp       usr</span><br><span class=\"line\">dev       home      root      testfile  tmpfile   <span class=\"keyword\">var</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"镜像构建过程\"><a href=\"#镜像构建过程\" class=\"headerlink\" title=\"镜像构建过程\"></a>镜像构建过程</h5><p>在构建命令执行时输出的一大堆信息中，是执行Dockerfile中的每一行，最关键的几行信息如下</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Step 1/5 : FROM centos  # 调用centos</span><br><span class=\"line\"> 5e35e350aded   # centos镜像id</span><br><span class=\"line\">  </span><br><span class=\"line\">Step <span class=\"number\">2</span>/<span class=\"number\">5</span> : RUN yum install httpd -y</span><br><span class=\"line\"> Running in a16ddf07c140  # 运行一个临时容器来执行install httpd</span><br><span class=\"line\">Removing intermediate container a16ddf07c140  # 完成后删除临时的容器id</span><br><span class=\"line\"> b51207823459  # 生成一个镜像</span><br><span class=\"line\">  </span><br><span class=\"line\">Step <span class=\"number\">3</span>/<span class=\"number\">5</span> : RUN yum install net-tools -y</span><br><span class=\"line\"> Running in 459c8823018a # 运行一个临时容器执行install net-tools</span><br><span class=\"line\">Removing intermediate container 459c8823018a # 完成后删除临时容器id</span><br><span class=\"line\"> 5b6c30a532d4  # 再生成一个镜像</span><br><span class=\"line\"> </span><br><span class=\"line\">Step <span class=\"number\">4</span>/<span class=\"number\">5</span> : RUN yum install elinks -y</span><br><span class=\"line\"> Running in a2cb490f9b2f  # 运行一个临时容器执行install elinks</span><br><span class=\"line\">Removing intermediate container a2cb490f9b2f # 完成后删除临时容器id</span><br><span class=\"line\"> 24ba4735814b # 生成一个镜像</span><br><span class=\"line\"> </span><br><span class=\"line\">Step <span class=\"number\">5</span>/<span class=\"number\">5</span> : CMD [<span class=\"string\">&quot;/bin/bash&quot;</span>]</span><br><span class=\"line\"> Running in 792333c88ba8  # 运行临时容器，执行/bin/bash</span><br><span class=\"line\">Removing intermediate container 792333c88ba8  # 完成后删除临时容器id</span><br><span class=\"line\"> 09266c896243  # 生成镜像</span><br><span class=\"line\">Successfully built 09266c896243  # 最终成功后的镜像id就是最后生成的镜像id</span><br></pre></td></tr></table></figure>\n<p>每一步生成一个镜像，都属于一个<code>docker commit</code>的执行结果</p>\n<p>在这个过程中一共生成了三个镜像层，都会被存储在graph中，包括层与层之间的关系，查看docker images中生成的镜像id是否为最后生成的镜像id，<code>FROM</code>和<code>CMD</code>都不算做镜像层</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker images</span><br><span class=\"line\">REPOSITORY             TAG       IMAGE ID       CREATED          SIZE</span><br><span class=\"line\">chai/centos-http-net   latest    <span class=\"number\">09266</span>c896243   <span class=\"number\">10</span> seconds ago   <span class=\"number\">581</span>MB</span><br></pre></td></tr></table></figure>\n<p>通过<code>docker history</code>也可以看到简单的构建过程，这几个过程的size容量加起来也就是最终生成镜像的大小，也可将这里的镜像id和上面过程中的id进行对比，我们所看到的是三个yum就是形成的三个镜像层</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker history chai/centos-http-net:latest </span><br><span class=\"line\">IMAGE         CREATED          CREATED BY                                      SIZE    COMMENT</span><br><span class=\"line\">09266c896243  17 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B                  </span><br><span class=\"line\"><span class=\"number\">24</span>ba4735814b  <span class=\"number\">17</span> minutes ago   /bin/sh -c yum install elinks -y                <span class=\"number\">121</span>MB               </span><br><span class=\"line\"><span class=\"number\">5</span>b6c30a532d4  <span class=\"number\">18</span> minutes ago   /bin/sh -c yum install net-tools -y             <span class=\"number\">112</span>MB               </span><br><span class=\"line\">b51207823459  <span class=\"number\">18</span> minutes ago   /bin/sh -c yum install httpd -y                 <span class=\"number\">145</span>MB               </span><br><span class=\"line\">5e35e350aded  4 months ago     /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B                  </span><br><span class=\"line\">&lt;missing&gt;     4 months ago     /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B                  </span><br><span class=\"line\">&lt;missing&gt;     4 months ago     /bin/sh -c #(nop) ADD file:45a381049c52b5664…   203MB</span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/pasted-81.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-82.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-83.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-84.png\" alt=\"upload successful\"></p>\n"},{"title":"Dockerfile构建Nginx镜像","author":"Semaik.","date":"2020-09-27T06:31:00.000Z","_content":"##### Dockerfile构建nginx镜像\n>要求：dockerfile做nginx源码镜像。并且启动后容器后可以直接启动。\n\n首先拖入nginx的tar包到物理机路径，与Dockerfile文件放在同一目录\n\n编写Dockerfile\n```java\n[root@localhost ~]# vim Dockerfile \nFROM centos  # 调用docker中已下载的centos镜像\nMAINTAINER FeiYi  # 作者名为FeiYi\n 安装环境所需包\nRUN yum -y install net-tools iproute pcre-devel openssl-devel gcc gcc-c++ make zlib-devel elinks\nADD nginx-1.11.1.tar.gz /usr/src  # 解压本地host中的nginx包到容器中的/usr/src目录\nENV NGINX_DIR /usr/src/nginx-1.11.1 # 定义环境变量\nWORKDIR $NGINX_DIR  # 进入容器中的解压目录\n 编译安装\nRUN ./configure --prefix=/usr/local/nginx --user=nginx --group=nginx && make && make install\n 回到根目录\nWORKDIR /\n 创建程序用户\nRUN useradd nginx\n 优化命令环境\nRUN ln -s /usr/local/nginx/sbin/nginx /usr/sbin/nginx\n 监听端口80\nEXPOSE 80\n 后台启动nginx服务\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n使用Dockerfile构建镜像\n```java\n[root@localhost ~]# docker build -t chai/centos-nginx-start /root/\nSuccessfully built c7efa3d71211\nSuccessfully tagged chai/centos-nginx-start:latest\n```\n使用构建完成的镜像实例化一个容器，验证80端口是否启用\n\n因为我们最后使用CMD去启动nginx，所以docker run后直接加/bin/bash会替代nginx启动的执行。所以使用以下方法进入容器\n```java\n[root@localhost ~]# docker run -itd --name nginxtest chai/centos-nginx-start\nda7fe6d1541751dd86078848bf46c532cca9efb40832271bbf02c0eb7a25a1f8\n[root@localhost ~]# docker exec -it nginxtest /bin/bash\n[root@da7fe6d15417 /]# netstat -anpt | grep 80\ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1/nginx: master pro\n```\n查看ip并访问页面\n```java\n# ip为172.17.0.3\n[root@localhost ~]# curl -I 172.17.0.3\nHTTP/1.1 200 OK\nServer: nginx/1.11.1\nDate: Fri, 27 Mar 2020 07:08:49 GMT\nContent-Type: text/html\nContent-Length: 612\nLast-Modified: Fri, 27 Mar 2020 06:58:35 GMT\nConnection: keep-alive\nETag: \"5e7da41b-264\"\nAccept-Ranges: bytes\n```","source":"_posts/Dockerfile构建Ngxin镜像.md","raw":"title: Dockerfile构建Nginx镜像\nauthor: Semaik.\ntags:\n  - Docker\ncategories: []\ndate: 2020-09-27 14:31:00\n---\n##### Dockerfile构建nginx镜像\n>要求：dockerfile做nginx源码镜像。并且启动后容器后可以直接启动。\n\n首先拖入nginx的tar包到物理机路径，与Dockerfile文件放在同一目录\n\n编写Dockerfile\n```java\n[root@localhost ~]# vim Dockerfile \nFROM centos  # 调用docker中已下载的centos镜像\nMAINTAINER FeiYi  # 作者名为FeiYi\n 安装环境所需包\nRUN yum -y install net-tools iproute pcre-devel openssl-devel gcc gcc-c++ make zlib-devel elinks\nADD nginx-1.11.1.tar.gz /usr/src  # 解压本地host中的nginx包到容器中的/usr/src目录\nENV NGINX_DIR /usr/src/nginx-1.11.1 # 定义环境变量\nWORKDIR $NGINX_DIR  # 进入容器中的解压目录\n 编译安装\nRUN ./configure --prefix=/usr/local/nginx --user=nginx --group=nginx && make && make install\n 回到根目录\nWORKDIR /\n 创建程序用户\nRUN useradd nginx\n 优化命令环境\nRUN ln -s /usr/local/nginx/sbin/nginx /usr/sbin/nginx\n 监听端口80\nEXPOSE 80\n 后台启动nginx服务\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n使用Dockerfile构建镜像\n```java\n[root@localhost ~]# docker build -t chai/centos-nginx-start /root/\nSuccessfully built c7efa3d71211\nSuccessfully tagged chai/centos-nginx-start:latest\n```\n使用构建完成的镜像实例化一个容器，验证80端口是否启用\n\n因为我们最后使用CMD去启动nginx，所以docker run后直接加/bin/bash会替代nginx启动的执行。所以使用以下方法进入容器\n```java\n[root@localhost ~]# docker run -itd --name nginxtest chai/centos-nginx-start\nda7fe6d1541751dd86078848bf46c532cca9efb40832271bbf02c0eb7a25a1f8\n[root@localhost ~]# docker exec -it nginxtest /bin/bash\n[root@da7fe6d15417 /]# netstat -anpt | grep 80\ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1/nginx: master pro\n```\n查看ip并访问页面\n```java\n# ip为172.17.0.3\n[root@localhost ~]# curl -I 172.17.0.3\nHTTP/1.1 200 OK\nServer: nginx/1.11.1\nDate: Fri, 27 Mar 2020 07:08:49 GMT\nContent-Type: text/html\nContent-Length: 612\nLast-Modified: Fri, 27 Mar 2020 06:58:35 GMT\nConnection: keep-alive\nETag: \"5e7da41b-264\"\nAccept-Ranges: bytes\n```","slug":"Dockerfile构建Ngxin镜像","published":1,"updated":"2020-11-03T07:03:57.433Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r736y000em3pvbzpl0wov","content":"<h5 id=\"Dockerfile构建nginx镜像\"><a href=\"#Dockerfile构建nginx镜像\" class=\"headerlink\" title=\"Dockerfile构建nginx镜像\"></a>Dockerfile构建nginx镜像</h5><blockquote>\n<p>要求：dockerfile做nginx源码镜像。并且启动后容器后可以直接启动。</p>\n</blockquote>\n<p>首先拖入nginx的tar包到物理机路径，与Dockerfile文件放在同一目录</p>\n<p>编写Dockerfile</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# vim Dockerfile </span><br><span class=\"line\">FROM centos  # 调用docker中已下载的centos镜像</span><br><span class=\"line\">MAINTAINER FeiYi  # 作者名为FeiYi</span><br><span class=\"line\"> 安装环境所需包</span><br><span class=\"line\">RUN yum -y install net-tools iproute pcre-devel openssl-devel gcc gcc-c++ make zlib-devel elinks</span><br><span class=\"line\">ADD nginx-1.11.1.tar.gz /usr/src  # 解压本地host中的nginx包到容器中的/usr/src目录</span><br><span class=\"line\">ENV NGINX_DIR /usr/src/nginx-1.11.1 # 定义环境变量</span><br><span class=\"line\">WORKDIR $NGINX_DIR  # 进入容器中的解压目录</span><br><span class=\"line\"> 编译安装</span><br><span class=\"line\">RUN ./configure --prefix=/usr/local/nginx --user=nginx --group=nginx &amp;&amp; make &amp;&amp; make install</span><br><span class=\"line\"> 回到根目录</span><br><span class=\"line\">WORKDIR /</span><br><span class=\"line\"> 创建程序用户</span><br><span class=\"line\">RUN useradd nginx</span><br><span class=\"line\"> 优化命令环境</span><br><span class=\"line\">RUN ln -s /usr/local/nginx/sbin/nginx /usr/sbin/nginx</span><br><span class=\"line\"> 监听端口<span class=\"number\">80</span></span><br><span class=\"line\">EXPOSE <span class=\"number\">80</span></span><br><span class=\"line\"> 后台启动nginx服务</span><br><span class=\"line\">CMD [<span class=\"string\">&quot;nginx&quot;</span>, <span class=\"string\">&quot;-g&quot;</span>, <span class=\"string\">&quot;daemon off;&quot;</span>]</span><br></pre></td></tr></table></figure>\n<p>使用Dockerfile构建镜像</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker build -t chai/centos-nginx-start /root/</span><br><span class=\"line\">Successfully built c7efa3d71211</span><br><span class=\"line\">Successfully tagged chai/centos-nginx-start:latest</span><br></pre></td></tr></table></figure>\n<p>使用构建完成的镜像实例化一个容器，验证80端口是否启用</p>\n<p>因为我们最后使用CMD去启动nginx，所以docker run后直接加/bin/bash会替代nginx启动的执行。所以使用以下方法进入容器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -itd --name nginxtest chai/centos-nginx-start</span><br><span class=\"line\">da7fe6d1541751dd86078848bf46c532cca9efb40832271bbf02c0eb7a25a1f8</span><br><span class=\"line\">[root@localhost ~]# docker exec -it nginxtest /bin/bash</span><br><span class=\"line\">[root@da7fe6d15417 /]# netstat -anpt | grep 80</span><br><span class=\"line\">tcp        <span class=\"number\">0</span>      <span class=\"number\">0</span> <span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">80</span>              <span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:*               LISTEN      <span class=\"number\">1</span>/nginx: master pro</span><br></pre></td></tr></table></figure>\n<p>查看ip并访问页面</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># ip为172.17.0.3</span><br><span class=\"line\">[root@localhost ~]# curl -I 172.17.0.3</span><br><span class=\"line\">HTTP/<span class=\"number\">1.1</span> <span class=\"number\">200</span> OK</span><br><span class=\"line\">Server: nginx/<span class=\"number\">1.11</span>.<span class=\"number\">1</span></span><br><span class=\"line\">Date: Fri, <span class=\"number\">27</span> Mar <span class=\"number\">2020</span> <span class=\"number\">07</span>:<span class=\"number\">08</span>:<span class=\"number\">49</span> GMT</span><br><span class=\"line\">Content-Type: text/html</span><br><span class=\"line\">Content-Length: <span class=\"number\">612</span></span><br><span class=\"line\">Last-Modified: Fri, <span class=\"number\">27</span> Mar <span class=\"number\">2020</span> <span class=\"number\">06</span>:<span class=\"number\">58</span>:<span class=\"number\">35</span> GMT</span><br><span class=\"line\">Connection: keep-alive</span><br><span class=\"line\">ETag: <span class=\"string\">&quot;5e7da41b-264&quot;</span></span><br><span class=\"line\">Accept-Ranges: bytes</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h5 id=\"Dockerfile构建nginx镜像\"><a href=\"#Dockerfile构建nginx镜像\" class=\"headerlink\" title=\"Dockerfile构建nginx镜像\"></a>Dockerfile构建nginx镜像</h5><blockquote>\n<p>要求：dockerfile做nginx源码镜像。并且启动后容器后可以直接启动。</p>\n</blockquote>\n<p>首先拖入nginx的tar包到物理机路径，与Dockerfile文件放在同一目录</p>\n<p>编写Dockerfile</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# vim Dockerfile </span><br><span class=\"line\">FROM centos  # 调用docker中已下载的centos镜像</span><br><span class=\"line\">MAINTAINER FeiYi  # 作者名为FeiYi</span><br><span class=\"line\"> 安装环境所需包</span><br><span class=\"line\">RUN yum -y install net-tools iproute pcre-devel openssl-devel gcc gcc-c++ make zlib-devel elinks</span><br><span class=\"line\">ADD nginx-1.11.1.tar.gz /usr/src  # 解压本地host中的nginx包到容器中的/usr/src目录</span><br><span class=\"line\">ENV NGINX_DIR /usr/src/nginx-1.11.1 # 定义环境变量</span><br><span class=\"line\">WORKDIR $NGINX_DIR  # 进入容器中的解压目录</span><br><span class=\"line\"> 编译安装</span><br><span class=\"line\">RUN ./configure --prefix=/usr/local/nginx --user=nginx --group=nginx &amp;&amp; make &amp;&amp; make install</span><br><span class=\"line\"> 回到根目录</span><br><span class=\"line\">WORKDIR /</span><br><span class=\"line\"> 创建程序用户</span><br><span class=\"line\">RUN useradd nginx</span><br><span class=\"line\"> 优化命令环境</span><br><span class=\"line\">RUN ln -s /usr/local/nginx/sbin/nginx /usr/sbin/nginx</span><br><span class=\"line\"> 监听端口<span class=\"number\">80</span></span><br><span class=\"line\">EXPOSE <span class=\"number\">80</span></span><br><span class=\"line\"> 后台启动nginx服务</span><br><span class=\"line\">CMD [<span class=\"string\">&quot;nginx&quot;</span>, <span class=\"string\">&quot;-g&quot;</span>, <span class=\"string\">&quot;daemon off;&quot;</span>]</span><br></pre></td></tr></table></figure>\n<p>使用Dockerfile构建镜像</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker build -t chai/centos-nginx-start /root/</span><br><span class=\"line\">Successfully built c7efa3d71211</span><br><span class=\"line\">Successfully tagged chai/centos-nginx-start:latest</span><br></pre></td></tr></table></figure>\n<p>使用构建完成的镜像实例化一个容器，验证80端口是否启用</p>\n<p>因为我们最后使用CMD去启动nginx，所以docker run后直接加/bin/bash会替代nginx启动的执行。所以使用以下方法进入容器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -itd --name nginxtest chai/centos-nginx-start</span><br><span class=\"line\">da7fe6d1541751dd86078848bf46c532cca9efb40832271bbf02c0eb7a25a1f8</span><br><span class=\"line\">[root@localhost ~]# docker exec -it nginxtest /bin/bash</span><br><span class=\"line\">[root@da7fe6d15417 /]# netstat -anpt | grep 80</span><br><span class=\"line\">tcp        <span class=\"number\">0</span>      <span class=\"number\">0</span> <span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">80</span>              <span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:*               LISTEN      <span class=\"number\">1</span>/nginx: master pro</span><br></pre></td></tr></table></figure>\n<p>查看ip并访问页面</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># ip为172.17.0.3</span><br><span class=\"line\">[root@localhost ~]# curl -I 172.17.0.3</span><br><span class=\"line\">HTTP/<span class=\"number\">1.1</span> <span class=\"number\">200</span> OK</span><br><span class=\"line\">Server: nginx/<span class=\"number\">1.11</span>.<span class=\"number\">1</span></span><br><span class=\"line\">Date: Fri, <span class=\"number\">27</span> Mar <span class=\"number\">2020</span> <span class=\"number\">07</span>:<span class=\"number\">08</span>:<span class=\"number\">49</span> GMT</span><br><span class=\"line\">Content-Type: text/html</span><br><span class=\"line\">Content-Length: <span class=\"number\">612</span></span><br><span class=\"line\">Last-Modified: Fri, <span class=\"number\">27</span> Mar <span class=\"number\">2020</span> <span class=\"number\">06</span>:<span class=\"number\">58</span>:<span class=\"number\">35</span> GMT</span><br><span class=\"line\">Connection: keep-alive</span><br><span class=\"line\">ETag: <span class=\"string\">&quot;5e7da41b-264&quot;</span></span><br><span class=\"line\">Accept-Ranges: bytes</span><br></pre></td></tr></table></figure>"},{"title":"Docker基础操作逻辑命令","author":"Semaik.","date":"2020-09-10T09:08:00.000Z","_content":"![upload successful](/images/pasted-15.png)\n\n镜像小的原因：\nLinux操作系统两个部分构成内核空间（kernel）、用户空间（rootfs）\n\n查看docker的基础信息\n\n`docker info`\n\n\n查看docker中已经存在的镜像\n```\ndocker images\n参数：\n\t-a：列出本地所有的镜像（含中间映像层）\n\t-q：只显示镜像id\n\t--digests：显示镜像的摘要信息\n\t--no-trunc：显示完整的镜像信息\n    ```\n\n\n\n在docker hub中查看关于该镜像的所有镜像\n\n```\ndocker search\n例：\ndocker search ubuntu # 全网搜索ubuntu镜像\n```\n\n下载镜像\n```\ndocker pull 镜像名   //默认下载tomcat:latest，意思是最新版，或者tomcat:3.2  下载3.2版本\n```\n\n删除镜像\n```\ndocker rmi 镜像名： 删除镜像，默认删除 镜像名:latest，这个镜像不能在运行中\ndocker rmi -f 镜像名：强制删除\ndocker rmi -f $（docker images -qa）：删除全部镜像\n```\n导出镜像\n```\ndocker save -o 压缩包名称 镜像名称\n例：将镜像导出当前目录下\ndocker save -o centos.tar centos:latest\n将镜像centos:latest另存到虚拟机当前目录下，命名为centos.tar\n```\n \n导入镜像\n```\ndocker load < centos.tar\n```\n重命名镜像名称\n```\ndocker tag 旧镜像名称 新镜像名称\n例：\ndocker tag 500b941e6f79 tomcat7:jre7\n```\n创建不运行容器\n```\ndocker create --name web httpd\n```\n创建并运行容器\n```\ndocker run -itd -p 88:80--name test --restart always centos:7 /bin/bash\n可用docker ps -a，查看容器运行状态\n参数：\n    -i  以交互方式登录\n    -t  允许以交互方式打开终端\n    -d  在后台运行\n    -p  映射端口，将容器中的80端口映射成物理机中的88端口\n    --name  添加容器名\n    --restart always  跟随docker启动而启动，就是当服务重启时、启动时，该容器也会运行\n    --rm  容器一旦停止就会被自动删除，不添加的话容器会永久保存在计算机中\n    --privileged  添加特权，不添加此参数 运行一些系统命令时错\n```\n查看所有容器\n```\ndocker ps -a\n```\n立马强制性退出容器\n```\ndocker kill 容器id\n```\n停止容器\n```\ndocker stop 容器id\n```\n启动容器\n```\ndocker start 容器id\n```\n进入容器\n```\ndocker exec -it 容器id /bin/bash\n```\n挂起容器\n```\ndocker pause 容器id\n```\n取消挂起正常运行容器\n```\ndocker unpause 容器id\n```\n删除容器：（删除容器前需要停止容器）\n```\ndocker rm 容器id\n如：容器正在运行中需要删除容器，就需要添加参数-f\ndocker rm -f 容器id\n```\n查看容器信息\n```\ndocker inspect 容器id\n```\n编写进入容器脚本\n```\nvim /usr/bin/docker-enter\n!/bin/sh\nif [ -e $(dirname \"$0\")/nsenter ]; then\n with boot2docker, nsenter is not in the PATH but it is in the same folder\n  NSENTER=$(dirname \"$0\")/nsenter\nelse\n  NSENTER=nsenter\nfi\nif [ -z \"$1\" ]; then\n  echo \"Usage: `basename \"$0\"` CONTAINER [COMMAND [ARG]...]\"\n  echo \"\"\n  echo \"Enters the Docker CONTAINER and executes the specified COMMAND.\"\n  echo \"If COMMAND is not specified, runs an interactive shell in CONTAINER.\"\nelse\n  PID=$(docker inspect --format \"{{.State.Pid}}\" \"$1\")\n  if [ -z \"$PID\" ]; then\n    exit 1\n  fi\n  shift\n  OPTS=\"--target $PID --mount --uts --ipc --net --pid --\"\n  if [ -z \"$1\" ]; then\n    # No command given.\n    # Use su to clear all host environment variables except for TERM,\n    # initialize the environment variables HOME, SHELL, USER, LOGNAME, PATH,\n    # and start a login shell.\n    \"$NSENTER\" $OPTS su - root\n else\n    # Use env to clear all host environment variables.\n    \"$NSENTER\" $OPTS env --ignore-environment -- \"$@\"\n  fi\nfi\n```\n给予权限\n```\nchmod +x /usr/bin/docker-enter\n```\n可以使用该脚本，加容器name或者容器id来启动容器\n```\ndocker-enter 容器id\n```\n\n\n\n\n\n\n\n\n##### 补充：\n虚拟机版本低于7.7，进如容器后无法使用网络，因为默认是关闭路由转发的，需要手动开启。\n退出容器在宿主机执行以下操作：\necho \"net.ipv4.ip_forward=1\" >> /etc/sysctl.conf\nsysctl -p\n\n##### 提示：\n进入任何一个容器中，所有命令不可以使用，环境比脸都干净，需要自己手动安装命令。\n如果想使用某一条命令就执行 yum provides 命令  该命令搜查出命令对应的安装包，安装成功后命令即可使用。\n\n如：\n我想使用ifcofnig这条命令查看IP地址\n安装前执行命令（报错：没有该命令）\n\n![upload successful](/images/pasted-16.png)\n\n搜查命令对应的软件包\n\n![upload successful](/images/pasted-17.png)\n安装软件包\n\n![upload successful](/images/pasted-18.png)\n测试\n\n\n![upload successful](/images/pasted-19.png)","source":"_posts/Docker基础操作逻辑命令.md","raw":"title: Docker基础操作逻辑命令\nauthor: Semaik.\ntags:\n  - Docker\ncategories:\n  - Docker\ndate: 2020-09-10 17:08:00\n---\n![upload successful](/images/pasted-15.png)\n\n镜像小的原因：\nLinux操作系统两个部分构成内核空间（kernel）、用户空间（rootfs）\n\n查看docker的基础信息\n\n`docker info`\n\n\n查看docker中已经存在的镜像\n```\ndocker images\n参数：\n\t-a：列出本地所有的镜像（含中间映像层）\n\t-q：只显示镜像id\n\t--digests：显示镜像的摘要信息\n\t--no-trunc：显示完整的镜像信息\n    ```\n\n\n\n在docker hub中查看关于该镜像的所有镜像\n\n```\ndocker search\n例：\ndocker search ubuntu # 全网搜索ubuntu镜像\n```\n\n下载镜像\n```\ndocker pull 镜像名   //默认下载tomcat:latest，意思是最新版，或者tomcat:3.2  下载3.2版本\n```\n\n删除镜像\n```\ndocker rmi 镜像名： 删除镜像，默认删除 镜像名:latest，这个镜像不能在运行中\ndocker rmi -f 镜像名：强制删除\ndocker rmi -f $（docker images -qa）：删除全部镜像\n```\n导出镜像\n```\ndocker save -o 压缩包名称 镜像名称\n例：将镜像导出当前目录下\ndocker save -o centos.tar centos:latest\n将镜像centos:latest另存到虚拟机当前目录下，命名为centos.tar\n```\n \n导入镜像\n```\ndocker load < centos.tar\n```\n重命名镜像名称\n```\ndocker tag 旧镜像名称 新镜像名称\n例：\ndocker tag 500b941e6f79 tomcat7:jre7\n```\n创建不运行容器\n```\ndocker create --name web httpd\n```\n创建并运行容器\n```\ndocker run -itd -p 88:80--name test --restart always centos:7 /bin/bash\n可用docker ps -a，查看容器运行状态\n参数：\n    -i  以交互方式登录\n    -t  允许以交互方式打开终端\n    -d  在后台运行\n    -p  映射端口，将容器中的80端口映射成物理机中的88端口\n    --name  添加容器名\n    --restart always  跟随docker启动而启动，就是当服务重启时、启动时，该容器也会运行\n    --rm  容器一旦停止就会被自动删除，不添加的话容器会永久保存在计算机中\n    --privileged  添加特权，不添加此参数 运行一些系统命令时错\n```\n查看所有容器\n```\ndocker ps -a\n```\n立马强制性退出容器\n```\ndocker kill 容器id\n```\n停止容器\n```\ndocker stop 容器id\n```\n启动容器\n```\ndocker start 容器id\n```\n进入容器\n```\ndocker exec -it 容器id /bin/bash\n```\n挂起容器\n```\ndocker pause 容器id\n```\n取消挂起正常运行容器\n```\ndocker unpause 容器id\n```\n删除容器：（删除容器前需要停止容器）\n```\ndocker rm 容器id\n如：容器正在运行中需要删除容器，就需要添加参数-f\ndocker rm -f 容器id\n```\n查看容器信息\n```\ndocker inspect 容器id\n```\n编写进入容器脚本\n```\nvim /usr/bin/docker-enter\n!/bin/sh\nif [ -e $(dirname \"$0\")/nsenter ]; then\n with boot2docker, nsenter is not in the PATH but it is in the same folder\n  NSENTER=$(dirname \"$0\")/nsenter\nelse\n  NSENTER=nsenter\nfi\nif [ -z \"$1\" ]; then\n  echo \"Usage: `basename \"$0\"` CONTAINER [COMMAND [ARG]...]\"\n  echo \"\"\n  echo \"Enters the Docker CONTAINER and executes the specified COMMAND.\"\n  echo \"If COMMAND is not specified, runs an interactive shell in CONTAINER.\"\nelse\n  PID=$(docker inspect --format \"{{.State.Pid}}\" \"$1\")\n  if [ -z \"$PID\" ]; then\n    exit 1\n  fi\n  shift\n  OPTS=\"--target $PID --mount --uts --ipc --net --pid --\"\n  if [ -z \"$1\" ]; then\n    # No command given.\n    # Use su to clear all host environment variables except for TERM,\n    # initialize the environment variables HOME, SHELL, USER, LOGNAME, PATH,\n    # and start a login shell.\n    \"$NSENTER\" $OPTS su - root\n else\n    # Use env to clear all host environment variables.\n    \"$NSENTER\" $OPTS env --ignore-environment -- \"$@\"\n  fi\nfi\n```\n给予权限\n```\nchmod +x /usr/bin/docker-enter\n```\n可以使用该脚本，加容器name或者容器id来启动容器\n```\ndocker-enter 容器id\n```\n\n\n\n\n\n\n\n\n##### 补充：\n虚拟机版本低于7.7，进如容器后无法使用网络，因为默认是关闭路由转发的，需要手动开启。\n退出容器在宿主机执行以下操作：\necho \"net.ipv4.ip_forward=1\" >> /etc/sysctl.conf\nsysctl -p\n\n##### 提示：\n进入任何一个容器中，所有命令不可以使用，环境比脸都干净，需要自己手动安装命令。\n如果想使用某一条命令就执行 yum provides 命令  该命令搜查出命令对应的安装包，安装成功后命令即可使用。\n\n如：\n我想使用ifcofnig这条命令查看IP地址\n安装前执行命令（报错：没有该命令）\n\n![upload successful](/images/pasted-16.png)\n\n搜查命令对应的软件包\n\n![upload successful](/images/pasted-17.png)\n安装软件包\n\n![upload successful](/images/pasted-18.png)\n测试\n\n\n![upload successful](/images/pasted-19.png)","slug":"Docker基础操作逻辑命令","published":1,"updated":"2020-09-10T09:28:29.395Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r7371000im3pv6mwlhc5b","content":"<p><img src=\"/images/pasted-15.png\" alt=\"upload successful\"></p>\n<p>镜像小的原因：<br>Linux操作系统两个部分构成内核空间（kernel）、用户空间（rootfs）</p>\n<p>查看docker的基础信息</p>\n<p><code>docker info</code></p>\n<p>查看docker中已经存在的镜像</p>\n<figure class=\"highlight haml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker images</span><br><span class=\"line\">参数：</span><br><span class=\"line\">\t-<span class=\"ruby\">a：列出本地所有的镜像（含中间映像层）</span></span><br><span class=\"line\"><span class=\"ruby\">\t-q：只显示镜像id</span></span><br><span class=\"line\"><span class=\"ruby\">\t--digests：显示镜像的摘要信息</span></span><br><span class=\"line\"><span class=\"ruby\">\t--no-trunc：显示完整的镜像信息</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>在docker hub中查看关于该镜像的所有镜像</p>\n<figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">search</span></span><br><span class=\"line\">例：</span><br><span class=\"line\">docker <span class=\"built_in\">search</span> ubuntu # 全网搜索ubuntu镜像</span><br></pre></td></tr></table></figure>\n\n<p>下载镜像</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">docker</span> pull 镜像名   //默认下载tomcat:latest，意思是最新版，或者tomcat:<span class=\"number\">3</span>.<span class=\"number\">2</span>  下载<span class=\"number\">3</span>.<span class=\"number\">2</span>版本</span><br></pre></td></tr></table></figure>\n\n<p>删除镜像</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rmi 镜像名： 删除镜像，默认删除 镜像名:latest，这个镜像不能在运行中</span><br><span class=\"line\">docker rmi <span class=\"operator\">-f</span> 镜像名：强制删除</span><br><span class=\"line\">docker rmi <span class=\"operator\">-f</span> <span class=\"variable\">$</span>（docker images <span class=\"literal\">-qa</span>）：删除全部镜像</span><br></pre></td></tr></table></figure>\n<p>导出镜像</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">save</span> <span class=\"selector-tag\">-o</span> 压缩包名称 镜像名称</span><br><span class=\"line\">例：将镜像导出当前目录下</span><br><span class=\"line\"><span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">save</span> <span class=\"selector-tag\">-o</span> <span class=\"selector-tag\">centos</span><span class=\"selector-class\">.tar</span> <span class=\"selector-tag\">centos</span><span class=\"selector-pseudo\">:latest</span></span><br><span class=\"line\">将镜像<span class=\"selector-tag\">centos</span><span class=\"selector-pseudo\">:latest</span>另存到虚拟机当前目录下，命名为<span class=\"selector-tag\">centos</span><span class=\"selector-class\">.tar</span></span><br></pre></td></tr></table></figure>\n\n<p>导入镜像</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">load</span> &lt; <span class=\"selector-tag\">centos</span><span class=\"selector-class\">.tar</span></span><br></pre></td></tr></table></figure>\n<p>重命名镜像名称</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"keyword\">tag</span> <span class=\"title\">旧镜像名称 新镜像名称</span></span><br><span class=\"line\"><span class=\"title\">例：</span></span><br><span class=\"line\"><span class=\"title\">docker</span> <span class=\"keyword\">tag</span> <span class=\"title\">500b941e6f79</span> tomcat7:jre7</span><br></pre></td></tr></table></figure>\n<p>创建不运行容器</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">create</span> <span class=\"comment\">--name web httpd</span></span><br></pre></td></tr></table></figure>\n<p>创建并运行容器</p>\n<figure class=\"highlight haml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -itd -p 88:80--name test --restart always centos:7 /bin/bash</span><br><span class=\"line\">可用docker ps -a，查看容器运行状态</span><br><span class=\"line\">参数：</span><br><span class=\"line\">    -<span class=\"ruby\">i  以交互方式登录</span></span><br><span class=\"line\"><span class=\"ruby\">    -t  允许以交互方式打开终端</span></span><br><span class=\"line\"><span class=\"ruby\">    -d  在后台运行</span></span><br><span class=\"line\"><span class=\"ruby\">    -p  映射端口，将容器中的<span class=\"number\">80</span>端口映射成物理机中的<span class=\"number\">88</span>端口</span></span><br><span class=\"line\"><span class=\"ruby\">    --name  添加容器名</span></span><br><span class=\"line\"><span class=\"ruby\">    --restart always  跟随docker启动而启动，就是当服务重启时、启动时，该容器也会运行</span></span><br><span class=\"line\"><span class=\"ruby\">    --rm  容器一旦停止就会被自动删除，不添加的话容器会永久保存在计算机中</span></span><br><span class=\"line\"><span class=\"ruby\">    --privileged  添加特权，不添加此参数 运行一些系统命令时错</span></span><br></pre></td></tr></table></figure>\n<p>查看所有容器</p>\n<figure class=\"highlight ebnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">docker ps -a</span></span><br></pre></td></tr></table></figure>\n<p>立马强制性退出容器</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"keyword\">kill</span> 容器<span class=\"keyword\">id</span></span><br></pre></td></tr></table></figure>\n<p>停止容器</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"keyword\">stop</span> 容器<span class=\"keyword\">id</span></span><br></pre></td></tr></table></figure>\n<p>启动容器</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"keyword\">start</span> 容器<span class=\"keyword\">id</span></span><br></pre></td></tr></table></figure>\n<p>进入容器</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -<span class=\"keyword\">it</span> 容器<span class=\"built_in\">id</span> /bin/bash</span><br></pre></td></tr></table></figure>\n<p>挂起容器</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pause 容器<span class=\"built_in\">id</span></span><br></pre></td></tr></table></figure>\n<p>取消挂起正常运行容器</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker unpause 容器<span class=\"built_in\">id</span></span><br></pre></td></tr></table></figure>\n<p>删除容器：（删除容器前需要停止容器）</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">rm</span> 容器id</span><br><span class=\"line\">如：容器正在运行中需要删除容器，就需要添加参数<span class=\"operator\">-f</span></span><br><span class=\"line\">docker <span class=\"built_in\">rm</span> <span class=\"operator\">-f</span> 容器id</span><br></pre></td></tr></table></figure>\n<p>查看容器信息</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker inspect 容器<span class=\"built_in\">id</span></span><br></pre></td></tr></table></figure>\n<p>编写进入容器脚本</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /usr/bin/docker-enter</span><br><span class=\"line\">!/bin/sh</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -e $(dirname <span class=\"string\">&quot;<span class=\"variable\">$0</span>&quot;</span>)/nsenter ]; <span class=\"keyword\">then</span></span><br><span class=\"line\"> with boot2docker, nsenter is not <span class=\"keyword\">in</span> the PATH but it is <span class=\"keyword\">in</span> the same folder</span><br><span class=\"line\">  NSENTER=$(dirname <span class=\"string\">&quot;<span class=\"variable\">$0</span>&quot;</span>)/nsenter</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  NSENTER=nsenter</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Usage: `basename &quot;</span><span class=\"variable\">$0</span><span class=\"string\">&quot;` CONTAINER [COMMAND [ARG]...]&quot;</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Enters the Docker CONTAINER and executes the specified COMMAND.&quot;</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&quot;If COMMAND is not specified, runs an interactive shell in CONTAINER.&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  PID=$(docker inspect --format <span class=\"string\">&quot;&#123;&#123;.State.Pid&#125;&#125;&quot;</span> <span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$PID</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"built_in\">shift</span></span><br><span class=\"line\">  OPTS=<span class=\"string\">&quot;--target <span class=\"variable\">$PID</span> --mount --uts --ipc --net --pid --&quot;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\"># No command given.</span></span><br><span class=\"line\">    <span class=\"comment\"># Use su to clear all host environment variables except for TERM,</span></span><br><span class=\"line\">    <span class=\"comment\"># initialize the environment variables HOME, SHELL, USER, LOGNAME, PATH,</span></span><br><span class=\"line\">    <span class=\"comment\"># and start a login shell.</span></span><br><span class=\"line\">    <span class=\"string\">&quot;<span class=\"variable\">$NSENTER</span>&quot;</span> <span class=\"variable\">$OPTS</span> su - root</span><br><span class=\"line\"> <span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"comment\"># Use env to clear all host environment variables.</span></span><br><span class=\"line\">    <span class=\"string\">&quot;<span class=\"variable\">$NSENTER</span>&quot;</span> <span class=\"variable\">$OPTS</span> env --ignore-environment -- <span class=\"string\">&quot;<span class=\"variable\">$@</span>&quot;</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n<p>给予权限</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x <span class=\"regexp\">/usr/</span>bin/docker-enter</span><br></pre></td></tr></table></figure>\n<p>可以使用该脚本，加容器name或者容器id来启动容器</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-enter 容器<span class=\"built_in\">id</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n<h5 id=\"补充：\"><a href=\"#补充：\" class=\"headerlink\" title=\"补充：\"></a>补充：</h5><p>虚拟机版本低于7.7，进如容器后无法使用网络，因为默认是关闭路由转发的，需要手动开启。<br>退出容器在宿主机执行以下操作：<br>echo “net.ipv4.ip_forward=1” &gt;&gt; /etc/sysctl.conf<br>sysctl -p</p>\n<h5 id=\"提示：\"><a href=\"#提示：\" class=\"headerlink\" title=\"提示：\"></a>提示：</h5><p>进入任何一个容器中，所有命令不可以使用，环境比脸都干净，需要自己手动安装命令。<br>如果想使用某一条命令就执行 yum provides 命令  该命令搜查出命令对应的安装包，安装成功后命令即可使用。</p>\n<p>如：<br>我想使用ifcofnig这条命令查看IP地址<br>安装前执行命令（报错：没有该命令）</p>\n<p><img src=\"/images/pasted-16.png\" alt=\"upload successful\"></p>\n<p>搜查命令对应的软件包</p>\n<p><img src=\"/images/pasted-17.png\" alt=\"upload successful\"><br>安装软件包</p>\n<p><img src=\"/images/pasted-18.png\" alt=\"upload successful\"><br>测试</p>\n<p><img src=\"/images/pasted-19.png\" alt=\"upload successful\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/images/pasted-15.png\" alt=\"upload successful\"></p>\n<p>镜像小的原因：<br>Linux操作系统两个部分构成内核空间（kernel）、用户空间（rootfs）</p>\n<p>查看docker的基础信息</p>\n<p><code>docker info</code></p>\n<p>查看docker中已经存在的镜像</p>\n<figure class=\"highlight haml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker images</span><br><span class=\"line\">参数：</span><br><span class=\"line\">\t-<span class=\"ruby\">a：列出本地所有的镜像（含中间映像层）</span></span><br><span class=\"line\"><span class=\"ruby\">\t-q：只显示镜像id</span></span><br><span class=\"line\"><span class=\"ruby\">\t--digests：显示镜像的摘要信息</span></span><br><span class=\"line\"><span class=\"ruby\">\t--no-trunc：显示完整的镜像信息</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>在docker hub中查看关于该镜像的所有镜像</p>\n<figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">search</span></span><br><span class=\"line\">例：</span><br><span class=\"line\">docker <span class=\"built_in\">search</span> ubuntu # 全网搜索ubuntu镜像</span><br></pre></td></tr></table></figure>\n\n<p>下载镜像</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">docker</span> pull 镜像名   //默认下载tomcat:latest，意思是最新版，或者tomcat:<span class=\"number\">3</span>.<span class=\"number\">2</span>  下载<span class=\"number\">3</span>.<span class=\"number\">2</span>版本</span><br></pre></td></tr></table></figure>\n\n<p>删除镜像</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rmi 镜像名： 删除镜像，默认删除 镜像名:latest，这个镜像不能在运行中</span><br><span class=\"line\">docker rmi <span class=\"operator\">-f</span> 镜像名：强制删除</span><br><span class=\"line\">docker rmi <span class=\"operator\">-f</span> <span class=\"variable\">$</span>（docker images <span class=\"literal\">-qa</span>）：删除全部镜像</span><br></pre></td></tr></table></figure>\n<p>导出镜像</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">save</span> <span class=\"selector-tag\">-o</span> 压缩包名称 镜像名称</span><br><span class=\"line\">例：将镜像导出当前目录下</span><br><span class=\"line\"><span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">save</span> <span class=\"selector-tag\">-o</span> <span class=\"selector-tag\">centos</span><span class=\"selector-class\">.tar</span> <span class=\"selector-tag\">centos</span><span class=\"selector-pseudo\">:latest</span></span><br><span class=\"line\">将镜像<span class=\"selector-tag\">centos</span><span class=\"selector-pseudo\">:latest</span>另存到虚拟机当前目录下，命名为<span class=\"selector-tag\">centos</span><span class=\"selector-class\">.tar</span></span><br></pre></td></tr></table></figure>\n\n<p>导入镜像</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">load</span> &lt; <span class=\"selector-tag\">centos</span><span class=\"selector-class\">.tar</span></span><br></pre></td></tr></table></figure>\n<p>重命名镜像名称</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"keyword\">tag</span> <span class=\"title\">旧镜像名称 新镜像名称</span></span><br><span class=\"line\"><span class=\"title\">例：</span></span><br><span class=\"line\"><span class=\"title\">docker</span> <span class=\"keyword\">tag</span> <span class=\"title\">500b941e6f79</span> tomcat7:jre7</span><br></pre></td></tr></table></figure>\n<p>创建不运行容器</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">create</span> <span class=\"comment\">--name web httpd</span></span><br></pre></td></tr></table></figure>\n<p>创建并运行容器</p>\n<figure class=\"highlight haml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -itd -p 88:80--name test --restart always centos:7 /bin/bash</span><br><span class=\"line\">可用docker ps -a，查看容器运行状态</span><br><span class=\"line\">参数：</span><br><span class=\"line\">    -<span class=\"ruby\">i  以交互方式登录</span></span><br><span class=\"line\"><span class=\"ruby\">    -t  允许以交互方式打开终端</span></span><br><span class=\"line\"><span class=\"ruby\">    -d  在后台运行</span></span><br><span class=\"line\"><span class=\"ruby\">    -p  映射端口，将容器中的<span class=\"number\">80</span>端口映射成物理机中的<span class=\"number\">88</span>端口</span></span><br><span class=\"line\"><span class=\"ruby\">    --name  添加容器名</span></span><br><span class=\"line\"><span class=\"ruby\">    --restart always  跟随docker启动而启动，就是当服务重启时、启动时，该容器也会运行</span></span><br><span class=\"line\"><span class=\"ruby\">    --rm  容器一旦停止就会被自动删除，不添加的话容器会永久保存在计算机中</span></span><br><span class=\"line\"><span class=\"ruby\">    --privileged  添加特权，不添加此参数 运行一些系统命令时错</span></span><br></pre></td></tr></table></figure>\n<p>查看所有容器</p>\n<figure class=\"highlight ebnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">docker ps -a</span></span><br></pre></td></tr></table></figure>\n<p>立马强制性退出容器</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"keyword\">kill</span> 容器<span class=\"keyword\">id</span></span><br></pre></td></tr></table></figure>\n<p>停止容器</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"keyword\">stop</span> 容器<span class=\"keyword\">id</span></span><br></pre></td></tr></table></figure>\n<p>启动容器</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"keyword\">start</span> 容器<span class=\"keyword\">id</span></span><br></pre></td></tr></table></figure>\n<p>进入容器</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -<span class=\"keyword\">it</span> 容器<span class=\"built_in\">id</span> /bin/bash</span><br></pre></td></tr></table></figure>\n<p>挂起容器</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pause 容器<span class=\"built_in\">id</span></span><br></pre></td></tr></table></figure>\n<p>取消挂起正常运行容器</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker unpause 容器<span class=\"built_in\">id</span></span><br></pre></td></tr></table></figure>\n<p>删除容器：（删除容器前需要停止容器）</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">rm</span> 容器id</span><br><span class=\"line\">如：容器正在运行中需要删除容器，就需要添加参数<span class=\"operator\">-f</span></span><br><span class=\"line\">docker <span class=\"built_in\">rm</span> <span class=\"operator\">-f</span> 容器id</span><br></pre></td></tr></table></figure>\n<p>查看容器信息</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker inspect 容器<span class=\"built_in\">id</span></span><br></pre></td></tr></table></figure>\n<p>编写进入容器脚本</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /usr/bin/docker-enter</span><br><span class=\"line\">!/bin/sh</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -e $(dirname <span class=\"string\">&quot;<span class=\"variable\">$0</span>&quot;</span>)/nsenter ]; <span class=\"keyword\">then</span></span><br><span class=\"line\"> with boot2docker, nsenter is not <span class=\"keyword\">in</span> the PATH but it is <span class=\"keyword\">in</span> the same folder</span><br><span class=\"line\">  NSENTER=$(dirname <span class=\"string\">&quot;<span class=\"variable\">$0</span>&quot;</span>)/nsenter</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  NSENTER=nsenter</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Usage: `basename &quot;</span><span class=\"variable\">$0</span><span class=\"string\">&quot;` CONTAINER [COMMAND [ARG]...]&quot;</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Enters the Docker CONTAINER and executes the specified COMMAND.&quot;</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&quot;If COMMAND is not specified, runs an interactive shell in CONTAINER.&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  PID=$(docker inspect --format <span class=\"string\">&quot;&#123;&#123;.State.Pid&#125;&#125;&quot;</span> <span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$PID</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"built_in\">shift</span></span><br><span class=\"line\">  OPTS=<span class=\"string\">&quot;--target <span class=\"variable\">$PID</span> --mount --uts --ipc --net --pid --&quot;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\"># No command given.</span></span><br><span class=\"line\">    <span class=\"comment\"># Use su to clear all host environment variables except for TERM,</span></span><br><span class=\"line\">    <span class=\"comment\"># initialize the environment variables HOME, SHELL, USER, LOGNAME, PATH,</span></span><br><span class=\"line\">    <span class=\"comment\"># and start a login shell.</span></span><br><span class=\"line\">    <span class=\"string\">&quot;<span class=\"variable\">$NSENTER</span>&quot;</span> <span class=\"variable\">$OPTS</span> su - root</span><br><span class=\"line\"> <span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"comment\"># Use env to clear all host environment variables.</span></span><br><span class=\"line\">    <span class=\"string\">&quot;<span class=\"variable\">$NSENTER</span>&quot;</span> <span class=\"variable\">$OPTS</span> env --ignore-environment -- <span class=\"string\">&quot;<span class=\"variable\">$@</span>&quot;</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n<p>给予权限</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x <span class=\"regexp\">/usr/</span>bin/docker-enter</span><br></pre></td></tr></table></figure>\n<p>可以使用该脚本，加容器name或者容器id来启动容器</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-enter 容器<span class=\"built_in\">id</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n<h5 id=\"补充：\"><a href=\"#补充：\" class=\"headerlink\" title=\"补充：\"></a>补充：</h5><p>虚拟机版本低于7.7，进如容器后无法使用网络，因为默认是关闭路由转发的，需要手动开启。<br>退出容器在宿主机执行以下操作：<br>echo “net.ipv4.ip_forward=1” &gt;&gt; /etc/sysctl.conf<br>sysctl -p</p>\n<h5 id=\"提示：\"><a href=\"#提示：\" class=\"headerlink\" title=\"提示：\"></a>提示：</h5><p>进入任何一个容器中，所有命令不可以使用，环境比脸都干净，需要自己手动安装命令。<br>如果想使用某一条命令就执行 yum provides 命令  该命令搜查出命令对应的安装包，安装成功后命令即可使用。</p>\n<p>如：<br>我想使用ifcofnig这条命令查看IP地址<br>安装前执行命令（报错：没有该命令）</p>\n<p><img src=\"/images/pasted-16.png\" alt=\"upload successful\"></p>\n<p>搜查命令对应的软件包</p>\n<p><img src=\"/images/pasted-17.png\" alt=\"upload successful\"><br>安装软件包</p>\n<p><img src=\"/images/pasted-18.png\" alt=\"upload successful\"><br>测试</p>\n<p><img src=\"/images/pasted-19.png\" alt=\"upload successful\"></p>\n"},{"title":"Docker的安装-镜像加速及理论","date":"2020-09-10T07:09:00.000Z","_content":"![upload successful](/images/pasted-1.png)\n![upload successful](/images/pasted-0.png)\n\n### Docker的安装\nDocker的[官网](https://www.docker.com/)\n\n必须是Centos7版本，最好是7.7的内核，docker目前不支持centos8\n\nDocker源路径的寻找\n\n点击`Get Docker`可以查看有关下载Docker的文档\n\n![upload successful](/images/pasted-2.png)\n\n在文档中找到对应的系统版本，就可以看到关于下载Docker的repo源\n\n![upload successful](/images/pasted-3.png)\n\n因为官网的Docker的repo源是通过走国外的网站来获取的，对于网络不是很好的，建议使用阿里的镜像站\n\n进入阿里的镜像站，找到`docker-ce`版本，在官网还有`docker-ee`版本，是企业版，会收费\n\n\n![upload successful](/images/pasted-4.png)\n\n这里好像阿里的网址改版了，进入后最下面的相关连接的下载地址才是我们想要的，也可以直接点击这里，根据系统版本选择对应的系统，这里以Linux为例\n\n\n![upload successful](/images/pasted-5.png)\n\n同样选择linux的系统版本，以centos为例\n\n\n![upload successful](/images/pasted-6.png)\n\n这里要求系统版本号为3.10，内核为7.5\n\n进入centos后，可以看到如图所示，其中gpg的路径用来校验安装docker的正确率，就是一个docker密钥，这个gpg的路径一会要用到，记下来`https://mirrors.aliyun.com/docker-ce/linux/centos/gpg`\n\n\n![upload successful](/images/pasted-8.png)\n\n根据上图再次选择centos的版本7，根据系统cpu选择`x86_64`\n\n\n![upload successful](/images/pasted-9.png)\n\n如上图所示stable代表稳定版本，稳定版本中的repodata，就是yum安装的源路径，Packages是安装是所用到的rpm包，所以正在编写yum源安装docker时，还需要记录稳定版本的路径`https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/`\n![upload successful](/images/pasted-7.png)\n\n#### 编写docker的yum源\n\n\n```java\nvim /etc/yum.repos.d/docker.repo   # 原来存在的repo文件不需要动\n 添加\n[docker]\nname=docker\n rpm源路径\nbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/\nenabled=1\ngpgcheck=1 # 启动密钥校验\ngpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg  # 密钥路径\n```\n#### 安装docker-ce\n```\nyum -y install docker-ce\ndocker -v # 查看docker版本\nsystemctl start docker  # 启动docker\ndocker version # 详细版本信息\n```\n##### 推荐下载以后学习中用到的镜像\n使用`docker pull`命令下载镜像\n```\ndocker pull centos  # 演示生产环境迁移或者安装软件时使用，默认下载完是8版本\ndocker pull busybox # 工具集，使用centos需要用到\ndocker pull httpd # apache\n```\n验证镜像是否下载完成\n```\ndocker images # 是否可以看到刚下载的三个镜像\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nubuntu              latest              4e5021d210f6        2 days ago          64.2MB\nhttpd               latest              c5a012f9cf45        3 weeks ago         165MB\ncentos              latest              470671670cac        2 months ago        237MB\n下载完成后centos的版本需要特别注意，因为docker目前仅支持Centos7版本，所以要进入容器去看一下centos的版本\n```\n\n运行centos容器\n```\ndocker run -it centos\n```\n查看容器版本，如果是8版本需要删除下载7版本\n```\n[root@d280c874ea80 /]# cat /etc/redhat-release \nCentOS Linux release 8.1.1911 (Core) \n[root@d280c874ea80 /]# exit\n可以这里的centos是8版本，所以要将这个镜像删除\n```\n\n由于刚才是先使用镜像运行了容器，i才看到的版本号，容器占用了镜像在运行，所以要先将运行的容器关闭或者删除\n\n删除需要知道刚才运行容器的容器ID\n```\ndocker ps -a  # 查看运行容器\nCONTAINER ID  IMAGE    COMMAND       CREATED          STATUS                     PORTS   NAMES\nfaf96581cf3f  centos    \"/bin/bash\"  10 seconds ago   Exited (0) 3 seconds ago           recursing_goldstine\ndocker rm faf96581cf3f   # 停止容器运行\n删除镜像\n```\n\n删除centos:latest的最新版本\n```\ndocker rmi centos:latest  # 删除最新版本\ndocker pull centos:7  # 下载centos7版本\n```\n更改标签\n```\ndocker tag centos:7 centos:latest\ndocker rmi centos:7\n```\n可以使用上面的方法去查看centos的版本，已经变为7.7，或者直接查看\n```\ndocker run centos cat /etc/redhat-release\n```\n##### Docker的镜像加速\n\n即使使用了阿里云的镜像站，但是拿取的镜像还是走国外的网站，通过命令docker info可以看到\n```\n[root@192 ~]# docker info\nClient:\n Debug Mode: false\n \nServer:\n Containers: 0\n  Running: 0\n  Paused: 0\n  Stopped: 0\n Images: 2\n Server Version: 19.03.8\n Storage Driver: overlay2\n  Backing Filesystem: <unknown>\n  Supports d_type: true\n  Native Overlay Diff: true\n Logging Driver: json-file\n Cgroup Driver: cgroupfs\n Plugins:\n  Volume: local\n  Network: bridge host ipvlan macvlan null overlay\n  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog\n Swarm: inactive\n Runtimes: runc\n Default Runtime: runc\n Init Binary: docker-init\n containerd version: 7ad184331fa3e55e52b890ea95e65ba581ae3429\n runc version: dc9208a3303feef5b3839f4323d9beb36df0a9dd\n init version: fec3683\n Security Options:\n  seccomp\n   Profile: default\n Kernel Version: 3.10.0-862.el7.x86_64\n Operating System: CentOS Linux 7 (Core)\n OSType: linux\n Architecture: x86_64\n CPUs: 1\n Total Memory: 974.6MiB\n Name: 192.168.1.6\n ID: JZ5Z:EWGC:XMEA:VEVX:MR7N:ACYZ:PPVD:GAWU:HURX:7PZ4:YLKE:O47S\n Docker Root Dir: /var/lib/docker\n Debug Mode: false  \n Registry: https://index.docker.io/v1/  # 这就是国内镜像站镜像所在的仓库地址，还是docker的网站\n Labels:\n Experimental: false\n Insecure Registries:\n  127.0.0.0/8\n Live Restore Enabled: false\n ```\n##### 国内镜像站\n我们可以将镜像站改到国内的镜像站，这里国内有两个非常好用的镜像加速服务\n\n[Daocloud](daocloud.io)\n\n市面上比较大的公司\n\n注册登录后，在用户页面点击加速器的标志\n\n![upload successful](/images/pasted-10.png)\n\n然后找到对应的系统，复制命令在系统中执行即可\n\n![upload successful](/images/pasted-11.png)\n```\ncurl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://f1361db2.m.daocloud.io\n```\n执行完毕后，需要重启docker服务，再次查看docker info，会发现在最下方的输出信息如下\n```\nRegistry Mirrors:\n http://f1361db2.m.daocloud.io/\n ```\n这个配置会在/etc/docker/daemon.json文件中\n\n##### aliyun\n还有一种就是使用阿里云的镜像加速\n\n首先登录阿里云账号，进入控制台\n\n![upload successful](/images/pasted-12.png)\n\n第一次使用需要设置Registry登录密码\n\n图中部分就是我们要添加到docker配置文件中的内容，会自动生成，如果直接修改`daemon.json`配置文件，就复制加速器地址就可以，如果是还没有`daemon.json`，就复制以下配置加速器的命令即可完成阿里云镜像的加速\n\n\n![upload successful](/images/pasted-13.png)\n\n此时，在重启docker，去查看docker info会看到最后的输出信息变成了你复制的加速器地址\n```\nRegistry Mirrors:\n https://xxxxxx.mirror.aliyuncs.com/\n ```\n##### 镜像概念\n指计算机中默认的镜像，每个用户都可以进行修改，docker pull后的镜像没有在物理机，需要单独保存到物理机\n```\ndocker save -o 保存后的路径以及名字 要保存的镜像名:标签\n```\n如：\n```\ndocker save -o centos.tar centos:latest\n```\n##### Docker监听\n该已经发现了，启动docker后，使用netstat -anpt | grep docker并没有监听地址，但是查看启动进程ps -ef | grep docker是没有问题的\n\n现在希望docker变成一个有监听进程的服务\n```\nvim /usr/lib/systemd/system/docker.service \n 在service模块找到14行修改为以下添加了-H tcp://0.0.0.0\nExecStart=/usr/bin/dockerd -H fd:// -H tcp://0.0.0.0 --containerd=/run/containerd/containerd.sock\n```\n重新加载配置文件并重启服务\n```\nsystemctl daemon-reload\nsystemctl restart docker\n```\n再次查看端口\n```\nnetstat -anpt | grep docker\ntcp6       0      0 :::2375           :::*             LISTEN      60630/dockerd\n2375就是docker的端口\n```\n#### 所需要开启的功能\n```\n[root@localhost ~]# vi /etc/sysctl.conf\n添加：\nnet.bridge.bridge-nf-call-iptables = 1    //开启桥接流量转发\nnet.bridge.bridge-nf-call-ip6tables = 1   //开启ipv6的桥接流量转发\nnet.ipv4.ip_forward = 1  //路由表转发\n\n[root@localhost ~]# sysctl -p\n[root@localhost ~]# modprobe ip_vs_rr   //rr轮训转发\n[root@localhost ~]# modprobe br_netfilter //桥接卡的iptables的filter表\n```","source":"_posts/Docker的安装-镜像加速及理论.md","raw":"title: Docker的安装-镜像加速及理论\ncategories:\n  - Docker\ntags:\n  - Docker\ndate: 2020-09-10 15:09:00\n---\n![upload successful](/images/pasted-1.png)\n![upload successful](/images/pasted-0.png)\n\n### Docker的安装\nDocker的[官网](https://www.docker.com/)\n\n必须是Centos7版本，最好是7.7的内核，docker目前不支持centos8\n\nDocker源路径的寻找\n\n点击`Get Docker`可以查看有关下载Docker的文档\n\n![upload successful](/images/pasted-2.png)\n\n在文档中找到对应的系统版本，就可以看到关于下载Docker的repo源\n\n![upload successful](/images/pasted-3.png)\n\n因为官网的Docker的repo源是通过走国外的网站来获取的，对于网络不是很好的，建议使用阿里的镜像站\n\n进入阿里的镜像站，找到`docker-ce`版本，在官网还有`docker-ee`版本，是企业版，会收费\n\n\n![upload successful](/images/pasted-4.png)\n\n这里好像阿里的网址改版了，进入后最下面的相关连接的下载地址才是我们想要的，也可以直接点击这里，根据系统版本选择对应的系统，这里以Linux为例\n\n\n![upload successful](/images/pasted-5.png)\n\n同样选择linux的系统版本，以centos为例\n\n\n![upload successful](/images/pasted-6.png)\n\n这里要求系统版本号为3.10，内核为7.5\n\n进入centos后，可以看到如图所示，其中gpg的路径用来校验安装docker的正确率，就是一个docker密钥，这个gpg的路径一会要用到，记下来`https://mirrors.aliyun.com/docker-ce/linux/centos/gpg`\n\n\n![upload successful](/images/pasted-8.png)\n\n根据上图再次选择centos的版本7，根据系统cpu选择`x86_64`\n\n\n![upload successful](/images/pasted-9.png)\n\n如上图所示stable代表稳定版本，稳定版本中的repodata，就是yum安装的源路径，Packages是安装是所用到的rpm包，所以正在编写yum源安装docker时，还需要记录稳定版本的路径`https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/`\n![upload successful](/images/pasted-7.png)\n\n#### 编写docker的yum源\n\n\n```java\nvim /etc/yum.repos.d/docker.repo   # 原来存在的repo文件不需要动\n 添加\n[docker]\nname=docker\n rpm源路径\nbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/\nenabled=1\ngpgcheck=1 # 启动密钥校验\ngpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg  # 密钥路径\n```\n#### 安装docker-ce\n```\nyum -y install docker-ce\ndocker -v # 查看docker版本\nsystemctl start docker  # 启动docker\ndocker version # 详细版本信息\n```\n##### 推荐下载以后学习中用到的镜像\n使用`docker pull`命令下载镜像\n```\ndocker pull centos  # 演示生产环境迁移或者安装软件时使用，默认下载完是8版本\ndocker pull busybox # 工具集，使用centos需要用到\ndocker pull httpd # apache\n```\n验证镜像是否下载完成\n```\ndocker images # 是否可以看到刚下载的三个镜像\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nubuntu              latest              4e5021d210f6        2 days ago          64.2MB\nhttpd               latest              c5a012f9cf45        3 weeks ago         165MB\ncentos              latest              470671670cac        2 months ago        237MB\n下载完成后centos的版本需要特别注意，因为docker目前仅支持Centos7版本，所以要进入容器去看一下centos的版本\n```\n\n运行centos容器\n```\ndocker run -it centos\n```\n查看容器版本，如果是8版本需要删除下载7版本\n```\n[root@d280c874ea80 /]# cat /etc/redhat-release \nCentOS Linux release 8.1.1911 (Core) \n[root@d280c874ea80 /]# exit\n可以这里的centos是8版本，所以要将这个镜像删除\n```\n\n由于刚才是先使用镜像运行了容器，i才看到的版本号，容器占用了镜像在运行，所以要先将运行的容器关闭或者删除\n\n删除需要知道刚才运行容器的容器ID\n```\ndocker ps -a  # 查看运行容器\nCONTAINER ID  IMAGE    COMMAND       CREATED          STATUS                     PORTS   NAMES\nfaf96581cf3f  centos    \"/bin/bash\"  10 seconds ago   Exited (0) 3 seconds ago           recursing_goldstine\ndocker rm faf96581cf3f   # 停止容器运行\n删除镜像\n```\n\n删除centos:latest的最新版本\n```\ndocker rmi centos:latest  # 删除最新版本\ndocker pull centos:7  # 下载centos7版本\n```\n更改标签\n```\ndocker tag centos:7 centos:latest\ndocker rmi centos:7\n```\n可以使用上面的方法去查看centos的版本，已经变为7.7，或者直接查看\n```\ndocker run centos cat /etc/redhat-release\n```\n##### Docker的镜像加速\n\n即使使用了阿里云的镜像站，但是拿取的镜像还是走国外的网站，通过命令docker info可以看到\n```\n[root@192 ~]# docker info\nClient:\n Debug Mode: false\n \nServer:\n Containers: 0\n  Running: 0\n  Paused: 0\n  Stopped: 0\n Images: 2\n Server Version: 19.03.8\n Storage Driver: overlay2\n  Backing Filesystem: <unknown>\n  Supports d_type: true\n  Native Overlay Diff: true\n Logging Driver: json-file\n Cgroup Driver: cgroupfs\n Plugins:\n  Volume: local\n  Network: bridge host ipvlan macvlan null overlay\n  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog\n Swarm: inactive\n Runtimes: runc\n Default Runtime: runc\n Init Binary: docker-init\n containerd version: 7ad184331fa3e55e52b890ea95e65ba581ae3429\n runc version: dc9208a3303feef5b3839f4323d9beb36df0a9dd\n init version: fec3683\n Security Options:\n  seccomp\n   Profile: default\n Kernel Version: 3.10.0-862.el7.x86_64\n Operating System: CentOS Linux 7 (Core)\n OSType: linux\n Architecture: x86_64\n CPUs: 1\n Total Memory: 974.6MiB\n Name: 192.168.1.6\n ID: JZ5Z:EWGC:XMEA:VEVX:MR7N:ACYZ:PPVD:GAWU:HURX:7PZ4:YLKE:O47S\n Docker Root Dir: /var/lib/docker\n Debug Mode: false  \n Registry: https://index.docker.io/v1/  # 这就是国内镜像站镜像所在的仓库地址，还是docker的网站\n Labels:\n Experimental: false\n Insecure Registries:\n  127.0.0.0/8\n Live Restore Enabled: false\n ```\n##### 国内镜像站\n我们可以将镜像站改到国内的镜像站，这里国内有两个非常好用的镜像加速服务\n\n[Daocloud](daocloud.io)\n\n市面上比较大的公司\n\n注册登录后，在用户页面点击加速器的标志\n\n![upload successful](/images/pasted-10.png)\n\n然后找到对应的系统，复制命令在系统中执行即可\n\n![upload successful](/images/pasted-11.png)\n```\ncurl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://f1361db2.m.daocloud.io\n```\n执行完毕后，需要重启docker服务，再次查看docker info，会发现在最下方的输出信息如下\n```\nRegistry Mirrors:\n http://f1361db2.m.daocloud.io/\n ```\n这个配置会在/etc/docker/daemon.json文件中\n\n##### aliyun\n还有一种就是使用阿里云的镜像加速\n\n首先登录阿里云账号，进入控制台\n\n![upload successful](/images/pasted-12.png)\n\n第一次使用需要设置Registry登录密码\n\n图中部分就是我们要添加到docker配置文件中的内容，会自动生成，如果直接修改`daemon.json`配置文件，就复制加速器地址就可以，如果是还没有`daemon.json`，就复制以下配置加速器的命令即可完成阿里云镜像的加速\n\n\n![upload successful](/images/pasted-13.png)\n\n此时，在重启docker，去查看docker info会看到最后的输出信息变成了你复制的加速器地址\n```\nRegistry Mirrors:\n https://xxxxxx.mirror.aliyuncs.com/\n ```\n##### 镜像概念\n指计算机中默认的镜像，每个用户都可以进行修改，docker pull后的镜像没有在物理机，需要单独保存到物理机\n```\ndocker save -o 保存后的路径以及名字 要保存的镜像名:标签\n```\n如：\n```\ndocker save -o centos.tar centos:latest\n```\n##### Docker监听\n该已经发现了，启动docker后，使用netstat -anpt | grep docker并没有监听地址，但是查看启动进程ps -ef | grep docker是没有问题的\n\n现在希望docker变成一个有监听进程的服务\n```\nvim /usr/lib/systemd/system/docker.service \n 在service模块找到14行修改为以下添加了-H tcp://0.0.0.0\nExecStart=/usr/bin/dockerd -H fd:// -H tcp://0.0.0.0 --containerd=/run/containerd/containerd.sock\n```\n重新加载配置文件并重启服务\n```\nsystemctl daemon-reload\nsystemctl restart docker\n```\n再次查看端口\n```\nnetstat -anpt | grep docker\ntcp6       0      0 :::2375           :::*             LISTEN      60630/dockerd\n2375就是docker的端口\n```\n#### 所需要开启的功能\n```\n[root@localhost ~]# vi /etc/sysctl.conf\n添加：\nnet.bridge.bridge-nf-call-iptables = 1    //开启桥接流量转发\nnet.bridge.bridge-nf-call-ip6tables = 1   //开启ipv6的桥接流量转发\nnet.ipv4.ip_forward = 1  //路由表转发\n\n[root@localhost ~]# sysctl -p\n[root@localhost ~]# modprobe ip_vs_rr   //rr轮训转发\n[root@localhost ~]# modprobe br_netfilter //桥接卡的iptables的filter表\n```","slug":"Docker的安装-镜像加速及理论","published":1,"updated":"2020-09-10T09:07:01.969Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r7372000km3pvcq014byo","content":"<p><img src=\"/images/pasted-1.png\" alt=\"upload successful\"><br><img src=\"/images/pasted-0.png\" alt=\"upload successful\"></p>\n<h3 id=\"Docker的安装\"><a href=\"#Docker的安装\" class=\"headerlink\" title=\"Docker的安装\"></a>Docker的安装</h3><p>Docker的<a href=\"https://www.docker.com/\">官网</a></p>\n<p>必须是Centos7版本，最好是7.7的内核，docker目前不支持centos8</p>\n<p>Docker源路径的寻找</p>\n<p>点击<code>Get Docker</code>可以查看有关下载Docker的文档</p>\n<p><img src=\"/images/pasted-2.png\" alt=\"upload successful\"></p>\n<p>在文档中找到对应的系统版本，就可以看到关于下载Docker的repo源</p>\n<p><img src=\"/images/pasted-3.png\" alt=\"upload successful\"></p>\n<p>因为官网的Docker的repo源是通过走国外的网站来获取的，对于网络不是很好的，建议使用阿里的镜像站</p>\n<p>进入阿里的镜像站，找到<code>docker-ce</code>版本，在官网还有<code>docker-ee</code>版本，是企业版，会收费</p>\n<p><img src=\"/images/pasted-4.png\" alt=\"upload successful\"></p>\n<p>这里好像阿里的网址改版了，进入后最下面的相关连接的下载地址才是我们想要的，也可以直接点击这里，根据系统版本选择对应的系统，这里以Linux为例</p>\n<p><img src=\"/images/pasted-5.png\" alt=\"upload successful\"></p>\n<p>同样选择linux的系统版本，以centos为例</p>\n<p><img src=\"/images/pasted-6.png\" alt=\"upload successful\"></p>\n<p>这里要求系统版本号为3.10，内核为7.5</p>\n<p>进入centos后，可以看到如图所示，其中gpg的路径用来校验安装docker的正确率，就是一个docker密钥，这个gpg的路径一会要用到，记下来<code>https://mirrors.aliyun.com/docker-ce/linux/centos/gpg</code></p>\n<p><img src=\"/images/pasted-8.png\" alt=\"upload successful\"></p>\n<p>根据上图再次选择centos的版本7，根据系统cpu选择<code>x86_64</code></p>\n<p><img src=\"/images/pasted-9.png\" alt=\"upload successful\"></p>\n<p>如上图所示stable代表稳定版本，稳定版本中的repodata，就是yum安装的源路径，Packages是安装是所用到的rpm包，所以正在编写yum源安装docker时，还需要记录稳定版本的路径<code>https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/</code><br><img src=\"/images/pasted-7.png\" alt=\"upload successful\"></p>\n<h4 id=\"编写docker的yum源\"><a href=\"#编写docker的yum源\" class=\"headerlink\" title=\"编写docker的yum源\"></a>编写docker的yum源</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/yum.repos.d/docker.repo   # 原来存在的repo文件不需要动</span><br><span class=\"line\"> 添加</span><br><span class=\"line\">[docker]</span><br><span class=\"line\">name=docker</span><br><span class=\"line\"> rpm源路径</span><br><span class=\"line\">baseurl=https:<span class=\"comment\">//mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/</span></span><br><span class=\"line\">enabled=<span class=\"number\">1</span></span><br><span class=\"line\">gpgcheck=1 # 启动密钥校验</span><br><span class=\"line\">gpgkey=https:<span class=\"comment\">//mirrors.aliyun.com/docker-ce/linux/centos/gpg  # 密钥路径</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"安装docker-ce\"><a href=\"#安装docker-ce\" class=\"headerlink\" title=\"安装docker-ce\"></a>安装docker-ce</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y <span class=\"keyword\">install</span> docker-ce</span><br><span class=\"line\">docker -v <span class=\"comment\"># 查看docker版本</span></span><br><span class=\"line\">systemctl <span class=\"keyword\">start</span> docker  <span class=\"comment\"># 启动docker</span></span><br><span class=\"line\">docker <span class=\"keyword\">version</span> <span class=\"comment\"># 详细版本信息</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"推荐下载以后学习中用到的镜像\"><a href=\"#推荐下载以后学习中用到的镜像\" class=\"headerlink\" title=\"推荐下载以后学习中用到的镜像\"></a>推荐下载以后学习中用到的镜像</h5><p>使用<code>docker pull</code>命令下载镜像</p>\n<figure class=\"highlight mipsasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull centos  <span class=\"comment\"># 演示生产环境迁移或者安装软件时使用，默认下载完是8版本</span></span><br><span class=\"line\">docker pull <span class=\"keyword\">busybox </span><span class=\"comment\"># 工具集，使用centos需要用到</span></span><br><span class=\"line\">docker pull httpd <span class=\"comment\"># apache</span></span><br></pre></td></tr></table></figure>\n<p>验证镜像是否下载完成</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker images # 是否可以看到刚下载的三个镜像</span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">ubuntu              latest              <span class=\"number\">4e5021</span>d210f6        <span class=\"number\">2</span> days ago          <span class=\"number\">64.2</span>MB</span><br><span class=\"line\">httpd               latest              c5a012f9cf45        <span class=\"number\">3</span> weeks ago         <span class=\"number\">165</span>MB</span><br><span class=\"line\">centos              latest              <span class=\"number\">470671670</span>cac        <span class=\"number\">2</span> months ago        <span class=\"number\">237</span>MB</span><br><span class=\"line\">下载完成后centos的版本需要特别注意，因为docker目前仅支持Centos7版本，所以要进入容器去看一下centos的版本</span><br></pre></td></tr></table></figure>\n\n<p>运行centos容器</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">run</span> -<span class=\"keyword\">it</span> centos</span><br></pre></td></tr></table></figure>\n<p>查看容器版本，如果是8版本需要删除下载7版本</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>d280c874ea80 /]# cat /etc/redhat-release </span><br><span class=\"line\">CentOS Linux release <span class=\"number\">8.1</span><span class=\"number\">.1911</span> (Core) </span><br><span class=\"line\">[<span class=\"symbol\">root@</span>d280c874ea80 /]# exit</span><br><span class=\"line\">可以这里的centos是<span class=\"number\">8</span>版本，所以要将这个镜像删除</span><br></pre></td></tr></table></figure>\n\n<p>由于刚才是先使用镜像运行了容器，i才看到的版本号，容器占用了镜像在运行，所以要先将运行的容器关闭或者删除</p>\n<p>删除需要知道刚才运行容器的容器ID</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker ps -<span class=\"keyword\">a</span>  <span class=\"comment\"># 查看运行容器</span></span><br><span class=\"line\">CONTAINER ID  IMAGE    COMMAND       CREATED          STATUS                     PORTS   NAMES</span><br><span class=\"line\">faf96581cf3f  centos    <span class=\"string\">&quot;/bin/bash&quot;</span>  <span class=\"number\">10</span> <span class=\"built_in\">seconds</span> ago   Exited (<span class=\"number\">0</span>) <span class=\"number\">3</span> <span class=\"built_in\">seconds</span> ago           recursing_goldstine</span><br><span class=\"line\">docker rm faf96581cf3f   <span class=\"comment\"># 停止容器运行</span></span><br><span class=\"line\">删除镜像</span><br></pre></td></tr></table></figure>\n\n<p>删除centos:latest的最新版本</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">docker</span> rmi centos:latest  <span class=\"comment\"># 删除最新版本</span></span><br><span class=\"line\">docker pull centos:<span class=\"number\">7</span>  <span class=\"comment\"># 下载centos7版本</span></span><br></pre></td></tr></table></figure>\n<p>更改标签</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"keyword\">tag</span> cento<span class=\"variable\">s:7</span> cento<span class=\"variable\">s:latest</span></span><br><span class=\"line\">docker rmi cento<span class=\"variable\">s:7</span></span><br></pre></td></tr></table></figure>\n<p>可以使用上面的方法去查看centos的版本，已经变为7.7，或者直接查看</p>\n<figure class=\"highlight arduino\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">run</span> centos cat /etc/redhat-<span class=\"built_in\">release</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"Docker的镜像加速\"><a href=\"#Docker的镜像加速\" class=\"headerlink\" title=\"Docker的镜像加速\"></a>Docker的镜像加速</h5><p>即使使用了阿里云的镜像站，但是拿取的镜像还是走国外的网站，通过命令docker info可以看到</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">root@192</span> <span class=\"string\">~</span>]<span class=\"comment\"># docker info</span></span><br><span class=\"line\"><span class=\"attr\">Client:</span></span><br><span class=\"line\"> <span class=\"attr\">Debug Mode:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"attr\">Server:</span></span><br><span class=\"line\"> <span class=\"attr\">Containers:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">Running:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">Paused:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">Stopped:</span> <span class=\"number\">0</span></span><br><span class=\"line\"> <span class=\"attr\">Images:</span> <span class=\"number\">2</span></span><br><span class=\"line\"> <span class=\"attr\">Server Version:</span> <span class=\"number\">19.03</span><span class=\"number\">.8</span></span><br><span class=\"line\"> <span class=\"attr\">Storage Driver:</span> <span class=\"string\">overlay2</span></span><br><span class=\"line\">  <span class=\"attr\">Backing Filesystem:</span> <span class=\"string\">&lt;unknown&gt;</span></span><br><span class=\"line\">  <span class=\"attr\">Supports d_type:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">Native Overlay Diff:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"> <span class=\"attr\">Logging Driver:</span> <span class=\"string\">json-file</span></span><br><span class=\"line\"> <span class=\"attr\">Cgroup Driver:</span> <span class=\"string\">cgroupfs</span></span><br><span class=\"line\"> <span class=\"attr\">Plugins:</span></span><br><span class=\"line\">  <span class=\"attr\">Volume:</span> <span class=\"string\">local</span></span><br><span class=\"line\">  <span class=\"attr\">Network:</span> <span class=\"string\">bridge</span> <span class=\"string\">host</span> <span class=\"string\">ipvlan</span> <span class=\"string\">macvlan</span> <span class=\"literal\">null</span> <span class=\"string\">overlay</span></span><br><span class=\"line\">  <span class=\"attr\">Log:</span> <span class=\"string\">awslogs</span> <span class=\"string\">fluentd</span> <span class=\"string\">gcplogs</span> <span class=\"string\">gelf</span> <span class=\"string\">journald</span> <span class=\"string\">json-file</span> <span class=\"string\">local</span> <span class=\"string\">logentries</span> <span class=\"string\">splunk</span> <span class=\"string\">syslog</span></span><br><span class=\"line\"> <span class=\"attr\">Swarm:</span> <span class=\"string\">inactive</span></span><br><span class=\"line\"> <span class=\"attr\">Runtimes:</span> <span class=\"string\">runc</span></span><br><span class=\"line\"> <span class=\"attr\">Default Runtime:</span> <span class=\"string\">runc</span></span><br><span class=\"line\"> <span class=\"attr\">Init Binary:</span> <span class=\"string\">docker-init</span></span><br><span class=\"line\"> <span class=\"attr\">containerd version:</span> <span class=\"string\">7ad184331fa3e55e52b890ea95e65ba581ae3429</span></span><br><span class=\"line\"> <span class=\"attr\">runc version:</span> <span class=\"string\">dc9208a3303feef5b3839f4323d9beb36df0a9dd</span></span><br><span class=\"line\"> <span class=\"attr\">init version:</span> <span class=\"string\">fec3683</span></span><br><span class=\"line\"> <span class=\"attr\">Security Options:</span></span><br><span class=\"line\">  <span class=\"string\">seccomp</span></span><br><span class=\"line\">   <span class=\"attr\">Profile:</span> <span class=\"string\">default</span></span><br><span class=\"line\"> <span class=\"attr\">Kernel Version:</span> <span class=\"number\">3.10</span><span class=\"number\">.0</span><span class=\"number\">-862.</span><span class=\"string\">el7.x86_64</span></span><br><span class=\"line\"> <span class=\"attr\">Operating System:</span> <span class=\"string\">CentOS</span> <span class=\"string\">Linux</span> <span class=\"number\">7</span> <span class=\"string\">(Core)</span></span><br><span class=\"line\"> <span class=\"attr\">OSType:</span> <span class=\"string\">linux</span></span><br><span class=\"line\"> <span class=\"attr\">Architecture:</span> <span class=\"string\">x86_64</span></span><br><span class=\"line\"> <span class=\"attr\">CPUs:</span> <span class=\"number\">1</span></span><br><span class=\"line\"> <span class=\"attr\">Total Memory:</span> <span class=\"number\">974.</span><span class=\"string\">6MiB</span></span><br><span class=\"line\"> <span class=\"attr\">Name:</span> <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.6</span></span><br><span class=\"line\"> <span class=\"attr\">ID:</span> <span class=\"string\">JZ5Z:EWGC:XMEA:VEVX:MR7N:ACYZ:PPVD:GAWU:HURX:7PZ4:YLKE:O47S</span></span><br><span class=\"line\"> <span class=\"attr\">Docker Root Dir:</span> <span class=\"string\">/var/lib/docker</span></span><br><span class=\"line\"> <span class=\"attr\">Debug Mode:</span> <span class=\"literal\">false</span>  </span><br><span class=\"line\"> <span class=\"attr\">Registry:</span> <span class=\"string\">https://index.docker.io/v1/</span>  <span class=\"comment\"># 这就是国内镜像站镜像所在的仓库地址，还是docker的网站</span></span><br><span class=\"line\"> <span class=\"attr\">Labels:</span></span><br><span class=\"line\"> <span class=\"attr\">Experimental:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"> <span class=\"attr\">Insecure Registries:</span></span><br><span class=\"line\">  <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"string\">/8</span></span><br><span class=\"line\"> <span class=\"attr\">Live Restore Enabled:</span> <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"国内镜像站\"><a href=\"#国内镜像站\" class=\"headerlink\" title=\"国内镜像站\"></a>国内镜像站</h5><p>我们可以将镜像站改到国内的镜像站，这里国内有两个非常好用的镜像加速服务</p>\n<p><a href=\"daocloud.io\">Daocloud</a></p>\n<p>市面上比较大的公司</p>\n<p>注册登录后，在用户页面点击加速器的标志</p>\n<p><img src=\"/images/pasted-10.png\" alt=\"upload successful\"></p>\n<p>然后找到对应的系统，复制命令在系统中执行即可</p>\n<p><img src=\"/images/pasted-11.png\" alt=\"upload successful\"></p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -sSL https:<span class=\"regexp\">//g</span>et.daocloud.io<span class=\"regexp\">/daotools/</span>set_mirror.sh | sh -s http:<span class=\"regexp\">//</span>f1361db2.m.daocloud.io</span><br></pre></td></tr></table></figure>\n<p>执行完毕后，需要重启docker服务，再次查看docker info，会发现在最下方的输出信息如下</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">Registry</span> Mirrors:</span><br><span class=\"line\"> <span class=\"attribute\">http</span>://f<span class=\"number\">1361</span>db<span class=\"number\">2</span>.m.daocloud.io/</span><br></pre></td></tr></table></figure>\n<p>这个配置会在/etc/docker/daemon.json文件中</p>\n<h5 id=\"aliyun\"><a href=\"#aliyun\" class=\"headerlink\" title=\"aliyun\"></a>aliyun</h5><p>还有一种就是使用阿里云的镜像加速</p>\n<p>首先登录阿里云账号，进入控制台</p>\n<p><img src=\"/images/pasted-12.png\" alt=\"upload successful\"></p>\n<p>第一次使用需要设置Registry登录密码</p>\n<p>图中部分就是我们要添加到docker配置文件中的内容，会自动生成，如果直接修改<code>daemon.json</code>配置文件，就复制加速器地址就可以，如果是还没有<code>daemon.json</code>，就复制以下配置加速器的命令即可完成阿里云镜像的加速</p>\n<p><img src=\"/images/pasted-13.png\" alt=\"upload successful\"></p>\n<p>此时，在重启docker，去查看docker info会看到最后的输出信息变成了你复制的加速器地址</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Registry Mirror<span class=\"variable\">s:</span></span><br><span class=\"line\"> http<span class=\"variable\">s:</span>//xxxxxx.mirror.aliyuncs.<span class=\"keyword\">com</span>/</span><br></pre></td></tr></table></figure>\n<h5 id=\"镜像概念\"><a href=\"#镜像概念\" class=\"headerlink\" title=\"镜像概念\"></a>镜像概念</h5><p>指计算机中默认的镜像，每个用户都可以进行修改，docker pull后的镜像没有在物理机，需要单独保存到物理机</p>\n<figure class=\"highlight fortran\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"keyword\">save</span> -o 保存后的路径以及名字 要保存的镜像名:标签</span><br></pre></td></tr></table></figure>\n<p>如：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">save</span> <span class=\"selector-tag\">-o</span> <span class=\"selector-tag\">centos</span><span class=\"selector-class\">.tar</span> <span class=\"selector-tag\">centos</span><span class=\"selector-pseudo\">:latest</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"Docker监听\"><a href=\"#Docker监听\" class=\"headerlink\" title=\"Docker监听\"></a>Docker监听</h5><p>该已经发现了，启动docker后，使用netstat -anpt | grep docker并没有监听地址，但是查看启动进程ps -ef | grep docker是没有问题的</p>\n<p>现在希望docker变成一个有监听进程的服务</p>\n<figure class=\"highlight crystal\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /usr/<span class=\"class\"><span class=\"keyword\">lib</span>/<span class=\"title\">systemd</span>/<span class=\"title\">system</span>/<span class=\"title\">docker</span>.<span class=\"title\">service</span> </span></span><br><span class=\"line\"> 在service模块找到<span class=\"number\">14</span>行修改为以下添加了-H <span class=\"symbol\">tcp:</span>/<span class=\"regexp\">/0.0.0.0</span></span><br><span class=\"line\"><span class=\"regexp\">ExecStart=/usr</span><span class=\"regexp\">/bin/dockerd</span> -H <span class=\"symbol\">fd:</span>/<span class=\"regexp\">/ -H tcp:/</span><span class=\"regexp\">/0.0.0.0 --containerd=/run</span><span class=\"regexp\">/containerd/containerd</span>.sock</span><br></pre></td></tr></table></figure>\n<p>重新加载配置文件并重启服务</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">systemctl</span> <span class=\"string\">daemon-reload</span></span><br><span class=\"line\"><span class=\"attr\">systemctl</span> <span class=\"string\">restart docker</span></span><br></pre></td></tr></table></figure>\n<p>再次查看端口</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">netstat -anpt | grep docker</span><br><span class=\"line\">tcp6       <span class=\"number\">0</span>      <span class=\"number\">0</span> :::<span class=\"number\">2375</span>           :::*             LISTEN      <span class=\"number\">60630</span>/dockerd</span><br><span class=\"line\"><span class=\"number\">2375</span>就是docker的端口</span><br></pre></td></tr></table></figure>\n<h4 id=\"所需要开启的功能\"><a href=\"#所需要开启的功能\" class=\"headerlink\" title=\"所需要开启的功能\"></a>所需要开启的功能</h4><figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# vi /etc/sysctl.conf</span><br><span class=\"line\">添加：</span><br><span class=\"line\">net.bridge.bridge-nf-call-iptables = <span class=\"number\">1</span>    <span class=\"comment\">//开启桥接流量转发</span></span><br><span class=\"line\">net.bridge.bridge-nf-call-ip6tables = <span class=\"number\">1</span>   <span class=\"comment\">//开启ipv6的桥接流量转发</span></span><br><span class=\"line\">net.ipv4.ip_forward = <span class=\"number\">1</span>  <span class=\"comment\">//路由表转发</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# sysctl -p</span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# modprobe ip_vs_rr   <span class=\"comment\">//rr轮训转发</span></span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# modprobe br_netfilter <span class=\"comment\">//桥接卡的iptables的filter表</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/images/pasted-1.png\" alt=\"upload successful\"><br><img src=\"/images/pasted-0.png\" alt=\"upload successful\"></p>\n<h3 id=\"Docker的安装\"><a href=\"#Docker的安装\" class=\"headerlink\" title=\"Docker的安装\"></a>Docker的安装</h3><p>Docker的<a href=\"https://www.docker.com/\">官网</a></p>\n<p>必须是Centos7版本，最好是7.7的内核，docker目前不支持centos8</p>\n<p>Docker源路径的寻找</p>\n<p>点击<code>Get Docker</code>可以查看有关下载Docker的文档</p>\n<p><img src=\"/images/pasted-2.png\" alt=\"upload successful\"></p>\n<p>在文档中找到对应的系统版本，就可以看到关于下载Docker的repo源</p>\n<p><img src=\"/images/pasted-3.png\" alt=\"upload successful\"></p>\n<p>因为官网的Docker的repo源是通过走国外的网站来获取的，对于网络不是很好的，建议使用阿里的镜像站</p>\n<p>进入阿里的镜像站，找到<code>docker-ce</code>版本，在官网还有<code>docker-ee</code>版本，是企业版，会收费</p>\n<p><img src=\"/images/pasted-4.png\" alt=\"upload successful\"></p>\n<p>这里好像阿里的网址改版了，进入后最下面的相关连接的下载地址才是我们想要的，也可以直接点击这里，根据系统版本选择对应的系统，这里以Linux为例</p>\n<p><img src=\"/images/pasted-5.png\" alt=\"upload successful\"></p>\n<p>同样选择linux的系统版本，以centos为例</p>\n<p><img src=\"/images/pasted-6.png\" alt=\"upload successful\"></p>\n<p>这里要求系统版本号为3.10，内核为7.5</p>\n<p>进入centos后，可以看到如图所示，其中gpg的路径用来校验安装docker的正确率，就是一个docker密钥，这个gpg的路径一会要用到，记下来<code>https://mirrors.aliyun.com/docker-ce/linux/centos/gpg</code></p>\n<p><img src=\"/images/pasted-8.png\" alt=\"upload successful\"></p>\n<p>根据上图再次选择centos的版本7，根据系统cpu选择<code>x86_64</code></p>\n<p><img src=\"/images/pasted-9.png\" alt=\"upload successful\"></p>\n<p>如上图所示stable代表稳定版本，稳定版本中的repodata，就是yum安装的源路径，Packages是安装是所用到的rpm包，所以正在编写yum源安装docker时，还需要记录稳定版本的路径<code>https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/</code><br><img src=\"/images/pasted-7.png\" alt=\"upload successful\"></p>\n<h4 id=\"编写docker的yum源\"><a href=\"#编写docker的yum源\" class=\"headerlink\" title=\"编写docker的yum源\"></a>编写docker的yum源</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/yum.repos.d/docker.repo   # 原来存在的repo文件不需要动</span><br><span class=\"line\"> 添加</span><br><span class=\"line\">[docker]</span><br><span class=\"line\">name=docker</span><br><span class=\"line\"> rpm源路径</span><br><span class=\"line\">baseurl=https:<span class=\"comment\">//mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/</span></span><br><span class=\"line\">enabled=<span class=\"number\">1</span></span><br><span class=\"line\">gpgcheck=1 # 启动密钥校验</span><br><span class=\"line\">gpgkey=https:<span class=\"comment\">//mirrors.aliyun.com/docker-ce/linux/centos/gpg  # 密钥路径</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"安装docker-ce\"><a href=\"#安装docker-ce\" class=\"headerlink\" title=\"安装docker-ce\"></a>安装docker-ce</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y <span class=\"keyword\">install</span> docker-ce</span><br><span class=\"line\">docker -v <span class=\"comment\"># 查看docker版本</span></span><br><span class=\"line\">systemctl <span class=\"keyword\">start</span> docker  <span class=\"comment\"># 启动docker</span></span><br><span class=\"line\">docker <span class=\"keyword\">version</span> <span class=\"comment\"># 详细版本信息</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"推荐下载以后学习中用到的镜像\"><a href=\"#推荐下载以后学习中用到的镜像\" class=\"headerlink\" title=\"推荐下载以后学习中用到的镜像\"></a>推荐下载以后学习中用到的镜像</h5><p>使用<code>docker pull</code>命令下载镜像</p>\n<figure class=\"highlight mipsasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull centos  <span class=\"comment\"># 演示生产环境迁移或者安装软件时使用，默认下载完是8版本</span></span><br><span class=\"line\">docker pull <span class=\"keyword\">busybox </span><span class=\"comment\"># 工具集，使用centos需要用到</span></span><br><span class=\"line\">docker pull httpd <span class=\"comment\"># apache</span></span><br></pre></td></tr></table></figure>\n<p>验证镜像是否下载完成</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker images # 是否可以看到刚下载的三个镜像</span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">ubuntu              latest              <span class=\"number\">4e5021</span>d210f6        <span class=\"number\">2</span> days ago          <span class=\"number\">64.2</span>MB</span><br><span class=\"line\">httpd               latest              c5a012f9cf45        <span class=\"number\">3</span> weeks ago         <span class=\"number\">165</span>MB</span><br><span class=\"line\">centos              latest              <span class=\"number\">470671670</span>cac        <span class=\"number\">2</span> months ago        <span class=\"number\">237</span>MB</span><br><span class=\"line\">下载完成后centos的版本需要特别注意，因为docker目前仅支持Centos7版本，所以要进入容器去看一下centos的版本</span><br></pre></td></tr></table></figure>\n\n<p>运行centos容器</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">run</span> -<span class=\"keyword\">it</span> centos</span><br></pre></td></tr></table></figure>\n<p>查看容器版本，如果是8版本需要删除下载7版本</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>d280c874ea80 /]# cat /etc/redhat-release </span><br><span class=\"line\">CentOS Linux release <span class=\"number\">8.1</span><span class=\"number\">.1911</span> (Core) </span><br><span class=\"line\">[<span class=\"symbol\">root@</span>d280c874ea80 /]# exit</span><br><span class=\"line\">可以这里的centos是<span class=\"number\">8</span>版本，所以要将这个镜像删除</span><br></pre></td></tr></table></figure>\n\n<p>由于刚才是先使用镜像运行了容器，i才看到的版本号，容器占用了镜像在运行，所以要先将运行的容器关闭或者删除</p>\n<p>删除需要知道刚才运行容器的容器ID</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker ps -<span class=\"keyword\">a</span>  <span class=\"comment\"># 查看运行容器</span></span><br><span class=\"line\">CONTAINER ID  IMAGE    COMMAND       CREATED          STATUS                     PORTS   NAMES</span><br><span class=\"line\">faf96581cf3f  centos    <span class=\"string\">&quot;/bin/bash&quot;</span>  <span class=\"number\">10</span> <span class=\"built_in\">seconds</span> ago   Exited (<span class=\"number\">0</span>) <span class=\"number\">3</span> <span class=\"built_in\">seconds</span> ago           recursing_goldstine</span><br><span class=\"line\">docker rm faf96581cf3f   <span class=\"comment\"># 停止容器运行</span></span><br><span class=\"line\">删除镜像</span><br></pre></td></tr></table></figure>\n\n<p>删除centos:latest的最新版本</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">docker</span> rmi centos:latest  <span class=\"comment\"># 删除最新版本</span></span><br><span class=\"line\">docker pull centos:<span class=\"number\">7</span>  <span class=\"comment\"># 下载centos7版本</span></span><br></pre></td></tr></table></figure>\n<p>更改标签</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"keyword\">tag</span> cento<span class=\"variable\">s:7</span> cento<span class=\"variable\">s:latest</span></span><br><span class=\"line\">docker rmi cento<span class=\"variable\">s:7</span></span><br></pre></td></tr></table></figure>\n<p>可以使用上面的方法去查看centos的版本，已经变为7.7，或者直接查看</p>\n<figure class=\"highlight arduino\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">run</span> centos cat /etc/redhat-<span class=\"built_in\">release</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"Docker的镜像加速\"><a href=\"#Docker的镜像加速\" class=\"headerlink\" title=\"Docker的镜像加速\"></a>Docker的镜像加速</h5><p>即使使用了阿里云的镜像站，但是拿取的镜像还是走国外的网站，通过命令docker info可以看到</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">root@192</span> <span class=\"string\">~</span>]<span class=\"comment\"># docker info</span></span><br><span class=\"line\"><span class=\"attr\">Client:</span></span><br><span class=\"line\"> <span class=\"attr\">Debug Mode:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"attr\">Server:</span></span><br><span class=\"line\"> <span class=\"attr\">Containers:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">Running:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">Paused:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">Stopped:</span> <span class=\"number\">0</span></span><br><span class=\"line\"> <span class=\"attr\">Images:</span> <span class=\"number\">2</span></span><br><span class=\"line\"> <span class=\"attr\">Server Version:</span> <span class=\"number\">19.03</span><span class=\"number\">.8</span></span><br><span class=\"line\"> <span class=\"attr\">Storage Driver:</span> <span class=\"string\">overlay2</span></span><br><span class=\"line\">  <span class=\"attr\">Backing Filesystem:</span> <span class=\"string\">&lt;unknown&gt;</span></span><br><span class=\"line\">  <span class=\"attr\">Supports d_type:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">Native Overlay Diff:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"> <span class=\"attr\">Logging Driver:</span> <span class=\"string\">json-file</span></span><br><span class=\"line\"> <span class=\"attr\">Cgroup Driver:</span> <span class=\"string\">cgroupfs</span></span><br><span class=\"line\"> <span class=\"attr\">Plugins:</span></span><br><span class=\"line\">  <span class=\"attr\">Volume:</span> <span class=\"string\">local</span></span><br><span class=\"line\">  <span class=\"attr\">Network:</span> <span class=\"string\">bridge</span> <span class=\"string\">host</span> <span class=\"string\">ipvlan</span> <span class=\"string\">macvlan</span> <span class=\"literal\">null</span> <span class=\"string\">overlay</span></span><br><span class=\"line\">  <span class=\"attr\">Log:</span> <span class=\"string\">awslogs</span> <span class=\"string\">fluentd</span> <span class=\"string\">gcplogs</span> <span class=\"string\">gelf</span> <span class=\"string\">journald</span> <span class=\"string\">json-file</span> <span class=\"string\">local</span> <span class=\"string\">logentries</span> <span class=\"string\">splunk</span> <span class=\"string\">syslog</span></span><br><span class=\"line\"> <span class=\"attr\">Swarm:</span> <span class=\"string\">inactive</span></span><br><span class=\"line\"> <span class=\"attr\">Runtimes:</span> <span class=\"string\">runc</span></span><br><span class=\"line\"> <span class=\"attr\">Default Runtime:</span> <span class=\"string\">runc</span></span><br><span class=\"line\"> <span class=\"attr\">Init Binary:</span> <span class=\"string\">docker-init</span></span><br><span class=\"line\"> <span class=\"attr\">containerd version:</span> <span class=\"string\">7ad184331fa3e55e52b890ea95e65ba581ae3429</span></span><br><span class=\"line\"> <span class=\"attr\">runc version:</span> <span class=\"string\">dc9208a3303feef5b3839f4323d9beb36df0a9dd</span></span><br><span class=\"line\"> <span class=\"attr\">init version:</span> <span class=\"string\">fec3683</span></span><br><span class=\"line\"> <span class=\"attr\">Security Options:</span></span><br><span class=\"line\">  <span class=\"string\">seccomp</span></span><br><span class=\"line\">   <span class=\"attr\">Profile:</span> <span class=\"string\">default</span></span><br><span class=\"line\"> <span class=\"attr\">Kernel Version:</span> <span class=\"number\">3.10</span><span class=\"number\">.0</span><span class=\"number\">-862.</span><span class=\"string\">el7.x86_64</span></span><br><span class=\"line\"> <span class=\"attr\">Operating System:</span> <span class=\"string\">CentOS</span> <span class=\"string\">Linux</span> <span class=\"number\">7</span> <span class=\"string\">(Core)</span></span><br><span class=\"line\"> <span class=\"attr\">OSType:</span> <span class=\"string\">linux</span></span><br><span class=\"line\"> <span class=\"attr\">Architecture:</span> <span class=\"string\">x86_64</span></span><br><span class=\"line\"> <span class=\"attr\">CPUs:</span> <span class=\"number\">1</span></span><br><span class=\"line\"> <span class=\"attr\">Total Memory:</span> <span class=\"number\">974.</span><span class=\"string\">6MiB</span></span><br><span class=\"line\"> <span class=\"attr\">Name:</span> <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.6</span></span><br><span class=\"line\"> <span class=\"attr\">ID:</span> <span class=\"string\">JZ5Z:EWGC:XMEA:VEVX:MR7N:ACYZ:PPVD:GAWU:HURX:7PZ4:YLKE:O47S</span></span><br><span class=\"line\"> <span class=\"attr\">Docker Root Dir:</span> <span class=\"string\">/var/lib/docker</span></span><br><span class=\"line\"> <span class=\"attr\">Debug Mode:</span> <span class=\"literal\">false</span>  </span><br><span class=\"line\"> <span class=\"attr\">Registry:</span> <span class=\"string\">https://index.docker.io/v1/</span>  <span class=\"comment\"># 这就是国内镜像站镜像所在的仓库地址，还是docker的网站</span></span><br><span class=\"line\"> <span class=\"attr\">Labels:</span></span><br><span class=\"line\"> <span class=\"attr\">Experimental:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"> <span class=\"attr\">Insecure Registries:</span></span><br><span class=\"line\">  <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"string\">/8</span></span><br><span class=\"line\"> <span class=\"attr\">Live Restore Enabled:</span> <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"国内镜像站\"><a href=\"#国内镜像站\" class=\"headerlink\" title=\"国内镜像站\"></a>国内镜像站</h5><p>我们可以将镜像站改到国内的镜像站，这里国内有两个非常好用的镜像加速服务</p>\n<p><a href=\"daocloud.io\">Daocloud</a></p>\n<p>市面上比较大的公司</p>\n<p>注册登录后，在用户页面点击加速器的标志</p>\n<p><img src=\"/images/pasted-10.png\" alt=\"upload successful\"></p>\n<p>然后找到对应的系统，复制命令在系统中执行即可</p>\n<p><img src=\"/images/pasted-11.png\" alt=\"upload successful\"></p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -sSL https:<span class=\"regexp\">//g</span>et.daocloud.io<span class=\"regexp\">/daotools/</span>set_mirror.sh | sh -s http:<span class=\"regexp\">//</span>f1361db2.m.daocloud.io</span><br></pre></td></tr></table></figure>\n<p>执行完毕后，需要重启docker服务，再次查看docker info，会发现在最下方的输出信息如下</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">Registry</span> Mirrors:</span><br><span class=\"line\"> <span class=\"attribute\">http</span>://f<span class=\"number\">1361</span>db<span class=\"number\">2</span>.m.daocloud.io/</span><br></pre></td></tr></table></figure>\n<p>这个配置会在/etc/docker/daemon.json文件中</p>\n<h5 id=\"aliyun\"><a href=\"#aliyun\" class=\"headerlink\" title=\"aliyun\"></a>aliyun</h5><p>还有一种就是使用阿里云的镜像加速</p>\n<p>首先登录阿里云账号，进入控制台</p>\n<p><img src=\"/images/pasted-12.png\" alt=\"upload successful\"></p>\n<p>第一次使用需要设置Registry登录密码</p>\n<p>图中部分就是我们要添加到docker配置文件中的内容，会自动生成，如果直接修改<code>daemon.json</code>配置文件，就复制加速器地址就可以，如果是还没有<code>daemon.json</code>，就复制以下配置加速器的命令即可完成阿里云镜像的加速</p>\n<p><img src=\"/images/pasted-13.png\" alt=\"upload successful\"></p>\n<p>此时，在重启docker，去查看docker info会看到最后的输出信息变成了你复制的加速器地址</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Registry Mirror<span class=\"variable\">s:</span></span><br><span class=\"line\"> http<span class=\"variable\">s:</span>//xxxxxx.mirror.aliyuncs.<span class=\"keyword\">com</span>/</span><br></pre></td></tr></table></figure>\n<h5 id=\"镜像概念\"><a href=\"#镜像概念\" class=\"headerlink\" title=\"镜像概念\"></a>镜像概念</h5><p>指计算机中默认的镜像，每个用户都可以进行修改，docker pull后的镜像没有在物理机，需要单独保存到物理机</p>\n<figure class=\"highlight fortran\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"keyword\">save</span> -o 保存后的路径以及名字 要保存的镜像名:标签</span><br></pre></td></tr></table></figure>\n<p>如：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">save</span> <span class=\"selector-tag\">-o</span> <span class=\"selector-tag\">centos</span><span class=\"selector-class\">.tar</span> <span class=\"selector-tag\">centos</span><span class=\"selector-pseudo\">:latest</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"Docker监听\"><a href=\"#Docker监听\" class=\"headerlink\" title=\"Docker监听\"></a>Docker监听</h5><p>该已经发现了，启动docker后，使用netstat -anpt | grep docker并没有监听地址，但是查看启动进程ps -ef | grep docker是没有问题的</p>\n<p>现在希望docker变成一个有监听进程的服务</p>\n<figure class=\"highlight crystal\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /usr/<span class=\"class\"><span class=\"keyword\">lib</span>/<span class=\"title\">systemd</span>/<span class=\"title\">system</span>/<span class=\"title\">docker</span>.<span class=\"title\">service</span> </span></span><br><span class=\"line\"> 在service模块找到<span class=\"number\">14</span>行修改为以下添加了-H <span class=\"symbol\">tcp:</span>/<span class=\"regexp\">/0.0.0.0</span></span><br><span class=\"line\"><span class=\"regexp\">ExecStart=/usr</span><span class=\"regexp\">/bin/dockerd</span> -H <span class=\"symbol\">fd:</span>/<span class=\"regexp\">/ -H tcp:/</span><span class=\"regexp\">/0.0.0.0 --containerd=/run</span><span class=\"regexp\">/containerd/containerd</span>.sock</span><br></pre></td></tr></table></figure>\n<p>重新加载配置文件并重启服务</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">systemctl</span> <span class=\"string\">daemon-reload</span></span><br><span class=\"line\"><span class=\"attr\">systemctl</span> <span class=\"string\">restart docker</span></span><br></pre></td></tr></table></figure>\n<p>再次查看端口</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">netstat -anpt | grep docker</span><br><span class=\"line\">tcp6       <span class=\"number\">0</span>      <span class=\"number\">0</span> :::<span class=\"number\">2375</span>           :::*             LISTEN      <span class=\"number\">60630</span>/dockerd</span><br><span class=\"line\"><span class=\"number\">2375</span>就是docker的端口</span><br></pre></td></tr></table></figure>\n<h4 id=\"所需要开启的功能\"><a href=\"#所需要开启的功能\" class=\"headerlink\" title=\"所需要开启的功能\"></a>所需要开启的功能</h4><figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# vi /etc/sysctl.conf</span><br><span class=\"line\">添加：</span><br><span class=\"line\">net.bridge.bridge-nf-call-iptables = <span class=\"number\">1</span>    <span class=\"comment\">//开启桥接流量转发</span></span><br><span class=\"line\">net.bridge.bridge-nf-call-ip6tables = <span class=\"number\">1</span>   <span class=\"comment\">//开启ipv6的桥接流量转发</span></span><br><span class=\"line\">net.ipv4.ip_forward = <span class=\"number\">1</span>  <span class=\"comment\">//路由表转发</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# sysctl -p</span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# modprobe ip_vs_rr   <span class=\"comment\">//rr轮训转发</span></span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# modprobe br_netfilter <span class=\"comment\">//桥接卡的iptables的filter表</span></span><br></pre></td></tr></table></figure>"},{"title":"Docker私有仓库","author":"Semaik.","date":"2020-09-10T09:30:00.000Z","_content":"##### [Docker的公共仓库](https://hub.docker.com/)\n\n由Docker公司维护的Registry，用户也可以将自己的镜像保存到DockerHub上中免费的response中，因为在国内访问由很多的限制\n登录方法\n```\ndocker login -u 用户名 密码 https://\n```\n登录后下载方法\n```\ndocker pull 用户名/images名:tag\n```\n##### [Quay](https://quay.io/)\n\n被红帽收购后速度相当慢，红帽对国内还不是完全开放，是一个私人注册托管中心，它上面更多的是很多用户自己上传制作的镜像，没有很多的官方镜像，使用面也不是很广\n\n##### 阿里云镜像仓库\n\n是国内提供docker镜像的仓库，需要用户登录后在控制中心，找到容器镜像服务，可以镜像镜像搜索、新建自己的仓库、也包括官方镜像和其他用户开放的镜像，官方镜像是直接拿取的DockerHub的镜像，属于国内的一个缓存。\n\n这些公有镜像不适合工作中去使用，接下来就看私有仓库\n\n##### 使用registry私有仓库镜像\nHarbor仓库在微服务架构的文章中已经写到怎么使用了，这里就不多说了\n\n环境要：Docker服务器必须开启路由转发\n\n使用两台主机来完成接下来验证私有仓库的使用\n\n|主机\t\t\t  |   \t服务       |\t备注 |\n|:---------------:|:--------------------:|:--------:|\n|192.168.1.11\t|已安装启动docker\t|私有仓库|\n|192.168.1.12\t|已安装启动docker\t| \t\t |\n\n###### 步骤\n两台主机都做路由转发\n```\necho \"net.ipv4.ip_forward = 1\" >> /etc/sysctl.conf\nsysctl -p\n```\n###### 下载私库镜像\n\n`192.168.1.11`\n\n下载2版本的私有仓库镜像，2版本是go语言写的，速度和安全性都比1要好，1是python写的\n```\n[root@localhost ~]# docker pull registry:2\n```\n创建私库在本地物理机的存放路径\n```\n[root@localhost ~]# mkdir -p /opt/data/registry\n```\n运行私库\n\n使用镜像实例化，并进行相应的指定，后台运行仓库\n```\ndocker run -itd -p 5000:5000 --restart always \\\n--volume /opt/data/registry/:/var/lib/registry registry:2\n# 解释参数\n-p：指定端口，5000:5000表示在物理机开一个端口，在容器内开一个端口\n--restart always：无论容器遇到什么错误就会重启容器\n-v/--volume：本地目录映射到容器内的目录\n5000：是registry的端口号\n/var/lib/registry：是registry仓库中存放镜像的目录\n```\n运行起来后，在本地是可以监听到5000端口的\n```\n[root@localhost ~]# netstat -anput | grep 5000\ntcp6     0      0 :::5000      :::*         LISTEN      80040/docker-proxy\n```\n查看仓库中的镜像\n```\n[root@localhost ~]# curl 192.168.1.11:5000/v2/_catalog\n{\"repositories\":[]}  # 表示没有任何镜像\n```\n###### 指定私库地址\n\n需要修改docker的服务文件，让docker知道私有仓库地址\n```\n[root@localhost ~]# vim /usr/lib/systemd/system/docker.service \n# 14行的末尾添加--insecure-registry 192.168.1.11:5000\n# 14行也就是以ExecStart开头的一行\n```\n重新加载配置文件，并重启服务生效\n```\n[root@localhost ~]# systemctl daemon-reload \n[root@localhost ~]# systemctl restart docker\n```\n查看服务状态，可以看到是否识别到了私有仓库\n```\n[root@localhost ~]# systemctl status docker -l\n# 找到以下关键信息，则代表识别私库地址成功\n   CGroup: /system.slice/docker.service\n           ├─80357 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --insecure-registry 192.168.1.11:5000\n           └─80477 /usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 5000 -container-ip 172.17.0.2 -container-port 5000\n ```\n`192.168.1.12`\n进行修改docker的文件去指向docker的私有仓库地址\n```\n[root@localhost ~]# vim /usr/lib/systemd/system/docker.service \n# 14行的末尾添加--insecure-registry 192.168.1.11:5000\n# 14行也就是以ExecStart开头的一行\n[root@localhost ~]# systemctl daemon-reload \n[root@localhost ~]# systemctl restart docker\n```\n###### 验证\n\n`192.168.1.11`\n使用tag为镜像改个名字\n注意：改名字要按照格式来私库ip:5000/镜像名，否则会上传失败\n此时镜像名的作用：push到私库中（私库ip:5000），镜像名为httpd\n```\n[root@localhost ~]# docker tag httpd:latest 192.168.1.11:5000/httpd\n[root@localhost ~]# docker tag centos:latest 192.168.1.11:5000/centos\n[root@localhost ~]# docker tag busybox:latest 192.168.1.11:5000/busybox\n```\n将改名后的镜像上传到私有仓库中\n```\n[root@localhost ~]# docker push 192.168.1.11:5000/httpd\nThe push refers to repository [192.168.1.11:5000/httpd]\n25a92d79dbfe: Pushed \nb5432b464616: Pushed \ne6699b4fc2e3: Pushed \n762ba19e7ef1: Pushed \nf2cb0ecef392: Pushed \n[root@localhost ~]# docker push 192.168.1.11:5000/centos\nThe push refers to repository [192.168.1.11:5000/centos]\n77b174a6a187: Pushed \n[root@localhost ~]# docker push 192.168.1.11:5000/busybox\nThe push refers to repository [192.168.1.11:5000/busybox]\na6d503001157: Pushed\n```\n查看上传后的私库中的镜像\n`192.168.1.12`\n查看到的镜像名和前面讲的是一样的\n```\n[root@localhost ~]# curl 192.168.1.11:5000/v2/_catalog\n{\"repositories\":[\"busybox\",\"centos\",\"httpd\"]}\n```\n下载镜像，速度相当快\n```\n[root@localhost ~]# docker pull 192.168.1.11:5000/httpd\n# 最后会输出下载地址\nStatus: Downloaded newer image for 192.168.1.11:5000/httpd:latest\n192.168.1.11:5000/httpd:latest\n```\n`192.168.1.11`\n查看镜像映射到本地的存储目录\n```\n[root@localhost ~]# ls /opt/data/registry/docker/registry/v2/repositories\nbusybox  centos  httpd\n```\n###### 查看仓库中镜像的信息\n查看httpd镜像的tags\n```\n[root@localhost ~]# curl 192.168.1.11:5000/v2/httpd/tags/list\n{\"name\":\"httpd\",\"tags\":[\"latest\"]}\n```\n查看镜像的hash值\n```\ncurl 192.168.1.11:5000/v2/httpd/manifests/latest \\\n--header \"Accept: application/vnd.docker.distribution.manifest.v2+json\"\n# 找到第一个\"digest\":的值就是该镜像的hash值，以下的\"digest\":都是镜像层的hash值\n```\n删除私库镜像\n```\n# 直接进入目录删除其中一个镜像的目录即可\n[root@localhost ~]# rm -rf /opt/data/registry/docker/registry/v2/repositories/httpd\n[root@localhost ~]# curl 192.168.1.11:5000/v2/_catalog\n{\"repositories\":[\"busybox\",\"centos\"]}\n ```\n \n","source":"_posts/Docker私有仓库.md","raw":"title: Docker私有仓库\nauthor: Semaik.\ntags:\n  - Docker\ncategories:\n  - Docker\ndate: 2020-09-10 17:30:00\n---\n##### [Docker的公共仓库](https://hub.docker.com/)\n\n由Docker公司维护的Registry，用户也可以将自己的镜像保存到DockerHub上中免费的response中，因为在国内访问由很多的限制\n登录方法\n```\ndocker login -u 用户名 密码 https://\n```\n登录后下载方法\n```\ndocker pull 用户名/images名:tag\n```\n##### [Quay](https://quay.io/)\n\n被红帽收购后速度相当慢，红帽对国内还不是完全开放，是一个私人注册托管中心，它上面更多的是很多用户自己上传制作的镜像，没有很多的官方镜像，使用面也不是很广\n\n##### 阿里云镜像仓库\n\n是国内提供docker镜像的仓库，需要用户登录后在控制中心，找到容器镜像服务，可以镜像镜像搜索、新建自己的仓库、也包括官方镜像和其他用户开放的镜像，官方镜像是直接拿取的DockerHub的镜像，属于国内的一个缓存。\n\n这些公有镜像不适合工作中去使用，接下来就看私有仓库\n\n##### 使用registry私有仓库镜像\nHarbor仓库在微服务架构的文章中已经写到怎么使用了，这里就不多说了\n\n环境要：Docker服务器必须开启路由转发\n\n使用两台主机来完成接下来验证私有仓库的使用\n\n|主机\t\t\t  |   \t服务       |\t备注 |\n|:---------------:|:--------------------:|:--------:|\n|192.168.1.11\t|已安装启动docker\t|私有仓库|\n|192.168.1.12\t|已安装启动docker\t| \t\t |\n\n###### 步骤\n两台主机都做路由转发\n```\necho \"net.ipv4.ip_forward = 1\" >> /etc/sysctl.conf\nsysctl -p\n```\n###### 下载私库镜像\n\n`192.168.1.11`\n\n下载2版本的私有仓库镜像，2版本是go语言写的，速度和安全性都比1要好，1是python写的\n```\n[root@localhost ~]# docker pull registry:2\n```\n创建私库在本地物理机的存放路径\n```\n[root@localhost ~]# mkdir -p /opt/data/registry\n```\n运行私库\n\n使用镜像实例化，并进行相应的指定，后台运行仓库\n```\ndocker run -itd -p 5000:5000 --restart always \\\n--volume /opt/data/registry/:/var/lib/registry registry:2\n# 解释参数\n-p：指定端口，5000:5000表示在物理机开一个端口，在容器内开一个端口\n--restart always：无论容器遇到什么错误就会重启容器\n-v/--volume：本地目录映射到容器内的目录\n5000：是registry的端口号\n/var/lib/registry：是registry仓库中存放镜像的目录\n```\n运行起来后，在本地是可以监听到5000端口的\n```\n[root@localhost ~]# netstat -anput | grep 5000\ntcp6     0      0 :::5000      :::*         LISTEN      80040/docker-proxy\n```\n查看仓库中的镜像\n```\n[root@localhost ~]# curl 192.168.1.11:5000/v2/_catalog\n{\"repositories\":[]}  # 表示没有任何镜像\n```\n###### 指定私库地址\n\n需要修改docker的服务文件，让docker知道私有仓库地址\n```\n[root@localhost ~]# vim /usr/lib/systemd/system/docker.service \n# 14行的末尾添加--insecure-registry 192.168.1.11:5000\n# 14行也就是以ExecStart开头的一行\n```\n重新加载配置文件，并重启服务生效\n```\n[root@localhost ~]# systemctl daemon-reload \n[root@localhost ~]# systemctl restart docker\n```\n查看服务状态，可以看到是否识别到了私有仓库\n```\n[root@localhost ~]# systemctl status docker -l\n# 找到以下关键信息，则代表识别私库地址成功\n   CGroup: /system.slice/docker.service\n           ├─80357 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --insecure-registry 192.168.1.11:5000\n           └─80477 /usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 5000 -container-ip 172.17.0.2 -container-port 5000\n ```\n`192.168.1.12`\n进行修改docker的文件去指向docker的私有仓库地址\n```\n[root@localhost ~]# vim /usr/lib/systemd/system/docker.service \n# 14行的末尾添加--insecure-registry 192.168.1.11:5000\n# 14行也就是以ExecStart开头的一行\n[root@localhost ~]# systemctl daemon-reload \n[root@localhost ~]# systemctl restart docker\n```\n###### 验证\n\n`192.168.1.11`\n使用tag为镜像改个名字\n注意：改名字要按照格式来私库ip:5000/镜像名，否则会上传失败\n此时镜像名的作用：push到私库中（私库ip:5000），镜像名为httpd\n```\n[root@localhost ~]# docker tag httpd:latest 192.168.1.11:5000/httpd\n[root@localhost ~]# docker tag centos:latest 192.168.1.11:5000/centos\n[root@localhost ~]# docker tag busybox:latest 192.168.1.11:5000/busybox\n```\n将改名后的镜像上传到私有仓库中\n```\n[root@localhost ~]# docker push 192.168.1.11:5000/httpd\nThe push refers to repository [192.168.1.11:5000/httpd]\n25a92d79dbfe: Pushed \nb5432b464616: Pushed \ne6699b4fc2e3: Pushed \n762ba19e7ef1: Pushed \nf2cb0ecef392: Pushed \n[root@localhost ~]# docker push 192.168.1.11:5000/centos\nThe push refers to repository [192.168.1.11:5000/centos]\n77b174a6a187: Pushed \n[root@localhost ~]# docker push 192.168.1.11:5000/busybox\nThe push refers to repository [192.168.1.11:5000/busybox]\na6d503001157: Pushed\n```\n查看上传后的私库中的镜像\n`192.168.1.12`\n查看到的镜像名和前面讲的是一样的\n```\n[root@localhost ~]# curl 192.168.1.11:5000/v2/_catalog\n{\"repositories\":[\"busybox\",\"centos\",\"httpd\"]}\n```\n下载镜像，速度相当快\n```\n[root@localhost ~]# docker pull 192.168.1.11:5000/httpd\n# 最后会输出下载地址\nStatus: Downloaded newer image for 192.168.1.11:5000/httpd:latest\n192.168.1.11:5000/httpd:latest\n```\n`192.168.1.11`\n查看镜像映射到本地的存储目录\n```\n[root@localhost ~]# ls /opt/data/registry/docker/registry/v2/repositories\nbusybox  centos  httpd\n```\n###### 查看仓库中镜像的信息\n查看httpd镜像的tags\n```\n[root@localhost ~]# curl 192.168.1.11:5000/v2/httpd/tags/list\n{\"name\":\"httpd\",\"tags\":[\"latest\"]}\n```\n查看镜像的hash值\n```\ncurl 192.168.1.11:5000/v2/httpd/manifests/latest \\\n--header \"Accept: application/vnd.docker.distribution.manifest.v2+json\"\n# 找到第一个\"digest\":的值就是该镜像的hash值，以下的\"digest\":都是镜像层的hash值\n```\n删除私库镜像\n```\n# 直接进入目录删除其中一个镜像的目录即可\n[root@localhost ~]# rm -rf /opt/data/registry/docker/registry/v2/repositories/httpd\n[root@localhost ~]# curl 192.168.1.11:5000/v2/_catalog\n{\"repositories\":[\"busybox\",\"centos\"]}\n ```\n \n","slug":"Docker私有仓库","published":1,"updated":"2020-09-10T09:39:40.097Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r7374000om3pvgkieagsa","content":"<h5 id=\"Docker的公共仓库\"><a href=\"#Docker的公共仓库\" class=\"headerlink\" title=\"Docker的公共仓库\"></a><a href=\"https://hub.docker.com/\">Docker的公共仓库</a></h5><p>由Docker公司维护的Registry，用户也可以将自己的镜像保存到DockerHub上中免费的response中，因为在国内访问由很多的限制<br>登录方法</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker login -u 用户名 密码 https:<span class=\"regexp\">//</span></span><br></pre></td></tr></table></figure>\n<p>登录后下载方法</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull 用户名/images名:<span class=\"keyword\">tag</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"Quay\"><a href=\"#Quay\" class=\"headerlink\" title=\"Quay\"></a><a href=\"https://quay.io/\">Quay</a></h5><p>被红帽收购后速度相当慢，红帽对国内还不是完全开放，是一个私人注册托管中心，它上面更多的是很多用户自己上传制作的镜像，没有很多的官方镜像，使用面也不是很广</p>\n<h5 id=\"阿里云镜像仓库\"><a href=\"#阿里云镜像仓库\" class=\"headerlink\" title=\"阿里云镜像仓库\"></a>阿里云镜像仓库</h5><p>是国内提供docker镜像的仓库，需要用户登录后在控制中心，找到容器镜像服务，可以镜像镜像搜索、新建自己的仓库、也包括官方镜像和其他用户开放的镜像，官方镜像是直接拿取的DockerHub的镜像，属于国内的一个缓存。</p>\n<p>这些公有镜像不适合工作中去使用，接下来就看私有仓库</p>\n<h5 id=\"使用registry私有仓库镜像\"><a href=\"#使用registry私有仓库镜像\" class=\"headerlink\" title=\"使用registry私有仓库镜像\"></a>使用registry私有仓库镜像</h5><p>Harbor仓库在微服务架构的文章中已经写到怎么使用了，这里就不多说了</p>\n<p>环境要：Docker服务器必须开启路由转发</p>\n<p>使用两台主机来完成接下来验证私有仓库的使用</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">主机</th>\n<th align=\"center\">服务</th>\n<th align=\"center\">备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">192.168.1.11</td>\n<td align=\"center\">已安装启动docker</td>\n<td align=\"center\">私有仓库</td>\n</tr>\n<tr>\n<td align=\"center\">192.168.1.12</td>\n<td align=\"center\">已安装启动docker</td>\n<td align=\"center\"></td>\n</tr>\n</tbody></table>\n<h6 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h6><p>两台主机都做路由转发</p>\n<figure class=\"highlight arcade\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo <span class=\"string\">&quot;net.ipv4.ip_forward = 1&quot;</span> &gt;&gt; <span class=\"regexp\">/etc/</span>sysctl.conf</span><br><span class=\"line\">sysctl -p</span><br></pre></td></tr></table></figure>\n<h6 id=\"下载私库镜像\"><a href=\"#下载私库镜像\" class=\"headerlink\" title=\"下载私库镜像\"></a>下载私库镜像</h6><p><code>192.168.1.11</code></p>\n<p>下载2版本的私有仓库镜像，2版本是go语言写的，速度和安全性都比1要好，1是python写的</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# docker pull registry:<span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n<p>创建私库在本地物理机的存放路径</p>\n<figure class=\"highlight autoit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"symbol\">@localhost</span> ~]<span class=\"meta\"># mkdir -p /opt/data/registry</span></span><br></pre></td></tr></table></figure>\n<p>运行私库</p>\n<p>使用镜像实例化，并进行相应的指定，后台运行仓库</p>\n<figure class=\"highlight haml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -itd -p 5000:5000 --restart always \\</span><br><span class=\"line\">-<span class=\"ruby\">-volume /opt/data/registry/<span class=\"symbol\">:/var/lib/registry</span> <span class=\"symbol\">registry:</span><span class=\"number\">2</span></span></span><br><span class=\"line\"><span class=\"ruby\"><span class=\"comment\"># 解释参数</span></span></span><br><span class=\"line\"><span class=\"ruby\">-p：指定端口，<span class=\"number\">5000</span><span class=\"symbol\">:</span><span class=\"number\">5000</span>表示在物理机开一个端口，在容器内开一个端口</span></span><br><span class=\"line\"><span class=\"ruby\">--restart always：无论容器遇到什么错误就会重启容器</span></span><br><span class=\"line\"><span class=\"ruby\">-v/--volume：本地目录映射到容器内的目录</span></span><br><span class=\"line\"><span class=\"ruby\"><span class=\"number\">5000</span>：是registry的端口号</span></span><br><span class=\"line\"><span class=\"ruby\">/var/lib/registry：是registry仓库中存放镜像的目录</span></span><br></pre></td></tr></table></figure>\n<p>运行起来后，在本地是可以监听到5000端口的</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# netstat -anput | grep <span class=\"number\">5000</span></span><br><span class=\"line\">tcp6     <span class=\"number\">0</span>      <span class=\"number\">0</span> :::<span class=\"number\">5000</span>      :::*         LISTEN      <span class=\"number\">80040</span>/docker-proxy</span><br></pre></td></tr></table></figure>\n<p>查看仓库中的镜像</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# curl <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/v2/_catalog</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;repositories&quot;</span>:[]&#125;  # 表示没有任何镜像</span><br></pre></td></tr></table></figure>\n<h6 id=\"指定私库地址\"><a href=\"#指定私库地址\" class=\"headerlink\" title=\"指定私库地址\"></a>指定私库地址</h6><p>需要修改docker的服务文件，让docker知道私有仓库地址</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# vim /usr/lib/systemd/system/docker.service </span><br><span class=\"line\"># <span class=\"number\">14</span>行的末尾添加--insecure-registry <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span></span><br><span class=\"line\"># <span class=\"number\">14</span>行也就是以ExecStart开头的一行</span><br></pre></td></tr></table></figure>\n<p>重新加载配置文件，并重启服务生效</p>\n<figure class=\"highlight autoit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"symbol\">@localhost</span> ~]<span class=\"meta\"># systemctl daemon-reload </span></span><br><span class=\"line\">[root<span class=\"symbol\">@localhost</span> ~]<span class=\"meta\"># systemctl restart docker</span></span><br></pre></td></tr></table></figure>\n<p>查看服务状态，可以看到是否识别到了私有仓库</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">root@localhost</span> <span class=\"string\">~</span>]<span class=\"comment\"># systemctl status docker -l</span></span><br><span class=\"line\"><span class=\"comment\"># 找到以下关键信息，则代表识别私库地址成功</span></span><br><span class=\"line\">   <span class=\"attr\">CGroup:</span> <span class=\"string\">/system.slice/docker.service</span></span><br><span class=\"line\">           <span class=\"string\">├─80357</span> <span class=\"string\">/usr/bin/dockerd</span> <span class=\"string\">-H</span> <span class=\"string\">fd://</span> <span class=\"string\">--containerd=/run/containerd/containerd.sock</span> <span class=\"string\">--insecure-registry</span> <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span><span class=\"string\">:5000</span></span><br><span class=\"line\">           <span class=\"string\">└─80477</span> <span class=\"string\">/usr/bin/docker-proxy</span> <span class=\"string\">-proto</span> <span class=\"string\">tcp</span> <span class=\"string\">-host-ip</span> <span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span> <span class=\"string\">-host-port</span> <span class=\"number\">5000</span> <span class=\"string\">-container-ip</span> <span class=\"number\">172.17</span><span class=\"number\">.0</span><span class=\"number\">.2</span> <span class=\"string\">-container-port</span> <span class=\"number\">5000</span></span><br></pre></td></tr></table></figure>\n<p><code>192.168.1.12</code><br>进行修改docker的文件去指向docker的私有仓库地址</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# vim /usr/lib/systemd/system/docker.service </span><br><span class=\"line\"># <span class=\"number\">14</span>行的末尾添加--insecure-registry <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span></span><br><span class=\"line\"># <span class=\"number\">14</span>行也就是以ExecStart开头的一行</span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# systemctl daemon-reload </span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# systemctl restart docker</span><br></pre></td></tr></table></figure>\n<h6 id=\"验证\"><a href=\"#验证\" class=\"headerlink\" title=\"验证\"></a>验证</h6><p><code>192.168.1.11</code><br>使用tag为镜像改个名字<br>注意：改名字要按照格式来私库ip:5000/镜像名，否则会上传失败<br>此时镜像名的作用：push到私库中（私库ip:5000），镜像名为httpd</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# docker tag httpd:latest <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/httpd</span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# docker tag centos:latest <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/centos</span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# docker tag busybox:latest <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/busybox</span><br></pre></td></tr></table></figure>\n<p>将改名后的镜像上传到私有仓库中</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# docker push <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/httpd</span><br><span class=\"line\">The push <span class=\"built_in\">ref</span>ers to repository [<span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/httpd]</span><br><span class=\"line\"><span class=\"number\">25</span>a92d79dbfe: Pushed </span><br><span class=\"line\">b5432b464616: Pushed </span><br><span class=\"line\">e6699b4fc2e3: Pushed </span><br><span class=\"line\"><span class=\"number\">762</span>ba19e7ef1: Pushed </span><br><span class=\"line\">f2cb0ecef392: Pushed </span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# docker push <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/centos</span><br><span class=\"line\">The push <span class=\"built_in\">ref</span>ers to repository [<span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/centos]</span><br><span class=\"line\"><span class=\"number\">77</span>b174a6a187: Pushed </span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# docker push <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/busybox</span><br><span class=\"line\">The push <span class=\"built_in\">ref</span>ers to repository [<span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/busybox]</span><br><span class=\"line\">a6d503001157: Pushed</span><br></pre></td></tr></table></figure>\n<p>查看上传后的私库中的镜像<br><code>192.168.1.12</code><br>查看到的镜像名和前面讲的是一样的</p>\n<figure class=\"highlight autoit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"symbol\">@localhost</span> ~]<span class=\"meta\"># curl 192.168.1.11:5000/v2/_catalog</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;repositories&quot;</span>:[<span class=\"string\">&quot;busybox&quot;</span>,<span class=\"string\">&quot;centos&quot;</span>,<span class=\"string\">&quot;httpd&quot;</span>]&#125;</span><br></pre></td></tr></table></figure>\n<p>下载镜像，速度相当快</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# docker pull <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/httpd</span><br><span class=\"line\"># 最后会输出下载地址</span><br><span class=\"line\">Status: Downloaded newer image <span class=\"keyword\">for</span> <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/httpd:latest</span><br><span class=\"line\"><span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/httpd:latest</span><br></pre></td></tr></table></figure>\n<p><code>192.168.1.11</code><br>查看镜像映射到本地的存储目录</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# ls <span class=\"regexp\">/opt/</span>data<span class=\"regexp\">/registry/</span>docker<span class=\"regexp\">/registry/</span>v2/<span class=\"keyword\">repositories</span></span><br><span class=\"line\">busybox  centos  httpd</span><br></pre></td></tr></table></figure>\n<h6 id=\"查看仓库中镜像的信息\"><a href=\"#查看仓库中镜像的信息\" class=\"headerlink\" title=\"查看仓库中镜像的信息\"></a>查看仓库中镜像的信息</h6><p>查看httpd镜像的tags</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# curl <span class=\"number\">192.168</span>.<span class=\"number\">1.11</span>:<span class=\"number\">5000</span><span class=\"regexp\">/v2/</span>httpd<span class=\"regexp\">/tags/</span>list</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;httpd&quot;</span>,<span class=\"string\">&quot;tags&quot;</span>:[<span class=\"string\">&quot;latest&quot;</span>]&#125;</span><br></pre></td></tr></table></figure>\n<p>查看镜像的hash值</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl <span class=\"number\">192.168</span>.<span class=\"number\">1.11</span>:<span class=\"number\">5000</span><span class=\"regexp\">/v2/</span>httpd<span class=\"regexp\">/manifests/</span>latest \\</span><br><span class=\"line\">--header <span class=\"string\">&quot;Accept: application/vnd.docker.distribution.manifest.v2+json&quot;</span></span><br><span class=\"line\"># 找到第一个<span class=\"string\">&quot;digest&quot;</span>:的值就是该镜像的hash值，以下的<span class=\"string\">&quot;digest&quot;</span>:都是镜像层的hash值</span><br></pre></td></tr></table></figure>\n<p>删除私库镜像</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 直接进入目录删除其中一个镜像的目录即可</span><br><span class=\"line\">[root@localhost ~]# rm -rf <span class=\"regexp\">/opt/</span>data<span class=\"regexp\">/registry/</span>docker<span class=\"regexp\">/registry/</span>v2<span class=\"regexp\">/repositories/</span>httpd</span><br><span class=\"line\">[root@localhost ~]# curl <span class=\"number\">192.168</span>.<span class=\"number\">1.11</span>:<span class=\"number\">5000</span><span class=\"regexp\">/v2/</span>_catalog</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;repositories&quot;</span>:[<span class=\"string\">&quot;busybox&quot;</span>,<span class=\"string\">&quot;centos&quot;</span>]&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h5 id=\"Docker的公共仓库\"><a href=\"#Docker的公共仓库\" class=\"headerlink\" title=\"Docker的公共仓库\"></a><a href=\"https://hub.docker.com/\">Docker的公共仓库</a></h5><p>由Docker公司维护的Registry，用户也可以将自己的镜像保存到DockerHub上中免费的response中，因为在国内访问由很多的限制<br>登录方法</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker login -u 用户名 密码 https:<span class=\"regexp\">//</span></span><br></pre></td></tr></table></figure>\n<p>登录后下载方法</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull 用户名/images名:<span class=\"keyword\">tag</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"Quay\"><a href=\"#Quay\" class=\"headerlink\" title=\"Quay\"></a><a href=\"https://quay.io/\">Quay</a></h5><p>被红帽收购后速度相当慢，红帽对国内还不是完全开放，是一个私人注册托管中心，它上面更多的是很多用户自己上传制作的镜像，没有很多的官方镜像，使用面也不是很广</p>\n<h5 id=\"阿里云镜像仓库\"><a href=\"#阿里云镜像仓库\" class=\"headerlink\" title=\"阿里云镜像仓库\"></a>阿里云镜像仓库</h5><p>是国内提供docker镜像的仓库，需要用户登录后在控制中心，找到容器镜像服务，可以镜像镜像搜索、新建自己的仓库、也包括官方镜像和其他用户开放的镜像，官方镜像是直接拿取的DockerHub的镜像，属于国内的一个缓存。</p>\n<p>这些公有镜像不适合工作中去使用，接下来就看私有仓库</p>\n<h5 id=\"使用registry私有仓库镜像\"><a href=\"#使用registry私有仓库镜像\" class=\"headerlink\" title=\"使用registry私有仓库镜像\"></a>使用registry私有仓库镜像</h5><p>Harbor仓库在微服务架构的文章中已经写到怎么使用了，这里就不多说了</p>\n<p>环境要：Docker服务器必须开启路由转发</p>\n<p>使用两台主机来完成接下来验证私有仓库的使用</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">主机</th>\n<th align=\"center\">服务</th>\n<th align=\"center\">备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">192.168.1.11</td>\n<td align=\"center\">已安装启动docker</td>\n<td align=\"center\">私有仓库</td>\n</tr>\n<tr>\n<td align=\"center\">192.168.1.12</td>\n<td align=\"center\">已安装启动docker</td>\n<td align=\"center\"></td>\n</tr>\n</tbody></table>\n<h6 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h6><p>两台主机都做路由转发</p>\n<figure class=\"highlight arcade\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo <span class=\"string\">&quot;net.ipv4.ip_forward = 1&quot;</span> &gt;&gt; <span class=\"regexp\">/etc/</span>sysctl.conf</span><br><span class=\"line\">sysctl -p</span><br></pre></td></tr></table></figure>\n<h6 id=\"下载私库镜像\"><a href=\"#下载私库镜像\" class=\"headerlink\" title=\"下载私库镜像\"></a>下载私库镜像</h6><p><code>192.168.1.11</code></p>\n<p>下载2版本的私有仓库镜像，2版本是go语言写的，速度和安全性都比1要好，1是python写的</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# docker pull registry:<span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n<p>创建私库在本地物理机的存放路径</p>\n<figure class=\"highlight autoit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"symbol\">@localhost</span> ~]<span class=\"meta\"># mkdir -p /opt/data/registry</span></span><br></pre></td></tr></table></figure>\n<p>运行私库</p>\n<p>使用镜像实例化，并进行相应的指定，后台运行仓库</p>\n<figure class=\"highlight haml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -itd -p 5000:5000 --restart always \\</span><br><span class=\"line\">-<span class=\"ruby\">-volume /opt/data/registry/<span class=\"symbol\">:/var/lib/registry</span> <span class=\"symbol\">registry:</span><span class=\"number\">2</span></span></span><br><span class=\"line\"><span class=\"ruby\"><span class=\"comment\"># 解释参数</span></span></span><br><span class=\"line\"><span class=\"ruby\">-p：指定端口，<span class=\"number\">5000</span><span class=\"symbol\">:</span><span class=\"number\">5000</span>表示在物理机开一个端口，在容器内开一个端口</span></span><br><span class=\"line\"><span class=\"ruby\">--restart always：无论容器遇到什么错误就会重启容器</span></span><br><span class=\"line\"><span class=\"ruby\">-v/--volume：本地目录映射到容器内的目录</span></span><br><span class=\"line\"><span class=\"ruby\"><span class=\"number\">5000</span>：是registry的端口号</span></span><br><span class=\"line\"><span class=\"ruby\">/var/lib/registry：是registry仓库中存放镜像的目录</span></span><br></pre></td></tr></table></figure>\n<p>运行起来后，在本地是可以监听到5000端口的</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# netstat -anput | grep <span class=\"number\">5000</span></span><br><span class=\"line\">tcp6     <span class=\"number\">0</span>      <span class=\"number\">0</span> :::<span class=\"number\">5000</span>      :::*         LISTEN      <span class=\"number\">80040</span>/docker-proxy</span><br></pre></td></tr></table></figure>\n<p>查看仓库中的镜像</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# curl <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/v2/_catalog</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;repositories&quot;</span>:[]&#125;  # 表示没有任何镜像</span><br></pre></td></tr></table></figure>\n<h6 id=\"指定私库地址\"><a href=\"#指定私库地址\" class=\"headerlink\" title=\"指定私库地址\"></a>指定私库地址</h6><p>需要修改docker的服务文件，让docker知道私有仓库地址</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# vim /usr/lib/systemd/system/docker.service </span><br><span class=\"line\"># <span class=\"number\">14</span>行的末尾添加--insecure-registry <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span></span><br><span class=\"line\"># <span class=\"number\">14</span>行也就是以ExecStart开头的一行</span><br></pre></td></tr></table></figure>\n<p>重新加载配置文件，并重启服务生效</p>\n<figure class=\"highlight autoit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"symbol\">@localhost</span> ~]<span class=\"meta\"># systemctl daemon-reload </span></span><br><span class=\"line\">[root<span class=\"symbol\">@localhost</span> ~]<span class=\"meta\"># systemctl restart docker</span></span><br></pre></td></tr></table></figure>\n<p>查看服务状态，可以看到是否识别到了私有仓库</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">root@localhost</span> <span class=\"string\">~</span>]<span class=\"comment\"># systemctl status docker -l</span></span><br><span class=\"line\"><span class=\"comment\"># 找到以下关键信息，则代表识别私库地址成功</span></span><br><span class=\"line\">   <span class=\"attr\">CGroup:</span> <span class=\"string\">/system.slice/docker.service</span></span><br><span class=\"line\">           <span class=\"string\">├─80357</span> <span class=\"string\">/usr/bin/dockerd</span> <span class=\"string\">-H</span> <span class=\"string\">fd://</span> <span class=\"string\">--containerd=/run/containerd/containerd.sock</span> <span class=\"string\">--insecure-registry</span> <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span><span class=\"string\">:5000</span></span><br><span class=\"line\">           <span class=\"string\">└─80477</span> <span class=\"string\">/usr/bin/docker-proxy</span> <span class=\"string\">-proto</span> <span class=\"string\">tcp</span> <span class=\"string\">-host-ip</span> <span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span> <span class=\"string\">-host-port</span> <span class=\"number\">5000</span> <span class=\"string\">-container-ip</span> <span class=\"number\">172.17</span><span class=\"number\">.0</span><span class=\"number\">.2</span> <span class=\"string\">-container-port</span> <span class=\"number\">5000</span></span><br></pre></td></tr></table></figure>\n<p><code>192.168.1.12</code><br>进行修改docker的文件去指向docker的私有仓库地址</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# vim /usr/lib/systemd/system/docker.service </span><br><span class=\"line\"># <span class=\"number\">14</span>行的末尾添加--insecure-registry <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span></span><br><span class=\"line\"># <span class=\"number\">14</span>行也就是以ExecStart开头的一行</span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# systemctl daemon-reload </span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# systemctl restart docker</span><br></pre></td></tr></table></figure>\n<h6 id=\"验证\"><a href=\"#验证\" class=\"headerlink\" title=\"验证\"></a>验证</h6><p><code>192.168.1.11</code><br>使用tag为镜像改个名字<br>注意：改名字要按照格式来私库ip:5000/镜像名，否则会上传失败<br>此时镜像名的作用：push到私库中（私库ip:5000），镜像名为httpd</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# docker tag httpd:latest <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/httpd</span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# docker tag centos:latest <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/centos</span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# docker tag busybox:latest <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/busybox</span><br></pre></td></tr></table></figure>\n<p>将改名后的镜像上传到私有仓库中</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# docker push <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/httpd</span><br><span class=\"line\">The push <span class=\"built_in\">ref</span>ers to repository [<span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/httpd]</span><br><span class=\"line\"><span class=\"number\">25</span>a92d79dbfe: Pushed </span><br><span class=\"line\">b5432b464616: Pushed </span><br><span class=\"line\">e6699b4fc2e3: Pushed </span><br><span class=\"line\"><span class=\"number\">762</span>ba19e7ef1: Pushed </span><br><span class=\"line\">f2cb0ecef392: Pushed </span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# docker push <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/centos</span><br><span class=\"line\">The push <span class=\"built_in\">ref</span>ers to repository [<span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/centos]</span><br><span class=\"line\"><span class=\"number\">77</span>b174a6a187: Pushed </span><br><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# docker push <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/busybox</span><br><span class=\"line\">The push <span class=\"built_in\">ref</span>ers to repository [<span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/busybox]</span><br><span class=\"line\">a6d503001157: Pushed</span><br></pre></td></tr></table></figure>\n<p>查看上传后的私库中的镜像<br><code>192.168.1.12</code><br>查看到的镜像名和前面讲的是一样的</p>\n<figure class=\"highlight autoit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"symbol\">@localhost</span> ~]<span class=\"meta\"># curl 192.168.1.11:5000/v2/_catalog</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;repositories&quot;</span>:[<span class=\"string\">&quot;busybox&quot;</span>,<span class=\"string\">&quot;centos&quot;</span>,<span class=\"string\">&quot;httpd&quot;</span>]&#125;</span><br></pre></td></tr></table></figure>\n<p>下载镜像，速度相当快</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"symbol\">root@</span>localhost ~]# docker pull <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/httpd</span><br><span class=\"line\"># 最后会输出下载地址</span><br><span class=\"line\">Status: Downloaded newer image <span class=\"keyword\">for</span> <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/httpd:latest</span><br><span class=\"line\"><span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.11</span>:<span class=\"number\">5000</span>/httpd:latest</span><br></pre></td></tr></table></figure>\n<p><code>192.168.1.11</code><br>查看镜像映射到本地的存储目录</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# ls <span class=\"regexp\">/opt/</span>data<span class=\"regexp\">/registry/</span>docker<span class=\"regexp\">/registry/</span>v2/<span class=\"keyword\">repositories</span></span><br><span class=\"line\">busybox  centos  httpd</span><br></pre></td></tr></table></figure>\n<h6 id=\"查看仓库中镜像的信息\"><a href=\"#查看仓库中镜像的信息\" class=\"headerlink\" title=\"查看仓库中镜像的信息\"></a>查看仓库中镜像的信息</h6><p>查看httpd镜像的tags</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# curl <span class=\"number\">192.168</span>.<span class=\"number\">1.11</span>:<span class=\"number\">5000</span><span class=\"regexp\">/v2/</span>httpd<span class=\"regexp\">/tags/</span>list</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;httpd&quot;</span>,<span class=\"string\">&quot;tags&quot;</span>:[<span class=\"string\">&quot;latest&quot;</span>]&#125;</span><br></pre></td></tr></table></figure>\n<p>查看镜像的hash值</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl <span class=\"number\">192.168</span>.<span class=\"number\">1.11</span>:<span class=\"number\">5000</span><span class=\"regexp\">/v2/</span>httpd<span class=\"regexp\">/manifests/</span>latest \\</span><br><span class=\"line\">--header <span class=\"string\">&quot;Accept: application/vnd.docker.distribution.manifest.v2+json&quot;</span></span><br><span class=\"line\"># 找到第一个<span class=\"string\">&quot;digest&quot;</span>:的值就是该镜像的hash值，以下的<span class=\"string\">&quot;digest&quot;</span>:都是镜像层的hash值</span><br></pre></td></tr></table></figure>\n<p>删除私库镜像</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 直接进入目录删除其中一个镜像的目录即可</span><br><span class=\"line\">[root@localhost ~]# rm -rf <span class=\"regexp\">/opt/</span>data<span class=\"regexp\">/registry/</span>docker<span class=\"regexp\">/registry/</span>v2<span class=\"regexp\">/repositories/</span>httpd</span><br><span class=\"line\">[root@localhost ~]# curl <span class=\"number\">192.168</span>.<span class=\"number\">1.11</span>:<span class=\"number\">5000</span><span class=\"regexp\">/v2/</span>_catalog</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;repositories&quot;</span>:[<span class=\"string\">&quot;busybox&quot;</span>,<span class=\"string\">&quot;centos&quot;</span>]&#125;</span><br></pre></td></tr></table></figure>\n\n"},{"title":"Docker部署nginx及web集群","author":"Semaik.","date":"2020-09-10T09:42:00.000Z","_content":"在容器部署基于centos镜像的nginx：\n\n首先将nginx软件包放入物理机（虚拟机）中\n\n进去容器后，什么都没有，环境相当干净，所以各种命令需要自己安装\n\n使用yum provides 查看命令的软件包，并且进行安装，即可使用\n```\nyum provides ip/ifconfig/scp\nyum -y install iproute   //ip\nyum -y install net-tools //ifconfig\nyum -y install openssh-clients  //scp\n```\n准备nginx环境\n```\nyum -y install gcc gcc-c++ pcre-devel zlib-devel openssl-devel make\n```\n查看容器的IP地址\n\n![upload successful](/images/pasted-20.png)\n\n退出容器：exit\n \n查看本地ip，docker网卡\n\n![upload successful](/images/pasted-21.png)\n\n方法一：在容器中，将物理机的软件包拷贝到容器中\n\n![upload successful](/images/pasted-22.png)\n\n方法二：在物理机中，3a9f...0c4为容器的id，也可以使用容器名（--name指定的名称）\n\n![upload successful](/images/pasted-23.png)\n\n \n###### 安装nginx\n```\ntar zxf nginx-1.12.0.tar.gz -C /usr/src\ncd /usr/src/nginx-1.12.0/\n./configure --prefix=/usr/local/nginx --user=nginx --group=ngixn --with-http_stub_status_module --with-pcre && make && make install\nuseradd nginx\nln -s /usr/local/nginx/sbin/nginx /usr/local/sbin/nginx\n/nginx\n```\n \n修改页面文件\n```\necho \"172.17.0.2\" > /usr/local/nginx/html/index.html\n```\n \n启动nginx\n\n![upload successful](/images/pasted-24.png)\n \n测试\n\n![upload successful](/images/pasted-25.png)\n \n为了后面做web集群时方便使用，可以将上面安装好命令与nginx的容器做一个镜像，方便后期使用。\n\n将配置好的容器制作成一个镜像\n\ndocker commit 容器id  镜像名称\n\n![upload successful](/images/pasted-26.png)\n \n将做好的镜像导出到本地（用于做备份）\n\n![upload successful](/images/pasted-27.png)\n \n模拟误删除镜像\n\n![upload successful](/images/pasted-28.png)\n\n将已导出的镜像tar包，再导入进来（这时发现删除的镜像又回来了）\n\n![upload successful](/images/pasted-29.png)\n \nWEB集群\n使用zu镜像做一个web2容器\n\n![upload successful](/images/pasted-30.png)\n\n![upload successful](/images/pasted-31.png)\n\n修改页面文件\n\n![upload successful](/images/pasted-32.png)\n\n启动nginx，并退出容器\n\n![upload successful](/images/pasted-33.png)\n\n使用zu镜像做一个web3容器\n\n![upload successful](/images/pasted-34.png)\n\n修改页面文件\n\n![upload successful](/images/pasted-35.png)\n\n启动nginx\n\n![upload successful](/images/pasted-36.png)\n\n![upload successful](/images/pasted-37.png)\n\n \n###### 本地部署nginx\n安装环境\n```\nyum -y install  pcre-devel zlib-devel openssl-devel\n```\n安装nginx\n```\ntar zxf nginx-1.12.0.tar.gz -C /usr/src/\ncd /usr/src/nginx-1.12.0/\n./configure --prefix=/usr/local/nginx --user=nginx --group=nginx --with-http_stub_status_module --with-pcre && make && make install\nuseradd nginx\nln -s /usr/local/nginx/sbin/nginx /usr/local/sbin/nginx\n```\n修改配置文件\nvim /usr/local/nginx/conf/nginx.conf\n\n![upload successful](/images/pasted-38.png)\n启动nginx\n\n![upload successful](/images/pasted-39.png)\n测试\n \n![upload successful](/images/pasted-40.png)\n\n","source":"_posts/Docker部署nginx及web集群.md","raw":"title: Docker部署nginx及web集群\nauthor: Semaik.\ntags:\n  - Docker\ncategories:\n  - Docker\ndate: 2020-09-10 17:42:00\n---\n在容器部署基于centos镜像的nginx：\n\n首先将nginx软件包放入物理机（虚拟机）中\n\n进去容器后，什么都没有，环境相当干净，所以各种命令需要自己安装\n\n使用yum provides 查看命令的软件包，并且进行安装，即可使用\n```\nyum provides ip/ifconfig/scp\nyum -y install iproute   //ip\nyum -y install net-tools //ifconfig\nyum -y install openssh-clients  //scp\n```\n准备nginx环境\n```\nyum -y install gcc gcc-c++ pcre-devel zlib-devel openssl-devel make\n```\n查看容器的IP地址\n\n![upload successful](/images/pasted-20.png)\n\n退出容器：exit\n \n查看本地ip，docker网卡\n\n![upload successful](/images/pasted-21.png)\n\n方法一：在容器中，将物理机的软件包拷贝到容器中\n\n![upload successful](/images/pasted-22.png)\n\n方法二：在物理机中，3a9f...0c4为容器的id，也可以使用容器名（--name指定的名称）\n\n![upload successful](/images/pasted-23.png)\n\n \n###### 安装nginx\n```\ntar zxf nginx-1.12.0.tar.gz -C /usr/src\ncd /usr/src/nginx-1.12.0/\n./configure --prefix=/usr/local/nginx --user=nginx --group=ngixn --with-http_stub_status_module --with-pcre && make && make install\nuseradd nginx\nln -s /usr/local/nginx/sbin/nginx /usr/local/sbin/nginx\n/nginx\n```\n \n修改页面文件\n```\necho \"172.17.0.2\" > /usr/local/nginx/html/index.html\n```\n \n启动nginx\n\n![upload successful](/images/pasted-24.png)\n \n测试\n\n![upload successful](/images/pasted-25.png)\n \n为了后面做web集群时方便使用，可以将上面安装好命令与nginx的容器做一个镜像，方便后期使用。\n\n将配置好的容器制作成一个镜像\n\ndocker commit 容器id  镜像名称\n\n![upload successful](/images/pasted-26.png)\n \n将做好的镜像导出到本地（用于做备份）\n\n![upload successful](/images/pasted-27.png)\n \n模拟误删除镜像\n\n![upload successful](/images/pasted-28.png)\n\n将已导出的镜像tar包，再导入进来（这时发现删除的镜像又回来了）\n\n![upload successful](/images/pasted-29.png)\n \nWEB集群\n使用zu镜像做一个web2容器\n\n![upload successful](/images/pasted-30.png)\n\n![upload successful](/images/pasted-31.png)\n\n修改页面文件\n\n![upload successful](/images/pasted-32.png)\n\n启动nginx，并退出容器\n\n![upload successful](/images/pasted-33.png)\n\n使用zu镜像做一个web3容器\n\n![upload successful](/images/pasted-34.png)\n\n修改页面文件\n\n![upload successful](/images/pasted-35.png)\n\n启动nginx\n\n![upload successful](/images/pasted-36.png)\n\n![upload successful](/images/pasted-37.png)\n\n \n###### 本地部署nginx\n安装环境\n```\nyum -y install  pcre-devel zlib-devel openssl-devel\n```\n安装nginx\n```\ntar zxf nginx-1.12.0.tar.gz -C /usr/src/\ncd /usr/src/nginx-1.12.0/\n./configure --prefix=/usr/local/nginx --user=nginx --group=nginx --with-http_stub_status_module --with-pcre && make && make install\nuseradd nginx\nln -s /usr/local/nginx/sbin/nginx /usr/local/sbin/nginx\n```\n修改配置文件\nvim /usr/local/nginx/conf/nginx.conf\n\n![upload successful](/images/pasted-38.png)\n启动nginx\n\n![upload successful](/images/pasted-39.png)\n测试\n \n![upload successful](/images/pasted-40.png)\n\n","slug":"Docker部署nginx及web集群","published":1,"updated":"2020-09-10T09:47:12.176Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r7375000qm3pv0co8a370","content":"<p>在容器部署基于centos镜像的nginx：</p>\n<p>首先将nginx软件包放入物理机（虚拟机）中</p>\n<p>进去容器后，什么都没有，环境相当干净，所以各种命令需要自己安装</p>\n<p>使用yum provides 查看命令的软件包，并且进行安装，即可使用</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum provides ip<span class=\"regexp\">/ifconfig/</span>scp</span><br><span class=\"line\">yum -y install iproute   <span class=\"regexp\">//i</span>p</span><br><span class=\"line\">yum -y install net-tools <span class=\"regexp\">//i</span>fconfig</span><br><span class=\"line\">yum -y install openssh-clients  <span class=\"regexp\">//</span>scp</span><br></pre></td></tr></table></figure>\n<p>准备nginx环境</p>\n<figure class=\"highlight brainfuck\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">yum</span> <span class=\"literal\">-</span><span class=\"comment\">y</span> <span class=\"comment\">install</span> <span class=\"comment\">gcc</span> <span class=\"comment\">gcc</span><span class=\"literal\">-</span><span class=\"comment\">c</span>++ <span class=\"comment\">pcre</span><span class=\"literal\">-</span><span class=\"comment\">devel</span> <span class=\"comment\">zlib</span><span class=\"literal\">-</span><span class=\"comment\">devel</span> <span class=\"comment\">openssl</span><span class=\"literal\">-</span><span class=\"comment\">devel</span> <span class=\"comment\">make</span></span><br></pre></td></tr></table></figure>\n<p>查看容器的IP地址</p>\n<p><img src=\"/images/pasted-20.png\" alt=\"upload successful\"></p>\n<p>退出容器：exit</p>\n<p>查看本地ip，docker网卡</p>\n<p><img src=\"/images/pasted-21.png\" alt=\"upload successful\"></p>\n<p>方法一：在容器中，将物理机的软件包拷贝到容器中</p>\n<p><img src=\"/images/pasted-22.png\" alt=\"upload successful\"></p>\n<p>方法二：在物理机中，3a9f…0c4为容器的id，也可以使用容器名（–name指定的名称）</p>\n<p><img src=\"/images/pasted-23.png\" alt=\"upload successful\"></p>\n<h6 id=\"安装nginx\"><a href=\"#安装nginx\" class=\"headerlink\" title=\"安装nginx\"></a>安装nginx</h6><figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxf nginx-<span class=\"number\">1.12</span>.<span class=\"number\">0</span>.tar.gz -C <span class=\"regexp\">/usr/</span>src</span><br><span class=\"line\">cd <span class=\"regexp\">/usr/</span>src<span class=\"regexp\">/nginx-1.12.0/</span></span><br><span class=\"line\">.<span class=\"regexp\">/configure --prefix=/u</span>sr<span class=\"regexp\">/local/</span>nginx --user=nginx --<span class=\"keyword\">group</span>=ngixn --with-http_stub_status_module --with-pcre &amp;&amp; make &amp;&amp; make install</span><br><span class=\"line\">useradd nginx</span><br><span class=\"line\">ln -s <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/nginx/</span>sbin<span class=\"regexp\">/nginx /u</span>sr<span class=\"regexp\">/local/</span>sbin/nginx</span><br><span class=\"line\">/nginx</span><br></pre></td></tr></table></figure>\n\n<p>修改页面文件</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo <span class=\"string\">&quot;172.17.0.2&quot;</span> &gt; <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/nginx/</span>html/index.html</span><br></pre></td></tr></table></figure>\n\n<p>启动nginx</p>\n<p><img src=\"/images/pasted-24.png\" alt=\"upload successful\"></p>\n<p>测试</p>\n<p><img src=\"/images/pasted-25.png\" alt=\"upload successful\"></p>\n<p>为了后面做web集群时方便使用，可以将上面安装好命令与nginx的容器做一个镜像，方便后期使用。</p>\n<p>将配置好的容器制作成一个镜像</p>\n<p>docker commit 容器id  镜像名称</p>\n<p><img src=\"/images/pasted-26.png\" alt=\"upload successful\"></p>\n<p>将做好的镜像导出到本地（用于做备份）</p>\n<p><img src=\"/images/pasted-27.png\" alt=\"upload successful\"></p>\n<p>模拟误删除镜像</p>\n<p><img src=\"/images/pasted-28.png\" alt=\"upload successful\"></p>\n<p>将已导出的镜像tar包，再导入进来（这时发现删除的镜像又回来了）</p>\n<p><img src=\"/images/pasted-29.png\" alt=\"upload successful\"></p>\n<p>WEB集群<br>使用zu镜像做一个web2容器</p>\n<p><img src=\"/images/pasted-30.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-31.png\" alt=\"upload successful\"></p>\n<p>修改页面文件</p>\n<p><img src=\"/images/pasted-32.png\" alt=\"upload successful\"></p>\n<p>启动nginx，并退出容器</p>\n<p><img src=\"/images/pasted-33.png\" alt=\"upload successful\"></p>\n<p>使用zu镜像做一个web3容器</p>\n<p><img src=\"/images/pasted-34.png\" alt=\"upload successful\"></p>\n<p>修改页面文件</p>\n<p><img src=\"/images/pasted-35.png\" alt=\"upload successful\"></p>\n<p>启动nginx</p>\n<p><img src=\"/images/pasted-36.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-37.png\" alt=\"upload successful\"></p>\n<h6 id=\"本地部署nginx\"><a href=\"#本地部署nginx\" class=\"headerlink\" title=\"本地部署nginx\"></a>本地部署nginx</h6><p>安装环境</p>\n<figure class=\"highlight cmake\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y <span class=\"keyword\">install</span>  pcre-devel zlib-devel openssl-devel</span><br></pre></td></tr></table></figure>\n<p>安装nginx</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxf nginx-<span class=\"number\">1.12</span>.<span class=\"number\">0</span>.tar.gz -C <span class=\"regexp\">/usr/</span>src/</span><br><span class=\"line\">cd <span class=\"regexp\">/usr/</span>src<span class=\"regexp\">/nginx-1.12.0/</span></span><br><span class=\"line\">.<span class=\"regexp\">/configure --prefix=/u</span>sr<span class=\"regexp\">/local/</span>nginx --user=nginx --<span class=\"keyword\">group</span>=nginx --with-http_stub_status_module --with-pcre &amp;&amp; make &amp;&amp; make install</span><br><span class=\"line\">useradd nginx</span><br><span class=\"line\">ln -s <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/nginx/</span>sbin<span class=\"regexp\">/nginx /u</span>sr<span class=\"regexp\">/local/</span>sbin/nginx</span><br></pre></td></tr></table></figure>\n<p>修改配置文件<br>vim /usr/local/nginx/conf/nginx.conf</p>\n<p><img src=\"/images/pasted-38.png\" alt=\"upload successful\"><br>启动nginx</p>\n<p><img src=\"/images/pasted-39.png\" alt=\"upload successful\"><br>测试</p>\n<p><img src=\"/images/pasted-40.png\" alt=\"upload successful\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>在容器部署基于centos镜像的nginx：</p>\n<p>首先将nginx软件包放入物理机（虚拟机）中</p>\n<p>进去容器后，什么都没有，环境相当干净，所以各种命令需要自己安装</p>\n<p>使用yum provides 查看命令的软件包，并且进行安装，即可使用</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum provides ip<span class=\"regexp\">/ifconfig/</span>scp</span><br><span class=\"line\">yum -y install iproute   <span class=\"regexp\">//i</span>p</span><br><span class=\"line\">yum -y install net-tools <span class=\"regexp\">//i</span>fconfig</span><br><span class=\"line\">yum -y install openssh-clients  <span class=\"regexp\">//</span>scp</span><br></pre></td></tr></table></figure>\n<p>准备nginx环境</p>\n<figure class=\"highlight brainfuck\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">yum</span> <span class=\"literal\">-</span><span class=\"comment\">y</span> <span class=\"comment\">install</span> <span class=\"comment\">gcc</span> <span class=\"comment\">gcc</span><span class=\"literal\">-</span><span class=\"comment\">c</span>++ <span class=\"comment\">pcre</span><span class=\"literal\">-</span><span class=\"comment\">devel</span> <span class=\"comment\">zlib</span><span class=\"literal\">-</span><span class=\"comment\">devel</span> <span class=\"comment\">openssl</span><span class=\"literal\">-</span><span class=\"comment\">devel</span> <span class=\"comment\">make</span></span><br></pre></td></tr></table></figure>\n<p>查看容器的IP地址</p>\n<p><img src=\"/images/pasted-20.png\" alt=\"upload successful\"></p>\n<p>退出容器：exit</p>\n<p>查看本地ip，docker网卡</p>\n<p><img src=\"/images/pasted-21.png\" alt=\"upload successful\"></p>\n<p>方法一：在容器中，将物理机的软件包拷贝到容器中</p>\n<p><img src=\"/images/pasted-22.png\" alt=\"upload successful\"></p>\n<p>方法二：在物理机中，3a9f…0c4为容器的id，也可以使用容器名（–name指定的名称）</p>\n<p><img src=\"/images/pasted-23.png\" alt=\"upload successful\"></p>\n<h6 id=\"安装nginx\"><a href=\"#安装nginx\" class=\"headerlink\" title=\"安装nginx\"></a>安装nginx</h6><figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxf nginx-<span class=\"number\">1.12</span>.<span class=\"number\">0</span>.tar.gz -C <span class=\"regexp\">/usr/</span>src</span><br><span class=\"line\">cd <span class=\"regexp\">/usr/</span>src<span class=\"regexp\">/nginx-1.12.0/</span></span><br><span class=\"line\">.<span class=\"regexp\">/configure --prefix=/u</span>sr<span class=\"regexp\">/local/</span>nginx --user=nginx --<span class=\"keyword\">group</span>=ngixn --with-http_stub_status_module --with-pcre &amp;&amp; make &amp;&amp; make install</span><br><span class=\"line\">useradd nginx</span><br><span class=\"line\">ln -s <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/nginx/</span>sbin<span class=\"regexp\">/nginx /u</span>sr<span class=\"regexp\">/local/</span>sbin/nginx</span><br><span class=\"line\">/nginx</span><br></pre></td></tr></table></figure>\n\n<p>修改页面文件</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo <span class=\"string\">&quot;172.17.0.2&quot;</span> &gt; <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/nginx/</span>html/index.html</span><br></pre></td></tr></table></figure>\n\n<p>启动nginx</p>\n<p><img src=\"/images/pasted-24.png\" alt=\"upload successful\"></p>\n<p>测试</p>\n<p><img src=\"/images/pasted-25.png\" alt=\"upload successful\"></p>\n<p>为了后面做web集群时方便使用，可以将上面安装好命令与nginx的容器做一个镜像，方便后期使用。</p>\n<p>将配置好的容器制作成一个镜像</p>\n<p>docker commit 容器id  镜像名称</p>\n<p><img src=\"/images/pasted-26.png\" alt=\"upload successful\"></p>\n<p>将做好的镜像导出到本地（用于做备份）</p>\n<p><img src=\"/images/pasted-27.png\" alt=\"upload successful\"></p>\n<p>模拟误删除镜像</p>\n<p><img src=\"/images/pasted-28.png\" alt=\"upload successful\"></p>\n<p>将已导出的镜像tar包，再导入进来（这时发现删除的镜像又回来了）</p>\n<p><img src=\"/images/pasted-29.png\" alt=\"upload successful\"></p>\n<p>WEB集群<br>使用zu镜像做一个web2容器</p>\n<p><img src=\"/images/pasted-30.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-31.png\" alt=\"upload successful\"></p>\n<p>修改页面文件</p>\n<p><img src=\"/images/pasted-32.png\" alt=\"upload successful\"></p>\n<p>启动nginx，并退出容器</p>\n<p><img src=\"/images/pasted-33.png\" alt=\"upload successful\"></p>\n<p>使用zu镜像做一个web3容器</p>\n<p><img src=\"/images/pasted-34.png\" alt=\"upload successful\"></p>\n<p>修改页面文件</p>\n<p><img src=\"/images/pasted-35.png\" alt=\"upload successful\"></p>\n<p>启动nginx</p>\n<p><img src=\"/images/pasted-36.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-37.png\" alt=\"upload successful\"></p>\n<h6 id=\"本地部署nginx\"><a href=\"#本地部署nginx\" class=\"headerlink\" title=\"本地部署nginx\"></a>本地部署nginx</h6><p>安装环境</p>\n<figure class=\"highlight cmake\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y <span class=\"keyword\">install</span>  pcre-devel zlib-devel openssl-devel</span><br></pre></td></tr></table></figure>\n<p>安装nginx</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxf nginx-<span class=\"number\">1.12</span>.<span class=\"number\">0</span>.tar.gz -C <span class=\"regexp\">/usr/</span>src/</span><br><span class=\"line\">cd <span class=\"regexp\">/usr/</span>src<span class=\"regexp\">/nginx-1.12.0/</span></span><br><span class=\"line\">.<span class=\"regexp\">/configure --prefix=/u</span>sr<span class=\"regexp\">/local/</span>nginx --user=nginx --<span class=\"keyword\">group</span>=nginx --with-http_stub_status_module --with-pcre &amp;&amp; make &amp;&amp; make install</span><br><span class=\"line\">useradd nginx</span><br><span class=\"line\">ln -s <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/nginx/</span>sbin<span class=\"regexp\">/nginx /u</span>sr<span class=\"regexp\">/local/</span>sbin/nginx</span><br></pre></td></tr></table></figure>\n<p>修改配置文件<br>vim /usr/local/nginx/conf/nginx.conf</p>\n<p><img src=\"/images/pasted-38.png\" alt=\"upload successful\"><br>启动nginx</p>\n<p><img src=\"/images/pasted-39.png\" alt=\"upload successful\"><br>测试</p>\n<p><img src=\"/images/pasted-40.png\" alt=\"upload successful\"></p>\n"},{"title":"HTTP方式共享YUM软件仓库","author":"Semaik.","date":"2020-10-13T07:04:00.000Z","_content":"##### 两台机器\n| IP \t\t| 备注 \t |\n| -- \t\t| \t----\t| \n| 1.1.1.5\t|\tYUM仓库|\n| 1.1.1.3\t|\t测试机器|\n\n**1.1.1.5通过apache镜像目录共享**\n```java\n[root@localhost ~]# yum install -y httpd\n```\n在/var/www/html下面创建centos目录\n\n```java\n[root@localhost ~]# mkdir /var/www/html/centos\n```\n\n挂载镜像到/var/www/html/aaa下\n```java\n[root@localhost ~]# mount CentOS-7-x86_64-DVD-1611.iso /var/www/html/centos/\n[root@localhost ~]# ls /var/www/html/centos/\nCentOS_BuildTag  EULA  images    LiveOS    repodata              RPM-GPG-KEY-CentOS-Testing-7\nEFI              GPL   isolinux  Packages  RPM-GPG-KEY-CentOS-7  TRANS.TBL\n```\n\n测试浏览器访问\n\n![upload successful](/images/pasted-99.png)\n\n在1.1.1.3配置yum\n```java\n[root@localhost ~]# vi /etc/yum.repos.d/yum.repo\n[yum]\nname=yum\nenabled=1\ngpgcheck=0\nbaseurl=http://1.1.1.5/centos                       \n```\n测试安装软件\n```java\n[root@localhost ~]# yum install vsftpd -y\n已加载插件：fastestmirror\nLoading mirror speeds from cached hostfile\n正在解决依赖关系\n......\n\n总下载量：169 k\n安装大小：348 k\nDownloading packages:\nvsftpd-3.0.2-22.el7.x86_64.rpm | 169 kB 00:00:00\nRunning transaction check\nRunning transaction test\nTransaction test succeeded\nRunning transaction\n正在安装 : vsftpd-3.0.2-22.el7.x86_64 1/1\n验证中 : vsftpd-3.0.2-22.el7.x86_64 1/1\n\n已安装:\nvsftpd.x86_64 0:3.0.2-22.el7\n\n完毕！\n```\n\n\n","source":"_posts/HTTP方式共享YUM软件仓库.md","raw":"title: HTTP方式共享YUM软件仓库\nauthor: Semaik.\ntags:\n  - Linux\ncategories:\n  - Linux\ndate: 2020-10-13 15:04:00\n---\n##### 两台机器\n| IP \t\t| 备注 \t |\n| -- \t\t| \t----\t| \n| 1.1.1.5\t|\tYUM仓库|\n| 1.1.1.3\t|\t测试机器|\n\n**1.1.1.5通过apache镜像目录共享**\n```java\n[root@localhost ~]# yum install -y httpd\n```\n在/var/www/html下面创建centos目录\n\n```java\n[root@localhost ~]# mkdir /var/www/html/centos\n```\n\n挂载镜像到/var/www/html/aaa下\n```java\n[root@localhost ~]# mount CentOS-7-x86_64-DVD-1611.iso /var/www/html/centos/\n[root@localhost ~]# ls /var/www/html/centos/\nCentOS_BuildTag  EULA  images    LiveOS    repodata              RPM-GPG-KEY-CentOS-Testing-7\nEFI              GPL   isolinux  Packages  RPM-GPG-KEY-CentOS-7  TRANS.TBL\n```\n\n测试浏览器访问\n\n![upload successful](/images/pasted-99.png)\n\n在1.1.1.3配置yum\n```java\n[root@localhost ~]# vi /etc/yum.repos.d/yum.repo\n[yum]\nname=yum\nenabled=1\ngpgcheck=0\nbaseurl=http://1.1.1.5/centos                       \n```\n测试安装软件\n```java\n[root@localhost ~]# yum install vsftpd -y\n已加载插件：fastestmirror\nLoading mirror speeds from cached hostfile\n正在解决依赖关系\n......\n\n总下载量：169 k\n安装大小：348 k\nDownloading packages:\nvsftpd-3.0.2-22.el7.x86_64.rpm | 169 kB 00:00:00\nRunning transaction check\nRunning transaction test\nTransaction test succeeded\nRunning transaction\n正在安装 : vsftpd-3.0.2-22.el7.x86_64 1/1\n验证中 : vsftpd-3.0.2-22.el7.x86_64 1/1\n\n已安装:\nvsftpd.x86_64 0:3.0.2-22.el7\n\n完毕！\n```\n\n\n","slug":"HTTP方式共享YUM软件仓库","published":1,"updated":"2020-10-13T07:28:04.042Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r7376000um3pv5s171mt6","content":"<h5 id=\"两台机器\"><a href=\"#两台机器\" class=\"headerlink\" title=\"两台机器\"></a>两台机器</h5><table>\n<thead>\n<tr>\n<th>IP</th>\n<th>备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1.1.1.5</td>\n<td>YUM仓库</td>\n</tr>\n<tr>\n<td>1.1.1.3</td>\n<td>测试机器</td>\n</tr>\n</tbody></table>\n<p><strong>1.1.1.5通过apache镜像目录共享</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# yum install -y httpd</span><br></pre></td></tr></table></figure>\n<p>在/var/www/html下面创建centos目录</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# mkdir /var/www/html/centos</span><br></pre></td></tr></table></figure>\n\n<p>挂载镜像到/var/www/html/aaa下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# mount CentOS-7-x86_64-DVD-1611.iso /var/www/html/centos/</span><br><span class=\"line\">[root@localhost ~]# ls /var/www/html/centos/</span><br><span class=\"line\">CentOS_BuildTag  EULA  images    LiveOS    repodata              RPM-GPG-KEY-CentOS-Testing-<span class=\"number\">7</span></span><br><span class=\"line\">EFI              GPL   isolinux  Packages  RPM-GPG-KEY-CentOS-<span class=\"number\">7</span>  TRANS.TBL</span><br></pre></td></tr></table></figure>\n\n<p>测试浏览器访问</p>\n<p><img src=\"/images/pasted-99.png\" alt=\"upload successful\"></p>\n<p>在1.1.1.3配置yum</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# vi /etc/yum.repos.d/yum.repo</span><br><span class=\"line\">[yum]</span><br><span class=\"line\">name=yum</span><br><span class=\"line\">enabled=<span class=\"number\">1</span></span><br><span class=\"line\">gpgcheck=<span class=\"number\">0</span></span><br><span class=\"line\">baseurl=http:<span class=\"comment\">//1.1.1.5/centos                       </span></span><br></pre></td></tr></table></figure>\n<p>测试安装软件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# yum install vsftpd -y</span><br><span class=\"line\">已加载插件：fastestmirror</span><br><span class=\"line\">Loading mirror speeds from cached hostfile</span><br><span class=\"line\">正在解决依赖关系</span><br><span class=\"line\">......</span><br><span class=\"line\"></span><br><span class=\"line\">总下载量：<span class=\"number\">169</span> k</span><br><span class=\"line\">安装大小：<span class=\"number\">348</span> k</span><br><span class=\"line\">Downloading packages:</span><br><span class=\"line\">vsftpd-<span class=\"number\">3.0</span>.<span class=\"number\">2</span>-<span class=\"number\">22.</span>el7.x86_64.rpm | <span class=\"number\">169</span> kB <span class=\"number\">00</span>:<span class=\"number\">00</span>:<span class=\"number\">00</span></span><br><span class=\"line\">Running transaction check</span><br><span class=\"line\">Running transaction test</span><br><span class=\"line\">Transaction test succeeded</span><br><span class=\"line\">Running transaction</span><br><span class=\"line\">正在安装 : vsftpd-<span class=\"number\">3.0</span>.<span class=\"number\">2</span>-<span class=\"number\">22.</span>el7.x86_64 <span class=\"number\">1</span>/<span class=\"number\">1</span></span><br><span class=\"line\">验证中 : vsftpd-<span class=\"number\">3.0</span>.<span class=\"number\">2</span>-<span class=\"number\">22.</span>el7.x86_64 <span class=\"number\">1</span>/<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">已安装:</span><br><span class=\"line\">vsftpd.x86_64 <span class=\"number\">0</span>:<span class=\"number\">3.0</span>.<span class=\"number\">2</span>-<span class=\"number\">22.</span>el7</span><br><span class=\"line\"></span><br><span class=\"line\">完毕！</span><br></pre></td></tr></table></figure>\n\n\n","site":{"data":{}},"excerpt":"","more":"<h5 id=\"两台机器\"><a href=\"#两台机器\" class=\"headerlink\" title=\"两台机器\"></a>两台机器</h5><table>\n<thead>\n<tr>\n<th>IP</th>\n<th>备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1.1.1.5</td>\n<td>YUM仓库</td>\n</tr>\n<tr>\n<td>1.1.1.3</td>\n<td>测试机器</td>\n</tr>\n</tbody></table>\n<p><strong>1.1.1.5通过apache镜像目录共享</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# yum install -y httpd</span><br></pre></td></tr></table></figure>\n<p>在/var/www/html下面创建centos目录</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# mkdir /var/www/html/centos</span><br></pre></td></tr></table></figure>\n\n<p>挂载镜像到/var/www/html/aaa下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# mount CentOS-7-x86_64-DVD-1611.iso /var/www/html/centos/</span><br><span class=\"line\">[root@localhost ~]# ls /var/www/html/centos/</span><br><span class=\"line\">CentOS_BuildTag  EULA  images    LiveOS    repodata              RPM-GPG-KEY-CentOS-Testing-<span class=\"number\">7</span></span><br><span class=\"line\">EFI              GPL   isolinux  Packages  RPM-GPG-KEY-CentOS-<span class=\"number\">7</span>  TRANS.TBL</span><br></pre></td></tr></table></figure>\n\n<p>测试浏览器访问</p>\n<p><img src=\"/images/pasted-99.png\" alt=\"upload successful\"></p>\n<p>在1.1.1.3配置yum</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# vi /etc/yum.repos.d/yum.repo</span><br><span class=\"line\">[yum]</span><br><span class=\"line\">name=yum</span><br><span class=\"line\">enabled=<span class=\"number\">1</span></span><br><span class=\"line\">gpgcheck=<span class=\"number\">0</span></span><br><span class=\"line\">baseurl=http:<span class=\"comment\">//1.1.1.5/centos                       </span></span><br></pre></td></tr></table></figure>\n<p>测试安装软件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# yum install vsftpd -y</span><br><span class=\"line\">已加载插件：fastestmirror</span><br><span class=\"line\">Loading mirror speeds from cached hostfile</span><br><span class=\"line\">正在解决依赖关系</span><br><span class=\"line\">......</span><br><span class=\"line\"></span><br><span class=\"line\">总下载量：<span class=\"number\">169</span> k</span><br><span class=\"line\">安装大小：<span class=\"number\">348</span> k</span><br><span class=\"line\">Downloading packages:</span><br><span class=\"line\">vsftpd-<span class=\"number\">3.0</span>.<span class=\"number\">2</span>-<span class=\"number\">22.</span>el7.x86_64.rpm | <span class=\"number\">169</span> kB <span class=\"number\">00</span>:<span class=\"number\">00</span>:<span class=\"number\">00</span></span><br><span class=\"line\">Running transaction check</span><br><span class=\"line\">Running transaction test</span><br><span class=\"line\">Transaction test succeeded</span><br><span class=\"line\">Running transaction</span><br><span class=\"line\">正在安装 : vsftpd-<span class=\"number\">3.0</span>.<span class=\"number\">2</span>-<span class=\"number\">22.</span>el7.x86_64 <span class=\"number\">1</span>/<span class=\"number\">1</span></span><br><span class=\"line\">验证中 : vsftpd-<span class=\"number\">3.0</span>.<span class=\"number\">2</span>-<span class=\"number\">22.</span>el7.x86_64 <span class=\"number\">1</span>/<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">已安装:</span><br><span class=\"line\">vsftpd.x86_64 <span class=\"number\">0</span>:<span class=\"number\">3.0</span>.<span class=\"number\">2</span>-<span class=\"number\">22.</span>el7</span><br><span class=\"line\"></span><br><span class=\"line\">完毕！</span><br></pre></td></tr></table></figure>\n\n\n"},{"title":"Hexo如何发布文章","date":"2020-09-10T04:57:45.000Z","_content":"#### 输入以下命令：\n```java\n$ hexo new [layout] <title>\n```\n","source":"_posts/Hexo如何发布文章.md","raw":"---\ntitle: Hexo如何发布文章\ndate: 2020-09-10 12:57:45\ncategories: Hexo\ntags: \n    - Hexo\n---\n#### 输入以下命令：\n```java\n$ hexo new [layout] <title>\n```\n","slug":"Hexo如何发布文章","published":1,"updated":"2020-09-10T05:12:18.081Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r7377000wm3pv1t5e6u11","content":"<h4 id=\"输入以下命令：\"><a href=\"#输入以下命令：\" class=\"headerlink\" title=\"输入以下命令：\"></a>输入以下命令：</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo <span class=\"keyword\">new</span> [layout] &lt;title&gt;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h4 id=\"输入以下命令：\"><a href=\"#输入以下命令：\" class=\"headerlink\" title=\"输入以下命令：\"></a>输入以下命令：</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo <span class=\"keyword\">new</span> [layout] &lt;title&gt;</span><br></pre></td></tr></table></figure>\n"},{"title":"Hexo添加分类和标签","date":"2020-09-10T05:21:18.000Z","_content":"#### 1.创建\"分类\"选项\n生成“分类”页并添加tpye属性,进入博客目录。执行命令下方命令\n```java\n$ hexo new page categories\n```\ncategories文件夹下会有index.md这个文件，打开后默认内容是这样的：\n```java\n\n---\ntitle: categories\ndate: 2019-04-22 14:47:40\n---\n```\n添加type: \"categories\"到内容中，添加后是这样的：\n```java\n\n---\ntitle: 分类\ndate: 2019-04-24 15:30:30\ntype: categories\n---\n```\n保存并关闭文件。\n\n给文章添加“categories”属性\n\n打开需要添加分类的文章，为其添加categories属性。下方的categories:Hexo表示这篇文章添加到到“Hexo”这个分类。注意：一篇文章只会添加到一个分类中，如果是多个默认放到第一个分类中。\n```java\n---\ntitle: Hexo 添加分类及标签\ndate: 2017-05-26 12:12:57\ncategories: Hexo\n---\n```\n至此，成功给文章添加分类，点击首页的“分类”可以看到该分类下的所有文章。当然，只有添加了categories: xxx的文章才会被收录到首页的“分类”中。\n#### 2.创建\"标签\"选项\n生成“标签”页并添加tpye属性\n```java\n$ hexo new page tags\n```\n在tags文件夹下，找到index.md这个文件，打开后默认内容是这样的：\n```java\n---\ntitle: 标签\ndate: 2019-04-22 14:22:08\n---\n```\n添加type: \"tags\"到内容中，添加后是这样的：\n```java\n---\ntitle: 标签\ndate: 2019-04-24 15:40:24\ntype: tags\n---\n```\n保存并关闭文件。\n\n给文章添加“tags”属性,打开需要添加标签的文章，为其添加tags属性。\n```java\n---\ntitle: Hexo 添加分类及标签\ndate: 2019-04-24 15:40:24\ncategories: \n           - Hexo\ntags:\n           - 博客\n---\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/Hexo添加分类和标签.md","raw":"---\ntitle: Hexo添加分类和标签\ndate: 2020-09-10 13:21:18\ntags:\n    - Hexo\ncategories: Hexo\n---\n#### 1.创建\"分类\"选项\n生成“分类”页并添加tpye属性,进入博客目录。执行命令下方命令\n```java\n$ hexo new page categories\n```\ncategories文件夹下会有index.md这个文件，打开后默认内容是这样的：\n```java\n\n---\ntitle: categories\ndate: 2019-04-22 14:47:40\n---\n```\n添加type: \"categories\"到内容中，添加后是这样的：\n```java\n\n---\ntitle: 分类\ndate: 2019-04-24 15:30:30\ntype: categories\n---\n```\n保存并关闭文件。\n\n给文章添加“categories”属性\n\n打开需要添加分类的文章，为其添加categories属性。下方的categories:Hexo表示这篇文章添加到到“Hexo”这个分类。注意：一篇文章只会添加到一个分类中，如果是多个默认放到第一个分类中。\n```java\n---\ntitle: Hexo 添加分类及标签\ndate: 2017-05-26 12:12:57\ncategories: Hexo\n---\n```\n至此，成功给文章添加分类，点击首页的“分类”可以看到该分类下的所有文章。当然，只有添加了categories: xxx的文章才会被收录到首页的“分类”中。\n#### 2.创建\"标签\"选项\n生成“标签”页并添加tpye属性\n```java\n$ hexo new page tags\n```\n在tags文件夹下，找到index.md这个文件，打开后默认内容是这样的：\n```java\n---\ntitle: 标签\ndate: 2019-04-22 14:22:08\n---\n```\n添加type: \"tags\"到内容中，添加后是这样的：\n```java\n---\ntitle: 标签\ndate: 2019-04-24 15:40:24\ntype: tags\n---\n```\n保存并关闭文件。\n\n给文章添加“tags”属性,打开需要添加标签的文章，为其添加tags属性。\n```java\n---\ntitle: Hexo 添加分类及标签\ndate: 2019-04-24 15:40:24\ncategories: \n           - Hexo\ntags:\n           - 博客\n---\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"Hexo添加分类和标签","published":1,"updated":"2020-09-10T05:26:57.702Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r73780011m3pv5i111tpq","content":"<h4 id=\"1-创建”分类”选项\"><a href=\"#1-创建”分类”选项\" class=\"headerlink\" title=\"1.创建”分类”选项\"></a>1.创建”分类”选项</h4><p>生成“分类”页并添加tpye属性,进入博客目录。执行命令下方命令</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo <span class=\"keyword\">new</span> page categories</span><br></pre></td></tr></table></figure>\n<p>categories文件夹下会有index.md这个文件，打开后默认内容是这样的：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">title: categories</span><br><span class=\"line\">date: <span class=\"number\">2019</span>-<span class=\"number\">04</span>-<span class=\"number\">22</span> <span class=\"number\">14</span>:<span class=\"number\">47</span>:<span class=\"number\">40</span></span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure>\n<p>添加type: “categories”到内容中，添加后是这样的：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">title: 分类</span><br><span class=\"line\">date: <span class=\"number\">2019</span>-<span class=\"number\">04</span>-<span class=\"number\">24</span> <span class=\"number\">15</span>:<span class=\"number\">30</span>:<span class=\"number\">30</span></span><br><span class=\"line\">type: categories</span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure>\n<p>保存并关闭文件。</p>\n<p>给文章添加“categories”属性</p>\n<p>打开需要添加分类的文章，为其添加categories属性。下方的categories:Hexo表示这篇文章添加到到“Hexo”这个分类。注意：一篇文章只会添加到一个分类中，如果是多个默认放到第一个分类中。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: Hexo 添加分类及标签</span><br><span class=\"line\">date: <span class=\"number\">2017</span>-<span class=\"number\">05</span>-<span class=\"number\">26</span> <span class=\"number\">12</span>:<span class=\"number\">12</span>:<span class=\"number\">57</span></span><br><span class=\"line\">categories: Hexo</span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure>\n<p>至此，成功给文章添加分类，点击首页的“分类”可以看到该分类下的所有文章。当然，只有添加了categories: xxx的文章才会被收录到首页的“分类”中。</p>\n<h4 id=\"2-创建”标签”选项\"><a href=\"#2-创建”标签”选项\" class=\"headerlink\" title=\"2.创建”标签”选项\"></a>2.创建”标签”选项</h4><p>生成“标签”页并添加tpye属性</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo <span class=\"keyword\">new</span> page tags</span><br></pre></td></tr></table></figure>\n<p>在tags文件夹下，找到index.md这个文件，打开后默认内容是这样的：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: 标签</span><br><span class=\"line\">date: <span class=\"number\">2019</span>-<span class=\"number\">04</span>-<span class=\"number\">22</span> <span class=\"number\">14</span>:<span class=\"number\">22</span>:<span class=\"number\">08</span></span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure>\n<p>添加type: “tags”到内容中，添加后是这样的：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: 标签</span><br><span class=\"line\">date: <span class=\"number\">2019</span>-<span class=\"number\">04</span>-<span class=\"number\">24</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">24</span></span><br><span class=\"line\">type: tags</span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure>\n<p>保存并关闭文件。</p>\n<p>给文章添加“tags”属性,打开需要添加标签的文章，为其添加tags属性。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: Hexo 添加分类及标签</span><br><span class=\"line\">date: <span class=\"number\">2019</span>-<span class=\"number\">04</span>-<span class=\"number\">24</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">24</span></span><br><span class=\"line\">categories: </span><br><span class=\"line\">           - Hexo</span><br><span class=\"line\">tags:</span><br><span class=\"line\">           - 博客</span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n\n\n\n\n","site":{"data":{}},"excerpt":"","more":"<h4 id=\"1-创建”分类”选项\"><a href=\"#1-创建”分类”选项\" class=\"headerlink\" title=\"1.创建”分类”选项\"></a>1.创建”分类”选项</h4><p>生成“分类”页并添加tpye属性,进入博客目录。执行命令下方命令</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo <span class=\"keyword\">new</span> page categories</span><br></pre></td></tr></table></figure>\n<p>categories文件夹下会有index.md这个文件，打开后默认内容是这样的：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">title: categories</span><br><span class=\"line\">date: <span class=\"number\">2019</span>-<span class=\"number\">04</span>-<span class=\"number\">22</span> <span class=\"number\">14</span>:<span class=\"number\">47</span>:<span class=\"number\">40</span></span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure>\n<p>添加type: “categories”到内容中，添加后是这样的：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">title: 分类</span><br><span class=\"line\">date: <span class=\"number\">2019</span>-<span class=\"number\">04</span>-<span class=\"number\">24</span> <span class=\"number\">15</span>:<span class=\"number\">30</span>:<span class=\"number\">30</span></span><br><span class=\"line\">type: categories</span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure>\n<p>保存并关闭文件。</p>\n<p>给文章添加“categories”属性</p>\n<p>打开需要添加分类的文章，为其添加categories属性。下方的categories:Hexo表示这篇文章添加到到“Hexo”这个分类。注意：一篇文章只会添加到一个分类中，如果是多个默认放到第一个分类中。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: Hexo 添加分类及标签</span><br><span class=\"line\">date: <span class=\"number\">2017</span>-<span class=\"number\">05</span>-<span class=\"number\">26</span> <span class=\"number\">12</span>:<span class=\"number\">12</span>:<span class=\"number\">57</span></span><br><span class=\"line\">categories: Hexo</span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure>\n<p>至此，成功给文章添加分类，点击首页的“分类”可以看到该分类下的所有文章。当然，只有添加了categories: xxx的文章才会被收录到首页的“分类”中。</p>\n<h4 id=\"2-创建”标签”选项\"><a href=\"#2-创建”标签”选项\" class=\"headerlink\" title=\"2.创建”标签”选项\"></a>2.创建”标签”选项</h4><p>生成“标签”页并添加tpye属性</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo <span class=\"keyword\">new</span> page tags</span><br></pre></td></tr></table></figure>\n<p>在tags文件夹下，找到index.md这个文件，打开后默认内容是这样的：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: 标签</span><br><span class=\"line\">date: <span class=\"number\">2019</span>-<span class=\"number\">04</span>-<span class=\"number\">22</span> <span class=\"number\">14</span>:<span class=\"number\">22</span>:<span class=\"number\">08</span></span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure>\n<p>添加type: “tags”到内容中，添加后是这样的：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: 标签</span><br><span class=\"line\">date: <span class=\"number\">2019</span>-<span class=\"number\">04</span>-<span class=\"number\">24</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">24</span></span><br><span class=\"line\">type: tags</span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure>\n<p>保存并关闭文件。</p>\n<p>给文章添加“tags”属性,打开需要添加标签的文章，为其添加tags属性。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: Hexo 添加分类及标签</span><br><span class=\"line\">date: <span class=\"number\">2019</span>-<span class=\"number\">04</span>-<span class=\"number\">24</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">24</span></span><br><span class=\"line\">categories: </span><br><span class=\"line\">           - Hexo</span><br><span class=\"line\">tags:</span><br><span class=\"line\">           - 博客</span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"title":"Keepalived","author":"Semaik.","date":"2020-11-03T07:49:00.000Z","_content":"Keepalived：最初给LVS负载均衡集群中的服务节点提供健康检查功能，后来因为集成了VRRP协议，可以实现解决服务节点的单点故障，提高服务的可靠性，支持高可用集群的部署\n\nVRRP协议\n\nVRRP（虚拟路由冗余协议）：由多台物理路由器组成一台高性能的虚拟路由器，多个物理路由器之间通过优先级举出主节点，其它节点为从节点，从节点不工作只接收主节点发来的VRRP通告，主节点管理虚拟IP并对外提供服务，主节点定时给从节点发送VRRP通告，通告中包含着主节点的优先级，当从节点在计时器的时间到了之后接收不到主机点发送的VRRP通告时，就认为主节点不可用，此时，从节点就会根据优先级选举出新的主节点并接管虚拟IP对外提供服务，这个切换过程对于客户端来说是透明的，这样解决了单点故障，保证了服务的可用性\n\n\n无故ARP（免费ARP）：特点是arp广播包中源IP目的IP源MAC目的MAC都是发送方的，也就是都是虚拟IP和虚拟MAC，\n\n作用：\n\n1.可以检测是否有地址冲突\n\n2.可以更新终端设备的ARP缓存表\n\n##### 实验环境：\n\n\n| 系统 | IP | 服务 |\n| :-----:| :----: | :----: |\n| Centos7.4 | 1.1.1.1 | keepalived主 |\n| Centos7.4 | 1.1.1.2 | keepalived备 |\n| Centos7.4 | 1.1.1.3 | Nginx |\n| Centos7.4 | 1.1.1.4 | Nginx |\n| * | 1.1.1.111 | VIP|\n| Centos7.4\t|\t1.1.1.10\t|\tClient\t|\n\n##### 配置keepalived主\n###### 使用yum安装keepalived服务\n```java\n# yum -y install keepalived\n```\n###### 修改配置文件\n```java\nvim /etc/keepalived/keepalived.conf\nglobal_defs {\t\t\t//默认全局配置\n   notification_email {\t\t//指定该keepalived节点故障时接收邮件的收信人\n     acassen@firewall.loc\t\n     failover@firewall.loc\t\n     sysadmin@firewall.loc\t\n   }\n   notification_email_from Alexandre.Cassen@firewall.loc\t\t//keepalived故障时发送邮件的发信人\n   smtp_server 192.168.200.1\t\t//指定邮件服务器的IP，stmp简单邮件传输协议，使用端口25\n   smtp_connect_timeout 30\t\t//与邮件服务器的连接超时时间，单位s，可以自定义\n   router_id master\t\t//该节点的唯一表示，用于发邮件时表示该节点，可以是主机名，也可以是自己指定的名字\n}\n\nvrrp_instance VI_1 {\t\t//定义一个VRRP实例，处于同一个组中的节点使用的实例名字应该一致，默认使用名字VI_1\n    state MASTER\t\t//该节点的状态，MASTER为主，BACKUP为备，必须大写，但是只是用来标识节点状态，节点主备是由优先级决定的\n    interface ens33\t\t//指定主节点从那块网卡发送VRRP通告\n    virtual_router_id 51\t\t//指定该实例所属的虚拟路由组的id，属于同一个组的节点使用的id应该相同，id取值范围为0-255\n    priority 100\t\t//指定该节点的优先级，属于同一个组的节点优先级最高为主节点，取值范围为1-255，配置超过取值范围的值都默认视为100\n添加：nopreempt\t\t//将该节点设置为非抢占模式\n    advert_int 1\t\t//主节点每隔1s发送一次VRRP通告，时间可以自定义\n    authentication {\t\t//配置主备节点之间的认证方式以及密码\n        auth_type PASS\t\t//认证类型，主备必须一致，有PASS和HA两种，PASS密码是明文的，HA是密文的\n        auth_pass 1111\t\t//认证密钥，主备必须一致，只识别前八位\n    }\n    virtual_ipaddress {\t\t//配置虚拟IP，只有主节点才会拥有该地址，只能通过ip add查看，ifconfig是查看不到的\n        1.1.1.111/8\t\t//与物理机IP同网段\n    }\n}\n\nvirtual_server 1.1.1.111 80 {\t\t//指定LVS集群使用的虚拟IP以及端口\n    delay_loop 6\t\t//指定对服务节点进行健康检查的间隔时间\n    lb_algo rr \t\t//该集群的使用的调度算法\n    lb_kind DR\t\t//该集群的调度模式\n    persistence_timeout 0\t\t//服务节点的连接时间，0表示为短链接\n    protocol TCP\t\t//集群中节点之间通过TCP协议通信\n    netmask 255.0.0.0\t//VIP掩码\n\n\treal_server 1.1.1.3 80 {\t\t//向集群中添加服务节点\n   \tweight 1\t\t//设置节点的权重，默认为1，如果权重为0则表示该节点不可用\n\t   TCP_CHECK {\t//启用TCP健康检查\n            connect_timeout 1\t\t//对服务节点做健康检查的连接超时时间，1s可以自定义\n            nb_get_retry 3\t\t//所健康检查的重试次数，可自定义\n            delay_before_retry 1\t\t//每次健康检查之间间隔时间，可自定义\n            connect_port 80\t\t//针对哪个端口进行TCP检查\n            }\n\t }\n\treal_server 1.1.1.4 80 {\t\t\n   \tweight 1\n\t   TCP_CHECK {\n            connect_timeout 3\t\n            nb_get_retry 3\t\n            delay_before_retry 3\n            connect_port 80\n            }\n     }\n}\n```\n###### 将配置文件拷贝给keepalived备\n```java\n# scp /etc/keepalived/keepalived.conf root@1.1.1.2:/etc/keepalived/keepalived.conf\n```\n###### 修改备的配置文件\n```java\n# vi /etc/keepalived/keepalived.conf\nrouter_id backup\nstate BACKUP\npriority 90\n```\n###### 启动主从的keepalived服务\n```java\n# systemctl restart keepalived\n```\n###### 配置Nginx（两台同样步骤）\n```java\n# 配置虚拟IP\n# cd /etc/sysconfig/network-scripts/\n# cp ifcfg-lo ifcfg-lo:1\n# vi ifcfg-lo:1\nDEVICE=lo:1\nIPADDR=1.1.1.111\t//虚拟IP\nNETMASK=255.255.255.255\nNAME=lo:1\n# 多余的删除\n```\n> 可以通过ifconfig命令来配置不过是临时IP重启失效\n\n>ifconfig lo:1 1.1.1.111 netmask 255.255.255.255\n###### 重启网卡\n```java\nsystemctl restart network\n```\n###### 修改系统内核文件\n```java\n# vim /etc/sysctl.conf\nnet.ipv4.conf.lo.arp_ignore=1\nnet.ipv4.conf.default.arp_ignore=1\t\nnet.ipv4.conf.all.arp_ignore=1\nnet.ipv4.conf.lo.arp_announce=2\nnet.ipv4.conf.default.arp_announce=2\nnet.ipv4.conf.all.arp_announce=2\n# sysctl -p\n```\n###### 修改web首页文件（第二台web改成NO.2）\n```java\n# echo \"Wecom to nginx NO.1\" > /usr/local/nginx/html/index.html\n```\n###### 放行防护墙\n```java\n# firewall-cmd --add-port=80/tcp --permanent\n# firewall-cmd --add-service=nginx --permanent\n# firewall-cmd --reload\n# setenforce 0\n```\n###### 客户端验证\n```java\n# curl 1.1.1.111\nwecom to nginx NO.1\n```","source":"_posts/Keepalived.md","raw":"title: Keepalived\nauthor: Semaik.\ntags:\n  - Linux\ncategories: []\ndate: 2020-11-03 15:49:00\n---\nKeepalived：最初给LVS负载均衡集群中的服务节点提供健康检查功能，后来因为集成了VRRP协议，可以实现解决服务节点的单点故障，提高服务的可靠性，支持高可用集群的部署\n\nVRRP协议\n\nVRRP（虚拟路由冗余协议）：由多台物理路由器组成一台高性能的虚拟路由器，多个物理路由器之间通过优先级举出主节点，其它节点为从节点，从节点不工作只接收主节点发来的VRRP通告，主节点管理虚拟IP并对外提供服务，主节点定时给从节点发送VRRP通告，通告中包含着主节点的优先级，当从节点在计时器的时间到了之后接收不到主机点发送的VRRP通告时，就认为主节点不可用，此时，从节点就会根据优先级选举出新的主节点并接管虚拟IP对外提供服务，这个切换过程对于客户端来说是透明的，这样解决了单点故障，保证了服务的可用性\n\n\n无故ARP（免费ARP）：特点是arp广播包中源IP目的IP源MAC目的MAC都是发送方的，也就是都是虚拟IP和虚拟MAC，\n\n作用：\n\n1.可以检测是否有地址冲突\n\n2.可以更新终端设备的ARP缓存表\n\n##### 实验环境：\n\n\n| 系统 | IP | 服务 |\n| :-----:| :----: | :----: |\n| Centos7.4 | 1.1.1.1 | keepalived主 |\n| Centos7.4 | 1.1.1.2 | keepalived备 |\n| Centos7.4 | 1.1.1.3 | Nginx |\n| Centos7.4 | 1.1.1.4 | Nginx |\n| * | 1.1.1.111 | VIP|\n| Centos7.4\t|\t1.1.1.10\t|\tClient\t|\n\n##### 配置keepalived主\n###### 使用yum安装keepalived服务\n```java\n# yum -y install keepalived\n```\n###### 修改配置文件\n```java\nvim /etc/keepalived/keepalived.conf\nglobal_defs {\t\t\t//默认全局配置\n   notification_email {\t\t//指定该keepalived节点故障时接收邮件的收信人\n     acassen@firewall.loc\t\n     failover@firewall.loc\t\n     sysadmin@firewall.loc\t\n   }\n   notification_email_from Alexandre.Cassen@firewall.loc\t\t//keepalived故障时发送邮件的发信人\n   smtp_server 192.168.200.1\t\t//指定邮件服务器的IP，stmp简单邮件传输协议，使用端口25\n   smtp_connect_timeout 30\t\t//与邮件服务器的连接超时时间，单位s，可以自定义\n   router_id master\t\t//该节点的唯一表示，用于发邮件时表示该节点，可以是主机名，也可以是自己指定的名字\n}\n\nvrrp_instance VI_1 {\t\t//定义一个VRRP实例，处于同一个组中的节点使用的实例名字应该一致，默认使用名字VI_1\n    state MASTER\t\t//该节点的状态，MASTER为主，BACKUP为备，必须大写，但是只是用来标识节点状态，节点主备是由优先级决定的\n    interface ens33\t\t//指定主节点从那块网卡发送VRRP通告\n    virtual_router_id 51\t\t//指定该实例所属的虚拟路由组的id，属于同一个组的节点使用的id应该相同，id取值范围为0-255\n    priority 100\t\t//指定该节点的优先级，属于同一个组的节点优先级最高为主节点，取值范围为1-255，配置超过取值范围的值都默认视为100\n添加：nopreempt\t\t//将该节点设置为非抢占模式\n    advert_int 1\t\t//主节点每隔1s发送一次VRRP通告，时间可以自定义\n    authentication {\t\t//配置主备节点之间的认证方式以及密码\n        auth_type PASS\t\t//认证类型，主备必须一致，有PASS和HA两种，PASS密码是明文的，HA是密文的\n        auth_pass 1111\t\t//认证密钥，主备必须一致，只识别前八位\n    }\n    virtual_ipaddress {\t\t//配置虚拟IP，只有主节点才会拥有该地址，只能通过ip add查看，ifconfig是查看不到的\n        1.1.1.111/8\t\t//与物理机IP同网段\n    }\n}\n\nvirtual_server 1.1.1.111 80 {\t\t//指定LVS集群使用的虚拟IP以及端口\n    delay_loop 6\t\t//指定对服务节点进行健康检查的间隔时间\n    lb_algo rr \t\t//该集群的使用的调度算法\n    lb_kind DR\t\t//该集群的调度模式\n    persistence_timeout 0\t\t//服务节点的连接时间，0表示为短链接\n    protocol TCP\t\t//集群中节点之间通过TCP协议通信\n    netmask 255.0.0.0\t//VIP掩码\n\n\treal_server 1.1.1.3 80 {\t\t//向集群中添加服务节点\n   \tweight 1\t\t//设置节点的权重，默认为1，如果权重为0则表示该节点不可用\n\t   TCP_CHECK {\t//启用TCP健康检查\n            connect_timeout 1\t\t//对服务节点做健康检查的连接超时时间，1s可以自定义\n            nb_get_retry 3\t\t//所健康检查的重试次数，可自定义\n            delay_before_retry 1\t\t//每次健康检查之间间隔时间，可自定义\n            connect_port 80\t\t//针对哪个端口进行TCP检查\n            }\n\t }\n\treal_server 1.1.1.4 80 {\t\t\n   \tweight 1\n\t   TCP_CHECK {\n            connect_timeout 3\t\n            nb_get_retry 3\t\n            delay_before_retry 3\n            connect_port 80\n            }\n     }\n}\n```\n###### 将配置文件拷贝给keepalived备\n```java\n# scp /etc/keepalived/keepalived.conf root@1.1.1.2:/etc/keepalived/keepalived.conf\n```\n###### 修改备的配置文件\n```java\n# vi /etc/keepalived/keepalived.conf\nrouter_id backup\nstate BACKUP\npriority 90\n```\n###### 启动主从的keepalived服务\n```java\n# systemctl restart keepalived\n```\n###### 配置Nginx（两台同样步骤）\n```java\n# 配置虚拟IP\n# cd /etc/sysconfig/network-scripts/\n# cp ifcfg-lo ifcfg-lo:1\n# vi ifcfg-lo:1\nDEVICE=lo:1\nIPADDR=1.1.1.111\t//虚拟IP\nNETMASK=255.255.255.255\nNAME=lo:1\n# 多余的删除\n```\n> 可以通过ifconfig命令来配置不过是临时IP重启失效\n\n>ifconfig lo:1 1.1.1.111 netmask 255.255.255.255\n###### 重启网卡\n```java\nsystemctl restart network\n```\n###### 修改系统内核文件\n```java\n# vim /etc/sysctl.conf\nnet.ipv4.conf.lo.arp_ignore=1\nnet.ipv4.conf.default.arp_ignore=1\t\nnet.ipv4.conf.all.arp_ignore=1\nnet.ipv4.conf.lo.arp_announce=2\nnet.ipv4.conf.default.arp_announce=2\nnet.ipv4.conf.all.arp_announce=2\n# sysctl -p\n```\n###### 修改web首页文件（第二台web改成NO.2）\n```java\n# echo \"Wecom to nginx NO.1\" > /usr/local/nginx/html/index.html\n```\n###### 放行防护墙\n```java\n# firewall-cmd --add-port=80/tcp --permanent\n# firewall-cmd --add-service=nginx --permanent\n# firewall-cmd --reload\n# setenforce 0\n```\n###### 客户端验证\n```java\n# curl 1.1.1.111\nwecom to nginx NO.1\n```","slug":"Keepalived","published":1,"updated":"2020-11-04T01:58:37.148Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r73790013m3pv7gpx31om","content":"<p>Keepalived：最初给LVS负载均衡集群中的服务节点提供健康检查功能，后来因为集成了VRRP协议，可以实现解决服务节点的单点故障，提高服务的可靠性，支持高可用集群的部署</p>\n<p>VRRP协议</p>\n<p>VRRP（虚拟路由冗余协议）：由多台物理路由器组成一台高性能的虚拟路由器，多个物理路由器之间通过优先级举出主节点，其它节点为从节点，从节点不工作只接收主节点发来的VRRP通告，主节点管理虚拟IP并对外提供服务，主节点定时给从节点发送VRRP通告，通告中包含着主节点的优先级，当从节点在计时器的时间到了之后接收不到主机点发送的VRRP通告时，就认为主节点不可用，此时，从节点就会根据优先级选举出新的主节点并接管虚拟IP对外提供服务，这个切换过程对于客户端来说是透明的，这样解决了单点故障，保证了服务的可用性</p>\n<p>无故ARP（免费ARP）：特点是arp广播包中源IP目的IP源MAC目的MAC都是发送方的，也就是都是虚拟IP和虚拟MAC，</p>\n<p>作用：</p>\n<p>1.可以检测是否有地址冲突</p>\n<p>2.可以更新终端设备的ARP缓存表</p>\n<h5 id=\"实验环境：\"><a href=\"#实验环境：\" class=\"headerlink\" title=\"实验环境：\"></a>实验环境：</h5><table>\n<thead>\n<tr>\n<th align=\"center\">系统</th>\n<th align=\"center\">IP</th>\n<th align=\"center\">服务</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">Centos7.4</td>\n<td align=\"center\">1.1.1.1</td>\n<td align=\"center\">keepalived主</td>\n</tr>\n<tr>\n<td align=\"center\">Centos7.4</td>\n<td align=\"center\">1.1.1.2</td>\n<td align=\"center\">keepalived备</td>\n</tr>\n<tr>\n<td align=\"center\">Centos7.4</td>\n<td align=\"center\">1.1.1.3</td>\n<td align=\"center\">Nginx</td>\n</tr>\n<tr>\n<td align=\"center\">Centos7.4</td>\n<td align=\"center\">1.1.1.4</td>\n<td align=\"center\">Nginx</td>\n</tr>\n<tr>\n<td align=\"center\">*</td>\n<td align=\"center\">1.1.1.111</td>\n<td align=\"center\">VIP</td>\n</tr>\n<tr>\n<td align=\"center\">Centos7.4</td>\n<td align=\"center\">1.1.1.10</td>\n<td align=\"center\">Client</td>\n</tr>\n</tbody></table>\n<h5 id=\"配置keepalived主\"><a href=\"#配置keepalived主\" class=\"headerlink\" title=\"配置keepalived主\"></a>配置keepalived主</h5><h6 id=\"使用yum安装keepalived服务\"><a href=\"#使用yum安装keepalived服务\" class=\"headerlink\" title=\"使用yum安装keepalived服务\"></a>使用yum安装keepalived服务</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum -y install keepalived</span><br></pre></td></tr></table></figure>\n<h6 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/keepalived/keepalived.conf</span><br><span class=\"line\">global_defs &#123;\t\t\t<span class=\"comment\">//默认全局配置</span></span><br><span class=\"line\">   notification_email &#123;\t\t<span class=\"comment\">//指定该keepalived节点故障时接收邮件的收信人</span></span><br><span class=\"line\">     acassen<span class=\"meta\">@firewall</span>.loc\t</span><br><span class=\"line\">     failover<span class=\"meta\">@firewall</span>.loc\t</span><br><span class=\"line\">     sysadmin<span class=\"meta\">@firewall</span>.loc\t</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   notification_email_from Alexandre.Cassen<span class=\"meta\">@firewall</span>.loc\t\t<span class=\"comment\">//keepalived故障时发送邮件的发信人</span></span><br><span class=\"line\">   smtp_server <span class=\"number\">192.168</span>.<span class=\"number\">200.1</span>\t\t<span class=\"comment\">//指定邮件服务器的IP，stmp简单邮件传输协议，使用端口25</span></span><br><span class=\"line\">   smtp_connect_timeout <span class=\"number\">30</span>\t\t<span class=\"comment\">//与邮件服务器的连接超时时间，单位s，可以自定义</span></span><br><span class=\"line\">   router_id master\t\t<span class=\"comment\">//该节点的唯一表示，用于发邮件时表示该节点，可以是主机名，也可以是自己指定的名字</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">vrrp_instance VI_1 &#123;\t\t<span class=\"comment\">//定义一个VRRP实例，处于同一个组中的节点使用的实例名字应该一致，默认使用名字VI_1</span></span><br><span class=\"line\">    state MASTER\t\t<span class=\"comment\">//该节点的状态，MASTER为主，BACKUP为备，必须大写，但是只是用来标识节点状态，节点主备是由优先级决定的</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ens33</span>\t\t//指定主节点从那块网卡发送<span class=\"title\">VRRP</span>通告</span></span><br><span class=\"line\"><span class=\"class\">    <span class=\"title\">virtual_router_id</span> 51\t\t//指定该实例所属的虚拟路由组的<span class=\"title\">id</span>，属于同一个组的节点使用的<span class=\"title\">id</span>应该相同，<span class=\"title\">id</span>取值范围为0-255</span></span><br><span class=\"line\"><span class=\"class\">    <span class=\"title\">priority</span> 100\t\t//指定该节点的优先级，属于同一个组的节点优先级最高为主节点，取值范围为1-255，配置超过取值范围的值都默认视为100</span></span><br><span class=\"line\"><span class=\"class\">添加：<span class=\"title\">nopreempt</span>\t\t//将该节点设置为非抢占模式</span></span><br><span class=\"line\"><span class=\"class\">    <span class=\"title\">advert_int</span> 1\t\t//主节点每隔1<span class=\"title\">s</span>发送一次<span class=\"title\">VRRP</span>通告，时间可以自定义</span></span><br><span class=\"line\"><span class=\"class\">    <span class=\"title\">authentication</span> </span>&#123;\t\t<span class=\"comment\">//配置主备节点之间的认证方式以及密码</span></span><br><span class=\"line\">        auth_type PASS\t\t<span class=\"comment\">//认证类型，主备必须一致，有PASS和HA两种，PASS密码是明文的，HA是密文的</span></span><br><span class=\"line\">        auth_pass <span class=\"number\">1111</span>\t\t<span class=\"comment\">//认证密钥，主备必须一致，只识别前八位</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    virtual_ipaddress &#123;\t\t<span class=\"comment\">//配置虚拟IP，只有主节点才会拥有该地址，只能通过ip add查看，ifconfig是查看不到的</span></span><br><span class=\"line\">        <span class=\"number\">1.1</span>.<span class=\"number\">1.111</span>/<span class=\"number\">8</span>\t\t<span class=\"comment\">//与物理机IP同网段</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">virtual_server <span class=\"number\">1.1</span>.<span class=\"number\">1.111</span> <span class=\"number\">80</span> &#123;\t\t<span class=\"comment\">//指定LVS集群使用的虚拟IP以及端口</span></span><br><span class=\"line\">    delay_loop <span class=\"number\">6</span>\t\t<span class=\"comment\">//指定对服务节点进行健康检查的间隔时间</span></span><br><span class=\"line\">    lb_algo rr \t\t<span class=\"comment\">//该集群的使用的调度算法</span></span><br><span class=\"line\">    lb_kind DR\t\t<span class=\"comment\">//该集群的调度模式</span></span><br><span class=\"line\">    persistence_timeout <span class=\"number\">0</span>\t\t<span class=\"comment\">//服务节点的连接时间，0表示为短链接</span></span><br><span class=\"line\">    protocol TCP\t\t<span class=\"comment\">//集群中节点之间通过TCP协议通信</span></span><br><span class=\"line\">    netmask <span class=\"number\">255.0</span>.<span class=\"number\">0.0</span>\t<span class=\"comment\">//VIP掩码</span></span><br><span class=\"line\"></span><br><span class=\"line\">\treal_server <span class=\"number\">1.1</span>.<span class=\"number\">1.3</span> <span class=\"number\">80</span> &#123;\t\t<span class=\"comment\">//向集群中添加服务节点</span></span><br><span class=\"line\">   \tweight <span class=\"number\">1</span>\t\t<span class=\"comment\">//设置节点的权重，默认为1，如果权重为0则表示该节点不可用</span></span><br><span class=\"line\">\t   TCP_CHECK &#123;\t<span class=\"comment\">//启用TCP健康检查</span></span><br><span class=\"line\">            connect_timeout <span class=\"number\">1</span>\t\t<span class=\"comment\">//对服务节点做健康检查的连接超时时间，1s可以自定义</span></span><br><span class=\"line\">            nb_get_retry <span class=\"number\">3</span>\t\t<span class=\"comment\">//所健康检查的重试次数，可自定义</span></span><br><span class=\"line\">            delay_before_retry <span class=\"number\">1</span>\t\t<span class=\"comment\">//每次健康检查之间间隔时间，可自定义</span></span><br><span class=\"line\">            connect_port <span class=\"number\">80</span>\t\t<span class=\"comment\">//针对哪个端口进行TCP检查</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">\t &#125;</span><br><span class=\"line\">\treal_server <span class=\"number\">1.1</span>.<span class=\"number\">1.4</span> <span class=\"number\">80</span> &#123;\t\t</span><br><span class=\"line\">   \tweight <span class=\"number\">1</span></span><br><span class=\"line\">\t   TCP_CHECK &#123;</span><br><span class=\"line\">            connect_timeout <span class=\"number\">3</span>\t</span><br><span class=\"line\">            nb_get_retry <span class=\"number\">3</span>\t</span><br><span class=\"line\">            delay_before_retry <span class=\"number\">3</span></span><br><span class=\"line\">            connect_port <span class=\"number\">80</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"将配置文件拷贝给keepalived备\"><a href=\"#将配置文件拷贝给keepalived备\" class=\"headerlink\" title=\"将配置文件拷贝给keepalived备\"></a>将配置文件拷贝给keepalived备</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># scp /etc/keepalived/keepalived.conf root@1.1.1.2:/etc/keepalived/keepalived.conf</span><br></pre></td></tr></table></figure>\n<h6 id=\"修改备的配置文件\"><a href=\"#修改备的配置文件\" class=\"headerlink\" title=\"修改备的配置文件\"></a>修改备的配置文件</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vi /etc/keepalived/keepalived.conf</span><br><span class=\"line\">router_id backup</span><br><span class=\"line\">state BACKUP</span><br><span class=\"line\">priority <span class=\"number\">90</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"启动主从的keepalived服务\"><a href=\"#启动主从的keepalived服务\" class=\"headerlink\" title=\"启动主从的keepalived服务\"></a>启动主从的keepalived服务</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># systemctl restart keepalived</span><br></pre></td></tr></table></figure>\n<h6 id=\"配置Nginx（两台同样步骤）\"><a href=\"#配置Nginx（两台同样步骤）\" class=\"headerlink\" title=\"配置Nginx（两台同样步骤）\"></a>配置Nginx（两台同样步骤）</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 配置虚拟IP</span><br><span class=\"line\"># cd /etc/sysconfig/network-scripts/</span><br><span class=\"line\"># cp ifcfg-lo ifcfg-lo:1</span><br><span class=\"line\"># vi ifcfg-lo:1</span><br><span class=\"line\">DEVICE=lo:<span class=\"number\">1</span></span><br><span class=\"line\">IPADDR=<span class=\"number\">1.1</span>.<span class=\"number\">1.111</span>\t<span class=\"comment\">//虚拟IP</span></span><br><span class=\"line\">NETMASK=<span class=\"number\">255.255</span>.<span class=\"number\">255.255</span></span><br><span class=\"line\">NAME=lo:<span class=\"number\">1</span></span><br><span class=\"line\"># 多余的删除</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>可以通过ifconfig命令来配置不过是临时IP重启失效</p>\n</blockquote>\n<blockquote>\n<p>ifconfig lo:1 1.1.1.111 netmask 255.255.255.255</p>\n</blockquote>\n<h6 id=\"重启网卡\"><a href=\"#重启网卡\" class=\"headerlink\" title=\"重启网卡\"></a>重启网卡</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart network</span><br></pre></td></tr></table></figure>\n<h6 id=\"修改系统内核文件\"><a href=\"#修改系统内核文件\" class=\"headerlink\" title=\"修改系统内核文件\"></a>修改系统内核文件</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /etc/sysctl.conf</span><br><span class=\"line\">net.ipv4.conf.lo.arp_ignore=<span class=\"number\">1</span></span><br><span class=\"line\">net.ipv4.conf.<span class=\"keyword\">default</span>.arp_ignore=<span class=\"number\">1</span>\t</span><br><span class=\"line\">net.ipv4.conf.all.arp_ignore=<span class=\"number\">1</span></span><br><span class=\"line\">net.ipv4.conf.lo.arp_announce=<span class=\"number\">2</span></span><br><span class=\"line\">net.ipv4.conf.<span class=\"keyword\">default</span>.arp_announce=<span class=\"number\">2</span></span><br><span class=\"line\">net.ipv4.conf.all.arp_announce=<span class=\"number\">2</span></span><br><span class=\"line\"># sysctl -p</span><br></pre></td></tr></table></figure>\n<h6 id=\"修改web首页文件（第二台web改成NO-2）\"><a href=\"#修改web首页文件（第二台web改成NO-2）\" class=\"headerlink\" title=\"修改web首页文件（第二台web改成NO.2）\"></a>修改web首页文件（第二台web改成NO.2）</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># echo &quot;Wecom to nginx NO.1&quot; &gt; /usr/local/nginx/html/index.html</span><br></pre></td></tr></table></figure>\n<h6 id=\"放行防护墙\"><a href=\"#放行防护墙\" class=\"headerlink\" title=\"放行防护墙\"></a>放行防护墙</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># firewall-cmd --add-port=80/tcp --permanent</span><br><span class=\"line\"># firewall-cmd --add-service=nginx --permanent</span><br><span class=\"line\"># firewall-cmd --reload</span><br><span class=\"line\"># setenforce 0</span><br></pre></td></tr></table></figure>\n<h6 id=\"客户端验证\"><a href=\"#客户端验证\" class=\"headerlink\" title=\"客户端验证\"></a>客户端验证</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># curl 1.1.1.111</span><br><span class=\"line\">wecom to nginx NO.<span class=\"number\">1</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<p>Keepalived：最初给LVS负载均衡集群中的服务节点提供健康检查功能，后来因为集成了VRRP协议，可以实现解决服务节点的单点故障，提高服务的可靠性，支持高可用集群的部署</p>\n<p>VRRP协议</p>\n<p>VRRP（虚拟路由冗余协议）：由多台物理路由器组成一台高性能的虚拟路由器，多个物理路由器之间通过优先级举出主节点，其它节点为从节点，从节点不工作只接收主节点发来的VRRP通告，主节点管理虚拟IP并对外提供服务，主节点定时给从节点发送VRRP通告，通告中包含着主节点的优先级，当从节点在计时器的时间到了之后接收不到主机点发送的VRRP通告时，就认为主节点不可用，此时，从节点就会根据优先级选举出新的主节点并接管虚拟IP对外提供服务，这个切换过程对于客户端来说是透明的，这样解决了单点故障，保证了服务的可用性</p>\n<p>无故ARP（免费ARP）：特点是arp广播包中源IP目的IP源MAC目的MAC都是发送方的，也就是都是虚拟IP和虚拟MAC，</p>\n<p>作用：</p>\n<p>1.可以检测是否有地址冲突</p>\n<p>2.可以更新终端设备的ARP缓存表</p>\n<h5 id=\"实验环境：\"><a href=\"#实验环境：\" class=\"headerlink\" title=\"实验环境：\"></a>实验环境：</h5><table>\n<thead>\n<tr>\n<th align=\"center\">系统</th>\n<th align=\"center\">IP</th>\n<th align=\"center\">服务</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">Centos7.4</td>\n<td align=\"center\">1.1.1.1</td>\n<td align=\"center\">keepalived主</td>\n</tr>\n<tr>\n<td align=\"center\">Centos7.4</td>\n<td align=\"center\">1.1.1.2</td>\n<td align=\"center\">keepalived备</td>\n</tr>\n<tr>\n<td align=\"center\">Centos7.4</td>\n<td align=\"center\">1.1.1.3</td>\n<td align=\"center\">Nginx</td>\n</tr>\n<tr>\n<td align=\"center\">Centos7.4</td>\n<td align=\"center\">1.1.1.4</td>\n<td align=\"center\">Nginx</td>\n</tr>\n<tr>\n<td align=\"center\">*</td>\n<td align=\"center\">1.1.1.111</td>\n<td align=\"center\">VIP</td>\n</tr>\n<tr>\n<td align=\"center\">Centos7.4</td>\n<td align=\"center\">1.1.1.10</td>\n<td align=\"center\">Client</td>\n</tr>\n</tbody></table>\n<h5 id=\"配置keepalived主\"><a href=\"#配置keepalived主\" class=\"headerlink\" title=\"配置keepalived主\"></a>配置keepalived主</h5><h6 id=\"使用yum安装keepalived服务\"><a href=\"#使用yum安装keepalived服务\" class=\"headerlink\" title=\"使用yum安装keepalived服务\"></a>使用yum安装keepalived服务</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum -y install keepalived</span><br></pre></td></tr></table></figure>\n<h6 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/keepalived/keepalived.conf</span><br><span class=\"line\">global_defs &#123;\t\t\t<span class=\"comment\">//默认全局配置</span></span><br><span class=\"line\">   notification_email &#123;\t\t<span class=\"comment\">//指定该keepalived节点故障时接收邮件的收信人</span></span><br><span class=\"line\">     acassen<span class=\"meta\">@firewall</span>.loc\t</span><br><span class=\"line\">     failover<span class=\"meta\">@firewall</span>.loc\t</span><br><span class=\"line\">     sysadmin<span class=\"meta\">@firewall</span>.loc\t</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   notification_email_from Alexandre.Cassen<span class=\"meta\">@firewall</span>.loc\t\t<span class=\"comment\">//keepalived故障时发送邮件的发信人</span></span><br><span class=\"line\">   smtp_server <span class=\"number\">192.168</span>.<span class=\"number\">200.1</span>\t\t<span class=\"comment\">//指定邮件服务器的IP，stmp简单邮件传输协议，使用端口25</span></span><br><span class=\"line\">   smtp_connect_timeout <span class=\"number\">30</span>\t\t<span class=\"comment\">//与邮件服务器的连接超时时间，单位s，可以自定义</span></span><br><span class=\"line\">   router_id master\t\t<span class=\"comment\">//该节点的唯一表示，用于发邮件时表示该节点，可以是主机名，也可以是自己指定的名字</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">vrrp_instance VI_1 &#123;\t\t<span class=\"comment\">//定义一个VRRP实例，处于同一个组中的节点使用的实例名字应该一致，默认使用名字VI_1</span></span><br><span class=\"line\">    state MASTER\t\t<span class=\"comment\">//该节点的状态，MASTER为主，BACKUP为备，必须大写，但是只是用来标识节点状态，节点主备是由优先级决定的</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ens33</span>\t\t//指定主节点从那块网卡发送<span class=\"title\">VRRP</span>通告</span></span><br><span class=\"line\"><span class=\"class\">    <span class=\"title\">virtual_router_id</span> 51\t\t//指定该实例所属的虚拟路由组的<span class=\"title\">id</span>，属于同一个组的节点使用的<span class=\"title\">id</span>应该相同，<span class=\"title\">id</span>取值范围为0-255</span></span><br><span class=\"line\"><span class=\"class\">    <span class=\"title\">priority</span> 100\t\t//指定该节点的优先级，属于同一个组的节点优先级最高为主节点，取值范围为1-255，配置超过取值范围的值都默认视为100</span></span><br><span class=\"line\"><span class=\"class\">添加：<span class=\"title\">nopreempt</span>\t\t//将该节点设置为非抢占模式</span></span><br><span class=\"line\"><span class=\"class\">    <span class=\"title\">advert_int</span> 1\t\t//主节点每隔1<span class=\"title\">s</span>发送一次<span class=\"title\">VRRP</span>通告，时间可以自定义</span></span><br><span class=\"line\"><span class=\"class\">    <span class=\"title\">authentication</span> </span>&#123;\t\t<span class=\"comment\">//配置主备节点之间的认证方式以及密码</span></span><br><span class=\"line\">        auth_type PASS\t\t<span class=\"comment\">//认证类型，主备必须一致，有PASS和HA两种，PASS密码是明文的，HA是密文的</span></span><br><span class=\"line\">        auth_pass <span class=\"number\">1111</span>\t\t<span class=\"comment\">//认证密钥，主备必须一致，只识别前八位</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    virtual_ipaddress &#123;\t\t<span class=\"comment\">//配置虚拟IP，只有主节点才会拥有该地址，只能通过ip add查看，ifconfig是查看不到的</span></span><br><span class=\"line\">        <span class=\"number\">1.1</span>.<span class=\"number\">1.111</span>/<span class=\"number\">8</span>\t\t<span class=\"comment\">//与物理机IP同网段</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">virtual_server <span class=\"number\">1.1</span>.<span class=\"number\">1.111</span> <span class=\"number\">80</span> &#123;\t\t<span class=\"comment\">//指定LVS集群使用的虚拟IP以及端口</span></span><br><span class=\"line\">    delay_loop <span class=\"number\">6</span>\t\t<span class=\"comment\">//指定对服务节点进行健康检查的间隔时间</span></span><br><span class=\"line\">    lb_algo rr \t\t<span class=\"comment\">//该集群的使用的调度算法</span></span><br><span class=\"line\">    lb_kind DR\t\t<span class=\"comment\">//该集群的调度模式</span></span><br><span class=\"line\">    persistence_timeout <span class=\"number\">0</span>\t\t<span class=\"comment\">//服务节点的连接时间，0表示为短链接</span></span><br><span class=\"line\">    protocol TCP\t\t<span class=\"comment\">//集群中节点之间通过TCP协议通信</span></span><br><span class=\"line\">    netmask <span class=\"number\">255.0</span>.<span class=\"number\">0.0</span>\t<span class=\"comment\">//VIP掩码</span></span><br><span class=\"line\"></span><br><span class=\"line\">\treal_server <span class=\"number\">1.1</span>.<span class=\"number\">1.3</span> <span class=\"number\">80</span> &#123;\t\t<span class=\"comment\">//向集群中添加服务节点</span></span><br><span class=\"line\">   \tweight <span class=\"number\">1</span>\t\t<span class=\"comment\">//设置节点的权重，默认为1，如果权重为0则表示该节点不可用</span></span><br><span class=\"line\">\t   TCP_CHECK &#123;\t<span class=\"comment\">//启用TCP健康检查</span></span><br><span class=\"line\">            connect_timeout <span class=\"number\">1</span>\t\t<span class=\"comment\">//对服务节点做健康检查的连接超时时间，1s可以自定义</span></span><br><span class=\"line\">            nb_get_retry <span class=\"number\">3</span>\t\t<span class=\"comment\">//所健康检查的重试次数，可自定义</span></span><br><span class=\"line\">            delay_before_retry <span class=\"number\">1</span>\t\t<span class=\"comment\">//每次健康检查之间间隔时间，可自定义</span></span><br><span class=\"line\">            connect_port <span class=\"number\">80</span>\t\t<span class=\"comment\">//针对哪个端口进行TCP检查</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">\t &#125;</span><br><span class=\"line\">\treal_server <span class=\"number\">1.1</span>.<span class=\"number\">1.4</span> <span class=\"number\">80</span> &#123;\t\t</span><br><span class=\"line\">   \tweight <span class=\"number\">1</span></span><br><span class=\"line\">\t   TCP_CHECK &#123;</span><br><span class=\"line\">            connect_timeout <span class=\"number\">3</span>\t</span><br><span class=\"line\">            nb_get_retry <span class=\"number\">3</span>\t</span><br><span class=\"line\">            delay_before_retry <span class=\"number\">3</span></span><br><span class=\"line\">            connect_port <span class=\"number\">80</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"将配置文件拷贝给keepalived备\"><a href=\"#将配置文件拷贝给keepalived备\" class=\"headerlink\" title=\"将配置文件拷贝给keepalived备\"></a>将配置文件拷贝给keepalived备</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># scp /etc/keepalived/keepalived.conf root@1.1.1.2:/etc/keepalived/keepalived.conf</span><br></pre></td></tr></table></figure>\n<h6 id=\"修改备的配置文件\"><a href=\"#修改备的配置文件\" class=\"headerlink\" title=\"修改备的配置文件\"></a>修改备的配置文件</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vi /etc/keepalived/keepalived.conf</span><br><span class=\"line\">router_id backup</span><br><span class=\"line\">state BACKUP</span><br><span class=\"line\">priority <span class=\"number\">90</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"启动主从的keepalived服务\"><a href=\"#启动主从的keepalived服务\" class=\"headerlink\" title=\"启动主从的keepalived服务\"></a>启动主从的keepalived服务</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># systemctl restart keepalived</span><br></pre></td></tr></table></figure>\n<h6 id=\"配置Nginx（两台同样步骤）\"><a href=\"#配置Nginx（两台同样步骤）\" class=\"headerlink\" title=\"配置Nginx（两台同样步骤）\"></a>配置Nginx（两台同样步骤）</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 配置虚拟IP</span><br><span class=\"line\"># cd /etc/sysconfig/network-scripts/</span><br><span class=\"line\"># cp ifcfg-lo ifcfg-lo:1</span><br><span class=\"line\"># vi ifcfg-lo:1</span><br><span class=\"line\">DEVICE=lo:<span class=\"number\">1</span></span><br><span class=\"line\">IPADDR=<span class=\"number\">1.1</span>.<span class=\"number\">1.111</span>\t<span class=\"comment\">//虚拟IP</span></span><br><span class=\"line\">NETMASK=<span class=\"number\">255.255</span>.<span class=\"number\">255.255</span></span><br><span class=\"line\">NAME=lo:<span class=\"number\">1</span></span><br><span class=\"line\"># 多余的删除</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>可以通过ifconfig命令来配置不过是临时IP重启失效</p>\n</blockquote>\n<blockquote>\n<p>ifconfig lo:1 1.1.1.111 netmask 255.255.255.255</p>\n</blockquote>\n<h6 id=\"重启网卡\"><a href=\"#重启网卡\" class=\"headerlink\" title=\"重启网卡\"></a>重启网卡</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart network</span><br></pre></td></tr></table></figure>\n<h6 id=\"修改系统内核文件\"><a href=\"#修改系统内核文件\" class=\"headerlink\" title=\"修改系统内核文件\"></a>修改系统内核文件</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /etc/sysctl.conf</span><br><span class=\"line\">net.ipv4.conf.lo.arp_ignore=<span class=\"number\">1</span></span><br><span class=\"line\">net.ipv4.conf.<span class=\"keyword\">default</span>.arp_ignore=<span class=\"number\">1</span>\t</span><br><span class=\"line\">net.ipv4.conf.all.arp_ignore=<span class=\"number\">1</span></span><br><span class=\"line\">net.ipv4.conf.lo.arp_announce=<span class=\"number\">2</span></span><br><span class=\"line\">net.ipv4.conf.<span class=\"keyword\">default</span>.arp_announce=<span class=\"number\">2</span></span><br><span class=\"line\">net.ipv4.conf.all.arp_announce=<span class=\"number\">2</span></span><br><span class=\"line\"># sysctl -p</span><br></pre></td></tr></table></figure>\n<h6 id=\"修改web首页文件（第二台web改成NO-2）\"><a href=\"#修改web首页文件（第二台web改成NO-2）\" class=\"headerlink\" title=\"修改web首页文件（第二台web改成NO.2）\"></a>修改web首页文件（第二台web改成NO.2）</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># echo &quot;Wecom to nginx NO.1&quot; &gt; /usr/local/nginx/html/index.html</span><br></pre></td></tr></table></figure>\n<h6 id=\"放行防护墙\"><a href=\"#放行防护墙\" class=\"headerlink\" title=\"放行防护墙\"></a>放行防护墙</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># firewall-cmd --add-port=80/tcp --permanent</span><br><span class=\"line\"># firewall-cmd --add-service=nginx --permanent</span><br><span class=\"line\"># firewall-cmd --reload</span><br><span class=\"line\"># setenforce 0</span><br></pre></td></tr></table></figure>\n<h6 id=\"客户端验证\"><a href=\"#客户端验证\" class=\"headerlink\" title=\"客户端验证\"></a>客户端验证</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># curl 1.1.1.111</span><br><span class=\"line\">wecom to nginx NO.<span class=\"number\">1</span></span><br></pre></td></tr></table></figure>"},{"title":"Linux 双网卡绑定","author":"Semaik.","date":"2020-09-22T09:25:00.000Z","_content":"#### Linux 双网卡绑定\n>双网卡绑定这项继续特别适合利用再生产环境7x24小时的网络传输服务，采取双网卡绑定模式不仅可以提高网络传输速度，更重要的是，还可以确保其中一块网卡出现故障时，依然可以正常高效可靠的措施。下面我会使用两种方案来完成网双卡绑定 一种是传统的配置文件修改方案，另一种是最新的命令生成配置文件方案。\n\n##### 主要常用的三种模式\n\n* mode0（平衡负载模式）：平时两块网卡均工作，且自动备援，但需要在与服务器本地网卡相连的交换机设备上进行端口聚合来支持绑定技术。\n* mode1（自动备援模式）：平时只有一块网卡工作，在它故障后自动替换为另外的网卡。\n* mode6（平衡负载模式）：平时两块网卡均工作，且自动备援，无须交换机设备提供辅助支持。(推荐)\n\n##### 其他模式介绍\n* balance-rr (mode=0)       默认, 有高可用 (容错) 和负载均衡的功能,  需要交换机的配置，每块网卡轮询发包 (流量分发比较均衡).\n* active-backup (mode=1)  只有高可用 (容错) 功能, 不需要交换机配置, 这种模式只有一块网卡工作, 对外只有一个mac地址。缺点是端口利用率比较低\n* balance-xor (mode=2)     不常用\n* broadcast (mode=3)        不常用\n* 802.3ad (mode=4)          IEEE 802.3ad 动态链路聚合，需要交换机配置，没用过\n* balance-tlb (mode=5)      不常用\n* balance-alb (mode=6)     有高可用 ( 容错 )和负载均衡的功能，不需要交换机配置  (流量分发到每个接口不是特别均衡)\n\n##### 修改配置文件实现双网卡绑定\n\n注意：\n* 必须保证服务器有两块同网段网卡设备\n\n环境：\n\n* 已添加 网卡1 ens33\n* 已添加 网卡2 ens34\n\n###### 新建Master配置文件\n```java\nvi /etc/sysconfig/network-scripts/ifcfg-bond6\n# 设备名\nDEVICE=bond6\n# 手动配置地址\nBOOTPROTO=none\n# 配置模式\nBONDING_OPTS=\"miimon=100 mode=6\"\n# IP地址\nIPADDR=192.168.1.100\n# 子网掩码\nPREFIX=24\n# 网关地址\nGATEWAY=192.168.1.1\n# DNS1地址\nDNS1=114.114.114.114\n# DNS2地址\nDNS2=8.8.8.8\n```\n###### 新建Slave1配置文件\n```java\nvi /etc/sysconfig/network-scripts/ifcfg-ens33\n# 设备名\nDEVICE=ens33\n# 手动获取    \nBOOTPROTO=none\n# master设备名\nMASTER=bond0\n# 开启SLAVE\nSLAVE=yes\n#是否允许普通用户管理此端口\nUSERCTL=no \n```\n###### 新建Slave2配置文件\n```java\nvi /etc/sysconfig/network-scripts/ifcfg-ens34\n# 设备名\nDEVICE=ens34\n# 手动获取\nBOOTPROTO=none\n# master设备名\nMASTER=bond0\n# 开启SLAVE\nSLAVE=yes\n#是否允许普通用户管理此端口\nUSERCTL=no  \n```\n##### nmcli命令行实现双网卡绑定\n###### 创建Master配置文件\n```java\n# nmcli connection add type bond con-name 设备名称 ifname 设备名称 mode 模式号 miimon 毫秒\nnmcli connection add type bond con-name bond6 ifname bond6 mode 1 miimon 100\n```\n> 注：miimon：指定当发现一个链路恢复时，在激活该链路之前的等待时间，以毫秒计算\n\n###### 新建Slave1配置文件\n```java\n# nmcli connection add type bond-slave ifname 设备名称 master master设备名称\nnmcli connection add type bond-slave ifname ens33 master bond6\n```\n###### 新建Slave2配置文件\n```java\n# nmcli connection add type bond-slave ifname 设备名称 master master设备名称\nnmcli connection add type bond-slave ifname ens34 master bond6\n```\n###### 激活网路设备\n```java\n# 激活bond6网络设备\nnmcli connection up \"bond6\"\n# 激活ens33网络设备\nnmcli connection up \"bond-slave-ens33\"\n# 激活ens34网络设备\nnmcli connection up \"bond-slave-ens34\"\n```\n###### 查看详情信息\n```java\ncat /proc/net/bonding/bond6 \n```","source":"_posts/Linux-双网卡绑定.md","raw":"title: Linux 双网卡绑定\nauthor: Semaik.\ntags:\n  - Linux\ncategories:\n  - Linux\ndate: 2020-09-22 17:25:00\n---\n#### Linux 双网卡绑定\n>双网卡绑定这项继续特别适合利用再生产环境7x24小时的网络传输服务，采取双网卡绑定模式不仅可以提高网络传输速度，更重要的是，还可以确保其中一块网卡出现故障时，依然可以正常高效可靠的措施。下面我会使用两种方案来完成网双卡绑定 一种是传统的配置文件修改方案，另一种是最新的命令生成配置文件方案。\n\n##### 主要常用的三种模式\n\n* mode0（平衡负载模式）：平时两块网卡均工作，且自动备援，但需要在与服务器本地网卡相连的交换机设备上进行端口聚合来支持绑定技术。\n* mode1（自动备援模式）：平时只有一块网卡工作，在它故障后自动替换为另外的网卡。\n* mode6（平衡负载模式）：平时两块网卡均工作，且自动备援，无须交换机设备提供辅助支持。(推荐)\n\n##### 其他模式介绍\n* balance-rr (mode=0)       默认, 有高可用 (容错) 和负载均衡的功能,  需要交换机的配置，每块网卡轮询发包 (流量分发比较均衡).\n* active-backup (mode=1)  只有高可用 (容错) 功能, 不需要交换机配置, 这种模式只有一块网卡工作, 对外只有一个mac地址。缺点是端口利用率比较低\n* balance-xor (mode=2)     不常用\n* broadcast (mode=3)        不常用\n* 802.3ad (mode=4)          IEEE 802.3ad 动态链路聚合，需要交换机配置，没用过\n* balance-tlb (mode=5)      不常用\n* balance-alb (mode=6)     有高可用 ( 容错 )和负载均衡的功能，不需要交换机配置  (流量分发到每个接口不是特别均衡)\n\n##### 修改配置文件实现双网卡绑定\n\n注意：\n* 必须保证服务器有两块同网段网卡设备\n\n环境：\n\n* 已添加 网卡1 ens33\n* 已添加 网卡2 ens34\n\n###### 新建Master配置文件\n```java\nvi /etc/sysconfig/network-scripts/ifcfg-bond6\n# 设备名\nDEVICE=bond6\n# 手动配置地址\nBOOTPROTO=none\n# 配置模式\nBONDING_OPTS=\"miimon=100 mode=6\"\n# IP地址\nIPADDR=192.168.1.100\n# 子网掩码\nPREFIX=24\n# 网关地址\nGATEWAY=192.168.1.1\n# DNS1地址\nDNS1=114.114.114.114\n# DNS2地址\nDNS2=8.8.8.8\n```\n###### 新建Slave1配置文件\n```java\nvi /etc/sysconfig/network-scripts/ifcfg-ens33\n# 设备名\nDEVICE=ens33\n# 手动获取    \nBOOTPROTO=none\n# master设备名\nMASTER=bond0\n# 开启SLAVE\nSLAVE=yes\n#是否允许普通用户管理此端口\nUSERCTL=no \n```\n###### 新建Slave2配置文件\n```java\nvi /etc/sysconfig/network-scripts/ifcfg-ens34\n# 设备名\nDEVICE=ens34\n# 手动获取\nBOOTPROTO=none\n# master设备名\nMASTER=bond0\n# 开启SLAVE\nSLAVE=yes\n#是否允许普通用户管理此端口\nUSERCTL=no  \n```\n##### nmcli命令行实现双网卡绑定\n###### 创建Master配置文件\n```java\n# nmcli connection add type bond con-name 设备名称 ifname 设备名称 mode 模式号 miimon 毫秒\nnmcli connection add type bond con-name bond6 ifname bond6 mode 1 miimon 100\n```\n> 注：miimon：指定当发现一个链路恢复时，在激活该链路之前的等待时间，以毫秒计算\n\n###### 新建Slave1配置文件\n```java\n# nmcli connection add type bond-slave ifname 设备名称 master master设备名称\nnmcli connection add type bond-slave ifname ens33 master bond6\n```\n###### 新建Slave2配置文件\n```java\n# nmcli connection add type bond-slave ifname 设备名称 master master设备名称\nnmcli connection add type bond-slave ifname ens34 master bond6\n```\n###### 激活网路设备\n```java\n# 激活bond6网络设备\nnmcli connection up \"bond6\"\n# 激活ens33网络设备\nnmcli connection up \"bond-slave-ens33\"\n# 激活ens34网络设备\nnmcli connection up \"bond-slave-ens34\"\n```\n###### 查看详情信息\n```java\ncat /proc/net/bonding/bond6 \n```","slug":"Linux-双网卡绑定","published":1,"updated":"2020-09-22T09:33:45.616Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737a0017m3pvd3tc0cka","content":"<h4 id=\"Linux-双网卡绑定\"><a href=\"#Linux-双网卡绑定\" class=\"headerlink\" title=\"Linux 双网卡绑定\"></a>Linux 双网卡绑定</h4><blockquote>\n<p>双网卡绑定这项继续特别适合利用再生产环境7x24小时的网络传输服务，采取双网卡绑定模式不仅可以提高网络传输速度，更重要的是，还可以确保其中一块网卡出现故障时，依然可以正常高效可靠的措施。下面我会使用两种方案来完成网双卡绑定 一种是传统的配置文件修改方案，另一种是最新的命令生成配置文件方案。</p>\n</blockquote>\n<h5 id=\"主要常用的三种模式\"><a href=\"#主要常用的三种模式\" class=\"headerlink\" title=\"主要常用的三种模式\"></a>主要常用的三种模式</h5><ul>\n<li>mode0（平衡负载模式）：平时两块网卡均工作，且自动备援，但需要在与服务器本地网卡相连的交换机设备上进行端口聚合来支持绑定技术。</li>\n<li>mode1（自动备援模式）：平时只有一块网卡工作，在它故障后自动替换为另外的网卡。</li>\n<li>mode6（平衡负载模式）：平时两块网卡均工作，且自动备援，无须交换机设备提供辅助支持。(推荐)</li>\n</ul>\n<h5 id=\"其他模式介绍\"><a href=\"#其他模式介绍\" class=\"headerlink\" title=\"其他模式介绍\"></a>其他模式介绍</h5><ul>\n<li>balance-rr (mode=0)       默认, 有高可用 (容错) 和负载均衡的功能,  需要交换机的配置，每块网卡轮询发包 (流量分发比较均衡).</li>\n<li>active-backup (mode=1)  只有高可用 (容错) 功能, 不需要交换机配置, 这种模式只有一块网卡工作, 对外只有一个mac地址。缺点是端口利用率比较低</li>\n<li>balance-xor (mode=2)     不常用</li>\n<li>broadcast (mode=3)        不常用</li>\n<li>802.3ad (mode=4)          IEEE 802.3ad 动态链路聚合，需要交换机配置，没用过</li>\n<li>balance-tlb (mode=5)      不常用</li>\n<li>balance-alb (mode=6)     有高可用 ( 容错 )和负载均衡的功能，不需要交换机配置  (流量分发到每个接口不是特别均衡)</li>\n</ul>\n<h5 id=\"修改配置文件实现双网卡绑定\"><a href=\"#修改配置文件实现双网卡绑定\" class=\"headerlink\" title=\"修改配置文件实现双网卡绑定\"></a>修改配置文件实现双网卡绑定</h5><p>注意：</p>\n<ul>\n<li>必须保证服务器有两块同网段网卡设备</li>\n</ul>\n<p>环境：</p>\n<ul>\n<li>已添加 网卡1 ens33</li>\n<li>已添加 网卡2 ens34</li>\n</ul>\n<h6 id=\"新建Master配置文件\"><a href=\"#新建Master配置文件\" class=\"headerlink\" title=\"新建Master配置文件\"></a>新建Master配置文件</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/sysconfig/network-scripts/ifcfg-bond6</span><br><span class=\"line\"># 设备名</span><br><span class=\"line\">DEVICE=bond6</span><br><span class=\"line\"># 手动配置地址</span><br><span class=\"line\">BOOTPROTO=none</span><br><span class=\"line\"># 配置模式</span><br><span class=\"line\">BONDING_OPTS=<span class=\"string\">&quot;miimon=100 mode=6&quot;</span></span><br><span class=\"line\"># IP地址</span><br><span class=\"line\">IPADDR=<span class=\"number\">192.168</span>.<span class=\"number\">1.100</span></span><br><span class=\"line\"># 子网掩码</span><br><span class=\"line\">PREFIX=<span class=\"number\">24</span></span><br><span class=\"line\"># 网关地址</span><br><span class=\"line\">GATEWAY=<span class=\"number\">192.168</span>.<span class=\"number\">1.1</span></span><br><span class=\"line\"># DNS1地址</span><br><span class=\"line\">DNS1=<span class=\"number\">114.114</span>.<span class=\"number\">114.114</span></span><br><span class=\"line\"># DNS2地址</span><br><span class=\"line\">DNS2=<span class=\"number\">8.8</span>.<span class=\"number\">8.8</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"新建Slave1配置文件\"><a href=\"#新建Slave1配置文件\" class=\"headerlink\" title=\"新建Slave1配置文件\"></a>新建Slave1配置文件</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/sysconfig/network-scripts/ifcfg-ens33</span><br><span class=\"line\"># 设备名</span><br><span class=\"line\">DEVICE=ens33</span><br><span class=\"line\"># 手动获取    </span><br><span class=\"line\">BOOTPROTO=none</span><br><span class=\"line\"># master设备名</span><br><span class=\"line\">MASTER=bond0</span><br><span class=\"line\"># 开启SLAVE</span><br><span class=\"line\">SLAVE=yes</span><br><span class=\"line\">#是否允许普通用户管理此端口</span><br><span class=\"line\">USERCTL=no </span><br></pre></td></tr></table></figure>\n<h6 id=\"新建Slave2配置文件\"><a href=\"#新建Slave2配置文件\" class=\"headerlink\" title=\"新建Slave2配置文件\"></a>新建Slave2配置文件</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/sysconfig/network-scripts/ifcfg-ens34</span><br><span class=\"line\"># 设备名</span><br><span class=\"line\">DEVICE=ens34</span><br><span class=\"line\"># 手动获取</span><br><span class=\"line\">BOOTPROTO=none</span><br><span class=\"line\"># master设备名</span><br><span class=\"line\">MASTER=bond0</span><br><span class=\"line\"># 开启SLAVE</span><br><span class=\"line\">SLAVE=yes</span><br><span class=\"line\">#是否允许普通用户管理此端口</span><br><span class=\"line\">USERCTL=no  </span><br></pre></td></tr></table></figure>\n<h5 id=\"nmcli命令行实现双网卡绑定\"><a href=\"#nmcli命令行实现双网卡绑定\" class=\"headerlink\" title=\"nmcli命令行实现双网卡绑定\"></a>nmcli命令行实现双网卡绑定</h5><h6 id=\"创建Master配置文件\"><a href=\"#创建Master配置文件\" class=\"headerlink\" title=\"创建Master配置文件\"></a>创建Master配置文件</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># nmcli connection add type bond con-name 设备名称 ifname 设备名称 mode 模式号 miimon 毫秒</span><br><span class=\"line\">nmcli connection add type bond con-name bond6 ifname bond6 mode <span class=\"number\">1</span> miimon <span class=\"number\">100</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>注：miimon：指定当发现一个链路恢复时，在激活该链路之前的等待时间，以毫秒计算</p>\n</blockquote>\n<h6 id=\"新建Slave1配置文件-1\"><a href=\"#新建Slave1配置文件-1\" class=\"headerlink\" title=\"新建Slave1配置文件\"></a>新建Slave1配置文件</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># nmcli connection add type bond-slave ifname 设备名称 master master设备名称</span><br><span class=\"line\">nmcli connection add type bond-slave ifname ens33 master bond6</span><br></pre></td></tr></table></figure>\n<h6 id=\"新建Slave2配置文件-1\"><a href=\"#新建Slave2配置文件-1\" class=\"headerlink\" title=\"新建Slave2配置文件\"></a>新建Slave2配置文件</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># nmcli connection add type bond-slave ifname 设备名称 master master设备名称</span><br><span class=\"line\">nmcli connection add type bond-slave ifname ens34 master bond6</span><br></pre></td></tr></table></figure>\n<h6 id=\"激活网路设备\"><a href=\"#激活网路设备\" class=\"headerlink\" title=\"激活网路设备\"></a>激活网路设备</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 激活bond6网络设备</span><br><span class=\"line\">nmcli connection up <span class=\"string\">&quot;bond6&quot;</span></span><br><span class=\"line\"># 激活ens33网络设备</span><br><span class=\"line\">nmcli connection up <span class=\"string\">&quot;bond-slave-ens33&quot;</span></span><br><span class=\"line\"># 激活ens34网络设备</span><br><span class=\"line\">nmcli connection up <span class=\"string\">&quot;bond-slave-ens34&quot;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"查看详情信息\"><a href=\"#查看详情信息\" class=\"headerlink\" title=\"查看详情信息\"></a>查看详情信息</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /proc/net/bonding/bond6 </span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h4 id=\"Linux-双网卡绑定\"><a href=\"#Linux-双网卡绑定\" class=\"headerlink\" title=\"Linux 双网卡绑定\"></a>Linux 双网卡绑定</h4><blockquote>\n<p>双网卡绑定这项继续特别适合利用再生产环境7x24小时的网络传输服务，采取双网卡绑定模式不仅可以提高网络传输速度，更重要的是，还可以确保其中一块网卡出现故障时，依然可以正常高效可靠的措施。下面我会使用两种方案来完成网双卡绑定 一种是传统的配置文件修改方案，另一种是最新的命令生成配置文件方案。</p>\n</blockquote>\n<h5 id=\"主要常用的三种模式\"><a href=\"#主要常用的三种模式\" class=\"headerlink\" title=\"主要常用的三种模式\"></a>主要常用的三种模式</h5><ul>\n<li>mode0（平衡负载模式）：平时两块网卡均工作，且自动备援，但需要在与服务器本地网卡相连的交换机设备上进行端口聚合来支持绑定技术。</li>\n<li>mode1（自动备援模式）：平时只有一块网卡工作，在它故障后自动替换为另外的网卡。</li>\n<li>mode6（平衡负载模式）：平时两块网卡均工作，且自动备援，无须交换机设备提供辅助支持。(推荐)</li>\n</ul>\n<h5 id=\"其他模式介绍\"><a href=\"#其他模式介绍\" class=\"headerlink\" title=\"其他模式介绍\"></a>其他模式介绍</h5><ul>\n<li>balance-rr (mode=0)       默认, 有高可用 (容错) 和负载均衡的功能,  需要交换机的配置，每块网卡轮询发包 (流量分发比较均衡).</li>\n<li>active-backup (mode=1)  只有高可用 (容错) 功能, 不需要交换机配置, 这种模式只有一块网卡工作, 对外只有一个mac地址。缺点是端口利用率比较低</li>\n<li>balance-xor (mode=2)     不常用</li>\n<li>broadcast (mode=3)        不常用</li>\n<li>802.3ad (mode=4)          IEEE 802.3ad 动态链路聚合，需要交换机配置，没用过</li>\n<li>balance-tlb (mode=5)      不常用</li>\n<li>balance-alb (mode=6)     有高可用 ( 容错 )和负载均衡的功能，不需要交换机配置  (流量分发到每个接口不是特别均衡)</li>\n</ul>\n<h5 id=\"修改配置文件实现双网卡绑定\"><a href=\"#修改配置文件实现双网卡绑定\" class=\"headerlink\" title=\"修改配置文件实现双网卡绑定\"></a>修改配置文件实现双网卡绑定</h5><p>注意：</p>\n<ul>\n<li>必须保证服务器有两块同网段网卡设备</li>\n</ul>\n<p>环境：</p>\n<ul>\n<li>已添加 网卡1 ens33</li>\n<li>已添加 网卡2 ens34</li>\n</ul>\n<h6 id=\"新建Master配置文件\"><a href=\"#新建Master配置文件\" class=\"headerlink\" title=\"新建Master配置文件\"></a>新建Master配置文件</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/sysconfig/network-scripts/ifcfg-bond6</span><br><span class=\"line\"># 设备名</span><br><span class=\"line\">DEVICE=bond6</span><br><span class=\"line\"># 手动配置地址</span><br><span class=\"line\">BOOTPROTO=none</span><br><span class=\"line\"># 配置模式</span><br><span class=\"line\">BONDING_OPTS=<span class=\"string\">&quot;miimon=100 mode=6&quot;</span></span><br><span class=\"line\"># IP地址</span><br><span class=\"line\">IPADDR=<span class=\"number\">192.168</span>.<span class=\"number\">1.100</span></span><br><span class=\"line\"># 子网掩码</span><br><span class=\"line\">PREFIX=<span class=\"number\">24</span></span><br><span class=\"line\"># 网关地址</span><br><span class=\"line\">GATEWAY=<span class=\"number\">192.168</span>.<span class=\"number\">1.1</span></span><br><span class=\"line\"># DNS1地址</span><br><span class=\"line\">DNS1=<span class=\"number\">114.114</span>.<span class=\"number\">114.114</span></span><br><span class=\"line\"># DNS2地址</span><br><span class=\"line\">DNS2=<span class=\"number\">8.8</span>.<span class=\"number\">8.8</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"新建Slave1配置文件\"><a href=\"#新建Slave1配置文件\" class=\"headerlink\" title=\"新建Slave1配置文件\"></a>新建Slave1配置文件</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/sysconfig/network-scripts/ifcfg-ens33</span><br><span class=\"line\"># 设备名</span><br><span class=\"line\">DEVICE=ens33</span><br><span class=\"line\"># 手动获取    </span><br><span class=\"line\">BOOTPROTO=none</span><br><span class=\"line\"># master设备名</span><br><span class=\"line\">MASTER=bond0</span><br><span class=\"line\"># 开启SLAVE</span><br><span class=\"line\">SLAVE=yes</span><br><span class=\"line\">#是否允许普通用户管理此端口</span><br><span class=\"line\">USERCTL=no </span><br></pre></td></tr></table></figure>\n<h6 id=\"新建Slave2配置文件\"><a href=\"#新建Slave2配置文件\" class=\"headerlink\" title=\"新建Slave2配置文件\"></a>新建Slave2配置文件</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/sysconfig/network-scripts/ifcfg-ens34</span><br><span class=\"line\"># 设备名</span><br><span class=\"line\">DEVICE=ens34</span><br><span class=\"line\"># 手动获取</span><br><span class=\"line\">BOOTPROTO=none</span><br><span class=\"line\"># master设备名</span><br><span class=\"line\">MASTER=bond0</span><br><span class=\"line\"># 开启SLAVE</span><br><span class=\"line\">SLAVE=yes</span><br><span class=\"line\">#是否允许普通用户管理此端口</span><br><span class=\"line\">USERCTL=no  </span><br></pre></td></tr></table></figure>\n<h5 id=\"nmcli命令行实现双网卡绑定\"><a href=\"#nmcli命令行实现双网卡绑定\" class=\"headerlink\" title=\"nmcli命令行实现双网卡绑定\"></a>nmcli命令行实现双网卡绑定</h5><h6 id=\"创建Master配置文件\"><a href=\"#创建Master配置文件\" class=\"headerlink\" title=\"创建Master配置文件\"></a>创建Master配置文件</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># nmcli connection add type bond con-name 设备名称 ifname 设备名称 mode 模式号 miimon 毫秒</span><br><span class=\"line\">nmcli connection add type bond con-name bond6 ifname bond6 mode <span class=\"number\">1</span> miimon <span class=\"number\">100</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>注：miimon：指定当发现一个链路恢复时，在激活该链路之前的等待时间，以毫秒计算</p>\n</blockquote>\n<h6 id=\"新建Slave1配置文件-1\"><a href=\"#新建Slave1配置文件-1\" class=\"headerlink\" title=\"新建Slave1配置文件\"></a>新建Slave1配置文件</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># nmcli connection add type bond-slave ifname 设备名称 master master设备名称</span><br><span class=\"line\">nmcli connection add type bond-slave ifname ens33 master bond6</span><br></pre></td></tr></table></figure>\n<h6 id=\"新建Slave2配置文件-1\"><a href=\"#新建Slave2配置文件-1\" class=\"headerlink\" title=\"新建Slave2配置文件\"></a>新建Slave2配置文件</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># nmcli connection add type bond-slave ifname 设备名称 master master设备名称</span><br><span class=\"line\">nmcli connection add type bond-slave ifname ens34 master bond6</span><br></pre></td></tr></table></figure>\n<h6 id=\"激活网路设备\"><a href=\"#激活网路设备\" class=\"headerlink\" title=\"激活网路设备\"></a>激活网路设备</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 激活bond6网络设备</span><br><span class=\"line\">nmcli connection up <span class=\"string\">&quot;bond6&quot;</span></span><br><span class=\"line\"># 激活ens33网络设备</span><br><span class=\"line\">nmcli connection up <span class=\"string\">&quot;bond-slave-ens33&quot;</span></span><br><span class=\"line\"># 激活ens34网络设备</span><br><span class=\"line\">nmcli connection up <span class=\"string\">&quot;bond-slave-ens34&quot;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"查看详情信息\"><a href=\"#查看详情信息\" class=\"headerlink\" title=\"查看详情信息\"></a>查看详情信息</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /proc/net/bonding/bond6 </span><br></pre></td></tr></table></figure>"},{"title":"Linux权限管理之ACL权限","author":"Semaik.","date":"2020-09-24T03:22:22.000Z","_content":"##### ACL权限设置规则：\n\n> 可以给任何的用户或用户组设置任何文件/目录的访问权限。\n\n###### 添加ACL规则的命令格式：\n\n　　①、给用户设定 ACL 权限：setfacl -m u:用户名:权限 指定文件名\n  \n　　②、给用户组设定 ACL 权限:setfacl -m g:组名:权限 指定文件名\n  \n###### 选项：\n\n\t-m：设定ACL权限\n\t\t\t例：setfacl -m [g/u]:[组名/用户名]:rwx 指定的目录/文件\n            \n\t-x：删除指定的ACL权限\n\t\t\t例：setfacl -x [g/u]:[组名/用户名] 指定的目录/文件\n            \n\t-b：删除所有的ACL权限\n\t\t\t例：setfacl -b 指定的目录/文件\n\n##### 拿用户组来举例（当然拿某个用户也是一样的）\n\n创建一个目录：\n```java\n[root@node1 /]# mkdir /pro\n```\n    \n创建两个用户：\n```java\n[root@node1 /]# useradd zs\n[root@node1 /]# useradd ls\n```\n\n切换zs用户或者ls用户去/pro目录中进行操作\n```java\n[root@node1 ~]# su zs\n[zs@node1 root]$ cd /pro\n[zs@node1 pro]$ touch file\ntouch: 无法创建\"file\": 权限不够\n[root@node1 ~]# su ls\n[ls@node1 root]$ cd /pro\n[ls@node1 pro]$ touch file\ntouch: 无法创建\"file\": 权限不够\n\n# 注意：这时通过zs用户去/pro目录下去操作，是无法进行操作的，该用户对此目录没有操作权限，当然ls用户也是一样。\n```\n创建一个用户组：\n```java\n[root@node1 ~]# groupadd userzu\n```\n将zs用户以及ls用户加入到userzu中\n```java\n[root@node1 ~]# usermod -G userzu zs\n[root@node1 ~]# usermod -G userzu ls\n[root@node1 ~]# groups zs\nzs : zs userzu\n[root@node1 ~]# groups ls\nls : ls userzu\t\t# 将用户已经加入到组内\n```\n当然之加入到组中也是没有权限的，需要通过acl对此目录绑定权限：\n```java\n[root@node1 ~]# setfacl -m g:userzu:rwx /pro\n[root@node1 ~]# chmod 775 /pro\t\t# 允许用户组有读写执\t行权限\n[root@node1 ~]# getfacl /pro\ngetfacl: Removing leading '/' from absolute path names\n# file: pro\n# owner: root\n# group: root\nuser::rwx\ngroup::rwx\ngroup:userzu:rwx\t\t# 这里已经显示由哪个组可以对该目录\t进行操作，并拥有什么样的权限（可以绑定多个用户组）\nmask::rwx\nother::r-x\n```\n再次切换zs用户去/pro目录进行操作\n```java\n[zs@node1 pro]$ touch {1..3}\n[zs@node1 pro]$ ls\n1  2  3\n[zs@node1 pro]$ ll\n总用量 0\n-rw-rw-r--. 1 zs zs 0 9月  12 17:34 1\n-rw-rw-r--. 1 zs zs 0 9月  12 17:34 2\n-rw-rw-r--. 1 zs zs 0 9月  12 17:34 3\n\n# 可以成功的进行操作！！！（ls用户也是一样）\n```\n","source":"_posts/Linux权限管理之ACL权限.md","raw":"title: Linux权限管理之ACL权限\nauthor: Semaik.\ndate: 2020-09-24 11:22:22\ntags:\n---\n##### ACL权限设置规则：\n\n> 可以给任何的用户或用户组设置任何文件/目录的访问权限。\n\n###### 添加ACL规则的命令格式：\n\n　　①、给用户设定 ACL 权限：setfacl -m u:用户名:权限 指定文件名\n  \n　　②、给用户组设定 ACL 权限:setfacl -m g:组名:权限 指定文件名\n  \n###### 选项：\n\n\t-m：设定ACL权限\n\t\t\t例：setfacl -m [g/u]:[组名/用户名]:rwx 指定的目录/文件\n            \n\t-x：删除指定的ACL权限\n\t\t\t例：setfacl -x [g/u]:[组名/用户名] 指定的目录/文件\n            \n\t-b：删除所有的ACL权限\n\t\t\t例：setfacl -b 指定的目录/文件\n\n##### 拿用户组来举例（当然拿某个用户也是一样的）\n\n创建一个目录：\n```java\n[root@node1 /]# mkdir /pro\n```\n    \n创建两个用户：\n```java\n[root@node1 /]# useradd zs\n[root@node1 /]# useradd ls\n```\n\n切换zs用户或者ls用户去/pro目录中进行操作\n```java\n[root@node1 ~]# su zs\n[zs@node1 root]$ cd /pro\n[zs@node1 pro]$ touch file\ntouch: 无法创建\"file\": 权限不够\n[root@node1 ~]# su ls\n[ls@node1 root]$ cd /pro\n[ls@node1 pro]$ touch file\ntouch: 无法创建\"file\": 权限不够\n\n# 注意：这时通过zs用户去/pro目录下去操作，是无法进行操作的，该用户对此目录没有操作权限，当然ls用户也是一样。\n```\n创建一个用户组：\n```java\n[root@node1 ~]# groupadd userzu\n```\n将zs用户以及ls用户加入到userzu中\n```java\n[root@node1 ~]# usermod -G userzu zs\n[root@node1 ~]# usermod -G userzu ls\n[root@node1 ~]# groups zs\nzs : zs userzu\n[root@node1 ~]# groups ls\nls : ls userzu\t\t# 将用户已经加入到组内\n```\n当然之加入到组中也是没有权限的，需要通过acl对此目录绑定权限：\n```java\n[root@node1 ~]# setfacl -m g:userzu:rwx /pro\n[root@node1 ~]# chmod 775 /pro\t\t# 允许用户组有读写执\t行权限\n[root@node1 ~]# getfacl /pro\ngetfacl: Removing leading '/' from absolute path names\n# file: pro\n# owner: root\n# group: root\nuser::rwx\ngroup::rwx\ngroup:userzu:rwx\t\t# 这里已经显示由哪个组可以对该目录\t进行操作，并拥有什么样的权限（可以绑定多个用户组）\nmask::rwx\nother::r-x\n```\n再次切换zs用户去/pro目录进行操作\n```java\n[zs@node1 pro]$ touch {1..3}\n[zs@node1 pro]$ ls\n1  2  3\n[zs@node1 pro]$ ll\n总用量 0\n-rw-rw-r--. 1 zs zs 0 9月  12 17:34 1\n-rw-rw-r--. 1 zs zs 0 9月  12 17:34 2\n-rw-rw-r--. 1 zs zs 0 9月  12 17:34 3\n\n# 可以成功的进行操作！！！（ls用户也是一样）\n```\n","slug":"Linux权限管理之ACL权限","published":1,"updated":"2020-09-24T03:26:44.838Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737b001am3pv42dcblu4","content":"<h5 id=\"ACL权限设置规则：\"><a href=\"#ACL权限设置规则：\" class=\"headerlink\" title=\"ACL权限设置规则：\"></a>ACL权限设置规则：</h5><blockquote>\n<p>可以给任何的用户或用户组设置任何文件/目录的访问权限。</p>\n</blockquote>\n<h6 id=\"添加ACL规则的命令格式：\"><a href=\"#添加ACL规则的命令格式：\" class=\"headerlink\" title=\"添加ACL规则的命令格式：\"></a>添加ACL规则的命令格式：</h6><p>　　①、给用户设定 ACL 权限：setfacl -m u:用户名:权限 指定文件名</p>\n<p>　　②、给用户组设定 ACL 权限:setfacl -m g:组名:权限 指定文件名</p>\n<h6 id=\"选项：\"><a href=\"#选项：\" class=\"headerlink\" title=\"选项：\"></a>选项：</h6><pre><code>-m：设定ACL权限\n        例：setfacl -m [g/u]:[组名/用户名]:rwx 指定的目录/文件\n\n-x：删除指定的ACL权限\n        例：setfacl -x [g/u]:[组名/用户名] 指定的目录/文件\n\n-b：删除所有的ACL权限\n        例：setfacl -b 指定的目录/文件</code></pre>\n<h5 id=\"拿用户组来举例（当然拿某个用户也是一样的）\"><a href=\"#拿用户组来举例（当然拿某个用户也是一样的）\" class=\"headerlink\" title=\"拿用户组来举例（当然拿某个用户也是一样的）\"></a>拿用户组来举例（当然拿某个用户也是一样的）</h5><p>创建一个目录：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node1 /]# mkdir /pro</span><br></pre></td></tr></table></figure>\n\n<p>创建两个用户：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node1 /]# useradd zs</span><br><span class=\"line\">[root@node1 /]# useradd ls</span><br></pre></td></tr></table></figure>\n\n<p>切换zs用户或者ls用户去/pro目录中进行操作</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node1 ~]# su zs</span><br><span class=\"line\">[zs<span class=\"meta\">@node1</span> root]$ cd /pro</span><br><span class=\"line\">[zs<span class=\"meta\">@node1</span> pro]$ touch file</span><br><span class=\"line\">touch: 无法创建<span class=\"string\">&quot;file&quot;</span>: 权限不够</span><br><span class=\"line\">[root@node1 ~]# su ls</span><br><span class=\"line\">[ls<span class=\"meta\">@node1</span> root]$ cd /pro</span><br><span class=\"line\">[ls<span class=\"meta\">@node1</span> pro]$ touch file</span><br><span class=\"line\">touch: 无法创建<span class=\"string\">&quot;file&quot;</span>: 权限不够</span><br><span class=\"line\"></span><br><span class=\"line\"># 注意：这时通过zs用户去/pro目录下去操作，是无法进行操作的，该用户对此目录没有操作权限，当然ls用户也是一样。</span><br></pre></td></tr></table></figure>\n<p>创建一个用户组：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node1 ~]# groupadd userzu</span><br></pre></td></tr></table></figure>\n<p>将zs用户以及ls用户加入到userzu中</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node1 ~]# usermod -G userzu zs</span><br><span class=\"line\">[root@node1 ~]# usermod -G userzu ls</span><br><span class=\"line\">[root@node1 ~]# groups zs</span><br><span class=\"line\">zs : zs userzu</span><br><span class=\"line\">[root@node1 ~]# groups ls</span><br><span class=\"line\">ls : ls userzu\t\t# 将用户已经加入到组内</span><br></pre></td></tr></table></figure>\n<p>当然之加入到组中也是没有权限的，需要通过acl对此目录绑定权限：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node1 ~]# setfacl -m g:userzu:rwx /pro</span><br><span class=\"line\">[root@node1 ~]# chmod 775 /pro\t\t# 允许用户组有读写执\t行权限</span><br><span class=\"line\">[root@node1 ~]# getfacl /pro</span><br><span class=\"line\">getfacl: Removing leading <span class=\"string\">&#x27;/&#x27;</span> from absolute path names</span><br><span class=\"line\"># file: pro</span><br><span class=\"line\"># owner: root</span><br><span class=\"line\"># group: root</span><br><span class=\"line\">user::rwx</span><br><span class=\"line\">group::rwx</span><br><span class=\"line\">group:userzu:rwx\t\t# 这里已经显示由哪个组可以对该目录\t进行操作，并拥有什么样的权限（可以绑定多个用户组）</span><br><span class=\"line\">mask::rwx</span><br><span class=\"line\">other::r-x</span><br></pre></td></tr></table></figure>\n<p>再次切换zs用户去/pro目录进行操作</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[zs<span class=\"meta\">@node1</span> pro]$ touch &#123;<span class=\"number\">1.</span>.<span class=\"number\">3</span>&#125;</span><br><span class=\"line\">[zs<span class=\"meta\">@node1</span> pro]$ ls</span><br><span class=\"line\"><span class=\"number\">1</span>  <span class=\"number\">2</span>  <span class=\"number\">3</span></span><br><span class=\"line\">[zs<span class=\"meta\">@node1</span> pro]$ ll</span><br><span class=\"line\">总用量 <span class=\"number\">0</span></span><br><span class=\"line\">-rw-rw-r--. <span class=\"number\">1</span> zs zs <span class=\"number\">0</span> <span class=\"number\">9</span>月  <span class=\"number\">12</span> <span class=\"number\">17</span>:<span class=\"number\">34</span> <span class=\"number\">1</span></span><br><span class=\"line\">-rw-rw-r--. <span class=\"number\">1</span> zs zs <span class=\"number\">0</span> <span class=\"number\">9</span>月  <span class=\"number\">12</span> <span class=\"number\">17</span>:<span class=\"number\">34</span> <span class=\"number\">2</span></span><br><span class=\"line\">-rw-rw-r--. <span class=\"number\">1</span> zs zs <span class=\"number\">0</span> <span class=\"number\">9</span>月  <span class=\"number\">12</span> <span class=\"number\">17</span>:<span class=\"number\">34</span> <span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\"># 可以成功的进行操作！！！（ls用户也是一样）</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h5 id=\"ACL权限设置规则：\"><a href=\"#ACL权限设置规则：\" class=\"headerlink\" title=\"ACL权限设置规则：\"></a>ACL权限设置规则：</h5><blockquote>\n<p>可以给任何的用户或用户组设置任何文件/目录的访问权限。</p>\n</blockquote>\n<h6 id=\"添加ACL规则的命令格式：\"><a href=\"#添加ACL规则的命令格式：\" class=\"headerlink\" title=\"添加ACL规则的命令格式：\"></a>添加ACL规则的命令格式：</h6><p>　　①、给用户设定 ACL 权限：setfacl -m u:用户名:权限 指定文件名</p>\n<p>　　②、给用户组设定 ACL 权限:setfacl -m g:组名:权限 指定文件名</p>\n<h6 id=\"选项：\"><a href=\"#选项：\" class=\"headerlink\" title=\"选项：\"></a>选项：</h6><pre><code>-m：设定ACL权限\n        例：setfacl -m [g/u]:[组名/用户名]:rwx 指定的目录/文件\n\n-x：删除指定的ACL权限\n        例：setfacl -x [g/u]:[组名/用户名] 指定的目录/文件\n\n-b：删除所有的ACL权限\n        例：setfacl -b 指定的目录/文件</code></pre>\n<h5 id=\"拿用户组来举例（当然拿某个用户也是一样的）\"><a href=\"#拿用户组来举例（当然拿某个用户也是一样的）\" class=\"headerlink\" title=\"拿用户组来举例（当然拿某个用户也是一样的）\"></a>拿用户组来举例（当然拿某个用户也是一样的）</h5><p>创建一个目录：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node1 /]# mkdir /pro</span><br></pre></td></tr></table></figure>\n\n<p>创建两个用户：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node1 /]# useradd zs</span><br><span class=\"line\">[root@node1 /]# useradd ls</span><br></pre></td></tr></table></figure>\n\n<p>切换zs用户或者ls用户去/pro目录中进行操作</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node1 ~]# su zs</span><br><span class=\"line\">[zs<span class=\"meta\">@node1</span> root]$ cd /pro</span><br><span class=\"line\">[zs<span class=\"meta\">@node1</span> pro]$ touch file</span><br><span class=\"line\">touch: 无法创建<span class=\"string\">&quot;file&quot;</span>: 权限不够</span><br><span class=\"line\">[root@node1 ~]# su ls</span><br><span class=\"line\">[ls<span class=\"meta\">@node1</span> root]$ cd /pro</span><br><span class=\"line\">[ls<span class=\"meta\">@node1</span> pro]$ touch file</span><br><span class=\"line\">touch: 无法创建<span class=\"string\">&quot;file&quot;</span>: 权限不够</span><br><span class=\"line\"></span><br><span class=\"line\"># 注意：这时通过zs用户去/pro目录下去操作，是无法进行操作的，该用户对此目录没有操作权限，当然ls用户也是一样。</span><br></pre></td></tr></table></figure>\n<p>创建一个用户组：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node1 ~]# groupadd userzu</span><br></pre></td></tr></table></figure>\n<p>将zs用户以及ls用户加入到userzu中</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node1 ~]# usermod -G userzu zs</span><br><span class=\"line\">[root@node1 ~]# usermod -G userzu ls</span><br><span class=\"line\">[root@node1 ~]# groups zs</span><br><span class=\"line\">zs : zs userzu</span><br><span class=\"line\">[root@node1 ~]# groups ls</span><br><span class=\"line\">ls : ls userzu\t\t# 将用户已经加入到组内</span><br></pre></td></tr></table></figure>\n<p>当然之加入到组中也是没有权限的，需要通过acl对此目录绑定权限：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node1 ~]# setfacl -m g:userzu:rwx /pro</span><br><span class=\"line\">[root@node1 ~]# chmod 775 /pro\t\t# 允许用户组有读写执\t行权限</span><br><span class=\"line\">[root@node1 ~]# getfacl /pro</span><br><span class=\"line\">getfacl: Removing leading <span class=\"string\">&#x27;/&#x27;</span> from absolute path names</span><br><span class=\"line\"># file: pro</span><br><span class=\"line\"># owner: root</span><br><span class=\"line\"># group: root</span><br><span class=\"line\">user::rwx</span><br><span class=\"line\">group::rwx</span><br><span class=\"line\">group:userzu:rwx\t\t# 这里已经显示由哪个组可以对该目录\t进行操作，并拥有什么样的权限（可以绑定多个用户组）</span><br><span class=\"line\">mask::rwx</span><br><span class=\"line\">other::r-x</span><br></pre></td></tr></table></figure>\n<p>再次切换zs用户去/pro目录进行操作</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[zs<span class=\"meta\">@node1</span> pro]$ touch &#123;<span class=\"number\">1.</span>.<span class=\"number\">3</span>&#125;</span><br><span class=\"line\">[zs<span class=\"meta\">@node1</span> pro]$ ls</span><br><span class=\"line\"><span class=\"number\">1</span>  <span class=\"number\">2</span>  <span class=\"number\">3</span></span><br><span class=\"line\">[zs<span class=\"meta\">@node1</span> pro]$ ll</span><br><span class=\"line\">总用量 <span class=\"number\">0</span></span><br><span class=\"line\">-rw-rw-r--. <span class=\"number\">1</span> zs zs <span class=\"number\">0</span> <span class=\"number\">9</span>月  <span class=\"number\">12</span> <span class=\"number\">17</span>:<span class=\"number\">34</span> <span class=\"number\">1</span></span><br><span class=\"line\">-rw-rw-r--. <span class=\"number\">1</span> zs zs <span class=\"number\">0</span> <span class=\"number\">9</span>月  <span class=\"number\">12</span> <span class=\"number\">17</span>:<span class=\"number\">34</span> <span class=\"number\">2</span></span><br><span class=\"line\">-rw-rw-r--. <span class=\"number\">1</span> zs zs <span class=\"number\">0</span> <span class=\"number\">9</span>月  <span class=\"number\">12</span> <span class=\"number\">17</span>:<span class=\"number\">34</span> <span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\"># 可以成功的进行操作！！！（ls用户也是一样）</span><br></pre></td></tr></table></figure>\n"},{"title":"Linux环境更新Python3.8","author":"Semaik.","date":"2020-11-03T04:41:00.000Z","_content":"#### 进入Python官网下载软件包：https://www.python.org/downloads/\n\n![upload successful](/images/pasted-101.png)\n\n> 下载需要更新的软件包\n\n![upload successful](/images/pasted-102.png)\n\n#### 我就拿3.8.5软件包举例\n\n###### 创建一个存储目录\n```java\n[root@one /]# mkdir /usr/local/python3-8\n```\n###### 安装依赖\n```java\n[root@one /]# yum install gcc libffi-devel zlib* openssl-devel\n```\n###### 解压\n\n```java\n[root@one /]# unzip Python-3.8.5.zip\n[root@one /]# cd Python-3.8.5/\n[root@one Python-3.8.5]# ./configure --prefix=/usr/local/python3-8 && make && make install\n```\n###### 给予权限\n```java\n[root@one /]# chmod 777 /usr/local/python3-8/\n```\n###### 备份Python2的文件\n```java\n[root@one /]# cp /usr/bin/python /usr/bin/python2.bak\n[root@one /]# rm -rf /usr/bin/python\n```\n###### 将Python3的文件链接到/usr/bin/下\n```java\n[root@one /]# ln -s /usr/local/python3-8/bin/python3.8 /usr/bin/pyhton\n```\n###### 验证\n![upload successful](/images/pasted-103.png)\n\n![upload successful](/images/pasted-104.png)\n> 如果pip的版本未更换成3.8就需要手动操作了\n\n###### 如果Yum出现以下错误\n\n```java\n[root@one /]# yum -y install openssl*\n  File \"/usr/bin/yum\", line 30\n    except KeyboardInterrupt, e:\n                            ^\nSyntaxError: invalid syntax\n\n或\n\n总下载量：3.9 M\nDownloading packages:\n  File \"/usr/libexec/urlgrabber-ext-down\", line 28\n    except OSError, e:\n                  ^\n```\n###### 以上报错需要修改yum解释器\n\n```java\n[root@one /]# vi /usr/bin/yum\n[root@one /]# vi /usr/libexec/urlgrabber-ext-down\n# 都修改成同样的python2.7\n```\n![upload successful](/images/pasted-105.png)","source":"_posts/Linux环境更新Python3-8.md","raw":"title: Linux环境更新Python3.8\nauthor: Semaik.\ntags:\n  - Linux\ncategories:\n  - Linux\ndate: 2020-11-03 12:41:00\n---\n#### 进入Python官网下载软件包：https://www.python.org/downloads/\n\n![upload successful](/images/pasted-101.png)\n\n> 下载需要更新的软件包\n\n![upload successful](/images/pasted-102.png)\n\n#### 我就拿3.8.5软件包举例\n\n###### 创建一个存储目录\n```java\n[root@one /]# mkdir /usr/local/python3-8\n```\n###### 安装依赖\n```java\n[root@one /]# yum install gcc libffi-devel zlib* openssl-devel\n```\n###### 解压\n\n```java\n[root@one /]# unzip Python-3.8.5.zip\n[root@one /]# cd Python-3.8.5/\n[root@one Python-3.8.5]# ./configure --prefix=/usr/local/python3-8 && make && make install\n```\n###### 给予权限\n```java\n[root@one /]# chmod 777 /usr/local/python3-8/\n```\n###### 备份Python2的文件\n```java\n[root@one /]# cp /usr/bin/python /usr/bin/python2.bak\n[root@one /]# rm -rf /usr/bin/python\n```\n###### 将Python3的文件链接到/usr/bin/下\n```java\n[root@one /]# ln -s /usr/local/python3-8/bin/python3.8 /usr/bin/pyhton\n```\n###### 验证\n![upload successful](/images/pasted-103.png)\n\n![upload successful](/images/pasted-104.png)\n> 如果pip的版本未更换成3.8就需要手动操作了\n\n###### 如果Yum出现以下错误\n\n```java\n[root@one /]# yum -y install openssl*\n  File \"/usr/bin/yum\", line 30\n    except KeyboardInterrupt, e:\n                            ^\nSyntaxError: invalid syntax\n\n或\n\n总下载量：3.9 M\nDownloading packages:\n  File \"/usr/libexec/urlgrabber-ext-down\", line 28\n    except OSError, e:\n                  ^\n```\n###### 以上报错需要修改yum解释器\n\n```java\n[root@one /]# vi /usr/bin/yum\n[root@one /]# vi /usr/libexec/urlgrabber-ext-down\n# 都修改成同样的python2.7\n```\n![upload successful](/images/pasted-105.png)","slug":"Linux环境更新Python3-8","published":1,"updated":"2020-11-03T05:13:26.097Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737c001fm3pve6nfew20","content":"<h4 id=\"进入Python官网下载软件包：https-www-python-org-downloads\"><a href=\"#进入Python官网下载软件包：https-www-python-org-downloads\" class=\"headerlink\" title=\"进入Python官网下载软件包：https://www.python.org/downloads/\"></a>进入Python官网下载软件包：<a href=\"https://www.python.org/downloads/\">https://www.python.org/downloads/</a></h4><p><img src=\"/images/pasted-101.png\" alt=\"upload successful\"></p>\n<blockquote>\n<p>下载需要更新的软件包</p>\n</blockquote>\n<p><img src=\"/images/pasted-102.png\" alt=\"upload successful\"></p>\n<h4 id=\"我就拿3-8-5软件包举例\"><a href=\"#我就拿3-8-5软件包举例\" class=\"headerlink\" title=\"我就拿3.8.5软件包举例\"></a>我就拿3.8.5软件包举例</h4><h6 id=\"创建一个存储目录\"><a href=\"#创建一个存储目录\" class=\"headerlink\" title=\"创建一个存储目录\"></a>创建一个存储目录</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@one /]# mkdir /usr/local/python3-8</span><br></pre></td></tr></table></figure>\n<h6 id=\"安装依赖\"><a href=\"#安装依赖\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@one /]# yum install gcc libffi-devel zlib* openssl-devel</span><br></pre></td></tr></table></figure>\n<h6 id=\"解压\"><a href=\"#解压\" class=\"headerlink\" title=\"解压\"></a>解压</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@one /]# unzip Python-3.8.5.zip</span><br><span class=\"line\">[root@one /]# cd Python-3.8.5/</span><br><span class=\"line\">[root@one Python-3.8.5]# ./configure --prefix=/usr/local/python3-8 &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n<h6 id=\"给予权限\"><a href=\"#给予权限\" class=\"headerlink\" title=\"给予权限\"></a>给予权限</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@one /]# chmod 777 /usr/local/python3-8/</span><br></pre></td></tr></table></figure>\n<h6 id=\"备份Python2的文件\"><a href=\"#备份Python2的文件\" class=\"headerlink\" title=\"备份Python2的文件\"></a>备份Python2的文件</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@one /]# cp /usr/bin/python /usr/bin/python2.bak</span><br><span class=\"line\">[root@one /]# rm -rf /usr/bin/python</span><br></pre></td></tr></table></figure>\n<h6 id=\"将Python3的文件链接到-usr-bin-下\"><a href=\"#将Python3的文件链接到-usr-bin-下\" class=\"headerlink\" title=\"将Python3的文件链接到/usr/bin/下\"></a>将Python3的文件链接到/usr/bin/下</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@one /]# ln -s /usr/local/python3-8/bin/python3.8 /usr/bin/pyhton</span><br></pre></td></tr></table></figure>\n<h6 id=\"验证\"><a href=\"#验证\" class=\"headerlink\" title=\"验证\"></a>验证</h6><p><img src=\"/images/pasted-103.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-104.png\" alt=\"upload successful\"></p>\n<blockquote>\n<p>如果pip的版本未更换成3.8就需要手动操作了</p>\n</blockquote>\n<h6 id=\"如果Yum出现以下错误\"><a href=\"#如果Yum出现以下错误\" class=\"headerlink\" title=\"如果Yum出现以下错误\"></a>如果Yum出现以下错误</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@one /]# yum -y install openssl*</span><br><span class=\"line\">  File <span class=\"string\">&quot;/usr/bin/yum&quot;</span>, line <span class=\"number\">30</span></span><br><span class=\"line\">    except KeyboardInterrupt, e:</span><br><span class=\"line\">                            ^</span><br><span class=\"line\">SyntaxError: invalid syntax</span><br><span class=\"line\"></span><br><span class=\"line\">或</span><br><span class=\"line\"></span><br><span class=\"line\">总下载量：<span class=\"number\">3.9</span> M</span><br><span class=\"line\">Downloading packages:</span><br><span class=\"line\">  File <span class=\"string\">&quot;/usr/libexec/urlgrabber-ext-down&quot;</span>, line <span class=\"number\">28</span></span><br><span class=\"line\">    except OSError, e:</span><br><span class=\"line\">                  ^</span><br></pre></td></tr></table></figure>\n<h6 id=\"以上报错需要修改yum解释器\"><a href=\"#以上报错需要修改yum解释器\" class=\"headerlink\" title=\"以上报错需要修改yum解释器\"></a>以上报错需要修改yum解释器</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@one /]# vi /usr/bin/yum</span><br><span class=\"line\">[root@one /]# vi /usr/libexec/urlgrabber-ext-down</span><br><span class=\"line\"># 都修改成同样的python2.7</span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/pasted-105.png\" alt=\"upload successful\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h4 id=\"进入Python官网下载软件包：https-www-python-org-downloads\"><a href=\"#进入Python官网下载软件包：https-www-python-org-downloads\" class=\"headerlink\" title=\"进入Python官网下载软件包：https://www.python.org/downloads/\"></a>进入Python官网下载软件包：<a href=\"https://www.python.org/downloads/\">https://www.python.org/downloads/</a></h4><p><img src=\"/images/pasted-101.png\" alt=\"upload successful\"></p>\n<blockquote>\n<p>下载需要更新的软件包</p>\n</blockquote>\n<p><img src=\"/images/pasted-102.png\" alt=\"upload successful\"></p>\n<h4 id=\"我就拿3-8-5软件包举例\"><a href=\"#我就拿3-8-5软件包举例\" class=\"headerlink\" title=\"我就拿3.8.5软件包举例\"></a>我就拿3.8.5软件包举例</h4><h6 id=\"创建一个存储目录\"><a href=\"#创建一个存储目录\" class=\"headerlink\" title=\"创建一个存储目录\"></a>创建一个存储目录</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@one /]# mkdir /usr/local/python3-8</span><br></pre></td></tr></table></figure>\n<h6 id=\"安装依赖\"><a href=\"#安装依赖\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@one /]# yum install gcc libffi-devel zlib* openssl-devel</span><br></pre></td></tr></table></figure>\n<h6 id=\"解压\"><a href=\"#解压\" class=\"headerlink\" title=\"解压\"></a>解压</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@one /]# unzip Python-3.8.5.zip</span><br><span class=\"line\">[root@one /]# cd Python-3.8.5/</span><br><span class=\"line\">[root@one Python-3.8.5]# ./configure --prefix=/usr/local/python3-8 &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n<h6 id=\"给予权限\"><a href=\"#给予权限\" class=\"headerlink\" title=\"给予权限\"></a>给予权限</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@one /]# chmod 777 /usr/local/python3-8/</span><br></pre></td></tr></table></figure>\n<h6 id=\"备份Python2的文件\"><a href=\"#备份Python2的文件\" class=\"headerlink\" title=\"备份Python2的文件\"></a>备份Python2的文件</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@one /]# cp /usr/bin/python /usr/bin/python2.bak</span><br><span class=\"line\">[root@one /]# rm -rf /usr/bin/python</span><br></pre></td></tr></table></figure>\n<h6 id=\"将Python3的文件链接到-usr-bin-下\"><a href=\"#将Python3的文件链接到-usr-bin-下\" class=\"headerlink\" title=\"将Python3的文件链接到/usr/bin/下\"></a>将Python3的文件链接到/usr/bin/下</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@one /]# ln -s /usr/local/python3-8/bin/python3.8 /usr/bin/pyhton</span><br></pre></td></tr></table></figure>\n<h6 id=\"验证\"><a href=\"#验证\" class=\"headerlink\" title=\"验证\"></a>验证</h6><p><img src=\"/images/pasted-103.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-104.png\" alt=\"upload successful\"></p>\n<blockquote>\n<p>如果pip的版本未更换成3.8就需要手动操作了</p>\n</blockquote>\n<h6 id=\"如果Yum出现以下错误\"><a href=\"#如果Yum出现以下错误\" class=\"headerlink\" title=\"如果Yum出现以下错误\"></a>如果Yum出现以下错误</h6><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@one /]# yum -y install openssl*</span><br><span class=\"line\">  File <span class=\"string\">&quot;/usr/bin/yum&quot;</span>, line <span class=\"number\">30</span></span><br><span class=\"line\">    except KeyboardInterrupt, e:</span><br><span class=\"line\">                            ^</span><br><span class=\"line\">SyntaxError: invalid syntax</span><br><span class=\"line\"></span><br><span class=\"line\">或</span><br><span class=\"line\"></span><br><span class=\"line\">总下载量：<span class=\"number\">3.9</span> M</span><br><span class=\"line\">Downloading packages:</span><br><span class=\"line\">  File <span class=\"string\">&quot;/usr/libexec/urlgrabber-ext-down&quot;</span>, line <span class=\"number\">28</span></span><br><span class=\"line\">    except OSError, e:</span><br><span class=\"line\">                  ^</span><br></pre></td></tr></table></figure>\n<h6 id=\"以上报错需要修改yum解释器\"><a href=\"#以上报错需要修改yum解释器\" class=\"headerlink\" title=\"以上报错需要修改yum解释器\"></a>以上报错需要修改yum解释器</h6><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@one /]# vi /usr/bin/yum</span><br><span class=\"line\">[root@one /]# vi /usr/libexec/urlgrabber-ext-down</span><br><span class=\"line\"># 都修改成同样的python2.7</span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/pasted-105.png\" alt=\"upload successful\"></p>\n"},{"title":"Linux高效文件处理三剑客","date":"2020-09-10T06:39:48.000Z","_content":"> grep、sed、awk我们叫他们三剑客，掌握它们可以更好的运维，提升工作效率，即使不是运维，对我们处理数据都是非常方便的～就很多数据处理来讲，写程序肯定是也能处理的，但是远没有已经存在特定功能的命令更高效，我们只需要操作命令即可。通过本文可以讲解三剑客的一些基础知识和实用;\n\n### Grep\n简介\ngrep是一款强大的文本搜索工具，支持正则表达式。\n全称（ global search regular expression(RE) and print out the line）\n语法:grep [option]... PATTERN [FILE]...\n常用:\n```java\nusage: grep [-abcDEFGHhIiJLlmnOoqRSsUVvwxZ] [-A num] [-B num] [-C[num]]\n [-e pattern] [-f file] [--binary-files=value] [--color=when]\n [--context[=num]] [--directories=action] [--label] [--line-buffered]\n [--null] [pattern] [file ...]\n```\n常用参数：\n```java\n            -v        取反\n            -i        忽略大小写\n            -c        符合条件的行数\n            -n        输出的同时打印行号\n            ^*        以*开头         \n            *$         以*结尾 \n            ^$         空行 \n```\n实际使用\n准备好一个小故事txt：\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# cat monkey\nOne day,a little monkey is playing by the well.一天,有只小猴子在井边玩儿.\nHe looks in the well and shouts :它往井里一瞧,高喊道：\n“Oh!My god!The moon has fallen into the well!” “噢!我的天!月亮掉到井里头啦!”\nAn older monkeys runs over,takes a look,and says,一只大猴子跑来一看,说,\n“Goodness me!The moon is really in the water!” “糟啦!月亮掉在井里头啦!”\nAnd olderly monkey comes over.老猴子也跑过来.\nHe is very surprised as well and cries out:他也非常惊奇,喊道：\n“The moon is in the well.” “糟了,月亮掉在井里头了!”\nA group of monkeys run over to the well .一群猴子跑到井边来,\nThey look at the moon in the well and shout:他们看到井里的月亮,喊道：\n“The moon did fall into the well!Come on!Let’get it out!”\n“月亮掉在井里头啦!快来!让我们把它捞起来!”\nThen,the oldest monkey hangs on the tree up side down ,with his feet on the branch .\n然后,老猴子倒挂在大树上,\nAnd he pulls the next monkey’s feet with his hands.拉住大猴子的脚,\nAll the other monkeys follow his suit,其他的猴子一个个跟着,\nAnd they join each other one by one down to the moon in the well.\n它们一只连着一只直到井里.\nJust before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢\nHe yells excitedly “Don’t be so foolish!The moon is still in the sky!”\n它兴奋地大叫：“别蠢了!月亮还好好地挂在天上呢!\n```\n#### 直接查找符合条件的行\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# grep moon monkey\n“Oh!My god!The moon has fallen into the well!” “噢!我的天!月亮掉到井里头啦!”\n“Goodness me!The moon is really in the water!” “糟啦!月亮掉在井里头啦!”\n“The moon is in the well.” “糟了,月亮掉在井里头了!”\nThey look at the moon in the well and shout:他们看到井里的月亮,喊道：\n“The moon did fall into the well!Come on!Let’get it out!”\nAnd they join each other one by one down to the moon in the well.\nJust before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢\nHe yells excitedly “Don’t be so foolish!The moon is still in the sky!”\n```\n#### 查找反向符合条件的行\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# grep -v  moon monkey\nOne day,a little monkey is playing by the well.一天,有只小猴子在井边玩儿.\nHe looks in the well and shouts :它往井里一瞧,高喊道：\nAn older monkeys runs over,takes a look,and says,一只大猴子跑来一看,说,\nAnd olderly monkey comes over.老猴子也跑过来.\nHe is very surprised as well and cries out:他也非常惊奇,喊道：\nA group of monkeys run over to the well .一群猴子跑到井边来,\n“月亮掉在井里头啦!快来!让我们把它捞起来!”\nThen,the oldest monkey hangs on the tree up side down ,with his feet on the branch .\n然后,老猴子倒挂在大树上,\nAnd he pulls the next monkey’s feet with his hands.拉住大猴子的脚,\nAll the other monkeys follow his suit,其他的猴子一个个跟着,\n它们一只连着一只直到井里.\n它兴奋地大叫：“别蠢了!月亮还好好地挂在天上呢!”\n```\n#### 直接查找符合条件的行数\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# grep -c  moon monkey\n8\n```\n#### 忽略大小写查找符合条件的行数\n先来看一下直接查找的结果\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# grep my monkey\n```\n#### 忽略大小写查看\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# grep -i my monkey\n“Oh!My god!The moon has fallen into the well!” “噢!我的天!月亮掉到井里头啦!”\n```\n#### 查找符合条件的行并输出行号\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# grep -n monkey monkey\n1:One day,a little monkey is playing by the well.一天,有只小猴子在井边玩儿.\n4:An older monkeys runs over,takes a look,and says,一只大猴子跑来一看,说,\n6:And olderly monkey comes over.老猴子也跑过来.\n9:A group of monkeys run over to the well .一群猴子跑到井边来,\n13:Then,the oldest monkey hangs on the tree up side down ,with his feet on the branch .\n15:And he pulls the next monkey’s feet with his hands.拉住大猴子的脚,\n16:All the other monkeys follow his suit,其他的猴子一个个跟着,\n19:Just before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢\n```\n#### 查找开头是J的行\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# grep '^J' monkey\nJust before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢\n```\n#### 查找结尾是呢的行\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# grep \"呢$\" monkey\nJust before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢\n```\n\n### Sed\n> sed是一种流编辑器，是一款处理文本比较优秀的工具，可以结合正则表达式一起使用。\n#### sed命令\n命令: sed\n语法 : sed [选项]... {命令集} [输入文件]...\n```java\n常用参数:\n            d  删除选择的行    \n            s   查找    \n            y  替换\n            i   当前行前面插入一行\n            a  当前行后面插入一行\n            p  打印行       \n            q  退出     \n\n 替换符:\n\n            数字 ：替换第几处    \n            g :  全局替换    \n            \\1:  子串匹配标记，前面搜索可以用元字符集\\(..\\)\n            &:  保留搜索刀的字符用来替换其他字符\n#### 操作\n##### 替换操作\n查看文件：\n```java\n# cat word\nTwinkle, twinkle, little star\nHow I wonder what you are\nUp above the world so high\nLike a diamond in the sky\nWhen the blazing sun is gone\n```\n替换：\n```java\n# sed 's/little/big/' word\nTwinkle, twinkle, big star\nHow I wonder what you are\nUp above the world so high\nLike a diamond in the sky\nWhen the blazing sun is gone\n```\n查看文本：\n```java\n# word1\nOh if there's one thing to be taught\nit's dreams are made to be caught\nand friends can never be bought\nDoesn't matter how long it's been\nI know you'll always jump in\n'Cause we don't know how to quit\n```\n全局替换：\n```java\n# sed 's/to/can/g' word1\nOh if there's one thing can be taught\nit's dreams are made can be caught\nand friends can nev\n```\n按行替换（替换2到最后一行)\n```java\n# sed '2,$s/to/can/' word1\nOh if there's one thing to be taught\nit's dreams are made can be caught\nand friends can never be bought\nDoesn't matter how long it's been\nI know you'll always jump in\n'Cause we don't know how can quit\n```java\n##### 删除操作:\n查看文本:\n```java\n# cat word\nTwinkle, twinkle, little star\nHow I wonder what you are\nUp above the world so high\nLike a diamond in the sky\nWhen the blazing sun is gone\n```\n删除:\n```java\n# sed '2d' word\nTwinkle, twinkle, little star\nUp above the world so high\nLike a diamond in the sky\nWhen the blazing sun is gone\n```\n显示行号:\n```java\n# sed '=;2d' word\n1\nTwinkle, twinkle, little star\n2\n3\nUp above the world so high\n4\nLike a diamond in the sky\n5\nWhen the blazing sun is gone\n```\n删除第2行到第四行:\n```java\n# sed '=;2,4d' word\n1\nTwinkle, twinkle, little star\n2\n3\n4\n5\nWhen the blazing sun is gone\n```\n##### 添加行操作:\n向前插入:\n```java\n# echo \"hello\" | sed 'i\\kitty'\nkitty\nhello\n```\n向后插入:\n```java\n# echo \"kitty\" | sed 'i\\hello'\nhello\nkitty\n```\n##### 修改行操作:\n替换第二行为hello kitty\n```java\n# sed '2c\\hello kitty' word\nTwinkle, twinkle, little star\nhello kitty\nUp above the world so high\nLike a diamond in the sky\nWhen the blazing sun is gone\n```\n替换第二行到最后一行为hello kitty\n```java\n# sed '2,$c\\hello kitty' word\nTwinkle, twinkle, little star\nhello kitty\n```\n##### 写入行操作\n把带star的行写入c文件中,c提前创建\n```java\n# sed -n '/star/w c' word\n# cat c\nTwinkle, twinkle, little star\n```\n##### 退出\n打印3行后，退出sed\n```java\n# sed '3q' word\nTwinkle, twinkle, little star\nHow I wonder what you are\nUp above the world so higher be bought\nDoesn't matter how long it's been\nI know you'll always jump in\n'Cause we don't know how can quit\n```\n##### 日常使用sed操作修改配置文件:\n查看原始数据\n```java\n[root@node2 ~]# cat /etc/ssh/sshd_config | grep Root\n# PermitRootLogin yes\n```\n操作指令\n```java\n[root@node2 ~]# sed -i '/PermitRootLogin/c\\PermitRootLogin no'  /etc/ssh/sshd_config\n```\n查看修改后的数据\n```java\n[root@node2 ~]# cat /etc/ssh/sshd_config | grep Root\nPermitRootLogin no\n```\n\n\n### Awk\n> awk是一个强大的文本分析工具，相对于grep的查找，sed的编辑，awk在其对数据分析并生成报告时，显得尤为强大。简单来说awk就是把文件逐行的读入，以空格为默认分隔符将每行切片，切开的部分再进行各种分析处理。\n\n命令格式：\nawk [option] 'scrip' var=value\n\n参数：\noption：\n-F 指定输入的分割字符，默认为 空格\n-v var=value 赋值一个用户自定义变量\n-f scripfile 从脚本中读取 awk 命令\n#### AWK 模式和操作awk 脚本是由模式和操作组成的。\n\n##### 模式\n模式可以是以下任意一个：\n```java\n/正则表达式/： 使用通配符的扩展集\n关系表达式：    使用运算符进行操作，可以是字符串或者数字比较测试\n模式匹配表达式：用运算符~9匹配和~！（不匹配）\nBEGIN 语句块，pattern语句块、END语句块\n```\n##### 操作\n操作有一个或者多个命令、函数、表达式组成，之间由换行符或分号隔开，并位于大括号内、主要部分有：\n```java\n变量或属组赋值\n输出命令\n内置函数\n控制流程语句\n```\n##### 实例\n例： 只是显示最近登录的5个帐号\n```java\n[root@localhost ~]# last -n 5 \nroot     pts/0        192.168.116.1    Fri Jun 12 10:59   still logged in   \nreboot   system boot  3.10.0-862.el7.x Fri Jun 12 10:58 - 11:36  (00:38)    \nreboot   system boot  3.10.0-862.el7.x Fri Jun  5 21:07 - 11:36 (6+14:28)   \nroot     pts/0        192.168.116.1    Fri Jun  5 18:40 - crash  (02:27)    \nreboot   system boot  3.10.0-862.el7.x Fri Jun  5 17:28 - 11:36 (6+18:08)   \n\nwtmp begins Thu Oct 10 22:36:04 2019\n[root@localhost ~]# last -n 5 | awk '{print $1}'\nroot\nreboot\nreboot\nroot\nreboot\n```\n例： 只显示/etc/passwd的账户\n```java\n[root@localhost ~]# cat /etc/passwd | awk -F ':' '{print $1}'\nroot\nbin\ndaemon\nadm\nlp\nsync\nshutdown\nhalt\nmail\noperator\ngames\nftp\nnobody\nsystemd-network\ndbus\npolkitd\ntss\nsshd\npostfix\nchrony\nmysql\n```\n例：只显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以tab键分割\n```java\n[root@localhost ~]# cat /etc/passwd | awk -F ':' '{print $1\"\\t\"$7}' \ndbus    /sbin/nologin\npolkitd    /sbin/nologin\ntss    /sbin/nologin\nsshd    /sbin/nologin\npostfix    /sbin/nologin\nchrony    /sbin/nologin\nmysql    /bin/bash\n```\n例：只是显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以逗号分割,而且在所有行添加列名name,shell,在最后一行添加”blue,/bin/nosh”\n```java\n[root@localhost ~]# cat /etc/passwd | awk -F ':' 'BEGIN {print \"name,shell\"} {print $1\"\\t\"$7} END {print \"Hello,/bin/nosh\"}'\ndbus    /sbin/nologin\npolkitd    /sbin/nologin\ntss    /sbin/nologin\nsshd    /sbin/nologin\npostfix    /sbin/nologin\nchrony    /sbin/nologin\nmysql    /bin/bash\nHello,/bin/nosh\n```\n> awk工作流程是这样的：先执行BEGING，然后读取文件，读入有/n换行符分割的一条记录，然后将记录按指定的域分隔符划分域，填充域，$0则表示所有域,$1表示第一个域,$n表示第n个域,随后开始执行模式所对应的动作action。接着开始读入第二条记录······直到所有的记录都读完，最后执行END操作。\n\n```java\n第一步： 执行 BEGIN {commond} 指令\n第二步： 从文件或标准输入{stdin}读取一行然后执行 pattern { commmod } \n第三步； 从读至输入流末尾，执行 END {commod}语句\n```\n> BEGIN 在awk 开始输入读取之前被执行，属于一个可选的模块，一般用于变量初始化、打印输出表头\n> \n> pattern 通用命令，是最重要的一块，属于可选的，一般用于打印出指定的列，如果没有指定 petter 模块，则默认执行 {print $0} 既打印出所有读取到的内容\n> \n> END 在 AWK 从输入流中读取完所有的内容之后再执行，在 awk 整个语句输入中末尾执行\n\n例：搜索 /etc/passwd 有 root 关键字的行\n```java\n[root@localhost ~]# awk -F: '/root/' /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\noperator:x:11:0:operator:/root:/sbin/nologin\n```\n例：搜索/etc/passwd有root关键字的所有行，并显示对应的shell\n```java\n[root@localhost ~]# awk -F: '/root/{print $7}' /etc/passwd\n/bin/bash\n/sbin/nologin\n```","source":"_posts/Linux高效文件处理三剑客.md","raw":"title: Linux高效文件处理三剑客\ncategories: Linux\ntags:\n  - Linux\ndate: 2020-09-10 14:39:48\n---\n> grep、sed、awk我们叫他们三剑客，掌握它们可以更好的运维，提升工作效率，即使不是运维，对我们处理数据都是非常方便的～就很多数据处理来讲，写程序肯定是也能处理的，但是远没有已经存在特定功能的命令更高效，我们只需要操作命令即可。通过本文可以讲解三剑客的一些基础知识和实用;\n\n### Grep\n简介\ngrep是一款强大的文本搜索工具，支持正则表达式。\n全称（ global search regular expression(RE) and print out the line）\n语法:grep [option]... PATTERN [FILE]...\n常用:\n```java\nusage: grep [-abcDEFGHhIiJLlmnOoqRSsUVvwxZ] [-A num] [-B num] [-C[num]]\n [-e pattern] [-f file] [--binary-files=value] [--color=when]\n [--context[=num]] [--directories=action] [--label] [--line-buffered]\n [--null] [pattern] [file ...]\n```\n常用参数：\n```java\n            -v        取反\n            -i        忽略大小写\n            -c        符合条件的行数\n            -n        输出的同时打印行号\n            ^*        以*开头         \n            *$         以*结尾 \n            ^$         空行 \n```\n实际使用\n准备好一个小故事txt：\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# cat monkey\nOne day,a little monkey is playing by the well.一天,有只小猴子在井边玩儿.\nHe looks in the well and shouts :它往井里一瞧,高喊道：\n“Oh!My god!The moon has fallen into the well!” “噢!我的天!月亮掉到井里头啦!”\nAn older monkeys runs over,takes a look,and says,一只大猴子跑来一看,说,\n“Goodness me!The moon is really in the water!” “糟啦!月亮掉在井里头啦!”\nAnd olderly monkey comes over.老猴子也跑过来.\nHe is very surprised as well and cries out:他也非常惊奇,喊道：\n“The moon is in the well.” “糟了,月亮掉在井里头了!”\nA group of monkeys run over to the well .一群猴子跑到井边来,\nThey look at the moon in the well and shout:他们看到井里的月亮,喊道：\n“The moon did fall into the well!Come on!Let’get it out!”\n“月亮掉在井里头啦!快来!让我们把它捞起来!”\nThen,the oldest monkey hangs on the tree up side down ,with his feet on the branch .\n然后,老猴子倒挂在大树上,\nAnd he pulls the next monkey’s feet with his hands.拉住大猴子的脚,\nAll the other monkeys follow his suit,其他的猴子一个个跟着,\nAnd they join each other one by one down to the moon in the well.\n它们一只连着一只直到井里.\nJust before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢\nHe yells excitedly “Don’t be so foolish!The moon is still in the sky!”\n它兴奋地大叫：“别蠢了!月亮还好好地挂在天上呢!\n```\n#### 直接查找符合条件的行\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# grep moon monkey\n“Oh!My god!The moon has fallen into the well!” “噢!我的天!月亮掉到井里头啦!”\n“Goodness me!The moon is really in the water!” “糟啦!月亮掉在井里头啦!”\n“The moon is in the well.” “糟了,月亮掉在井里头了!”\nThey look at the moon in the well and shout:他们看到井里的月亮,喊道：\n“The moon did fall into the well!Come on!Let’get it out!”\nAnd they join each other one by one down to the moon in the well.\nJust before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢\nHe yells excitedly “Don’t be so foolish!The moon is still in the sky!”\n```\n#### 查找反向符合条件的行\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# grep -v  moon monkey\nOne day,a little monkey is playing by the well.一天,有只小猴子在井边玩儿.\nHe looks in the well and shouts :它往井里一瞧,高喊道：\nAn older monkeys runs over,takes a look,and says,一只大猴子跑来一看,说,\nAnd olderly monkey comes over.老猴子也跑过来.\nHe is very surprised as well and cries out:他也非常惊奇,喊道：\nA group of monkeys run over to the well .一群猴子跑到井边来,\n“月亮掉在井里头啦!快来!让我们把它捞起来!”\nThen,the oldest monkey hangs on the tree up side down ,with his feet on the branch .\n然后,老猴子倒挂在大树上,\nAnd he pulls the next monkey’s feet with his hands.拉住大猴子的脚,\nAll the other monkeys follow his suit,其他的猴子一个个跟着,\n它们一只连着一只直到井里.\n它兴奋地大叫：“别蠢了!月亮还好好地挂在天上呢!”\n```\n#### 直接查找符合条件的行数\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# grep -c  moon monkey\n8\n```\n#### 忽略大小写查找符合条件的行数\n先来看一下直接查找的结果\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# grep my monkey\n```\n#### 忽略大小写查看\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# grep -i my monkey\n“Oh!My god!The moon has fallen into the well!” “噢!我的天!月亮掉到井里头啦!”\n```\n#### 查找符合条件的行并输出行号\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# grep -n monkey monkey\n1:One day,a little monkey is playing by the well.一天,有只小猴子在井边玩儿.\n4:An older monkeys runs over,takes a look,and says,一只大猴子跑来一看,说,\n6:And olderly monkey comes over.老猴子也跑过来.\n9:A group of monkeys run over to the well .一群猴子跑到井边来,\n13:Then,the oldest monkey hangs on the tree up side down ,with his feet on the branch .\n15:And he pulls the next monkey’s feet with his hands.拉住大猴子的脚,\n16:All the other monkeys follow his suit,其他的猴子一个个跟着,\n19:Just before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢\n```\n#### 查找开头是J的行\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# grep '^J' monkey\nJust before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢\n```\n#### 查找结尾是呢的行\n```java\n[root@iz2ze76ybn73dvwmdij06zz ~]# grep \"呢$\" monkey\nJust before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢\n```\n\n### Sed\n> sed是一种流编辑器，是一款处理文本比较优秀的工具，可以结合正则表达式一起使用。\n#### sed命令\n命令: sed\n语法 : sed [选项]... {命令集} [输入文件]...\n```java\n常用参数:\n            d  删除选择的行    \n            s   查找    \n            y  替换\n            i   当前行前面插入一行\n            a  当前行后面插入一行\n            p  打印行       \n            q  退出     \n\n 替换符:\n\n            数字 ：替换第几处    \n            g :  全局替换    \n            \\1:  子串匹配标记，前面搜索可以用元字符集\\(..\\)\n            &:  保留搜索刀的字符用来替换其他字符\n#### 操作\n##### 替换操作\n查看文件：\n```java\n# cat word\nTwinkle, twinkle, little star\nHow I wonder what you are\nUp above the world so high\nLike a diamond in the sky\nWhen the blazing sun is gone\n```\n替换：\n```java\n# sed 's/little/big/' word\nTwinkle, twinkle, big star\nHow I wonder what you are\nUp above the world so high\nLike a diamond in the sky\nWhen the blazing sun is gone\n```\n查看文本：\n```java\n# word1\nOh if there's one thing to be taught\nit's dreams are made to be caught\nand friends can never be bought\nDoesn't matter how long it's been\nI know you'll always jump in\n'Cause we don't know how to quit\n```\n全局替换：\n```java\n# sed 's/to/can/g' word1\nOh if there's one thing can be taught\nit's dreams are made can be caught\nand friends can nev\n```\n按行替换（替换2到最后一行)\n```java\n# sed '2,$s/to/can/' word1\nOh if there's one thing to be taught\nit's dreams are made can be caught\nand friends can never be bought\nDoesn't matter how long it's been\nI know you'll always jump in\n'Cause we don't know how can quit\n```java\n##### 删除操作:\n查看文本:\n```java\n# cat word\nTwinkle, twinkle, little star\nHow I wonder what you are\nUp above the world so high\nLike a diamond in the sky\nWhen the blazing sun is gone\n```\n删除:\n```java\n# sed '2d' word\nTwinkle, twinkle, little star\nUp above the world so high\nLike a diamond in the sky\nWhen the blazing sun is gone\n```\n显示行号:\n```java\n# sed '=;2d' word\n1\nTwinkle, twinkle, little star\n2\n3\nUp above the world so high\n4\nLike a diamond in the sky\n5\nWhen the blazing sun is gone\n```\n删除第2行到第四行:\n```java\n# sed '=;2,4d' word\n1\nTwinkle, twinkle, little star\n2\n3\n4\n5\nWhen the blazing sun is gone\n```\n##### 添加行操作:\n向前插入:\n```java\n# echo \"hello\" | sed 'i\\kitty'\nkitty\nhello\n```\n向后插入:\n```java\n# echo \"kitty\" | sed 'i\\hello'\nhello\nkitty\n```\n##### 修改行操作:\n替换第二行为hello kitty\n```java\n# sed '2c\\hello kitty' word\nTwinkle, twinkle, little star\nhello kitty\nUp above the world so high\nLike a diamond in the sky\nWhen the blazing sun is gone\n```\n替换第二行到最后一行为hello kitty\n```java\n# sed '2,$c\\hello kitty' word\nTwinkle, twinkle, little star\nhello kitty\n```\n##### 写入行操作\n把带star的行写入c文件中,c提前创建\n```java\n# sed -n '/star/w c' word\n# cat c\nTwinkle, twinkle, little star\n```\n##### 退出\n打印3行后，退出sed\n```java\n# sed '3q' word\nTwinkle, twinkle, little star\nHow I wonder what you are\nUp above the world so higher be bought\nDoesn't matter how long it's been\nI know you'll always jump in\n'Cause we don't know how can quit\n```\n##### 日常使用sed操作修改配置文件:\n查看原始数据\n```java\n[root@node2 ~]# cat /etc/ssh/sshd_config | grep Root\n# PermitRootLogin yes\n```\n操作指令\n```java\n[root@node2 ~]# sed -i '/PermitRootLogin/c\\PermitRootLogin no'  /etc/ssh/sshd_config\n```\n查看修改后的数据\n```java\n[root@node2 ~]# cat /etc/ssh/sshd_config | grep Root\nPermitRootLogin no\n```\n\n\n### Awk\n> awk是一个强大的文本分析工具，相对于grep的查找，sed的编辑，awk在其对数据分析并生成报告时，显得尤为强大。简单来说awk就是把文件逐行的读入，以空格为默认分隔符将每行切片，切开的部分再进行各种分析处理。\n\n命令格式：\nawk [option] 'scrip' var=value\n\n参数：\noption：\n-F 指定输入的分割字符，默认为 空格\n-v var=value 赋值一个用户自定义变量\n-f scripfile 从脚本中读取 awk 命令\n#### AWK 模式和操作awk 脚本是由模式和操作组成的。\n\n##### 模式\n模式可以是以下任意一个：\n```java\n/正则表达式/： 使用通配符的扩展集\n关系表达式：    使用运算符进行操作，可以是字符串或者数字比较测试\n模式匹配表达式：用运算符~9匹配和~！（不匹配）\nBEGIN 语句块，pattern语句块、END语句块\n```\n##### 操作\n操作有一个或者多个命令、函数、表达式组成，之间由换行符或分号隔开，并位于大括号内、主要部分有：\n```java\n变量或属组赋值\n输出命令\n内置函数\n控制流程语句\n```\n##### 实例\n例： 只是显示最近登录的5个帐号\n```java\n[root@localhost ~]# last -n 5 \nroot     pts/0        192.168.116.1    Fri Jun 12 10:59   still logged in   \nreboot   system boot  3.10.0-862.el7.x Fri Jun 12 10:58 - 11:36  (00:38)    \nreboot   system boot  3.10.0-862.el7.x Fri Jun  5 21:07 - 11:36 (6+14:28)   \nroot     pts/0        192.168.116.1    Fri Jun  5 18:40 - crash  (02:27)    \nreboot   system boot  3.10.0-862.el7.x Fri Jun  5 17:28 - 11:36 (6+18:08)   \n\nwtmp begins Thu Oct 10 22:36:04 2019\n[root@localhost ~]# last -n 5 | awk '{print $1}'\nroot\nreboot\nreboot\nroot\nreboot\n```\n例： 只显示/etc/passwd的账户\n```java\n[root@localhost ~]# cat /etc/passwd | awk -F ':' '{print $1}'\nroot\nbin\ndaemon\nadm\nlp\nsync\nshutdown\nhalt\nmail\noperator\ngames\nftp\nnobody\nsystemd-network\ndbus\npolkitd\ntss\nsshd\npostfix\nchrony\nmysql\n```\n例：只显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以tab键分割\n```java\n[root@localhost ~]# cat /etc/passwd | awk -F ':' '{print $1\"\\t\"$7}' \ndbus    /sbin/nologin\npolkitd    /sbin/nologin\ntss    /sbin/nologin\nsshd    /sbin/nologin\npostfix    /sbin/nologin\nchrony    /sbin/nologin\nmysql    /bin/bash\n```\n例：只是显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以逗号分割,而且在所有行添加列名name,shell,在最后一行添加”blue,/bin/nosh”\n```java\n[root@localhost ~]# cat /etc/passwd | awk -F ':' 'BEGIN {print \"name,shell\"} {print $1\"\\t\"$7} END {print \"Hello,/bin/nosh\"}'\ndbus    /sbin/nologin\npolkitd    /sbin/nologin\ntss    /sbin/nologin\nsshd    /sbin/nologin\npostfix    /sbin/nologin\nchrony    /sbin/nologin\nmysql    /bin/bash\nHello,/bin/nosh\n```\n> awk工作流程是这样的：先执行BEGING，然后读取文件，读入有/n换行符分割的一条记录，然后将记录按指定的域分隔符划分域，填充域，$0则表示所有域,$1表示第一个域,$n表示第n个域,随后开始执行模式所对应的动作action。接着开始读入第二条记录······直到所有的记录都读完，最后执行END操作。\n\n```java\n第一步： 执行 BEGIN {commond} 指令\n第二步： 从文件或标准输入{stdin}读取一行然后执行 pattern { commmod } \n第三步； 从读至输入流末尾，执行 END {commod}语句\n```\n> BEGIN 在awk 开始输入读取之前被执行，属于一个可选的模块，一般用于变量初始化、打印输出表头\n> \n> pattern 通用命令，是最重要的一块，属于可选的，一般用于打印出指定的列，如果没有指定 petter 模块，则默认执行 {print $0} 既打印出所有读取到的内容\n> \n> END 在 AWK 从输入流中读取完所有的内容之后再执行，在 awk 整个语句输入中末尾执行\n\n例：搜索 /etc/passwd 有 root 关键字的行\n```java\n[root@localhost ~]# awk -F: '/root/' /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\noperator:x:11:0:operator:/root:/sbin/nologin\n```\n例：搜索/etc/passwd有root关键字的所有行，并显示对应的shell\n```java\n[root@localhost ~]# awk -F: '/root/{print $7}' /etc/passwd\n/bin/bash\n/sbin/nologin\n```","slug":"Linux高效文件处理三剑客","published":1,"updated":"2020-09-21T11:53:30.235Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737d001hm3pvezmeh2de","content":"<blockquote>\n<p>grep、sed、awk我们叫他们三剑客，掌握它们可以更好的运维，提升工作效率，即使不是运维，对我们处理数据都是非常方便的～就很多数据处理来讲，写程序肯定是也能处理的，但是远没有已经存在特定功能的命令更高效，我们只需要操作命令即可。通过本文可以讲解三剑客的一些基础知识和实用;</p>\n</blockquote>\n<h3 id=\"Grep\"><a href=\"#Grep\" class=\"headerlink\" title=\"Grep\"></a>Grep</h3><p>简介<br>grep是一款强大的文本搜索工具，支持正则表达式。<br>全称（ global search regular expression(RE) and print out the line）<br>语法:grep [option]… PATTERN [FILE]…<br>常用:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">usage: grep [-abcDEFGHhIiJLlmnOoqRSsUVvwxZ] [-A num] [-B num] [-C[num]]</span><br><span class=\"line\"> [-e pattern] [-f file] [--binary-files=value] [--color=when]</span><br><span class=\"line\"> [--context[=num]] [--directories=action] [--label] [--line-buffered]</span><br><span class=\"line\"> [--<span class=\"keyword\">null</span>] [pattern] [file ...]</span><br></pre></td></tr></table></figure>\n<p>常用参数：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-v        取反</span><br><span class=\"line\">-i        忽略大小写</span><br><span class=\"line\">-c        符合条件的行数</span><br><span class=\"line\">-n        输出的同时打印行号</span><br><span class=\"line\">^*        以*开头         </span><br><span class=\"line\">*$         以*结尾 </span><br><span class=\"line\">^$         空行 </span><br></pre></td></tr></table></figure>\n<p>实际使用<br>准备好一个小故事txt：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# cat monkey</span><br><span class=\"line\">One day,a little monkey is playing by the well.一天,有只小猴子在井边玩儿.</span><br><span class=\"line\">He looks in the well and shouts :它往井里一瞧,高喊道：</span><br><span class=\"line\">“Oh!My god!The moon has fallen into the well!” “噢!我的天!月亮掉到井里头啦!”</span><br><span class=\"line\">An older monkeys runs over,takes a look,and says,一只大猴子跑来一看,说,</span><br><span class=\"line\">“Goodness me!The moon is really in the water!” “糟啦!月亮掉在井里头啦!”</span><br><span class=\"line\">And olderly monkey comes over.老猴子也跑过来.</span><br><span class=\"line\">He is very surprised as well and cries out:他也非常惊奇,喊道：</span><br><span class=\"line\">“The moon is in the well.” “糟了,月亮掉在井里头了!”</span><br><span class=\"line\">A group of monkeys run over to the well .一群猴子跑到井边来,</span><br><span class=\"line\">They look at the moon in the well and shout:他们看到井里的月亮,喊道：</span><br><span class=\"line\">“The moon did fall into the well!Come on!Let’get it out!”</span><br><span class=\"line\">“月亮掉在井里头啦!快来!让我们把它捞起来!”</span><br><span class=\"line\">Then,the oldest monkey hangs on the tree up side down ,with his feet on the branch .</span><br><span class=\"line\">然后,老猴子倒挂在大树上,</span><br><span class=\"line\">And he pulls the next monkey’s feet with his hands.拉住大猴子的脚,</span><br><span class=\"line\">All the other monkeys follow his suit,其他的猴子一个个跟着,</span><br><span class=\"line\">And they join each other one by one down to the moon in the well.</span><br><span class=\"line\">它们一只连着一只直到井里.</span><br><span class=\"line\">Just before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢</span><br><span class=\"line\">He yells excitedly “Don’t be so foolish!The moon is still in the sky!”</span><br><span class=\"line\">它兴奋地大叫：“别蠢了!月亮还好好地挂在天上呢!</span><br></pre></td></tr></table></figure>\n<h4 id=\"直接查找符合条件的行\"><a href=\"#直接查找符合条件的行\" class=\"headerlink\" title=\"直接查找符合条件的行\"></a>直接查找符合条件的行</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# grep moon monkey</span><br><span class=\"line\">“Oh!My god!The moon has fallen into the well!” “噢!我的天!月亮掉到井里头啦!”</span><br><span class=\"line\">“Goodness me!The moon is really in the water!” “糟啦!月亮掉在井里头啦!”</span><br><span class=\"line\">“The moon is in the well.” “糟了,月亮掉在井里头了!”</span><br><span class=\"line\">They look at the moon in the well and shout:他们看到井里的月亮,喊道：</span><br><span class=\"line\">“The moon did fall into the well!Come on!Let’get it out!”</span><br><span class=\"line\">And they join each other one by one down to the moon in the well.</span><br><span class=\"line\">Just before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢</span><br><span class=\"line\">He yells excitedly “Don’t be so foolish!The moon is still in the sky!”</span><br></pre></td></tr></table></figure>\n<h4 id=\"查找反向符合条件的行\"><a href=\"#查找反向符合条件的行\" class=\"headerlink\" title=\"查找反向符合条件的行\"></a>查找反向符合条件的行</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# grep -v  moon monkey</span><br><span class=\"line\">One day,a little monkey is playing by the well.一天,有只小猴子在井边玩儿.</span><br><span class=\"line\">He looks in the well and shouts :它往井里一瞧,高喊道：</span><br><span class=\"line\">An older monkeys runs over,takes a look,and says,一只大猴子跑来一看,说,</span><br><span class=\"line\">And olderly monkey comes over.老猴子也跑过来.</span><br><span class=\"line\">He is very surprised as well and cries out:他也非常惊奇,喊道：</span><br><span class=\"line\">A group of monkeys run over to the well .一群猴子跑到井边来,</span><br><span class=\"line\">“月亮掉在井里头啦!快来!让我们把它捞起来!”</span><br><span class=\"line\">Then,the oldest monkey hangs on the tree up side down ,with his feet on the branch .</span><br><span class=\"line\">然后,老猴子倒挂在大树上,</span><br><span class=\"line\">And he pulls the next monkey’s feet with his hands.拉住大猴子的脚,</span><br><span class=\"line\">All the other monkeys follow his suit,其他的猴子一个个跟着,</span><br><span class=\"line\">它们一只连着一只直到井里.</span><br><span class=\"line\">它兴奋地大叫：“别蠢了!月亮还好好地挂在天上呢!”</span><br></pre></td></tr></table></figure>\n<h4 id=\"直接查找符合条件的行数\"><a href=\"#直接查找符合条件的行数\" class=\"headerlink\" title=\"直接查找符合条件的行数\"></a>直接查找符合条件的行数</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# grep -c  moon monkey</span><br><span class=\"line\"><span class=\"number\">8</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"忽略大小写查找符合条件的行数\"><a href=\"#忽略大小写查找符合条件的行数\" class=\"headerlink\" title=\"忽略大小写查找符合条件的行数\"></a>忽略大小写查找符合条件的行数</h4><p>先来看一下直接查找的结果</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# grep my monkey</span><br></pre></td></tr></table></figure>\n<h4 id=\"忽略大小写查看\"><a href=\"#忽略大小写查看\" class=\"headerlink\" title=\"忽略大小写查看\"></a>忽略大小写查看</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# grep -i my monkey</span><br><span class=\"line\">“Oh!My god!The moon has fallen into the well!” “噢!我的天!月亮掉到井里头啦!”</span><br></pre></td></tr></table></figure>\n<h4 id=\"查找符合条件的行并输出行号\"><a href=\"#查找符合条件的行并输出行号\" class=\"headerlink\" title=\"查找符合条件的行并输出行号\"></a>查找符合条件的行并输出行号</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# grep -n monkey monkey</span><br><span class=\"line\"><span class=\"number\">1</span>:One day,a little monkey is playing by the well.一天,有只小猴子在井边玩儿.</span><br><span class=\"line\"><span class=\"number\">4</span>:An older monkeys runs over,takes a look,and says,一只大猴子跑来一看,说,</span><br><span class=\"line\"><span class=\"number\">6</span>:And olderly monkey comes over.老猴子也跑过来.</span><br><span class=\"line\"><span class=\"number\">9</span>:A group of monkeys run over to the well .一群猴子跑到井边来,</span><br><span class=\"line\"><span class=\"number\">13</span>:Then,the oldest monkey hangs on the tree up side down ,with his feet on the branch .</span><br><span class=\"line\"><span class=\"number\">15</span>:And he pulls the next monkey’s feet with his hands.拉住大猴子的脚,</span><br><span class=\"line\"><span class=\"number\">16</span>:All the other monkeys follow his suit,其他的猴子一个个跟着,</span><br><span class=\"line\"><span class=\"number\">19</span>:Just before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢</span><br></pre></td></tr></table></figure>\n<h4 id=\"查找开头是J的行\"><a href=\"#查找开头是J的行\" class=\"headerlink\" title=\"查找开头是J的行\"></a>查找开头是J的行</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# grep &#x27;^J&#x27; monkey</span><br><span class=\"line\">Just before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢</span><br></pre></td></tr></table></figure>\n<h4 id=\"查找结尾是呢的行\"><a href=\"#查找结尾是呢的行\" class=\"headerlink\" title=\"查找结尾是呢的行\"></a>查找结尾是呢的行</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# grep &quot;呢$&quot; monkey</span><br><span class=\"line\">Just before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Sed\"><a href=\"#Sed\" class=\"headerlink\" title=\"Sed\"></a>Sed</h3><blockquote>\n<p>sed是一种流编辑器，是一款处理文本比较优秀的工具，可以结合正则表达式一起使用。</p>\n</blockquote>\n<h4 id=\"sed命令\"><a href=\"#sed命令\" class=\"headerlink\" title=\"sed命令\"></a>sed命令</h4><p>命令: sed<br>语法 : sed [选项]… {命令集} [输入文件]…</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">常用参数:</span><br><span class=\"line\">            d  删除选择的行    </span><br><span class=\"line\">            s   查找    </span><br><span class=\"line\">            y  替换</span><br><span class=\"line\">            i   当前行前面插入一行</span><br><span class=\"line\">            a  当前行后面插入一行</span><br><span class=\"line\">            p  打印行       </span><br><span class=\"line\">            q  退出     </span><br><span class=\"line\"></span><br><span class=\"line\"> 替换符:</span><br><span class=\"line\"></span><br><span class=\"line\">            数字 ：替换第几处    </span><br><span class=\"line\">            g :  全局替换    </span><br><span class=\"line\">            \\<span class=\"number\">1</span>:  子串匹配标记，前面搜索可以用元字符集\\(..\\)</span><br><span class=\"line\">            &amp;:  保留搜索刀的字符用来替换其他字符</span><br><span class=\"line\">#### 操作</span><br><span class=\"line\">##### 替换操作</span><br><span class=\"line\">查看文件：</span><br><span class=\"line\">```java</span><br><span class=\"line\"># cat word</span><br><span class=\"line\">Twinkle, twinkle, little star</span><br><span class=\"line\">How I wonder what you are</span><br><span class=\"line\">Up above the world so high</span><br><span class=\"line\">Like a diamond in the sky</span><br><span class=\"line\">When the blazing sun is gone</span><br></pre></td></tr></table></figure>\n<p>替换：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;s/little/big/&#x27; word</span><br><span class=\"line\">Twinkle, twinkle, big star</span><br><span class=\"line\">How I wonder what you are</span><br><span class=\"line\">Up above the world so high</span><br><span class=\"line\">Like a diamond in the sky</span><br><span class=\"line\">When the blazing sun is gone</span><br></pre></td></tr></table></figure>\n<p>查看文本：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># word1</span><br><span class=\"line\">Oh <span class=\"keyword\">if</span> there<span class=\"string\">&#x27;s one thing to be taught</span></span><br><span class=\"line\"><span class=\"string\">it&#x27;</span>s dreams are made to be caught</span><br><span class=\"line\">and friends can never be bought</span><br><span class=\"line\">Doesn<span class=\"string\">&#x27;t matter how long it&#x27;</span>s been</span><br><span class=\"line\">I know you<span class=\"string\">&#x27;ll always jump in</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span>Cause we don<span class=\"string\">&#x27;t know how to quit</span></span><br></pre></td></tr></table></figure>\n<p>全局替换：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;s/to/can/g&#x27; word1</span><br><span class=\"line\">Oh <span class=\"keyword\">if</span> there<span class=\"string\">&#x27;s one thing can be taught</span></span><br><span class=\"line\"><span class=\"string\">it&#x27;</span>s dreams are made can be caught</span><br><span class=\"line\">and friends can nev</span><br></pre></td></tr></table></figure>\n<p>按行替换（替换2到最后一行)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;2,$s/to/can/&#x27; word1</span><br><span class=\"line\">Oh <span class=\"keyword\">if</span> there<span class=\"string\">&#x27;s one thing to be taught</span></span><br><span class=\"line\"><span class=\"string\">it&#x27;</span>s dreams are made can be caught</span><br><span class=\"line\">and friends can never be bought</span><br><span class=\"line\">Doesn<span class=\"string\">&#x27;t matter how long it&#x27;</span>s been</span><br><span class=\"line\">I know you<span class=\"string\">&#x27;ll always jump in</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span>Cause we don<span class=\"string\">&#x27;t know how can quit</span></span><br><span class=\"line\"><span class=\"string\">```java</span></span><br><span class=\"line\"><span class=\"string\">##### 删除操作:</span></span><br><span class=\"line\"><span class=\"string\">查看文本:</span></span><br><span class=\"line\"><span class=\"string\">```java</span></span><br><span class=\"line\"><span class=\"string\"># cat word</span></span><br><span class=\"line\"><span class=\"string\">Twinkle, twinkle, little star</span></span><br><span class=\"line\"><span class=\"string\">How I wonder what you are</span></span><br><span class=\"line\"><span class=\"string\">Up above the world so high</span></span><br><span class=\"line\"><span class=\"string\">Like a diamond in the sky</span></span><br><span class=\"line\"><span class=\"string\">When the blazing sun is gone</span></span><br></pre></td></tr></table></figure>\n<p>删除:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;2d&#x27; word</span><br><span class=\"line\">Twinkle, twinkle, little star</span><br><span class=\"line\">Up above the world so high</span><br><span class=\"line\">Like a diamond in the sky</span><br><span class=\"line\">When the blazing sun is gone</span><br></pre></td></tr></table></figure>\n<p>显示行号:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;=;2d&#x27; word</span><br><span class=\"line\"><span class=\"number\">1</span></span><br><span class=\"line\">Twinkle, twinkle, little star</span><br><span class=\"line\"><span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">3</span></span><br><span class=\"line\">Up above the world so high</span><br><span class=\"line\"><span class=\"number\">4</span></span><br><span class=\"line\">Like a diamond in the sky</span><br><span class=\"line\"><span class=\"number\">5</span></span><br><span class=\"line\">When the blazing sun is gone</span><br></pre></td></tr></table></figure>\n<p>删除第2行到第四行:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;=;2,4d&#x27; word</span><br><span class=\"line\"><span class=\"number\">1</span></span><br><span class=\"line\">Twinkle, twinkle, little star</span><br><span class=\"line\"><span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">5</span></span><br><span class=\"line\">When the blazing sun is gone</span><br></pre></td></tr></table></figure>\n<h5 id=\"添加行操作\"><a href=\"#添加行操作\" class=\"headerlink\" title=\"添加行操作:\"></a>添加行操作:</h5><p>向前插入:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># echo &quot;hello&quot; | sed &#x27;i\\kitty&#x27;</span><br><span class=\"line\">kitty</span><br><span class=\"line\">hello</span><br></pre></td></tr></table></figure>\n<p>向后插入:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># echo &quot;kitty&quot; | sed &#x27;i\\hello&#x27;</span><br><span class=\"line\">hello</span><br><span class=\"line\">kitty</span><br></pre></td></tr></table></figure>\n<h5 id=\"修改行操作\"><a href=\"#修改行操作\" class=\"headerlink\" title=\"修改行操作:\"></a>修改行操作:</h5><p>替换第二行为hello kitty</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;2c\\hello kitty&#x27; word</span><br><span class=\"line\">Twinkle, twinkle, little star</span><br><span class=\"line\">hello kitty</span><br><span class=\"line\">Up above the world so high</span><br><span class=\"line\">Like a diamond in the sky</span><br><span class=\"line\">When the blazing sun is gone</span><br></pre></td></tr></table></figure>\n<p>替换第二行到最后一行为hello kitty</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;2,$c\\hello kitty&#x27; word</span><br><span class=\"line\">Twinkle, twinkle, little star</span><br><span class=\"line\">hello kitty</span><br></pre></td></tr></table></figure>\n<h5 id=\"写入行操作\"><a href=\"#写入行操作\" class=\"headerlink\" title=\"写入行操作\"></a>写入行操作</h5><p>把带star的行写入c文件中,c提前创建</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed -n &#x27;/star/w c&#x27; word</span><br><span class=\"line\"># cat c</span><br><span class=\"line\">Twinkle, twinkle, little star</span><br></pre></td></tr></table></figure>\n<h5 id=\"退出\"><a href=\"#退出\" class=\"headerlink\" title=\"退出\"></a>退出</h5><p>打印3行后，退出sed</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;3q&#x27; word</span><br><span class=\"line\">Twinkle, twinkle, little star</span><br><span class=\"line\">How I wonder what you are</span><br><span class=\"line\">Up above the world so higher be bought</span><br><span class=\"line\">Doesn<span class=\"string\">&#x27;t matter how long it&#x27;</span>s been</span><br><span class=\"line\">I know you<span class=\"string\">&#x27;ll always jump in</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span>Cause we don<span class=\"string\">&#x27;t know how can quit</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"日常使用sed操作修改配置文件\"><a href=\"#日常使用sed操作修改配置文件\" class=\"headerlink\" title=\"日常使用sed操作修改配置文件:\"></a>日常使用sed操作修改配置文件:</h5><p>查看原始数据</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node2 ~]# cat /etc/ssh/sshd_config | grep Root</span><br><span class=\"line\"># PermitRootLogin yes</span><br></pre></td></tr></table></figure>\n<p>操作指令</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node2 ~]# sed -i &#x27;/PermitRootLogin/c\\PermitRootLogin no&#x27;  /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>\n<p>查看修改后的数据</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node2 ~]# cat /etc/ssh/sshd_config | grep Root</span><br><span class=\"line\">PermitRootLogin no</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Awk\"><a href=\"#Awk\" class=\"headerlink\" title=\"Awk\"></a>Awk</h3><blockquote>\n<p>awk是一个强大的文本分析工具，相对于grep的查找，sed的编辑，awk在其对数据分析并生成报告时，显得尤为强大。简单来说awk就是把文件逐行的读入，以空格为默认分隔符将每行切片，切开的部分再进行各种分析处理。</p>\n</blockquote>\n<p>命令格式：<br>awk [option] ‘scrip’ var=value</p>\n<p>参数：<br>option：<br>-F 指定输入的分割字符，默认为 空格<br>-v var=value 赋值一个用户自定义变量<br>-f scripfile 从脚本中读取 awk 命令</p>\n<h4 id=\"AWK-模式和操作awk-脚本是由模式和操作组成的。\"><a href=\"#AWK-模式和操作awk-脚本是由模式和操作组成的。\" class=\"headerlink\" title=\"AWK 模式和操作awk 脚本是由模式和操作组成的。\"></a>AWK 模式和操作awk 脚本是由模式和操作组成的。</h4><h5 id=\"模式\"><a href=\"#模式\" class=\"headerlink\" title=\"模式\"></a>模式</h5><p>模式可以是以下任意一个：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/正则表达式/： 使用通配符的扩展集</span><br><span class=\"line\">关系表达式：    使用运算符进行操作，可以是字符串或者数字比较测试</span><br><span class=\"line\">模式匹配表达式：用运算符~<span class=\"number\">9</span>匹配和~！（不匹配）</span><br><span class=\"line\">BEGIN 语句块，pattern语句块、END语句块</span><br></pre></td></tr></table></figure>\n<h5 id=\"操作\"><a href=\"#操作\" class=\"headerlink\" title=\"操作\"></a>操作</h5><p>操作有一个或者多个命令、函数、表达式组成，之间由换行符或分号隔开，并位于大括号内、主要部分有：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">变量或属组赋值</span><br><span class=\"line\">输出命令</span><br><span class=\"line\">内置函数</span><br><span class=\"line\">控制流程语句</span><br></pre></td></tr></table></figure>\n<h5 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h5><p>例： 只是显示最近登录的5个帐号</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# last -n 5 </span><br><span class=\"line\">root     pts/<span class=\"number\">0</span>        <span class=\"number\">192.168</span>.<span class=\"number\">116.1</span>    Fri Jun <span class=\"number\">12</span> <span class=\"number\">10</span>:<span class=\"number\">59</span>   still logged in   </span><br><span class=\"line\">reboot   system boot  <span class=\"number\">3.10</span>.<span class=\"number\">0</span>-<span class=\"number\">862.</span>el7.x Fri Jun <span class=\"number\">12</span> <span class=\"number\">10</span>:<span class=\"number\">58</span> - <span class=\"number\">11</span>:<span class=\"number\">36</span>  (<span class=\"number\">00</span>:<span class=\"number\">38</span>)    </span><br><span class=\"line\">reboot   system boot  <span class=\"number\">3.10</span>.<span class=\"number\">0</span>-<span class=\"number\">862.</span>el7.x Fri Jun  <span class=\"number\">5</span> <span class=\"number\">21</span>:<span class=\"number\">07</span> - <span class=\"number\">11</span>:<span class=\"number\">36</span> (<span class=\"number\">6</span>+<span class=\"number\">14</span>:<span class=\"number\">28</span>)   </span><br><span class=\"line\">root     pts/<span class=\"number\">0</span>        <span class=\"number\">192.168</span>.<span class=\"number\">116.1</span>    Fri Jun  <span class=\"number\">5</span> <span class=\"number\">18</span>:<span class=\"number\">40</span> - crash  (<span class=\"number\">02</span>:<span class=\"number\">27</span>)    </span><br><span class=\"line\">reboot   system boot  <span class=\"number\">3.10</span>.<span class=\"number\">0</span>-<span class=\"number\">862.</span>el7.x Fri Jun  <span class=\"number\">5</span> <span class=\"number\">17</span>:<span class=\"number\">28</span> - <span class=\"number\">11</span>:<span class=\"number\">36</span> (<span class=\"number\">6</span>+<span class=\"number\">18</span>:<span class=\"number\">08</span>)   </span><br><span class=\"line\"></span><br><span class=\"line\">wtmp begins Thu Oct <span class=\"number\">10</span> <span class=\"number\">22</span>:<span class=\"number\">36</span>:<span class=\"number\">04</span> <span class=\"number\">2019</span></span><br><span class=\"line\">[root@localhost ~]# last -n 5 | awk &#x27;&#123;print $1&#125;&#x27;</span><br><span class=\"line\">root</span><br><span class=\"line\">reboot</span><br><span class=\"line\">reboot</span><br><span class=\"line\">root</span><br><span class=\"line\">reboot</span><br></pre></td></tr></table></figure>\n<p>例： 只显示/etc/passwd的账户</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# cat /etc/passwd | awk -F &#x27;:&#x27; &#x27;&#123;print $1&#125;&#x27;</span><br><span class=\"line\">root</span><br><span class=\"line\">bin</span><br><span class=\"line\">daemon</span><br><span class=\"line\">adm</span><br><span class=\"line\">lp</span><br><span class=\"line\">sync</span><br><span class=\"line\">shutdown</span><br><span class=\"line\">halt</span><br><span class=\"line\">mail</span><br><span class=\"line\">operator</span><br><span class=\"line\">games</span><br><span class=\"line\">ftp</span><br><span class=\"line\">nobody</span><br><span class=\"line\">systemd-network</span><br><span class=\"line\">dbus</span><br><span class=\"line\">polkitd</span><br><span class=\"line\">tss</span><br><span class=\"line\">sshd</span><br><span class=\"line\">postfix</span><br><span class=\"line\">chrony</span><br><span class=\"line\">mysql</span><br></pre></td></tr></table></figure>\n<p>例：只显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以tab键分割</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# cat /etc/passwd | awk -F &#x27;:&#x27; &#x27;&#123;print $1&quot;\\t&quot;$7&#125;&#x27; </span><br><span class=\"line\">dbus    /sbin/nologin</span><br><span class=\"line\">polkitd    /sbin/nologin</span><br><span class=\"line\">tss    /sbin/nologin</span><br><span class=\"line\">sshd    /sbin/nologin</span><br><span class=\"line\">postfix    /sbin/nologin</span><br><span class=\"line\">chrony    /sbin/nologin</span><br><span class=\"line\">mysql    /bin/bash</span><br></pre></td></tr></table></figure>\n<p>例：只是显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以逗号分割,而且在所有行添加列名name,shell,在最后一行添加”blue,/bin/nosh”</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# cat /etc/passwd | awk -F &#x27;:&#x27; &#x27;BEGIN &#123;print &quot;name,shell&quot;&#125; &#123;print $1&quot;\\t&quot;$7&#125; END &#123;print &quot;Hello,/bin/nosh&quot;&#125;&#x27;</span><br><span class=\"line\">dbus    /sbin/nologin</span><br><span class=\"line\">polkitd    /sbin/nologin</span><br><span class=\"line\">tss    /sbin/nologin</span><br><span class=\"line\">sshd    /sbin/nologin</span><br><span class=\"line\">postfix    /sbin/nologin</span><br><span class=\"line\">chrony    /sbin/nologin</span><br><span class=\"line\">mysql    /bin/bash</span><br><span class=\"line\">Hello,/bin/nosh</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>awk工作流程是这样的：先执行BEGING，然后读取文件，读入有/n换行符分割的一条记录，然后将记录按指定的域分隔符划分域，填充域，$0则表示所有域,$1表示第一个域,$n表示第n个域,随后开始执行模式所对应的动作action。接着开始读入第二条记录······直到所有的记录都读完，最后执行END操作。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">第一步： 执行 BEGIN &#123;commond&#125; 指令</span><br><span class=\"line\">第二步： 从文件或标准输入&#123;stdin&#125;读取一行然后执行 pattern &#123; commmod &#125; </span><br><span class=\"line\">第三步； 从读至输入流末尾，执行 END &#123;commod&#125;语句</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>BEGIN 在awk 开始输入读取之前被执行，属于一个可选的模块，一般用于变量初始化、打印输出表头</p>\n<p>pattern 通用命令，是最重要的一块，属于可选的，一般用于打印出指定的列，如果没有指定 petter 模块，则默认执行 {print $0} 既打印出所有读取到的内容</p>\n<p>END 在 AWK 从输入流中读取完所有的内容之后再执行，在 awk 整个语句输入中末尾执行</p>\n</blockquote>\n<p>例：搜索 /etc/passwd 有 root 关键字的行</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# awk -F: &#x27;/root/&#x27; /etc/passwd</span><br><span class=\"line\">root:x:<span class=\"number\">0</span>:<span class=\"number\">0</span>:root:/root:/bin/bash</span><br><span class=\"line\">operator:x:<span class=\"number\">11</span>:<span class=\"number\">0</span>:operator:/root:/sbin/nologin</span><br></pre></td></tr></table></figure>\n<p>例：搜索/etc/passwd有root关键字的所有行，并显示对应的shell</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# awk -F: &#x27;/root/&#123;print $7&#125;&#x27; /etc/passwd</span><br><span class=\"line\">/bin/bash</span><br><span class=\"line\">/sbin/nologin</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>grep、sed、awk我们叫他们三剑客，掌握它们可以更好的运维，提升工作效率，即使不是运维，对我们处理数据都是非常方便的～就很多数据处理来讲，写程序肯定是也能处理的，但是远没有已经存在特定功能的命令更高效，我们只需要操作命令即可。通过本文可以讲解三剑客的一些基础知识和实用;</p>\n</blockquote>\n<h3 id=\"Grep\"><a href=\"#Grep\" class=\"headerlink\" title=\"Grep\"></a>Grep</h3><p>简介<br>grep是一款强大的文本搜索工具，支持正则表达式。<br>全称（ global search regular expression(RE) and print out the line）<br>语法:grep [option]… PATTERN [FILE]…<br>常用:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">usage: grep [-abcDEFGHhIiJLlmnOoqRSsUVvwxZ] [-A num] [-B num] [-C[num]]</span><br><span class=\"line\"> [-e pattern] [-f file] [--binary-files=value] [--color=when]</span><br><span class=\"line\"> [--context[=num]] [--directories=action] [--label] [--line-buffered]</span><br><span class=\"line\"> [--<span class=\"keyword\">null</span>] [pattern] [file ...]</span><br></pre></td></tr></table></figure>\n<p>常用参数：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-v        取反</span><br><span class=\"line\">-i        忽略大小写</span><br><span class=\"line\">-c        符合条件的行数</span><br><span class=\"line\">-n        输出的同时打印行号</span><br><span class=\"line\">^*        以*开头         </span><br><span class=\"line\">*$         以*结尾 </span><br><span class=\"line\">^$         空行 </span><br></pre></td></tr></table></figure>\n<p>实际使用<br>准备好一个小故事txt：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# cat monkey</span><br><span class=\"line\">One day,a little monkey is playing by the well.一天,有只小猴子在井边玩儿.</span><br><span class=\"line\">He looks in the well and shouts :它往井里一瞧,高喊道：</span><br><span class=\"line\">“Oh!My god!The moon has fallen into the well!” “噢!我的天!月亮掉到井里头啦!”</span><br><span class=\"line\">An older monkeys runs over,takes a look,and says,一只大猴子跑来一看,说,</span><br><span class=\"line\">“Goodness me!The moon is really in the water!” “糟啦!月亮掉在井里头啦!”</span><br><span class=\"line\">And olderly monkey comes over.老猴子也跑过来.</span><br><span class=\"line\">He is very surprised as well and cries out:他也非常惊奇,喊道：</span><br><span class=\"line\">“The moon is in the well.” “糟了,月亮掉在井里头了!”</span><br><span class=\"line\">A group of monkeys run over to the well .一群猴子跑到井边来,</span><br><span class=\"line\">They look at the moon in the well and shout:他们看到井里的月亮,喊道：</span><br><span class=\"line\">“The moon did fall into the well!Come on!Let’get it out!”</span><br><span class=\"line\">“月亮掉在井里头啦!快来!让我们把它捞起来!”</span><br><span class=\"line\">Then,the oldest monkey hangs on the tree up side down ,with his feet on the branch .</span><br><span class=\"line\">然后,老猴子倒挂在大树上,</span><br><span class=\"line\">And he pulls the next monkey’s feet with his hands.拉住大猴子的脚,</span><br><span class=\"line\">All the other monkeys follow his suit,其他的猴子一个个跟着,</span><br><span class=\"line\">And they join each other one by one down to the moon in the well.</span><br><span class=\"line\">它们一只连着一只直到井里.</span><br><span class=\"line\">Just before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢</span><br><span class=\"line\">He yells excitedly “Don’t be so foolish!The moon is still in the sky!”</span><br><span class=\"line\">它兴奋地大叫：“别蠢了!月亮还好好地挂在天上呢!</span><br></pre></td></tr></table></figure>\n<h4 id=\"直接查找符合条件的行\"><a href=\"#直接查找符合条件的行\" class=\"headerlink\" title=\"直接查找符合条件的行\"></a>直接查找符合条件的行</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# grep moon monkey</span><br><span class=\"line\">“Oh!My god!The moon has fallen into the well!” “噢!我的天!月亮掉到井里头啦!”</span><br><span class=\"line\">“Goodness me!The moon is really in the water!” “糟啦!月亮掉在井里头啦!”</span><br><span class=\"line\">“The moon is in the well.” “糟了,月亮掉在井里头了!”</span><br><span class=\"line\">They look at the moon in the well and shout:他们看到井里的月亮,喊道：</span><br><span class=\"line\">“The moon did fall into the well!Come on!Let’get it out!”</span><br><span class=\"line\">And they join each other one by one down to the moon in the well.</span><br><span class=\"line\">Just before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢</span><br><span class=\"line\">He yells excitedly “Don’t be so foolish!The moon is still in the sky!”</span><br></pre></td></tr></table></figure>\n<h4 id=\"查找反向符合条件的行\"><a href=\"#查找反向符合条件的行\" class=\"headerlink\" title=\"查找反向符合条件的行\"></a>查找反向符合条件的行</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# grep -v  moon monkey</span><br><span class=\"line\">One day,a little monkey is playing by the well.一天,有只小猴子在井边玩儿.</span><br><span class=\"line\">He looks in the well and shouts :它往井里一瞧,高喊道：</span><br><span class=\"line\">An older monkeys runs over,takes a look,and says,一只大猴子跑来一看,说,</span><br><span class=\"line\">And olderly monkey comes over.老猴子也跑过来.</span><br><span class=\"line\">He is very surprised as well and cries out:他也非常惊奇,喊道：</span><br><span class=\"line\">A group of monkeys run over to the well .一群猴子跑到井边来,</span><br><span class=\"line\">“月亮掉在井里头啦!快来!让我们把它捞起来!”</span><br><span class=\"line\">Then,the oldest monkey hangs on the tree up side down ,with his feet on the branch .</span><br><span class=\"line\">然后,老猴子倒挂在大树上,</span><br><span class=\"line\">And he pulls the next monkey’s feet with his hands.拉住大猴子的脚,</span><br><span class=\"line\">All the other monkeys follow his suit,其他的猴子一个个跟着,</span><br><span class=\"line\">它们一只连着一只直到井里.</span><br><span class=\"line\">它兴奋地大叫：“别蠢了!月亮还好好地挂在天上呢!”</span><br></pre></td></tr></table></figure>\n<h4 id=\"直接查找符合条件的行数\"><a href=\"#直接查找符合条件的行数\" class=\"headerlink\" title=\"直接查找符合条件的行数\"></a>直接查找符合条件的行数</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# grep -c  moon monkey</span><br><span class=\"line\"><span class=\"number\">8</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"忽略大小写查找符合条件的行数\"><a href=\"#忽略大小写查找符合条件的行数\" class=\"headerlink\" title=\"忽略大小写查找符合条件的行数\"></a>忽略大小写查找符合条件的行数</h4><p>先来看一下直接查找的结果</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# grep my monkey</span><br></pre></td></tr></table></figure>\n<h4 id=\"忽略大小写查看\"><a href=\"#忽略大小写查看\" class=\"headerlink\" title=\"忽略大小写查看\"></a>忽略大小写查看</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# grep -i my monkey</span><br><span class=\"line\">“Oh!My god!The moon has fallen into the well!” “噢!我的天!月亮掉到井里头啦!”</span><br></pre></td></tr></table></figure>\n<h4 id=\"查找符合条件的行并输出行号\"><a href=\"#查找符合条件的行并输出行号\" class=\"headerlink\" title=\"查找符合条件的行并输出行号\"></a>查找符合条件的行并输出行号</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# grep -n monkey monkey</span><br><span class=\"line\"><span class=\"number\">1</span>:One day,a little monkey is playing by the well.一天,有只小猴子在井边玩儿.</span><br><span class=\"line\"><span class=\"number\">4</span>:An older monkeys runs over,takes a look,and says,一只大猴子跑来一看,说,</span><br><span class=\"line\"><span class=\"number\">6</span>:And olderly monkey comes over.老猴子也跑过来.</span><br><span class=\"line\"><span class=\"number\">9</span>:A group of monkeys run over to the well .一群猴子跑到井边来,</span><br><span class=\"line\"><span class=\"number\">13</span>:Then,the oldest monkey hangs on the tree up side down ,with his feet on the branch .</span><br><span class=\"line\"><span class=\"number\">15</span>:And he pulls the next monkey’s feet with his hands.拉住大猴子的脚,</span><br><span class=\"line\"><span class=\"number\">16</span>:All the other monkeys follow his suit,其他的猴子一个个跟着,</span><br><span class=\"line\"><span class=\"number\">19</span>:Just before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢</span><br></pre></td></tr></table></figure>\n<h4 id=\"查找开头是J的行\"><a href=\"#查找开头是J的行\" class=\"headerlink\" title=\"查找开头是J的行\"></a>查找开头是J的行</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# grep &#x27;^J&#x27; monkey</span><br><span class=\"line\">Just before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢</span><br></pre></td></tr></table></figure>\n<h4 id=\"查找结尾是呢的行\"><a href=\"#查找结尾是呢的行\" class=\"headerlink\" title=\"查找结尾是呢的行\"></a>查找结尾是呢的行</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze76ybn73dvwmdij06zz ~]# grep &quot;呢$&quot; monkey</span><br><span class=\"line\">Just before they reach the moon,the oldest monkey raises his head and happens to see the moon in the sky,正好他们摸到月亮的时候,老猴子抬头发现月亮挂在天上呢</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Sed\"><a href=\"#Sed\" class=\"headerlink\" title=\"Sed\"></a>Sed</h3><blockquote>\n<p>sed是一种流编辑器，是一款处理文本比较优秀的工具，可以结合正则表达式一起使用。</p>\n</blockquote>\n<h4 id=\"sed命令\"><a href=\"#sed命令\" class=\"headerlink\" title=\"sed命令\"></a>sed命令</h4><p>命令: sed<br>语法 : sed [选项]… {命令集} [输入文件]…</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">常用参数:</span><br><span class=\"line\">            d  删除选择的行    </span><br><span class=\"line\">            s   查找    </span><br><span class=\"line\">            y  替换</span><br><span class=\"line\">            i   当前行前面插入一行</span><br><span class=\"line\">            a  当前行后面插入一行</span><br><span class=\"line\">            p  打印行       </span><br><span class=\"line\">            q  退出     </span><br><span class=\"line\"></span><br><span class=\"line\"> 替换符:</span><br><span class=\"line\"></span><br><span class=\"line\">            数字 ：替换第几处    </span><br><span class=\"line\">            g :  全局替换    </span><br><span class=\"line\">            \\<span class=\"number\">1</span>:  子串匹配标记，前面搜索可以用元字符集\\(..\\)</span><br><span class=\"line\">            &amp;:  保留搜索刀的字符用来替换其他字符</span><br><span class=\"line\">#### 操作</span><br><span class=\"line\">##### 替换操作</span><br><span class=\"line\">查看文件：</span><br><span class=\"line\">```java</span><br><span class=\"line\"># cat word</span><br><span class=\"line\">Twinkle, twinkle, little star</span><br><span class=\"line\">How I wonder what you are</span><br><span class=\"line\">Up above the world so high</span><br><span class=\"line\">Like a diamond in the sky</span><br><span class=\"line\">When the blazing sun is gone</span><br></pre></td></tr></table></figure>\n<p>替换：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;s/little/big/&#x27; word</span><br><span class=\"line\">Twinkle, twinkle, big star</span><br><span class=\"line\">How I wonder what you are</span><br><span class=\"line\">Up above the world so high</span><br><span class=\"line\">Like a diamond in the sky</span><br><span class=\"line\">When the blazing sun is gone</span><br></pre></td></tr></table></figure>\n<p>查看文本：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># word1</span><br><span class=\"line\">Oh <span class=\"keyword\">if</span> there<span class=\"string\">&#x27;s one thing to be taught</span></span><br><span class=\"line\"><span class=\"string\">it&#x27;</span>s dreams are made to be caught</span><br><span class=\"line\">and friends can never be bought</span><br><span class=\"line\">Doesn<span class=\"string\">&#x27;t matter how long it&#x27;</span>s been</span><br><span class=\"line\">I know you<span class=\"string\">&#x27;ll always jump in</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span>Cause we don<span class=\"string\">&#x27;t know how to quit</span></span><br></pre></td></tr></table></figure>\n<p>全局替换：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;s/to/can/g&#x27; word1</span><br><span class=\"line\">Oh <span class=\"keyword\">if</span> there<span class=\"string\">&#x27;s one thing can be taught</span></span><br><span class=\"line\"><span class=\"string\">it&#x27;</span>s dreams are made can be caught</span><br><span class=\"line\">and friends can nev</span><br></pre></td></tr></table></figure>\n<p>按行替换（替换2到最后一行)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;2,$s/to/can/&#x27; word1</span><br><span class=\"line\">Oh <span class=\"keyword\">if</span> there<span class=\"string\">&#x27;s one thing to be taught</span></span><br><span class=\"line\"><span class=\"string\">it&#x27;</span>s dreams are made can be caught</span><br><span class=\"line\">and friends can never be bought</span><br><span class=\"line\">Doesn<span class=\"string\">&#x27;t matter how long it&#x27;</span>s been</span><br><span class=\"line\">I know you<span class=\"string\">&#x27;ll always jump in</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span>Cause we don<span class=\"string\">&#x27;t know how can quit</span></span><br><span class=\"line\"><span class=\"string\">```java</span></span><br><span class=\"line\"><span class=\"string\">##### 删除操作:</span></span><br><span class=\"line\"><span class=\"string\">查看文本:</span></span><br><span class=\"line\"><span class=\"string\">```java</span></span><br><span class=\"line\"><span class=\"string\"># cat word</span></span><br><span class=\"line\"><span class=\"string\">Twinkle, twinkle, little star</span></span><br><span class=\"line\"><span class=\"string\">How I wonder what you are</span></span><br><span class=\"line\"><span class=\"string\">Up above the world so high</span></span><br><span class=\"line\"><span class=\"string\">Like a diamond in the sky</span></span><br><span class=\"line\"><span class=\"string\">When the blazing sun is gone</span></span><br></pre></td></tr></table></figure>\n<p>删除:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;2d&#x27; word</span><br><span class=\"line\">Twinkle, twinkle, little star</span><br><span class=\"line\">Up above the world so high</span><br><span class=\"line\">Like a diamond in the sky</span><br><span class=\"line\">When the blazing sun is gone</span><br></pre></td></tr></table></figure>\n<p>显示行号:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;=;2d&#x27; word</span><br><span class=\"line\"><span class=\"number\">1</span></span><br><span class=\"line\">Twinkle, twinkle, little star</span><br><span class=\"line\"><span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">3</span></span><br><span class=\"line\">Up above the world so high</span><br><span class=\"line\"><span class=\"number\">4</span></span><br><span class=\"line\">Like a diamond in the sky</span><br><span class=\"line\"><span class=\"number\">5</span></span><br><span class=\"line\">When the blazing sun is gone</span><br></pre></td></tr></table></figure>\n<p>删除第2行到第四行:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;=;2,4d&#x27; word</span><br><span class=\"line\"><span class=\"number\">1</span></span><br><span class=\"line\">Twinkle, twinkle, little star</span><br><span class=\"line\"><span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">5</span></span><br><span class=\"line\">When the blazing sun is gone</span><br></pre></td></tr></table></figure>\n<h5 id=\"添加行操作\"><a href=\"#添加行操作\" class=\"headerlink\" title=\"添加行操作:\"></a>添加行操作:</h5><p>向前插入:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># echo &quot;hello&quot; | sed &#x27;i\\kitty&#x27;</span><br><span class=\"line\">kitty</span><br><span class=\"line\">hello</span><br></pre></td></tr></table></figure>\n<p>向后插入:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># echo &quot;kitty&quot; | sed &#x27;i\\hello&#x27;</span><br><span class=\"line\">hello</span><br><span class=\"line\">kitty</span><br></pre></td></tr></table></figure>\n<h5 id=\"修改行操作\"><a href=\"#修改行操作\" class=\"headerlink\" title=\"修改行操作:\"></a>修改行操作:</h5><p>替换第二行为hello kitty</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;2c\\hello kitty&#x27; word</span><br><span class=\"line\">Twinkle, twinkle, little star</span><br><span class=\"line\">hello kitty</span><br><span class=\"line\">Up above the world so high</span><br><span class=\"line\">Like a diamond in the sky</span><br><span class=\"line\">When the blazing sun is gone</span><br></pre></td></tr></table></figure>\n<p>替换第二行到最后一行为hello kitty</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;2,$c\\hello kitty&#x27; word</span><br><span class=\"line\">Twinkle, twinkle, little star</span><br><span class=\"line\">hello kitty</span><br></pre></td></tr></table></figure>\n<h5 id=\"写入行操作\"><a href=\"#写入行操作\" class=\"headerlink\" title=\"写入行操作\"></a>写入行操作</h5><p>把带star的行写入c文件中,c提前创建</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed -n &#x27;/star/w c&#x27; word</span><br><span class=\"line\"># cat c</span><br><span class=\"line\">Twinkle, twinkle, little star</span><br></pre></td></tr></table></figure>\n<h5 id=\"退出\"><a href=\"#退出\" class=\"headerlink\" title=\"退出\"></a>退出</h5><p>打印3行后，退出sed</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sed &#x27;3q&#x27; word</span><br><span class=\"line\">Twinkle, twinkle, little star</span><br><span class=\"line\">How I wonder what you are</span><br><span class=\"line\">Up above the world so higher be bought</span><br><span class=\"line\">Doesn<span class=\"string\">&#x27;t matter how long it&#x27;</span>s been</span><br><span class=\"line\">I know you<span class=\"string\">&#x27;ll always jump in</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span>Cause we don<span class=\"string\">&#x27;t know how can quit</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"日常使用sed操作修改配置文件\"><a href=\"#日常使用sed操作修改配置文件\" class=\"headerlink\" title=\"日常使用sed操作修改配置文件:\"></a>日常使用sed操作修改配置文件:</h5><p>查看原始数据</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node2 ~]# cat /etc/ssh/sshd_config | grep Root</span><br><span class=\"line\"># PermitRootLogin yes</span><br></pre></td></tr></table></figure>\n<p>操作指令</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node2 ~]# sed -i &#x27;/PermitRootLogin/c\\PermitRootLogin no&#x27;  /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>\n<p>查看修改后的数据</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node2 ~]# cat /etc/ssh/sshd_config | grep Root</span><br><span class=\"line\">PermitRootLogin no</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Awk\"><a href=\"#Awk\" class=\"headerlink\" title=\"Awk\"></a>Awk</h3><blockquote>\n<p>awk是一个强大的文本分析工具，相对于grep的查找，sed的编辑，awk在其对数据分析并生成报告时，显得尤为强大。简单来说awk就是把文件逐行的读入，以空格为默认分隔符将每行切片，切开的部分再进行各种分析处理。</p>\n</blockquote>\n<p>命令格式：<br>awk [option] ‘scrip’ var=value</p>\n<p>参数：<br>option：<br>-F 指定输入的分割字符，默认为 空格<br>-v var=value 赋值一个用户自定义变量<br>-f scripfile 从脚本中读取 awk 命令</p>\n<h4 id=\"AWK-模式和操作awk-脚本是由模式和操作组成的。\"><a href=\"#AWK-模式和操作awk-脚本是由模式和操作组成的。\" class=\"headerlink\" title=\"AWK 模式和操作awk 脚本是由模式和操作组成的。\"></a>AWK 模式和操作awk 脚本是由模式和操作组成的。</h4><h5 id=\"模式\"><a href=\"#模式\" class=\"headerlink\" title=\"模式\"></a>模式</h5><p>模式可以是以下任意一个：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/正则表达式/： 使用通配符的扩展集</span><br><span class=\"line\">关系表达式：    使用运算符进行操作，可以是字符串或者数字比较测试</span><br><span class=\"line\">模式匹配表达式：用运算符~<span class=\"number\">9</span>匹配和~！（不匹配）</span><br><span class=\"line\">BEGIN 语句块，pattern语句块、END语句块</span><br></pre></td></tr></table></figure>\n<h5 id=\"操作\"><a href=\"#操作\" class=\"headerlink\" title=\"操作\"></a>操作</h5><p>操作有一个或者多个命令、函数、表达式组成，之间由换行符或分号隔开，并位于大括号内、主要部分有：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">变量或属组赋值</span><br><span class=\"line\">输出命令</span><br><span class=\"line\">内置函数</span><br><span class=\"line\">控制流程语句</span><br></pre></td></tr></table></figure>\n<h5 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h5><p>例： 只是显示最近登录的5个帐号</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# last -n 5 </span><br><span class=\"line\">root     pts/<span class=\"number\">0</span>        <span class=\"number\">192.168</span>.<span class=\"number\">116.1</span>    Fri Jun <span class=\"number\">12</span> <span class=\"number\">10</span>:<span class=\"number\">59</span>   still logged in   </span><br><span class=\"line\">reboot   system boot  <span class=\"number\">3.10</span>.<span class=\"number\">0</span>-<span class=\"number\">862.</span>el7.x Fri Jun <span class=\"number\">12</span> <span class=\"number\">10</span>:<span class=\"number\">58</span> - <span class=\"number\">11</span>:<span class=\"number\">36</span>  (<span class=\"number\">00</span>:<span class=\"number\">38</span>)    </span><br><span class=\"line\">reboot   system boot  <span class=\"number\">3.10</span>.<span class=\"number\">0</span>-<span class=\"number\">862.</span>el7.x Fri Jun  <span class=\"number\">5</span> <span class=\"number\">21</span>:<span class=\"number\">07</span> - <span class=\"number\">11</span>:<span class=\"number\">36</span> (<span class=\"number\">6</span>+<span class=\"number\">14</span>:<span class=\"number\">28</span>)   </span><br><span class=\"line\">root     pts/<span class=\"number\">0</span>        <span class=\"number\">192.168</span>.<span class=\"number\">116.1</span>    Fri Jun  <span class=\"number\">5</span> <span class=\"number\">18</span>:<span class=\"number\">40</span> - crash  (<span class=\"number\">02</span>:<span class=\"number\">27</span>)    </span><br><span class=\"line\">reboot   system boot  <span class=\"number\">3.10</span>.<span class=\"number\">0</span>-<span class=\"number\">862.</span>el7.x Fri Jun  <span class=\"number\">5</span> <span class=\"number\">17</span>:<span class=\"number\">28</span> - <span class=\"number\">11</span>:<span class=\"number\">36</span> (<span class=\"number\">6</span>+<span class=\"number\">18</span>:<span class=\"number\">08</span>)   </span><br><span class=\"line\"></span><br><span class=\"line\">wtmp begins Thu Oct <span class=\"number\">10</span> <span class=\"number\">22</span>:<span class=\"number\">36</span>:<span class=\"number\">04</span> <span class=\"number\">2019</span></span><br><span class=\"line\">[root@localhost ~]# last -n 5 | awk &#x27;&#123;print $1&#125;&#x27;</span><br><span class=\"line\">root</span><br><span class=\"line\">reboot</span><br><span class=\"line\">reboot</span><br><span class=\"line\">root</span><br><span class=\"line\">reboot</span><br></pre></td></tr></table></figure>\n<p>例： 只显示/etc/passwd的账户</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# cat /etc/passwd | awk -F &#x27;:&#x27; &#x27;&#123;print $1&#125;&#x27;</span><br><span class=\"line\">root</span><br><span class=\"line\">bin</span><br><span class=\"line\">daemon</span><br><span class=\"line\">adm</span><br><span class=\"line\">lp</span><br><span class=\"line\">sync</span><br><span class=\"line\">shutdown</span><br><span class=\"line\">halt</span><br><span class=\"line\">mail</span><br><span class=\"line\">operator</span><br><span class=\"line\">games</span><br><span class=\"line\">ftp</span><br><span class=\"line\">nobody</span><br><span class=\"line\">systemd-network</span><br><span class=\"line\">dbus</span><br><span class=\"line\">polkitd</span><br><span class=\"line\">tss</span><br><span class=\"line\">sshd</span><br><span class=\"line\">postfix</span><br><span class=\"line\">chrony</span><br><span class=\"line\">mysql</span><br></pre></td></tr></table></figure>\n<p>例：只显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以tab键分割</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# cat /etc/passwd | awk -F &#x27;:&#x27; &#x27;&#123;print $1&quot;\\t&quot;$7&#125;&#x27; </span><br><span class=\"line\">dbus    /sbin/nologin</span><br><span class=\"line\">polkitd    /sbin/nologin</span><br><span class=\"line\">tss    /sbin/nologin</span><br><span class=\"line\">sshd    /sbin/nologin</span><br><span class=\"line\">postfix    /sbin/nologin</span><br><span class=\"line\">chrony    /sbin/nologin</span><br><span class=\"line\">mysql    /bin/bash</span><br></pre></td></tr></table></figure>\n<p>例：只是显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以逗号分割,而且在所有行添加列名name,shell,在最后一行添加”blue,/bin/nosh”</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# cat /etc/passwd | awk -F &#x27;:&#x27; &#x27;BEGIN &#123;print &quot;name,shell&quot;&#125; &#123;print $1&quot;\\t&quot;$7&#125; END &#123;print &quot;Hello,/bin/nosh&quot;&#125;&#x27;</span><br><span class=\"line\">dbus    /sbin/nologin</span><br><span class=\"line\">polkitd    /sbin/nologin</span><br><span class=\"line\">tss    /sbin/nologin</span><br><span class=\"line\">sshd    /sbin/nologin</span><br><span class=\"line\">postfix    /sbin/nologin</span><br><span class=\"line\">chrony    /sbin/nologin</span><br><span class=\"line\">mysql    /bin/bash</span><br><span class=\"line\">Hello,/bin/nosh</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>awk工作流程是这样的：先执行BEGING，然后读取文件，读入有/n换行符分割的一条记录，然后将记录按指定的域分隔符划分域，填充域，$0则表示所有域,$1表示第一个域,$n表示第n个域,随后开始执行模式所对应的动作action。接着开始读入第二条记录······直到所有的记录都读完，最后执行END操作。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">第一步： 执行 BEGIN &#123;commond&#125; 指令</span><br><span class=\"line\">第二步： 从文件或标准输入&#123;stdin&#125;读取一行然后执行 pattern &#123; commmod &#125; </span><br><span class=\"line\">第三步； 从读至输入流末尾，执行 END &#123;commod&#125;语句</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>BEGIN 在awk 开始输入读取之前被执行，属于一个可选的模块，一般用于变量初始化、打印输出表头</p>\n<p>pattern 通用命令，是最重要的一块，属于可选的，一般用于打印出指定的列，如果没有指定 petter 模块，则默认执行 {print $0} 既打印出所有读取到的内容</p>\n<p>END 在 AWK 从输入流中读取完所有的内容之后再执行，在 awk 整个语句输入中末尾执行</p>\n</blockquote>\n<p>例：搜索 /etc/passwd 有 root 关键字的行</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# awk -F: &#x27;/root/&#x27; /etc/passwd</span><br><span class=\"line\">root:x:<span class=\"number\">0</span>:<span class=\"number\">0</span>:root:/root:/bin/bash</span><br><span class=\"line\">operator:x:<span class=\"number\">11</span>:<span class=\"number\">0</span>:operator:/root:/sbin/nologin</span><br></pre></td></tr></table></figure>\n<p>例：搜索/etc/passwd有root关键字的所有行，并显示对应的shell</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# awk -F: &#x27;/root/&#123;print $7&#125;&#x27; /etc/passwd</span><br><span class=\"line\">/bin/bash</span><br><span class=\"line\">/sbin/nologin</span><br></pre></td></tr></table></figure>"},{"title":"commit构建镜像","author":"Semaik.","date":"2020-09-10T09:40:00.000Z","_content":"###### 用docker commit构建映像\n```\n　　1.docker run -i -t centos /bin/bash　　//启动一个容器，启动后默认进入该窗口的bash进程\n　　2.yum install -y epel-release.noarch　　//为启动的窗口安装软件源\n　　3.yum install -y nginx　　//为启动的容器安装nginx\n　　4.exit　　//退出该容器，回到宿主机环境\n　　5.docker commit 容器ID zx/nginx　　//将上次创建的窗口ID当作映像提交到本地,zrs是repository名称,nginx是image名称\n　　6.docker images　　//可以查看到上步提交的映像\n  ```\n###### 注意：\n　　　　1.一定要区分开容器和映像的区别；\n    \n　　　　2.有了zx/nginx后，下次可以直接使用该映像来启动容器，而不用为这个容器安装nginx;\n    \n　　　　3.docker commit -m=\"this is a container contains nginx\" --author=\"zx\" 容器ID zx/nginx，类似git不作多余解释；","source":"_posts/commit构建镜像.md","raw":"title: commit构建镜像\nauthor: Semaik.\ntags:\n  - Docker\ncategories:\n  - Docker\ndate: 2020-09-10 17:40:00\n---\n###### 用docker commit构建映像\n```\n　　1.docker run -i -t centos /bin/bash　　//启动一个容器，启动后默认进入该窗口的bash进程\n　　2.yum install -y epel-release.noarch　　//为启动的窗口安装软件源\n　　3.yum install -y nginx　　//为启动的容器安装nginx\n　　4.exit　　//退出该容器，回到宿主机环境\n　　5.docker commit 容器ID zx/nginx　　//将上次创建的窗口ID当作映像提交到本地,zrs是repository名称,nginx是image名称\n　　6.docker images　　//可以查看到上步提交的映像\n  ```\n###### 注意：\n　　　　1.一定要区分开容器和映像的区别；\n    \n　　　　2.有了zx/nginx后，下次可以直接使用该映像来启动容器，而不用为这个容器安装nginx;\n    \n　　　　3.docker commit -m=\"this is a container contains nginx\" --author=\"zx\" 容器ID zx/nginx，类似git不作多余解释；","slug":"commit构建镜像","published":1,"updated":"2020-09-10T09:41:49.692Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737e001mm3pv7n5ddfe9","content":"<h6 id=\"用docker-commit构建映像\"><a href=\"#用docker-commit构建映像\" class=\"headerlink\" title=\"用docker commit构建映像\"></a>用docker commit构建映像</h6><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">　　<span class=\"number\">1</span><span class=\"selector-class\">.docker</span> run -<span class=\"selector-tag\">i</span> -t centos /bin/bash　　<span class=\"comment\">//启动一个容器，启动后默认进入该窗口的bash进程</span></span><br><span class=\"line\">　　<span class=\"number\">2</span><span class=\"selector-class\">.yum</span> install -y epel-release<span class=\"selector-class\">.noarch</span>　　<span class=\"comment\">//为启动的窗口安装软件源</span></span><br><span class=\"line\">　　<span class=\"number\">3</span><span class=\"selector-class\">.yum</span> install -y nginx　　<span class=\"comment\">//为启动的容器安装nginx</span></span><br><span class=\"line\">　　<span class=\"number\">4</span><span class=\"selector-class\">.exit</span>　　<span class=\"comment\">//退出该容器，回到宿主机环境</span></span><br><span class=\"line\">　　<span class=\"number\">5</span><span class=\"selector-class\">.docker</span> commit 容器ID zx/nginx　　<span class=\"comment\">//将上次创建的窗口ID当作映像提交到本地,zrs是repository名称,nginx是image名称</span></span><br><span class=\"line\">　　<span class=\"number\">6</span><span class=\"selector-class\">.docker</span> images　　<span class=\"comment\">//可以查看到上步提交的映像</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"注意：\"><a href=\"#注意：\" class=\"headerlink\" title=\"注意：\"></a>注意：</h6><p>　　　　1.一定要区分开容器和映像的区别；</p>\n<p>　　　　2.有了zx/nginx后，下次可以直接使用该映像来启动容器，而不用为这个容器安装nginx;</p>\n<p>　　　　3.docker commit -m=”this is a container contains nginx” –author=”zx” 容器ID zx/nginx，类似git不作多余解释；</p>\n","site":{"data":{}},"excerpt":"","more":"<h6 id=\"用docker-commit构建映像\"><a href=\"#用docker-commit构建映像\" class=\"headerlink\" title=\"用docker commit构建映像\"></a>用docker commit构建映像</h6><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">　　<span class=\"number\">1</span><span class=\"selector-class\">.docker</span> run -<span class=\"selector-tag\">i</span> -t centos /bin/bash　　<span class=\"comment\">//启动一个容器，启动后默认进入该窗口的bash进程</span></span><br><span class=\"line\">　　<span class=\"number\">2</span><span class=\"selector-class\">.yum</span> install -y epel-release<span class=\"selector-class\">.noarch</span>　　<span class=\"comment\">//为启动的窗口安装软件源</span></span><br><span class=\"line\">　　<span class=\"number\">3</span><span class=\"selector-class\">.yum</span> install -y nginx　　<span class=\"comment\">//为启动的容器安装nginx</span></span><br><span class=\"line\">　　<span class=\"number\">4</span><span class=\"selector-class\">.exit</span>　　<span class=\"comment\">//退出该容器，回到宿主机环境</span></span><br><span class=\"line\">　　<span class=\"number\">5</span><span class=\"selector-class\">.docker</span> commit 容器ID zx/nginx　　<span class=\"comment\">//将上次创建的窗口ID当作映像提交到本地,zrs是repository名称,nginx是image名称</span></span><br><span class=\"line\">　　<span class=\"number\">6</span><span class=\"selector-class\">.docker</span> images　　<span class=\"comment\">//可以查看到上步提交的映像</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"注意：\"><a href=\"#注意：\" class=\"headerlink\" title=\"注意：\"></a>注意：</h6><p>　　　　1.一定要区分开容器和映像的区别；</p>\n<p>　　　　2.有了zx/nginx后，下次可以直接使用该映像来启动容器，而不用为这个容器安装nginx;</p>\n<p>　　　　3.docker commit -m=”this is a container contains nginx” –author=”zx” 容器ID zx/nginx，类似git不作多余解释；</p>\n"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","slug":"hello-world","published":1,"date":"2020-09-10T01:31:08.375Z","updated":"2020-09-10T01:31:08.375Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737g001pm3pvd5nsdnt6","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n"},{"title":"k8s重新生成Tocken并加入集群","date":"2020-09-10T06:23:09.000Z","_content":"#### 生成Token以及ca证书sha256hash值\n```java\n[root@node1 ~]# kubeadm token create --print-join-command \nW0710 09:11:07.688855   62169 configset.go:202] WARNING: kubeadm cannot validate component configs for API groups [kubelet.config.k8s.io kubeproxy.config.k8s.io]\nkubeadm join 1.1.1.5:6443 --token 1cpem4.adim7zc1fqi4x1px     --discovery-token-ca-cert-hash sha256:9c4f217b0a12781be5c49262aa58738f873e7e0037719eeb0adeb7293bcdc1ca \n```\n#### 如果之前怡景加入过集群需要关闭10250端口以及删除K8S目录\n```java\n[root@node3 ~]# rm -rf /etc/kubernetes/\n[root@node2 ~]# netstat -anpt | grep 10250\ntcp6       0      0 :::10250                :::*                    LISTEN      9992/kubelet        \n[root@node2 ~]# kill -9 9992\n```\n#### node加入集群\n复制生成的值\n```java\nkubeadm join 1.1.1.5:6443 --token 1cpem4.adim7zc1fqi4x1px     --discovery-token-ca-cert-hash sha256:9c4f217b0a12781be5c49262aa58738f873e7e0037719eeb0adeb7293bcdc1ca \n```\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/k8s重新生成Tocken并加入集群.md","raw":"---\ntitle: k8s重新生成Tocken并加入集群\ndate: 2020-09-10 14:23:09\ncategories: Kubernetes\ntags:\n    - Kubetnetes\n---\n#### 生成Token以及ca证书sha256hash值\n```java\n[root@node1 ~]# kubeadm token create --print-join-command \nW0710 09:11:07.688855   62169 configset.go:202] WARNING: kubeadm cannot validate component configs for API groups [kubelet.config.k8s.io kubeproxy.config.k8s.io]\nkubeadm join 1.1.1.5:6443 --token 1cpem4.adim7zc1fqi4x1px     --discovery-token-ca-cert-hash sha256:9c4f217b0a12781be5c49262aa58738f873e7e0037719eeb0adeb7293bcdc1ca \n```\n#### 如果之前怡景加入过集群需要关闭10250端口以及删除K8S目录\n```java\n[root@node3 ~]# rm -rf /etc/kubernetes/\n[root@node2 ~]# netstat -anpt | grep 10250\ntcp6       0      0 :::10250                :::*                    LISTEN      9992/kubelet        \n[root@node2 ~]# kill -9 9992\n```\n#### node加入集群\n复制生成的值\n```java\nkubeadm join 1.1.1.5:6443 --token 1cpem4.adim7zc1fqi4x1px     --discovery-token-ca-cert-hash sha256:9c4f217b0a12781be5c49262aa58738f873e7e0037719eeb0adeb7293bcdc1ca \n```\n\n\n\n\n\n\n\n\n\n\n","slug":"k8s重新生成Tocken并加入集群","published":1,"updated":"2020-09-10T06:26:33.006Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737h001um3pv0kms7nsx","content":"<h4 id=\"生成Token以及ca证书sha256hash值\"><a href=\"#生成Token以及ca证书sha256hash值\" class=\"headerlink\" title=\"生成Token以及ca证书sha256hash值\"></a>生成Token以及ca证书sha256hash值</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node1 ~]# kubeadm token create --print-join-command </span><br><span class=\"line\">W0710 <span class=\"number\">09</span>:<span class=\"number\">11</span>:<span class=\"number\">07</span>.<span class=\"number\">688855</span>   <span class=\"number\">62169</span> configset.go:<span class=\"number\">202</span>] WARNING: kubeadm cannot validate component configs <span class=\"keyword\">for</span> API groups [kubelet.config.k8s.io kubeproxy.config.k8s.io]</span><br><span class=\"line\">kubeadm join <span class=\"number\">1.1</span>.<span class=\"number\">1.5</span>:<span class=\"number\">6443</span> --token <span class=\"number\">1</span>cpem4.adim7zc1fqi4x1px     --discovery-token-ca-cert-hash sha256:<span class=\"number\">9</span>c4f217b0a12781be5c49262aa58738f873e7e0037719eeb0adeb7293bcdc1ca </span><br></pre></td></tr></table></figure>\n<h4 id=\"如果之前怡景加入过集群需要关闭10250端口以及删除K8S目录\"><a href=\"#如果之前怡景加入过集群需要关闭10250端口以及删除K8S目录\" class=\"headerlink\" title=\"如果之前怡景加入过集群需要关闭10250端口以及删除K8S目录\"></a>如果之前怡景加入过集群需要关闭10250端口以及删除K8S目录</h4><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node3 ~]# rm -rf /etc/kubernetes/</span><br><span class=\"line\">[root@node2 ~]# netstat -anpt | grep 10250</span><br><span class=\"line\">tcp6       <span class=\"number\">0</span>      <span class=\"number\">0</span> :::<span class=\"number\">10250</span>                :::*                    LISTEN      <span class=\"number\">9992</span>/kubelet        </span><br><span class=\"line\">[root@node2 ~]# kill -9 9992</span><br></pre></td></tr></table></figure>\n<h4 id=\"node加入集群\"><a href=\"#node加入集群\" class=\"headerlink\" title=\"node加入集群\"></a>node加入集群</h4><p>复制生成的值</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm join <span class=\"number\">1.1</span>.<span class=\"number\">1.5</span>:<span class=\"number\">6443</span> --token <span class=\"number\">1</span>cpem4.adim7zc1fqi4x1px     --discovery-token-ca-cert-hash sha256:<span class=\"number\">9</span>c4f217b0a12781be5c49262aa58738f873e7e0037719eeb0adeb7293bcdc1ca </span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n\n","site":{"data":{}},"excerpt":"","more":"<h4 id=\"生成Token以及ca证书sha256hash值\"><a href=\"#生成Token以及ca证书sha256hash值\" class=\"headerlink\" title=\"生成Token以及ca证书sha256hash值\"></a>生成Token以及ca证书sha256hash值</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node1 ~]# kubeadm token create --print-join-command </span><br><span class=\"line\">W0710 <span class=\"number\">09</span>:<span class=\"number\">11</span>:<span class=\"number\">07</span>.<span class=\"number\">688855</span>   <span class=\"number\">62169</span> configset.go:<span class=\"number\">202</span>] WARNING: kubeadm cannot validate component configs <span class=\"keyword\">for</span> API groups [kubelet.config.k8s.io kubeproxy.config.k8s.io]</span><br><span class=\"line\">kubeadm join <span class=\"number\">1.1</span>.<span class=\"number\">1.5</span>:<span class=\"number\">6443</span> --token <span class=\"number\">1</span>cpem4.adim7zc1fqi4x1px     --discovery-token-ca-cert-hash sha256:<span class=\"number\">9</span>c4f217b0a12781be5c49262aa58738f873e7e0037719eeb0adeb7293bcdc1ca </span><br></pre></td></tr></table></figure>\n<h4 id=\"如果之前怡景加入过集群需要关闭10250端口以及删除K8S目录\"><a href=\"#如果之前怡景加入过集群需要关闭10250端口以及删除K8S目录\" class=\"headerlink\" title=\"如果之前怡景加入过集群需要关闭10250端口以及删除K8S目录\"></a>如果之前怡景加入过集群需要关闭10250端口以及删除K8S目录</h4><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node3 ~]# rm -rf /etc/kubernetes/</span><br><span class=\"line\">[root@node2 ~]# netstat -anpt | grep 10250</span><br><span class=\"line\">tcp6       <span class=\"number\">0</span>      <span class=\"number\">0</span> :::<span class=\"number\">10250</span>                :::*                    LISTEN      <span class=\"number\">9992</span>/kubelet        </span><br><span class=\"line\">[root@node2 ~]# kill -9 9992</span><br></pre></td></tr></table></figure>\n<h4 id=\"node加入集群\"><a href=\"#node加入集群\" class=\"headerlink\" title=\"node加入集群\"></a>node加入集群</h4><p>复制生成的值</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm join <span class=\"number\">1.1</span>.<span class=\"number\">1.5</span>:<span class=\"number\">6443</span> --token <span class=\"number\">1</span>cpem4.adim7zc1fqi4x1px     --discovery-token-ca-cert-hash sha256:<span class=\"number\">9</span>c4f217b0a12781be5c49262aa58738f873e7e0037719eeb0adeb7293bcdc1ca </span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n\n"},{"title":"使用SSH连接Docker容器","author":"Semaik.","date":"2020-09-27T06:54:00.000Z","_content":"**实验：使用ssh管理docker的容器**\n \n**实验要求：**\n \n>1、ssh可以登录容器\n>2、在容器内yum 安装httpd并且启动\n \n**实验步骤**\n \n将docker的centos镜像实例化名为sshd的容器\n ```java\n[root@localhost ~]# docker run -itd --name sshd centos /bin/bash\ncd3c512d6cd959263b1c94e19781d7213831aad714a2e962ade7c0adc28c510e\n```\n进入容器，并进行安装sshd和启动sshd的相应操作\n ```java\n[root@localhost ~]# docker exec -it sshd /bin/bash\n[root@cd3c512d6cd9 /]# yum -y install openssh-server openssh-clients password iproute net-tools\n[root@cd3c512d6cd9 /]# passwd root   # 设置root密码\n[root@cd3c512d6cd9 /]# cat /usr/lib/systemd/system/sshd.service\n 找到以下\nExecStart=/usr/sbin/sshd -D $OPTIONS\n /usr/sbin/sshd -D这个用来启动yum安装的服务，几乎所有yum安装的都有这个\n[root@5c46b791e8d2 /]# /usr/sbin/sshd -D\n 执行之后发现报错，找不到3个密钥文件\nCould not load host key: /etc/ssh/ssh_host_rsa_key\nCould not load host key: /etc/ssh/ssh_host_ecdsa_key\nCould not load host key: /etc/ssh/ssh_host_ed25519_key\nsshd: no hostkeys available -- exiting.\n 生成密钥，分别存放到它要找到三个路径中\n[root@cd3c512d6cd9 /]# ssh-keygen -q -t rsa -b 2048 -f /etc/ssh/ssh_host_rsa_key -N ''\n[root@cd3c512d6cd9 /]# ssh-keygen -q -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key -N ''\n[root@cd3c512d6cd9 /]# ssh-keygen -q -t dsa -f /etc/ssh/ssh_host_ed25519_key -N ''\n \nkeygen参数：\n    -q：不在终端显示密钥\n    -b：字节长度\n    -f：指定密钥文件路径\n \n 可以通过cat去查看这三个密钥\n[root@cd3c512d6cd9 /]# vi /etc/ssh/sshd_config \n 修此文件是得ssh以进程方式运行\n 这是pam模块使用sshd，容器中没有这个模块，所以需要注释\nUsePAM no  \n 解开以下注释并修改值为no\nUsePrivilegeSeparation sandbox  //将sandbox改为no\n 以下解开注释，允许超级用户登录\nPermitRootLogin yes\n```\n启动sshd服务\n```java\n[root@5c46b791e8d2 /]# /usr/sbin/sshd -D &\n[root@5c46b791e8d2 /]# exit\nexit\n```\n然后就可以通过ssh来使用物理机连接docker容器sshd\n ```java\n[root@192 ~]# ssh root@172.17.0.2\nThe authenticity of host '172.17.0.2 (172.17.0.2)' can't be established.\nECDSA key fingerprint is SHA256:8M08usrRzTfDZjM9cfZhM+DAMn8d4O6/xW3ULlpM17o.\nECDSA key fingerprint is MD5:8b:72:3b:0f:15:ac:f4:8f:24:f0:ed:fa:40:12:c3:ae.\nAre you sure you want to continue connecting (yes/no)? yes\nWarning: Permanently added '172.17.0.2' (ECDSA) to the list of known hosts.\nroot@172.17.0.2's password:\n```\n安装httpd并启动\n```java\n[root@5c46b791e8d2 ~]# yum -y install httpd\n[root@5c46b791e8d2 ~]# find / -name httpd.service\n/usr/lib/systemd/system/httpd.service\n[root@5c46b791e8d2 ~]# cat /usr/lib/systemd/system/httpd.service\nExecStart=/usr/sbin/httpd $OPTIONS -DFOREGROUND\n[root@5c46b791e8d2 ~]# /usr/sbin/httpd  &\nAH00558: httpd: Could not reliably determine the server's fully qualified\ndomain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message\n[root@5c46b791e8d2 ~]# netstat -anpt | grep 80\ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      191/httpd \n[root@5c46b791e8d2 ~]# curl 172.17.0.2\n```\n","source":"_posts/使用SSH连接Docker容器.md","raw":"title: 使用SSH连接Docker容器\nauthor: Semaik.\ntags:\n  - Docker\ncategories: []\ndate: 2020-09-27 14:54:00\n---\n**实验：使用ssh管理docker的容器**\n \n**实验要求：**\n \n>1、ssh可以登录容器\n>2、在容器内yum 安装httpd并且启动\n \n**实验步骤**\n \n将docker的centos镜像实例化名为sshd的容器\n ```java\n[root@localhost ~]# docker run -itd --name sshd centos /bin/bash\ncd3c512d6cd959263b1c94e19781d7213831aad714a2e962ade7c0adc28c510e\n```\n进入容器，并进行安装sshd和启动sshd的相应操作\n ```java\n[root@localhost ~]# docker exec -it sshd /bin/bash\n[root@cd3c512d6cd9 /]# yum -y install openssh-server openssh-clients password iproute net-tools\n[root@cd3c512d6cd9 /]# passwd root   # 设置root密码\n[root@cd3c512d6cd9 /]# cat /usr/lib/systemd/system/sshd.service\n 找到以下\nExecStart=/usr/sbin/sshd -D $OPTIONS\n /usr/sbin/sshd -D这个用来启动yum安装的服务，几乎所有yum安装的都有这个\n[root@5c46b791e8d2 /]# /usr/sbin/sshd -D\n 执行之后发现报错，找不到3个密钥文件\nCould not load host key: /etc/ssh/ssh_host_rsa_key\nCould not load host key: /etc/ssh/ssh_host_ecdsa_key\nCould not load host key: /etc/ssh/ssh_host_ed25519_key\nsshd: no hostkeys available -- exiting.\n 生成密钥，分别存放到它要找到三个路径中\n[root@cd3c512d6cd9 /]# ssh-keygen -q -t rsa -b 2048 -f /etc/ssh/ssh_host_rsa_key -N ''\n[root@cd3c512d6cd9 /]# ssh-keygen -q -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key -N ''\n[root@cd3c512d6cd9 /]# ssh-keygen -q -t dsa -f /etc/ssh/ssh_host_ed25519_key -N ''\n \nkeygen参数：\n    -q：不在终端显示密钥\n    -b：字节长度\n    -f：指定密钥文件路径\n \n 可以通过cat去查看这三个密钥\n[root@cd3c512d6cd9 /]# vi /etc/ssh/sshd_config \n 修此文件是得ssh以进程方式运行\n 这是pam模块使用sshd，容器中没有这个模块，所以需要注释\nUsePAM no  \n 解开以下注释并修改值为no\nUsePrivilegeSeparation sandbox  //将sandbox改为no\n 以下解开注释，允许超级用户登录\nPermitRootLogin yes\n```\n启动sshd服务\n```java\n[root@5c46b791e8d2 /]# /usr/sbin/sshd -D &\n[root@5c46b791e8d2 /]# exit\nexit\n```\n然后就可以通过ssh来使用物理机连接docker容器sshd\n ```java\n[root@192 ~]# ssh root@172.17.0.2\nThe authenticity of host '172.17.0.2 (172.17.0.2)' can't be established.\nECDSA key fingerprint is SHA256:8M08usrRzTfDZjM9cfZhM+DAMn8d4O6/xW3ULlpM17o.\nECDSA key fingerprint is MD5:8b:72:3b:0f:15:ac:f4:8f:24:f0:ed:fa:40:12:c3:ae.\nAre you sure you want to continue connecting (yes/no)? yes\nWarning: Permanently added '172.17.0.2' (ECDSA) to the list of known hosts.\nroot@172.17.0.2's password:\n```\n安装httpd并启动\n```java\n[root@5c46b791e8d2 ~]# yum -y install httpd\n[root@5c46b791e8d2 ~]# find / -name httpd.service\n/usr/lib/systemd/system/httpd.service\n[root@5c46b791e8d2 ~]# cat /usr/lib/systemd/system/httpd.service\nExecStart=/usr/sbin/httpd $OPTIONS -DFOREGROUND\n[root@5c46b791e8d2 ~]# /usr/sbin/httpd  &\nAH00558: httpd: Could not reliably determine the server's fully qualified\ndomain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message\n[root@5c46b791e8d2 ~]# netstat -anpt | grep 80\ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      191/httpd \n[root@5c46b791e8d2 ~]# curl 172.17.0.2\n```\n","slug":"使用SSH连接Docker容器","published":1,"updated":"2020-09-27T06:59:17.978Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737i001xm3pv10z31ggr","content":"<p><strong>实验：使用ssh管理docker的容器</strong></p>\n<p><strong>实验要求：</strong></p>\n<blockquote>\n<p>1、ssh可以登录容器<br>2、在容器内yum 安装httpd并且启动</p>\n</blockquote>\n<p><strong>实验步骤</strong></p>\n<p>将docker的centos镜像实例化名为sshd的容器<br> <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -itd --name sshd centos /bin/bash</span><br><span class=\"line\">cd3c512d6cd959263b1c94e19781d7213831aad714a2e962ade7c0adc28c510e</span><br></pre></td></tr></table></figure><br>进入容器，并进行安装sshd和启动sshd的相应操作<br> <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker exec -it sshd /bin/bash</span><br><span class=\"line\">[root@cd3c512d6cd9 /]# yum -y install openssh-server openssh-clients password iproute net-tools</span><br><span class=\"line\">[root@cd3c512d6cd9 /]# passwd root   # 设置root密码</span><br><span class=\"line\">[root@cd3c512d6cd9 /]# cat /usr/lib/systemd/system/sshd.service</span><br><span class=\"line\"> 找到以下</span><br><span class=\"line\">ExecStart=/usr/sbin/sshd -D $OPTIONS</span><br><span class=\"line\"> /usr/sbin/sshd -D这个用来启动yum安装的服务，几乎所有yum安装的都有这个</span><br><span class=\"line\">[root@5c46b791e8d2 /]# /usr/sbin/sshd -D</span><br><span class=\"line\"> 执行之后发现报错，找不到<span class=\"number\">3</span>个密钥文件</span><br><span class=\"line\">Could not load host key: /etc/ssh/ssh_host_rsa_key</span><br><span class=\"line\">Could not load host key: /etc/ssh/ssh_host_ecdsa_key</span><br><span class=\"line\">Could not load host key: /etc/ssh/ssh_host_ed25519_key</span><br><span class=\"line\">sshd: no hostkeys available -- exiting.</span><br><span class=\"line\"> 生成密钥，分别存放到它要找到三个路径中</span><br><span class=\"line\">[root@cd3c512d6cd9 /]# ssh-keygen -q -t rsa -b 2048 -f /etc/ssh/ssh_host_rsa_key -N &#x27;&#x27;</span><br><span class=\"line\">[root@cd3c512d6cd9 /]# ssh-keygen -q -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key -N &#x27;&#x27;</span><br><span class=\"line\">[root@cd3c512d6cd9 /]# ssh-keygen -q -t dsa -f /etc/ssh/ssh_host_ed25519_key -N &#x27;&#x27;</span><br><span class=\"line\"> </span><br><span class=\"line\">keygen参数：</span><br><span class=\"line\">    -q：不在终端显示密钥</span><br><span class=\"line\">    -b：字节长度</span><br><span class=\"line\">    -f：指定密钥文件路径</span><br><span class=\"line\"> </span><br><span class=\"line\"> 可以通过cat去查看这三个密钥</span><br><span class=\"line\">[root@cd3c512d6cd9 /]# vi /etc/ssh/sshd_config </span><br><span class=\"line\"> 修此文件是得ssh以进程方式运行</span><br><span class=\"line\"> 这是pam模块使用sshd，容器中没有这个模块，所以需要注释</span><br><span class=\"line\">UsePAM no  </span><br><span class=\"line\"> 解开以下注释并修改值为no</span><br><span class=\"line\">UsePrivilegeSeparation sandbox  <span class=\"comment\">//将sandbox改为no</span></span><br><span class=\"line\"> 以下解开注释，允许超级用户登录</span><br><span class=\"line\">PermitRootLogin yes</span><br></pre></td></tr></table></figure><br>启动sshd服务</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@5c46b791e8d2 /]# /usr/sbin/sshd -D &amp;</span><br><span class=\"line\">[root@5c46b791e8d2 /]# exit</span><br><span class=\"line\">exit</span><br></pre></td></tr></table></figure>\n<p>然后就可以通过ssh来使用物理机连接docker容器sshd<br> <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 ~]# ssh root@172.17.0.2</span><br><span class=\"line\">The authenticity of host <span class=\"string\">&#x27;172.17.0.2 (172.17.0.2)&#x27;</span> can<span class=\"string\">&#x27;t be established.</span></span><br><span class=\"line\"><span class=\"string\">ECDSA key fingerprint is SHA256:8M08usrRzTfDZjM9cfZhM+DAMn8d4O6/xW3ULlpM17o.</span></span><br><span class=\"line\"><span class=\"string\">ECDSA key fingerprint is MD5:8b:72:3b:0f:15:ac:f4:8f:24:f0:ed:fa:40:12:c3:ae.</span></span><br><span class=\"line\"><span class=\"string\">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class=\"line\"><span class=\"string\">Warning: Permanently added &#x27;</span><span class=\"number\">172.17</span>.<span class=\"number\">0.2</span><span class=\"string\">&#x27; (ECDSA) to the list of known hosts.</span></span><br><span class=\"line\"><span class=\"string\">root@172.17.0.2&#x27;</span>s password:</span><br></pre></td></tr></table></figure><br>安装httpd并启动</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@5c46b791e8d2 ~]# yum -y install httpd</span><br><span class=\"line\">[root@5c46b791e8d2 ~]# find / -name httpd.service</span><br><span class=\"line\">/usr/lib/systemd/system/httpd.service</span><br><span class=\"line\">[root@5c46b791e8d2 ~]# cat /usr/lib/systemd/system/httpd.service</span><br><span class=\"line\">ExecStart=/usr/sbin/httpd $OPTIONS -DFOREGROUND</span><br><span class=\"line\">[root@5c46b791e8d2 ~]# /usr/sbin/httpd  &amp;</span><br><span class=\"line\">AH00558: httpd: Could not reliably determine the server<span class=\"string\">&#x27;s fully qualified</span></span><br><span class=\"line\"><span class=\"string\">domain name, using 172.17.0.2. Set the &#x27;</span>ServerName<span class=\"string\">&#x27; directive globally to suppress this message</span></span><br><span class=\"line\"><span class=\"string\">[root@5c46b791e8d2 ~]# netstat -anpt | grep 80</span></span><br><span class=\"line\"><span class=\"string\">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      191/httpd </span></span><br><span class=\"line\"><span class=\"string\">[root@5c46b791e8d2 ~]# curl 172.17.0.2</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p><strong>实验：使用ssh管理docker的容器</strong></p>\n<p><strong>实验要求：</strong></p>\n<blockquote>\n<p>1、ssh可以登录容器<br>2、在容器内yum 安装httpd并且启动</p>\n</blockquote>\n<p><strong>实验步骤</strong></p>\n<p>将docker的centos镜像实例化名为sshd的容器<br> <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -itd --name sshd centos /bin/bash</span><br><span class=\"line\">cd3c512d6cd959263b1c94e19781d7213831aad714a2e962ade7c0adc28c510e</span><br></pre></td></tr></table></figure><br>进入容器，并进行安装sshd和启动sshd的相应操作<br> <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker exec -it sshd /bin/bash</span><br><span class=\"line\">[root@cd3c512d6cd9 /]# yum -y install openssh-server openssh-clients password iproute net-tools</span><br><span class=\"line\">[root@cd3c512d6cd9 /]# passwd root   # 设置root密码</span><br><span class=\"line\">[root@cd3c512d6cd9 /]# cat /usr/lib/systemd/system/sshd.service</span><br><span class=\"line\"> 找到以下</span><br><span class=\"line\">ExecStart=/usr/sbin/sshd -D $OPTIONS</span><br><span class=\"line\"> /usr/sbin/sshd -D这个用来启动yum安装的服务，几乎所有yum安装的都有这个</span><br><span class=\"line\">[root@5c46b791e8d2 /]# /usr/sbin/sshd -D</span><br><span class=\"line\"> 执行之后发现报错，找不到<span class=\"number\">3</span>个密钥文件</span><br><span class=\"line\">Could not load host key: /etc/ssh/ssh_host_rsa_key</span><br><span class=\"line\">Could not load host key: /etc/ssh/ssh_host_ecdsa_key</span><br><span class=\"line\">Could not load host key: /etc/ssh/ssh_host_ed25519_key</span><br><span class=\"line\">sshd: no hostkeys available -- exiting.</span><br><span class=\"line\"> 生成密钥，分别存放到它要找到三个路径中</span><br><span class=\"line\">[root@cd3c512d6cd9 /]# ssh-keygen -q -t rsa -b 2048 -f /etc/ssh/ssh_host_rsa_key -N &#x27;&#x27;</span><br><span class=\"line\">[root@cd3c512d6cd9 /]# ssh-keygen -q -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key -N &#x27;&#x27;</span><br><span class=\"line\">[root@cd3c512d6cd9 /]# ssh-keygen -q -t dsa -f /etc/ssh/ssh_host_ed25519_key -N &#x27;&#x27;</span><br><span class=\"line\"> </span><br><span class=\"line\">keygen参数：</span><br><span class=\"line\">    -q：不在终端显示密钥</span><br><span class=\"line\">    -b：字节长度</span><br><span class=\"line\">    -f：指定密钥文件路径</span><br><span class=\"line\"> </span><br><span class=\"line\"> 可以通过cat去查看这三个密钥</span><br><span class=\"line\">[root@cd3c512d6cd9 /]# vi /etc/ssh/sshd_config </span><br><span class=\"line\"> 修此文件是得ssh以进程方式运行</span><br><span class=\"line\"> 这是pam模块使用sshd，容器中没有这个模块，所以需要注释</span><br><span class=\"line\">UsePAM no  </span><br><span class=\"line\"> 解开以下注释并修改值为no</span><br><span class=\"line\">UsePrivilegeSeparation sandbox  <span class=\"comment\">//将sandbox改为no</span></span><br><span class=\"line\"> 以下解开注释，允许超级用户登录</span><br><span class=\"line\">PermitRootLogin yes</span><br></pre></td></tr></table></figure><br>启动sshd服务</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@5c46b791e8d2 /]# /usr/sbin/sshd -D &amp;</span><br><span class=\"line\">[root@5c46b791e8d2 /]# exit</span><br><span class=\"line\">exit</span><br></pre></td></tr></table></figure>\n<p>然后就可以通过ssh来使用物理机连接docker容器sshd<br> <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 ~]# ssh root@172.17.0.2</span><br><span class=\"line\">The authenticity of host <span class=\"string\">&#x27;172.17.0.2 (172.17.0.2)&#x27;</span> can<span class=\"string\">&#x27;t be established.</span></span><br><span class=\"line\"><span class=\"string\">ECDSA key fingerprint is SHA256:8M08usrRzTfDZjM9cfZhM+DAMn8d4O6/xW3ULlpM17o.</span></span><br><span class=\"line\"><span class=\"string\">ECDSA key fingerprint is MD5:8b:72:3b:0f:15:ac:f4:8f:24:f0:ed:fa:40:12:c3:ae.</span></span><br><span class=\"line\"><span class=\"string\">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class=\"line\"><span class=\"string\">Warning: Permanently added &#x27;</span><span class=\"number\">172.17</span>.<span class=\"number\">0.2</span><span class=\"string\">&#x27; (ECDSA) to the list of known hosts.</span></span><br><span class=\"line\"><span class=\"string\">root@172.17.0.2&#x27;</span>s password:</span><br></pre></td></tr></table></figure><br>安装httpd并启动</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@5c46b791e8d2 ~]# yum -y install httpd</span><br><span class=\"line\">[root@5c46b791e8d2 ~]# find / -name httpd.service</span><br><span class=\"line\">/usr/lib/systemd/system/httpd.service</span><br><span class=\"line\">[root@5c46b791e8d2 ~]# cat /usr/lib/systemd/system/httpd.service</span><br><span class=\"line\">ExecStart=/usr/sbin/httpd $OPTIONS -DFOREGROUND</span><br><span class=\"line\">[root@5c46b791e8d2 ~]# /usr/sbin/httpd  &amp;</span><br><span class=\"line\">AH00558: httpd: Could not reliably determine the server<span class=\"string\">&#x27;s fully qualified</span></span><br><span class=\"line\"><span class=\"string\">domain name, using 172.17.0.2. Set the &#x27;</span>ServerName<span class=\"string\">&#x27; directive globally to suppress this message</span></span><br><span class=\"line\"><span class=\"string\">[root@5c46b791e8d2 ~]# netstat -anpt | grep 80</span></span><br><span class=\"line\"><span class=\"string\">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      191/httpd </span></span><br><span class=\"line\"><span class=\"string\">[root@5c46b791e8d2 ~]# curl 172.17.0.2</span></span><br></pre></td></tr></table></figure>\n"},{"title":"升级Openssh详细步骤","author":"Semaik.","date":"2020-09-11T07:34:00.000Z","_content":"#### 1、准备工作\n\n1.1、下载相关软件包\n\n> OpenSSH需要依赖ZLIB和OpenSSL，因此需要从官网下载三者的源码包。需要注意的是：OpenSSH最新版8.1p1依赖的OpenSSL版本为1.0.2k，而不是其最新版1.1.0e（使用此版会升级失败）,ZLIB可以使用最新 版1.2.11。 \n\n三者源码下载地址：\n\n     http://www.zlib.net/\n     http://www.openssl.org/\n     http://www.openssh.org/\n\n1.2、查看系统当前软件版本\n\n    # rpm -q zlib\n    # openssl version\n    # ssh -V\n\n1.3、配置在线yum源\n```\n# cd /etc/yum.repos.d\n# rm -rf *             #删除当前所有yum源文件\n\n# wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo   #连接阿里云在线源\n```\n\n1.4、安装telnet服务并启用\n\n   > 因升级OpenSSH过程中需要卸载现有OpenSSH, 因此为了保持服务器的远程连接可用，需要启用telnet服务作为替代，如升级出现问题，也可通过telnet登录服务器进行回退。\n\n   A、安装telnet服务\n```\n   # yum -y install telnet-server*\n```\n   B、启用telnet\n\n   先关闭防火墙，否则telnet可能无法连接\n```\n# service iptables stop\n# chkconfig iptables off\n# vi /etc/xinetd.d/telnet\n将其中disable字段的yes改为no以启用telnet服务\n# mv /etc/securetty /etc/securetty.old          #允许root用户通过telnet登录\n# /etc/init.d/xinetd start       #启动telnet服务\n# chkconfig xinetd on              #使telnet服务开机启动，避免升级过程中服务器意外重启后无法远程登录系统\n# telnet [ip]                 #新开启一个远程终端以telnet登录验证是否成功启用\n```\n1.5、安装编译所需工具包\n```\n# yum -y install gcc pam-devel zlib-devel\n```\n\n#### 2、正式升级\n\n2.1、升级ZLIB\n\nA、解压zlib_1.2.11源码并编译\n```\n# tar -zxvf zlib-1.2.11.tar.gz\n# cd zlib-1.2.11\n# ./configure --prefix=/usr\n# make\n```\nB、卸载当前zlib\n\n> 注意：此步骤必须在步骤A执行完毕后再执行，否则先卸载zlib后，/lib64/目录下的zlib相关库文件会被删除，步骤A编译zlib会失败。\n```\n# rpm -e --nodeps zlib \n```\n\nC、安装之前编译好的zlib \n```\n# make install \n```\n在zlib编译目录执行如下命令\n\nD、共享库注册\n\n> zlib安装完成后，会在/usr/lib目录中生产zlib相关库文件，需要将这些共享库文件注册到系统中。\n```\n# echo '/usr/lib' >> /etc/ld.so.conf\n# ldconfig #更新共享库cache\n```\n\n2.2、升级OpenSSL\n\nA、备份当前openssl\n```\n# find / -name openssl\n  /usr/lib64/openssl\n  /usr/bin/openssl\n  /etc/pki/ca-trust/extracted/openssl\n\n# mv /usr/lib64/openssl /usr/lib64/openssl.old\n# mv /usr/bin/openssl /usr/bin/openssl.old\n# mv /etc/pki/ca-trust/extracted/openssl /etc/pki/ca-trust/extracted/openssl.old\n\n如下两个库文件必须先备份，因系统内部分工具（如yum、wget等）依赖此库，而新版OpenSSL不包含这两个库\n# cp /usr/lib64/libcrypto.so.10 /usr/lib64/libcrypto.so.10.old\n# cp /usr/lib64/libssl.so.10 /usr/lib64/libssl.so.10.old\n\n```\nB、卸载当前openssl\n```\n# rpm -qa | grep openssl\n   openssl-1.0.1e-42.el6.x86_64\n\n# rpm -e --nodeps openssl-1.0.1e-42.el6.x86_64\n# rpm -qa | grep openssl\n```\n\nC、解压openssl_1.0.2k源码并编译安装\n```\n# tar -zxvf openssl-1.0.2k.tar.gz\n# cd openssl-1.0.2k\n# ./config --prefix=/usr --openssldir=/etc/ssl --shared zlib                                #必须加上--shared，否则编译时会找不到新安装的openssl的库而报错\n# make\n# make test                             #必须执行这一步结果为pass才能继续，否则即使安装完成，ssh也无法使用\n# make install\n# openssl version -a                           #查看是否升级成功\n```\n\nD、恢复共享库\n\n> 由于OpenSSL_1.0.2k不提供libcrypto.so.10和libssl.so.10这两个库，而yum、wget等工具又依赖此库，因此需要将先前备份的这两个库进行恢复，其他的可视情况考虑是否恢复。\n```\n# mv /usr/lib64/libcrypto.so.10.old  /usr/lib64/libcrypto.so.10\n# mv /usr/lib64/libssl.so.10.old   /usr/lib64/libssl.so.\n```\n\n2.3、升级OpenSSH\n\nA、备份当前openssh\n```\n# mv /etc/ssh  /etc/ssh.old\n```\n\nB、卸载当前openssh\n```\n# rpm -qa | grep openssh\nopenssh-clients-5.3p1-111.el6.x86_64\nopenssh-server-5.3p1-111.el6.x86_64\nopenssh-5.3p1-111.el6.x86_64\nopenssh-askpass-5.3p1-111.el6.x86_64\n\n# rpm -e --nodeps openssh-5.3p1-111.el6.x86_64\n# rpm -e --nodeps openssh-server-5.3p1-111.el6.x86_64\n# rpm -e --nodeps openssh-clients-5.3p1-111.el6.x86_64\n# rpm -e --nodeps openssh-askpass-5.3p1-111.el6.x86_64\n# rpm -qa | grep openssh                # 查看是否卸载成功\n```\n\nC、openssh安装前环境配置\n```\n# install -v -m700 -d /var/lib/sshd\n# chown -v root:sys /var/lib/sshd\n# groupadd -g 50 sshd\n# useradd -c 'sshd PrivSep' -d /var/lib/sshd -g sshd -s /bin/false -u 50 sshd\n```\n\nD、解压openssh_7.4p1源码并编译安装\n```\n# tar -zxvf openssh-8.1p1.tar.gz\n# cd openssh-8.1p1\n# ./configure --prefix=/usr --sysconfdir=/etc/ssh --with-md5-passwords --with-pam --with-zlib --with-openssl-includes=/usr --with-privsep-path=/var/lib/sshd\n# make\n# make install\n```\n\nE、openssh安装后环境配置\n```\n# 在openssh编译目录执行如下命令\n# install -v -m755 contrib/ssh-copy-id /usr/bin\n# install -v -m644 contrib/ssh-copy-id.1 /usr/share/man/man1\n# install -v -m755 -d /usr/share/doc/openssh-8.1p1\n# install -v -m644 INSTALL LICENCE OVERVIEW README* /usr/share/doc/openssh-8.1p1\n# ssh -V #验证是否升级成功\n```\n\nF、启用OpenSSH服务\n```\n# 在openssh编译目录执行如下目录\n# echo 'X11Forwarding yes' >> /etc/ssh/sshd_config\n# echo \"PermitRootLogin yes\" >> /etc/ssh/sshd_config #允许root用户通过ssh登录\n# cp -p contrib/redhat/sshd.init /etc/init.d/sshd\n# chmod +x /etc/init.d/sshd\n# chkconfig --add sshd\n# chkconfig sshd on\n# chkconfig --list sshd\n# /etc/init.d/sshd restart\n```\n> 注意：如果升级操作一直是在ssh远程会话中进行的，上述sshd服务重启命令可能导致会话断开并无法使用ssh再行登入（即ssh未能成功重启），此时需要通过telnet登入再执行sshd服务重启命令。\n\n \n\n#### 3、善后工作\n\n > 新开启远程终端以ssh [ip]登录系统，确认一切正常升级成功后，只需关闭telnet服务以保证系统安全性即可。\n```\n# mv /etc/securetty.old  /etc/securetty\n# chkconfig xinetd off\n# /etc/init.d/xinetd stop\n```","source":"_posts/升级Openssh详细步骤.md","raw":"title: 升级Openssh详细步骤\nauthor: Semaik.\ntags:\n  - Linux\ncategories:\n  - Linux\ndate: 2020-09-11 15:34:00\n---\n#### 1、准备工作\n\n1.1、下载相关软件包\n\n> OpenSSH需要依赖ZLIB和OpenSSL，因此需要从官网下载三者的源码包。需要注意的是：OpenSSH最新版8.1p1依赖的OpenSSL版本为1.0.2k，而不是其最新版1.1.0e（使用此版会升级失败）,ZLIB可以使用最新 版1.2.11。 \n\n三者源码下载地址：\n\n     http://www.zlib.net/\n     http://www.openssl.org/\n     http://www.openssh.org/\n\n1.2、查看系统当前软件版本\n\n    # rpm -q zlib\n    # openssl version\n    # ssh -V\n\n1.3、配置在线yum源\n```\n# cd /etc/yum.repos.d\n# rm -rf *             #删除当前所有yum源文件\n\n# wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo   #连接阿里云在线源\n```\n\n1.4、安装telnet服务并启用\n\n   > 因升级OpenSSH过程中需要卸载现有OpenSSH, 因此为了保持服务器的远程连接可用，需要启用telnet服务作为替代，如升级出现问题，也可通过telnet登录服务器进行回退。\n\n   A、安装telnet服务\n```\n   # yum -y install telnet-server*\n```\n   B、启用telnet\n\n   先关闭防火墙，否则telnet可能无法连接\n```\n# service iptables stop\n# chkconfig iptables off\n# vi /etc/xinetd.d/telnet\n将其中disable字段的yes改为no以启用telnet服务\n# mv /etc/securetty /etc/securetty.old          #允许root用户通过telnet登录\n# /etc/init.d/xinetd start       #启动telnet服务\n# chkconfig xinetd on              #使telnet服务开机启动，避免升级过程中服务器意外重启后无法远程登录系统\n# telnet [ip]                 #新开启一个远程终端以telnet登录验证是否成功启用\n```\n1.5、安装编译所需工具包\n```\n# yum -y install gcc pam-devel zlib-devel\n```\n\n#### 2、正式升级\n\n2.1、升级ZLIB\n\nA、解压zlib_1.2.11源码并编译\n```\n# tar -zxvf zlib-1.2.11.tar.gz\n# cd zlib-1.2.11\n# ./configure --prefix=/usr\n# make\n```\nB、卸载当前zlib\n\n> 注意：此步骤必须在步骤A执行完毕后再执行，否则先卸载zlib后，/lib64/目录下的zlib相关库文件会被删除，步骤A编译zlib会失败。\n```\n# rpm -e --nodeps zlib \n```\n\nC、安装之前编译好的zlib \n```\n# make install \n```\n在zlib编译目录执行如下命令\n\nD、共享库注册\n\n> zlib安装完成后，会在/usr/lib目录中生产zlib相关库文件，需要将这些共享库文件注册到系统中。\n```\n# echo '/usr/lib' >> /etc/ld.so.conf\n# ldconfig #更新共享库cache\n```\n\n2.2、升级OpenSSL\n\nA、备份当前openssl\n```\n# find / -name openssl\n  /usr/lib64/openssl\n  /usr/bin/openssl\n  /etc/pki/ca-trust/extracted/openssl\n\n# mv /usr/lib64/openssl /usr/lib64/openssl.old\n# mv /usr/bin/openssl /usr/bin/openssl.old\n# mv /etc/pki/ca-trust/extracted/openssl /etc/pki/ca-trust/extracted/openssl.old\n\n如下两个库文件必须先备份，因系统内部分工具（如yum、wget等）依赖此库，而新版OpenSSL不包含这两个库\n# cp /usr/lib64/libcrypto.so.10 /usr/lib64/libcrypto.so.10.old\n# cp /usr/lib64/libssl.so.10 /usr/lib64/libssl.so.10.old\n\n```\nB、卸载当前openssl\n```\n# rpm -qa | grep openssl\n   openssl-1.0.1e-42.el6.x86_64\n\n# rpm -e --nodeps openssl-1.0.1e-42.el6.x86_64\n# rpm -qa | grep openssl\n```\n\nC、解压openssl_1.0.2k源码并编译安装\n```\n# tar -zxvf openssl-1.0.2k.tar.gz\n# cd openssl-1.0.2k\n# ./config --prefix=/usr --openssldir=/etc/ssl --shared zlib                                #必须加上--shared，否则编译时会找不到新安装的openssl的库而报错\n# make\n# make test                             #必须执行这一步结果为pass才能继续，否则即使安装完成，ssh也无法使用\n# make install\n# openssl version -a                           #查看是否升级成功\n```\n\nD、恢复共享库\n\n> 由于OpenSSL_1.0.2k不提供libcrypto.so.10和libssl.so.10这两个库，而yum、wget等工具又依赖此库，因此需要将先前备份的这两个库进行恢复，其他的可视情况考虑是否恢复。\n```\n# mv /usr/lib64/libcrypto.so.10.old  /usr/lib64/libcrypto.so.10\n# mv /usr/lib64/libssl.so.10.old   /usr/lib64/libssl.so.\n```\n\n2.3、升级OpenSSH\n\nA、备份当前openssh\n```\n# mv /etc/ssh  /etc/ssh.old\n```\n\nB、卸载当前openssh\n```\n# rpm -qa | grep openssh\nopenssh-clients-5.3p1-111.el6.x86_64\nopenssh-server-5.3p1-111.el6.x86_64\nopenssh-5.3p1-111.el6.x86_64\nopenssh-askpass-5.3p1-111.el6.x86_64\n\n# rpm -e --nodeps openssh-5.3p1-111.el6.x86_64\n# rpm -e --nodeps openssh-server-5.3p1-111.el6.x86_64\n# rpm -e --nodeps openssh-clients-5.3p1-111.el6.x86_64\n# rpm -e --nodeps openssh-askpass-5.3p1-111.el6.x86_64\n# rpm -qa | grep openssh                # 查看是否卸载成功\n```\n\nC、openssh安装前环境配置\n```\n# install -v -m700 -d /var/lib/sshd\n# chown -v root:sys /var/lib/sshd\n# groupadd -g 50 sshd\n# useradd -c 'sshd PrivSep' -d /var/lib/sshd -g sshd -s /bin/false -u 50 sshd\n```\n\nD、解压openssh_7.4p1源码并编译安装\n```\n# tar -zxvf openssh-8.1p1.tar.gz\n# cd openssh-8.1p1\n# ./configure --prefix=/usr --sysconfdir=/etc/ssh --with-md5-passwords --with-pam --with-zlib --with-openssl-includes=/usr --with-privsep-path=/var/lib/sshd\n# make\n# make install\n```\n\nE、openssh安装后环境配置\n```\n# 在openssh编译目录执行如下命令\n# install -v -m755 contrib/ssh-copy-id /usr/bin\n# install -v -m644 contrib/ssh-copy-id.1 /usr/share/man/man1\n# install -v -m755 -d /usr/share/doc/openssh-8.1p1\n# install -v -m644 INSTALL LICENCE OVERVIEW README* /usr/share/doc/openssh-8.1p1\n# ssh -V #验证是否升级成功\n```\n\nF、启用OpenSSH服务\n```\n# 在openssh编译目录执行如下目录\n# echo 'X11Forwarding yes' >> /etc/ssh/sshd_config\n# echo \"PermitRootLogin yes\" >> /etc/ssh/sshd_config #允许root用户通过ssh登录\n# cp -p contrib/redhat/sshd.init /etc/init.d/sshd\n# chmod +x /etc/init.d/sshd\n# chkconfig --add sshd\n# chkconfig sshd on\n# chkconfig --list sshd\n# /etc/init.d/sshd restart\n```\n> 注意：如果升级操作一直是在ssh远程会话中进行的，上述sshd服务重启命令可能导致会话断开并无法使用ssh再行登入（即ssh未能成功重启），此时需要通过telnet登入再执行sshd服务重启命令。\n\n \n\n#### 3、善后工作\n\n > 新开启远程终端以ssh [ip]登录系统，确认一切正常升级成功后，只需关闭telnet服务以保证系统安全性即可。\n```\n# mv /etc/securetty.old  /etc/securetty\n# chkconfig xinetd off\n# /etc/init.d/xinetd stop\n```","slug":"升级Openssh详细步骤","published":1,"updated":"2020-09-13T01:45:22.787Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737k0021m3pv113ua68a","content":"<h4 id=\"1、准备工作\"><a href=\"#1、准备工作\" class=\"headerlink\" title=\"1、准备工作\"></a>1、准备工作</h4><p>1.1、下载相关软件包</p>\n<blockquote>\n<p>OpenSSH需要依赖ZLIB和OpenSSL，因此需要从官网下载三者的源码包。需要注意的是：OpenSSH最新版8.1p1依赖的OpenSSL版本为1.0.2k，而不是其最新版1.1.0e（使用此版会升级失败）,ZLIB可以使用最新 版1.2.11。 </p>\n</blockquote>\n<p>三者源码下载地址：</p>\n<pre><code> http://www.zlib.net/\n http://www.openssl.org/\n http://www.openssh.org/</code></pre>\n<p>1.2、查看系统当前软件版本</p>\n<pre><code># rpm -q zlib\n# openssl version\n# ssh -V</code></pre>\n<p>1.3、配置在线yum源</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cd <span class=\"regexp\">/etc/yum</span>.repos.d</span><br><span class=\"line\"># rm -rf *             #删除当前所有yum源文件</span><br><span class=\"line\"></span><br><span class=\"line\"># wget -O <span class=\"regexp\">/etc/yum</span>.repos.d<span class=\"regexp\">/CentOS-Base.repo http:/</span><span class=\"regexp\">/mirrors.aliyun.com/</span>repo/Centos-<span class=\"number\">6</span>.repo   #连接阿里云在线源</span><br></pre></td></tr></table></figure>\n\n<p>1.4、安装telnet服务并启用</p>\n<blockquote>\n<p>因升级OpenSSH过程中需要卸载现有OpenSSH, 因此为了保持服务器的远程连接可用，需要启用telnet服务作为替代，如升级出现问题，也可通过telnet登录服务器进行回退。</p>\n</blockquote>\n<p>   A、安装telnet服务</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># yum -y install telnet-server*</span></span><br></pre></td></tr></table></figure>\n<p>   B、启用telnet</p>\n<p>   先关闭防火墙，否则telnet可能无法连接</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># service iptables stop</span></span><br><span class=\"line\"><span class=\"meta\"># chkconfig iptables off</span></span><br><span class=\"line\"><span class=\"meta\"># vi /etc/xinetd.d/telnet</span></span><br><span class=\"line\">将其中disable字段的yes改为no以启用telnet服务</span><br><span class=\"line\"><span class=\"meta\"># mv /etc/securetty /etc/securetty.old          #允许root用户通过telnet登录</span></span><br><span class=\"line\"><span class=\"meta\"># /etc/init.d/xinetd start       #启动telnet服务</span></span><br><span class=\"line\"><span class=\"meta\"># chkconfig xinetd on              #使telnet服务开机启动，避免升级过程中服务器意外重启后无法远程登录系统</span></span><br><span class=\"line\"><span class=\"meta\"># telnet [ip]                 #新开启一个远程终端以telnet登录验证是否成功启用</span></span><br></pre></td></tr></table></figure>\n<p>1.5、安装编译所需工具包</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># yum -y install gcc pam-devel zlib-devel</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2、正式升级\"><a href=\"#2、正式升级\" class=\"headerlink\" title=\"2、正式升级\"></a>2、正式升级</h4><p>2.1、升级ZLIB</p>\n<p>A、解压zlib_1.2.11源码并编译</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># tar -zxvf zlib-1.2.11.tar.gz</span></span><br><span class=\"line\"><span class=\"meta\"># cd zlib-1.2.11</span></span><br><span class=\"line\"><span class=\"meta\"># ./configure --prefix=/usr</span></span><br><span class=\"line\"><span class=\"meta\"># make</span></span><br></pre></td></tr></table></figure>\n<p>B、卸载当前zlib</p>\n<blockquote>\n<p>注意：此步骤必须在步骤A执行完毕后再执行，否则先卸载zlib后，/lib64/目录下的zlib相关库文件会被删除，步骤A编译zlib会失败。</p>\n</blockquote>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># rpm -e --nodeps zlib </span></span><br></pre></td></tr></table></figure>\n\n<p>C、安装之前编译好的zlib </p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># make install </span></span><br></pre></td></tr></table></figure>\n<p>在zlib编译目录执行如下命令</p>\n<p>D、共享库注册</p>\n<blockquote>\n<p>zlib安装完成后，会在/usr/lib目录中生产zlib相关库文件，需要将这些共享库文件注册到系统中。</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;/usr/lib&#x27;</span> &gt;&gt; /etc/ld.so.conf</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ldconfig <span class=\"comment\">#更新共享库cache</span></span></span><br></pre></td></tr></table></figure>\n\n<p>2.2、升级OpenSSL</p>\n<p>A、备份当前openssl</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># <span class=\"keyword\">find</span> / -name openssl</span><br><span class=\"line\">  <span class=\"regexp\">/usr/</span>lib64/openssl</span><br><span class=\"line\">  <span class=\"regexp\">/usr/</span>bin/openssl</span><br><span class=\"line\">  <span class=\"regexp\">/etc/</span>pki<span class=\"regexp\">/ca-trust/</span>extracted/openssl</span><br><span class=\"line\"></span><br><span class=\"line\"># mv <span class=\"regexp\">/usr/</span>lib64<span class=\"regexp\">/openssl /u</span>sr<span class=\"regexp\">/lib64/</span>openssl.old</span><br><span class=\"line\"># mv <span class=\"regexp\">/usr/</span>bin<span class=\"regexp\">/openssl /u</span>sr<span class=\"regexp\">/bin/</span>openssl.old</span><br><span class=\"line\"># mv <span class=\"regexp\">/etc/</span>pki<span class=\"regexp\">/ca-trust/</span>extracted<span class=\"regexp\">/openssl /</span>etc<span class=\"regexp\">/pki/</span>ca-trust<span class=\"regexp\">/extracted/</span>openssl.old</span><br><span class=\"line\"></span><br><span class=\"line\">如下两个库文件必须先备份，因系统内部分工具（如yum、wget等）依赖此库，而新版OpenSSL不包含这两个库</span><br><span class=\"line\"># cp <span class=\"regexp\">/usr/</span>lib64<span class=\"regexp\">/libcrypto.so.10 /u</span>sr<span class=\"regexp\">/lib64/</span>libcrypto.so.<span class=\"number\">10</span>.old</span><br><span class=\"line\"># cp <span class=\"regexp\">/usr/</span>lib64<span class=\"regexp\">/libssl.so.10 /u</span>sr<span class=\"regexp\">/lib64/</span>libssl.so.<span class=\"number\">10</span>.old</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>B、卸载当前openssl</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rpm -qa | grep openssl</span></span><br><span class=\"line\">   <span class=\"attribute\">openssl</span>-<span class=\"number\">1</span>.<span class=\"number\">0</span>.<span class=\"number\">1</span>e-<span class=\"number\">42</span>.el<span class=\"number\">6</span>.x<span class=\"number\">86</span>_<span class=\"number\">64</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># rpm -e --nodeps openssl-1.0.1e-42.el6.x86_64</span></span><br><span class=\"line\"><span class=\"comment\"># rpm -qa | grep openssl</span></span><br></pre></td></tr></table></figure>\n\n<p>C、解压openssl_1.0.2k源码并编译安装</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># tar -zxvf openssl-1.0.2k.tar.gz</span></span><br><span class=\"line\"><span class=\"meta\"># cd openssl-1.0.2k</span></span><br><span class=\"line\"><span class=\"meta\"># ./config --prefix=/usr --openssldir=/etc/ssl --shared zlib                                #必须加上--shared，否则编译时会找不到新安装的openssl的库而报错</span></span><br><span class=\"line\"><span class=\"meta\"># make</span></span><br><span class=\"line\"><span class=\"meta\"># make test                             #必须执行这一步结果为pass才能继续，否则即使安装完成，ssh也无法使用</span></span><br><span class=\"line\"><span class=\"meta\"># make install</span></span><br><span class=\"line\"><span class=\"meta\"># openssl version -a                           #查看是否升级成功</span></span><br></pre></td></tr></table></figure>\n\n<p>D、恢复共享库</p>\n<blockquote>\n<p>由于OpenSSL_1.0.2k不提供libcrypto.so.10和libssl.so.10这两个库，而yum、wget等工具又依赖此库，因此需要将先前备份的这两个库进行恢复，其他的可视情况考虑是否恢复。</p>\n</blockquote>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mv <span class=\"regexp\">/usr/</span>lib64<span class=\"regexp\">/libcrypto.so.10.old  /u</span>sr<span class=\"regexp\">/lib64/</span>libcrypto.so.<span class=\"number\">10</span></span><br><span class=\"line\"># mv <span class=\"regexp\">/usr/</span>lib64<span class=\"regexp\">/libssl.so.10.old   /u</span>sr<span class=\"regexp\">/lib64/</span>libssl.so.</span><br></pre></td></tr></table></figure>\n\n<p>2.3、升级OpenSSH</p>\n<p>A、备份当前openssh</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mv <span class=\"regexp\">/etc/</span>ssh  <span class=\"regexp\">/etc/</span>ssh.old</span><br></pre></td></tr></table></figure>\n\n<p>B、卸载当前openssh</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rpm -qa | grep openssh</span></span><br><span class=\"line\"><span class=\"attribute\">openssh</span>-clients-<span class=\"number\">5</span>.<span class=\"number\">3</span>p<span class=\"number\">1</span>-<span class=\"number\">111</span>.el<span class=\"number\">6</span>.x<span class=\"number\">86</span>_<span class=\"number\">64</span></span><br><span class=\"line\"><span class=\"attribute\">openssh</span>-server-<span class=\"number\">5</span>.<span class=\"number\">3</span>p<span class=\"number\">1</span>-<span class=\"number\">111</span>.el<span class=\"number\">6</span>.x<span class=\"number\">86</span>_<span class=\"number\">64</span></span><br><span class=\"line\"><span class=\"attribute\">openssh</span>-<span class=\"number\">5</span>.<span class=\"number\">3</span>p<span class=\"number\">1</span>-<span class=\"number\">111</span>.el<span class=\"number\">6</span>.x<span class=\"number\">86</span>_<span class=\"number\">64</span></span><br><span class=\"line\"><span class=\"attribute\">openssh</span>-askpass-<span class=\"number\">5</span>.<span class=\"number\">3</span>p<span class=\"number\">1</span>-<span class=\"number\">111</span>.el<span class=\"number\">6</span>.x<span class=\"number\">86</span>_<span class=\"number\">64</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># rpm -e --nodeps openssh-5.3p1-111.el6.x86_64</span></span><br><span class=\"line\"><span class=\"comment\"># rpm -e --nodeps openssh-server-5.3p1-111.el6.x86_64</span></span><br><span class=\"line\"><span class=\"comment\"># rpm -e --nodeps openssh-clients-5.3p1-111.el6.x86_64</span></span><br><span class=\"line\"><span class=\"comment\"># rpm -e --nodeps openssh-askpass-5.3p1-111.el6.x86_64</span></span><br><span class=\"line\"><span class=\"comment\"># rpm -qa | grep openssh                # 查看是否卸载成功</span></span><br></pre></td></tr></table></figure>\n\n<p>C、openssh安装前环境配置</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># install -v -m700 -d <span class=\"regexp\">/var/</span>lib/sshd</span><br><span class=\"line\"># chown -v root:sys <span class=\"regexp\">/var/</span>lib/sshd</span><br><span class=\"line\"># groupadd -g <span class=\"number\">50</span> sshd</span><br><span class=\"line\"># useradd -c <span class=\"string\">&#x27;sshd PrivSep&#x27;</span> -d <span class=\"regexp\">/var/</span>lib<span class=\"regexp\">/sshd -g sshd -s /</span>bin/<span class=\"keyword\">false</span> -u <span class=\"number\">50</span> sshd</span><br></pre></td></tr></table></figure>\n\n<p>D、解压openssh_7.4p1源码并编译安装</p>\n<figure class=\"highlight clean\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># tar -zxvf openssh<span class=\"number\">-8.1</span>p1.tar.gz</span><br><span class=\"line\"># cd openssh<span class=\"number\">-8.1</span>p1</span><br><span class=\"line\"># ./configure --prefix=/usr --sysconfdir=/etc/ssh --<span class=\"keyword\">with</span>-md5-passwords --<span class=\"keyword\">with</span>-pam --<span class=\"keyword\">with</span>-zlib --<span class=\"keyword\">with</span>-openssl-includes=/usr --<span class=\"keyword\">with</span>-privsep-path=/var/lib/sshd</span><br><span class=\"line\"># make</span><br><span class=\"line\"># make install</span><br></pre></td></tr></table></figure>\n\n<p>E、openssh安装后环境配置</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 在openssh编译目录执行如下命令</span><br><span class=\"line\"># install -v -m755 contrib<span class=\"regexp\">/ssh-copy-id /u</span>sr/bin</span><br><span class=\"line\"># install -v -m644 contrib<span class=\"regexp\">/ssh-copy-id.1 /u</span>sr<span class=\"regexp\">/share/m</span>an/man1</span><br><span class=\"line\"># install -v -m755 -d <span class=\"regexp\">/usr/</span>share<span class=\"regexp\">/doc/</span>openssh-<span class=\"number\">8.1</span>p1</span><br><span class=\"line\"># install -v -m644 INSTALL LICENCE OVERVIEW README* <span class=\"regexp\">/usr/</span>share<span class=\"regexp\">/doc/</span>openssh-<span class=\"number\">8.1</span>p1</span><br><span class=\"line\"># ssh -V #验证是否升级成功</span><br></pre></td></tr></table></figure>\n\n<p>F、启用OpenSSH服务</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># 在openssh编译目录执行如下目录</span></span><br><span class=\"line\"><span class=\"meta\"># echo &#x27;X11Forwarding yes&#x27; &gt;&gt; /etc/ssh/sshd_config</span></span><br><span class=\"line\"><span class=\"meta\"># echo &quot;PermitRootLogin yes&quot; &gt;&gt; /etc/ssh/sshd_config #允许root用户通过ssh登录</span></span><br><span class=\"line\"><span class=\"meta\"># cp -p contrib/redhat/sshd.init /etc/init.d/sshd</span></span><br><span class=\"line\"><span class=\"meta\"># chmod +x /etc/init.d/sshd</span></span><br><span class=\"line\"><span class=\"meta\"># chkconfig --add sshd</span></span><br><span class=\"line\"><span class=\"meta\"># chkconfig sshd on</span></span><br><span class=\"line\"><span class=\"meta\"># chkconfig --list sshd</span></span><br><span class=\"line\"><span class=\"meta\"># /etc/init.d/sshd restart</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>注意：如果升级操作一直是在ssh远程会话中进行的，上述sshd服务重启命令可能导致会话断开并无法使用ssh再行登入（即ssh未能成功重启），此时需要通过telnet登入再执行sshd服务重启命令。</p>\n</blockquote>\n<h4 id=\"3、善后工作\"><a href=\"#3、善后工作\" class=\"headerlink\" title=\"3、善后工作\"></a>3、善后工作</h4><blockquote>\n<p>新开启远程终端以ssh [ip]登录系统，确认一切正常升级成功后，只需关闭telnet服务以保证系统安全性即可。</p>\n</blockquote>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mv <span class=\"regexp\">/etc/</span>securetty.old  <span class=\"regexp\">/etc/</span>securetty</span><br><span class=\"line\"># chkconfig xinetd off</span><br><span class=\"line\"># <span class=\"regexp\">/etc/i</span>nit.d/xinetd stop</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h4 id=\"1、准备工作\"><a href=\"#1、准备工作\" class=\"headerlink\" title=\"1、准备工作\"></a>1、准备工作</h4><p>1.1、下载相关软件包</p>\n<blockquote>\n<p>OpenSSH需要依赖ZLIB和OpenSSL，因此需要从官网下载三者的源码包。需要注意的是：OpenSSH最新版8.1p1依赖的OpenSSL版本为1.0.2k，而不是其最新版1.1.0e（使用此版会升级失败）,ZLIB可以使用最新 版1.2.11。 </p>\n</blockquote>\n<p>三者源码下载地址：</p>\n<pre><code> http://www.zlib.net/\n http://www.openssl.org/\n http://www.openssh.org/</code></pre>\n<p>1.2、查看系统当前软件版本</p>\n<pre><code># rpm -q zlib\n# openssl version\n# ssh -V</code></pre>\n<p>1.3、配置在线yum源</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cd <span class=\"regexp\">/etc/yum</span>.repos.d</span><br><span class=\"line\"># rm -rf *             #删除当前所有yum源文件</span><br><span class=\"line\"></span><br><span class=\"line\"># wget -O <span class=\"regexp\">/etc/yum</span>.repos.d<span class=\"regexp\">/CentOS-Base.repo http:/</span><span class=\"regexp\">/mirrors.aliyun.com/</span>repo/Centos-<span class=\"number\">6</span>.repo   #连接阿里云在线源</span><br></pre></td></tr></table></figure>\n\n<p>1.4、安装telnet服务并启用</p>\n<blockquote>\n<p>因升级OpenSSH过程中需要卸载现有OpenSSH, 因此为了保持服务器的远程连接可用，需要启用telnet服务作为替代，如升级出现问题，也可通过telnet登录服务器进行回退。</p>\n</blockquote>\n<p>   A、安装telnet服务</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># yum -y install telnet-server*</span></span><br></pre></td></tr></table></figure>\n<p>   B、启用telnet</p>\n<p>   先关闭防火墙，否则telnet可能无法连接</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># service iptables stop</span></span><br><span class=\"line\"><span class=\"meta\"># chkconfig iptables off</span></span><br><span class=\"line\"><span class=\"meta\"># vi /etc/xinetd.d/telnet</span></span><br><span class=\"line\">将其中disable字段的yes改为no以启用telnet服务</span><br><span class=\"line\"><span class=\"meta\"># mv /etc/securetty /etc/securetty.old          #允许root用户通过telnet登录</span></span><br><span class=\"line\"><span class=\"meta\"># /etc/init.d/xinetd start       #启动telnet服务</span></span><br><span class=\"line\"><span class=\"meta\"># chkconfig xinetd on              #使telnet服务开机启动，避免升级过程中服务器意外重启后无法远程登录系统</span></span><br><span class=\"line\"><span class=\"meta\"># telnet [ip]                 #新开启一个远程终端以telnet登录验证是否成功启用</span></span><br></pre></td></tr></table></figure>\n<p>1.5、安装编译所需工具包</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># yum -y install gcc pam-devel zlib-devel</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2、正式升级\"><a href=\"#2、正式升级\" class=\"headerlink\" title=\"2、正式升级\"></a>2、正式升级</h4><p>2.1、升级ZLIB</p>\n<p>A、解压zlib_1.2.11源码并编译</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># tar -zxvf zlib-1.2.11.tar.gz</span></span><br><span class=\"line\"><span class=\"meta\"># cd zlib-1.2.11</span></span><br><span class=\"line\"><span class=\"meta\"># ./configure --prefix=/usr</span></span><br><span class=\"line\"><span class=\"meta\"># make</span></span><br></pre></td></tr></table></figure>\n<p>B、卸载当前zlib</p>\n<blockquote>\n<p>注意：此步骤必须在步骤A执行完毕后再执行，否则先卸载zlib后，/lib64/目录下的zlib相关库文件会被删除，步骤A编译zlib会失败。</p>\n</blockquote>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># rpm -e --nodeps zlib </span></span><br></pre></td></tr></table></figure>\n\n<p>C、安装之前编译好的zlib </p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># make install </span></span><br></pre></td></tr></table></figure>\n<p>在zlib编译目录执行如下命令</p>\n<p>D、共享库注册</p>\n<blockquote>\n<p>zlib安装完成后，会在/usr/lib目录中生产zlib相关库文件，需要将这些共享库文件注册到系统中。</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;/usr/lib&#x27;</span> &gt;&gt; /etc/ld.so.conf</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ldconfig <span class=\"comment\">#更新共享库cache</span></span></span><br></pre></td></tr></table></figure>\n\n<p>2.2、升级OpenSSL</p>\n<p>A、备份当前openssl</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># <span class=\"keyword\">find</span> / -name openssl</span><br><span class=\"line\">  <span class=\"regexp\">/usr/</span>lib64/openssl</span><br><span class=\"line\">  <span class=\"regexp\">/usr/</span>bin/openssl</span><br><span class=\"line\">  <span class=\"regexp\">/etc/</span>pki<span class=\"regexp\">/ca-trust/</span>extracted/openssl</span><br><span class=\"line\"></span><br><span class=\"line\"># mv <span class=\"regexp\">/usr/</span>lib64<span class=\"regexp\">/openssl /u</span>sr<span class=\"regexp\">/lib64/</span>openssl.old</span><br><span class=\"line\"># mv <span class=\"regexp\">/usr/</span>bin<span class=\"regexp\">/openssl /u</span>sr<span class=\"regexp\">/bin/</span>openssl.old</span><br><span class=\"line\"># mv <span class=\"regexp\">/etc/</span>pki<span class=\"regexp\">/ca-trust/</span>extracted<span class=\"regexp\">/openssl /</span>etc<span class=\"regexp\">/pki/</span>ca-trust<span class=\"regexp\">/extracted/</span>openssl.old</span><br><span class=\"line\"></span><br><span class=\"line\">如下两个库文件必须先备份，因系统内部分工具（如yum、wget等）依赖此库，而新版OpenSSL不包含这两个库</span><br><span class=\"line\"># cp <span class=\"regexp\">/usr/</span>lib64<span class=\"regexp\">/libcrypto.so.10 /u</span>sr<span class=\"regexp\">/lib64/</span>libcrypto.so.<span class=\"number\">10</span>.old</span><br><span class=\"line\"># cp <span class=\"regexp\">/usr/</span>lib64<span class=\"regexp\">/libssl.so.10 /u</span>sr<span class=\"regexp\">/lib64/</span>libssl.so.<span class=\"number\">10</span>.old</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>B、卸载当前openssl</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rpm -qa | grep openssl</span></span><br><span class=\"line\">   <span class=\"attribute\">openssl</span>-<span class=\"number\">1</span>.<span class=\"number\">0</span>.<span class=\"number\">1</span>e-<span class=\"number\">42</span>.el<span class=\"number\">6</span>.x<span class=\"number\">86</span>_<span class=\"number\">64</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># rpm -e --nodeps openssl-1.0.1e-42.el6.x86_64</span></span><br><span class=\"line\"><span class=\"comment\"># rpm -qa | grep openssl</span></span><br></pre></td></tr></table></figure>\n\n<p>C、解压openssl_1.0.2k源码并编译安装</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># tar -zxvf openssl-1.0.2k.tar.gz</span></span><br><span class=\"line\"><span class=\"meta\"># cd openssl-1.0.2k</span></span><br><span class=\"line\"><span class=\"meta\"># ./config --prefix=/usr --openssldir=/etc/ssl --shared zlib                                #必须加上--shared，否则编译时会找不到新安装的openssl的库而报错</span></span><br><span class=\"line\"><span class=\"meta\"># make</span></span><br><span class=\"line\"><span class=\"meta\"># make test                             #必须执行这一步结果为pass才能继续，否则即使安装完成，ssh也无法使用</span></span><br><span class=\"line\"><span class=\"meta\"># make install</span></span><br><span class=\"line\"><span class=\"meta\"># openssl version -a                           #查看是否升级成功</span></span><br></pre></td></tr></table></figure>\n\n<p>D、恢复共享库</p>\n<blockquote>\n<p>由于OpenSSL_1.0.2k不提供libcrypto.so.10和libssl.so.10这两个库，而yum、wget等工具又依赖此库，因此需要将先前备份的这两个库进行恢复，其他的可视情况考虑是否恢复。</p>\n</blockquote>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mv <span class=\"regexp\">/usr/</span>lib64<span class=\"regexp\">/libcrypto.so.10.old  /u</span>sr<span class=\"regexp\">/lib64/</span>libcrypto.so.<span class=\"number\">10</span></span><br><span class=\"line\"># mv <span class=\"regexp\">/usr/</span>lib64<span class=\"regexp\">/libssl.so.10.old   /u</span>sr<span class=\"regexp\">/lib64/</span>libssl.so.</span><br></pre></td></tr></table></figure>\n\n<p>2.3、升级OpenSSH</p>\n<p>A、备份当前openssh</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mv <span class=\"regexp\">/etc/</span>ssh  <span class=\"regexp\">/etc/</span>ssh.old</span><br></pre></td></tr></table></figure>\n\n<p>B、卸载当前openssh</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rpm -qa | grep openssh</span></span><br><span class=\"line\"><span class=\"attribute\">openssh</span>-clients-<span class=\"number\">5</span>.<span class=\"number\">3</span>p<span class=\"number\">1</span>-<span class=\"number\">111</span>.el<span class=\"number\">6</span>.x<span class=\"number\">86</span>_<span class=\"number\">64</span></span><br><span class=\"line\"><span class=\"attribute\">openssh</span>-server-<span class=\"number\">5</span>.<span class=\"number\">3</span>p<span class=\"number\">1</span>-<span class=\"number\">111</span>.el<span class=\"number\">6</span>.x<span class=\"number\">86</span>_<span class=\"number\">64</span></span><br><span class=\"line\"><span class=\"attribute\">openssh</span>-<span class=\"number\">5</span>.<span class=\"number\">3</span>p<span class=\"number\">1</span>-<span class=\"number\">111</span>.el<span class=\"number\">6</span>.x<span class=\"number\">86</span>_<span class=\"number\">64</span></span><br><span class=\"line\"><span class=\"attribute\">openssh</span>-askpass-<span class=\"number\">5</span>.<span class=\"number\">3</span>p<span class=\"number\">1</span>-<span class=\"number\">111</span>.el<span class=\"number\">6</span>.x<span class=\"number\">86</span>_<span class=\"number\">64</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># rpm -e --nodeps openssh-5.3p1-111.el6.x86_64</span></span><br><span class=\"line\"><span class=\"comment\"># rpm -e --nodeps openssh-server-5.3p1-111.el6.x86_64</span></span><br><span class=\"line\"><span class=\"comment\"># rpm -e --nodeps openssh-clients-5.3p1-111.el6.x86_64</span></span><br><span class=\"line\"><span class=\"comment\"># rpm -e --nodeps openssh-askpass-5.3p1-111.el6.x86_64</span></span><br><span class=\"line\"><span class=\"comment\"># rpm -qa | grep openssh                # 查看是否卸载成功</span></span><br></pre></td></tr></table></figure>\n\n<p>C、openssh安装前环境配置</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># install -v -m700 -d <span class=\"regexp\">/var/</span>lib/sshd</span><br><span class=\"line\"># chown -v root:sys <span class=\"regexp\">/var/</span>lib/sshd</span><br><span class=\"line\"># groupadd -g <span class=\"number\">50</span> sshd</span><br><span class=\"line\"># useradd -c <span class=\"string\">&#x27;sshd PrivSep&#x27;</span> -d <span class=\"regexp\">/var/</span>lib<span class=\"regexp\">/sshd -g sshd -s /</span>bin/<span class=\"keyword\">false</span> -u <span class=\"number\">50</span> sshd</span><br></pre></td></tr></table></figure>\n\n<p>D、解压openssh_7.4p1源码并编译安装</p>\n<figure class=\"highlight clean\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># tar -zxvf openssh<span class=\"number\">-8.1</span>p1.tar.gz</span><br><span class=\"line\"># cd openssh<span class=\"number\">-8.1</span>p1</span><br><span class=\"line\"># ./configure --prefix=/usr --sysconfdir=/etc/ssh --<span class=\"keyword\">with</span>-md5-passwords --<span class=\"keyword\">with</span>-pam --<span class=\"keyword\">with</span>-zlib --<span class=\"keyword\">with</span>-openssl-includes=/usr --<span class=\"keyword\">with</span>-privsep-path=/var/lib/sshd</span><br><span class=\"line\"># make</span><br><span class=\"line\"># make install</span><br></pre></td></tr></table></figure>\n\n<p>E、openssh安装后环境配置</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 在openssh编译目录执行如下命令</span><br><span class=\"line\"># install -v -m755 contrib<span class=\"regexp\">/ssh-copy-id /u</span>sr/bin</span><br><span class=\"line\"># install -v -m644 contrib<span class=\"regexp\">/ssh-copy-id.1 /u</span>sr<span class=\"regexp\">/share/m</span>an/man1</span><br><span class=\"line\"># install -v -m755 -d <span class=\"regexp\">/usr/</span>share<span class=\"regexp\">/doc/</span>openssh-<span class=\"number\">8.1</span>p1</span><br><span class=\"line\"># install -v -m644 INSTALL LICENCE OVERVIEW README* <span class=\"regexp\">/usr/</span>share<span class=\"regexp\">/doc/</span>openssh-<span class=\"number\">8.1</span>p1</span><br><span class=\"line\"># ssh -V #验证是否升级成功</span><br></pre></td></tr></table></figure>\n\n<p>F、启用OpenSSH服务</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># 在openssh编译目录执行如下目录</span></span><br><span class=\"line\"><span class=\"meta\"># echo &#x27;X11Forwarding yes&#x27; &gt;&gt; /etc/ssh/sshd_config</span></span><br><span class=\"line\"><span class=\"meta\"># echo &quot;PermitRootLogin yes&quot; &gt;&gt; /etc/ssh/sshd_config #允许root用户通过ssh登录</span></span><br><span class=\"line\"><span class=\"meta\"># cp -p contrib/redhat/sshd.init /etc/init.d/sshd</span></span><br><span class=\"line\"><span class=\"meta\"># chmod +x /etc/init.d/sshd</span></span><br><span class=\"line\"><span class=\"meta\"># chkconfig --add sshd</span></span><br><span class=\"line\"><span class=\"meta\"># chkconfig sshd on</span></span><br><span class=\"line\"><span class=\"meta\"># chkconfig --list sshd</span></span><br><span class=\"line\"><span class=\"meta\"># /etc/init.d/sshd restart</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>注意：如果升级操作一直是在ssh远程会话中进行的，上述sshd服务重启命令可能导致会话断开并无法使用ssh再行登入（即ssh未能成功重启），此时需要通过telnet登入再执行sshd服务重启命令。</p>\n</blockquote>\n<h4 id=\"3、善后工作\"><a href=\"#3、善后工作\" class=\"headerlink\" title=\"3、善后工作\"></a>3、善后工作</h4><blockquote>\n<p>新开启远程终端以ssh [ip]登录系统，确认一切正常升级成功后，只需关闭telnet服务以保证系统安全性即可。</p>\n</blockquote>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mv <span class=\"regexp\">/etc/</span>securetty.old  <span class=\"regexp\">/etc/</span>securetty</span><br><span class=\"line\"># chkconfig xinetd off</span><br><span class=\"line\"># <span class=\"regexp\">/etc/i</span>nit.d/xinetd stop</span><br></pre></td></tr></table></figure>"},{"title":"实现容器的底层技术","author":"Semaik.","date":"2020-09-27T07:04:00.000Z","_content":"\n\n![upload successful](/images/pasted-90.png)\n\n通讯的前提：\n一个网段=一个vlan=一个广播域\n\n##### 实现容器的底层技术：\n```java\ncgroup是实现资源的限制\nnamespace是实现资源的隔离（六项内容）：\n  mount：容器内目录可以任意mount互相是不影响的\n  uts：使容器拥有自己的主机名\n  ipc：使容器拥有自己的共享内存和信号量不和host主机混在一起\n  network：让每个容器拥有独立的ip、网卡、路由等资源\n  user：让容器能自己管理用户，host不能看到容器内的用户\n  pid：容器内的pid不同于host中对应进程的pid，容器中的pid=1的进程也不是host的init 进程。也就是说，容器拥有自己独立的一套pid\n   重要的问题：因为container的pid=1的进程部署init，导致container无法使用systemd 管理程序\n  解决方法：1、提权使1号进程是init/systemd； 2、通过启动命令启动程序，不通过systemd 1、提权：   管理程序\n      docker run -it --restart always -d --name web  --privileged [需要提权的容器] /sbin/init\n      2、通过启动命令来启动程序，不要通过systemd管理程序。每个systemd在启动程序 的时候都是用XXXX.sersvice文件内的Execstart文件\n```\n\n查询网桥信息：\n\nbrctl show\n\n![upload successful](/images/pasted-91.png)\ndocker的原生网络\n\n查看：docker network ls\n\n容器的原生网络\n```java\nnone：封闭意味着隔离，生成随机码，生成二维码等，对安全性要求高，并不需要联网用\nhost：容器和物理机使用完全相同的网络栈\njoined：容器使用另一个容器的网络栈 \n# docker run -it --rm --name test --network container:web busybox sh\nbridge：应用最广泛和默认的网络，必须要懂\n# 当创建一个容器并运行会在物理机和容器内上出现一对网卡，物理机网卡没有ip是用 来链接创建容器内的网卡，当容器内要访问外部网络的时候   比如ping百度  数据从 容器内的网卡转到容器外的veth pair，然后这个网段由\ndocker0去与外界练习通信\n```\n##### docker网络是怎么实现隔离的呢？\n\n采用iptables防火墙进行隔离\n\n##### 嵌套旧容器运行新容器\n运行一个基于http镜像的web容器\n\n![upload successful](/images/pasted-92.png)\n进入容器后查看IP（这里是查看不了的，因为httpd只是一个服务镜像，没有其他使用命令，属于纯净的服务镜像）\n\n![upload successful](/images/pasted-93.png)\n这时，我们应该怎样查看这个容器的IP地址呢？\n\n再次运行一个基于busybox镜像的web容器（busybox镜像所有基础命令可以使用）\n```java\ndocker run -it --rm --network container:web busybox\n```\n\n![upload successful](/images/pasted-94.png)\n\n参数：\n  >--rm：容器停止后自动删除\n  \n  >--network container:\n  \n  >用于连接某台容器，使得两台容器使用同一个网络，也就是使用同一个IP\n这时我们查看到的IP地址和web容器里的IP地址是相同的。\n\n![upload successful](/images/pasted-95.png)\n\n\n##### 我们应该怎么样去查看容器和宿主机之间的网络连接呢？\n首先查看桥接信息\n\n![upload successful](/images/pasted-96.png)\n\n进去容器内敲ip a（会有网卡信息标识）\n\n![upload successful](/images/pasted-97.png)\n\n退出容器在宿主机敲ip a（找到21对应20的标识）\n\n\n![upload successful](/images/pasted-98.png)\n\n##### 实现一个容器连接多个网卡的命令\ndocker network connect 网卡名称 连接到哪个容器的名称\n\n例：`docker network connect my_net nginx`\n\n作用：可以实现不同网络间通信\n\n\n\n\n","source":"_posts/实现容器的底层技术.md","raw":"title: 实现容器的底层技术\nauthor: Semaik.\ntags:\n  - Docker\ncategories:\n  - Docker\ndate: 2020-09-27 15:04:00\n---\n\n\n![upload successful](/images/pasted-90.png)\n\n通讯的前提：\n一个网段=一个vlan=一个广播域\n\n##### 实现容器的底层技术：\n```java\ncgroup是实现资源的限制\nnamespace是实现资源的隔离（六项内容）：\n  mount：容器内目录可以任意mount互相是不影响的\n  uts：使容器拥有自己的主机名\n  ipc：使容器拥有自己的共享内存和信号量不和host主机混在一起\n  network：让每个容器拥有独立的ip、网卡、路由等资源\n  user：让容器能自己管理用户，host不能看到容器内的用户\n  pid：容器内的pid不同于host中对应进程的pid，容器中的pid=1的进程也不是host的init 进程。也就是说，容器拥有自己独立的一套pid\n   重要的问题：因为container的pid=1的进程部署init，导致container无法使用systemd 管理程序\n  解决方法：1、提权使1号进程是init/systemd； 2、通过启动命令启动程序，不通过systemd 1、提权：   管理程序\n      docker run -it --restart always -d --name web  --privileged [需要提权的容器] /sbin/init\n      2、通过启动命令来启动程序，不要通过systemd管理程序。每个systemd在启动程序 的时候都是用XXXX.sersvice文件内的Execstart文件\n```\n\n查询网桥信息：\n\nbrctl show\n\n![upload successful](/images/pasted-91.png)\ndocker的原生网络\n\n查看：docker network ls\n\n容器的原生网络\n```java\nnone：封闭意味着隔离，生成随机码，生成二维码等，对安全性要求高，并不需要联网用\nhost：容器和物理机使用完全相同的网络栈\njoined：容器使用另一个容器的网络栈 \n# docker run -it --rm --name test --network container:web busybox sh\nbridge：应用最广泛和默认的网络，必须要懂\n# 当创建一个容器并运行会在物理机和容器内上出现一对网卡，物理机网卡没有ip是用 来链接创建容器内的网卡，当容器内要访问外部网络的时候   比如ping百度  数据从 容器内的网卡转到容器外的veth pair，然后这个网段由\ndocker0去与外界练习通信\n```\n##### docker网络是怎么实现隔离的呢？\n\n采用iptables防火墙进行隔离\n\n##### 嵌套旧容器运行新容器\n运行一个基于http镜像的web容器\n\n![upload successful](/images/pasted-92.png)\n进入容器后查看IP（这里是查看不了的，因为httpd只是一个服务镜像，没有其他使用命令，属于纯净的服务镜像）\n\n![upload successful](/images/pasted-93.png)\n这时，我们应该怎样查看这个容器的IP地址呢？\n\n再次运行一个基于busybox镜像的web容器（busybox镜像所有基础命令可以使用）\n```java\ndocker run -it --rm --network container:web busybox\n```\n\n![upload successful](/images/pasted-94.png)\n\n参数：\n  >--rm：容器停止后自动删除\n  \n  >--network container:\n  \n  >用于连接某台容器，使得两台容器使用同一个网络，也就是使用同一个IP\n这时我们查看到的IP地址和web容器里的IP地址是相同的。\n\n![upload successful](/images/pasted-95.png)\n\n\n##### 我们应该怎么样去查看容器和宿主机之间的网络连接呢？\n首先查看桥接信息\n\n![upload successful](/images/pasted-96.png)\n\n进去容器内敲ip a（会有网卡信息标识）\n\n![upload successful](/images/pasted-97.png)\n\n退出容器在宿主机敲ip a（找到21对应20的标识）\n\n\n![upload successful](/images/pasted-98.png)\n\n##### 实现一个容器连接多个网卡的命令\ndocker network connect 网卡名称 连接到哪个容器的名称\n\n例：`docker network connect my_net nginx`\n\n作用：可以实现不同网络间通信\n\n\n\n\n","slug":"实现容器的底层技术","published":1,"updated":"2020-09-27T07:12:50.780Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737l0025m3pv9th4c0rv","content":"<p><img src=\"/images/pasted-90.png\" alt=\"upload successful\"></p>\n<p>通讯的前提：<br>一个网段=一个vlan=一个广播域</p>\n<h5 id=\"实现容器的底层技术：\"><a href=\"#实现容器的底层技术：\" class=\"headerlink\" title=\"实现容器的底层技术：\"></a>实现容器的底层技术：</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cgroup是实现资源的限制</span><br><span class=\"line\">namespace是实现资源的隔离（六项内容）：</span><br><span class=\"line\">  mount：容器内目录可以任意mount互相是不影响的</span><br><span class=\"line\">  uts：使容器拥有自己的主机名</span><br><span class=\"line\">  ipc：使容器拥有自己的共享内存和信号量不和host主机混在一起</span><br><span class=\"line\">  network：让每个容器拥有独立的ip、网卡、路由等资源</span><br><span class=\"line\">  user：让容器能自己管理用户，host不能看到容器内的用户</span><br><span class=\"line\">  pid：容器内的pid不同于host中对应进程的pid，容器中的pid=<span class=\"number\">1</span>的进程也不是host的init 进程。也就是说，容器拥有自己独立的一套pid</span><br><span class=\"line\">   重要的问题：因为container的pid=<span class=\"number\">1</span>的进程部署init，导致container无法使用systemd 管理程序</span><br><span class=\"line\">  解决方法：<span class=\"number\">1</span>、提权使<span class=\"number\">1</span>号进程是init/systemd； <span class=\"number\">2</span>、通过启动命令启动程序，不通过systemd <span class=\"number\">1</span>、提权：   管理程序</span><br><span class=\"line\">      docker run -it --restart always -d --name web  --privileged [需要提权的容器] /sbin/init</span><br><span class=\"line\">      <span class=\"number\">2</span>、通过启动命令来启动程序，不要通过systemd管理程序。每个systemd在启动程序 的时候都是用XXXX.sersvice文件内的Execstart文件</span><br></pre></td></tr></table></figure>\n\n<p>查询网桥信息：</p>\n<p>brctl show</p>\n<p><img src=\"/images/pasted-91.png\" alt=\"upload successful\"><br>docker的原生网络</p>\n<p>查看：docker network ls</p>\n<p>容器的原生网络</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">none：封闭意味着隔离，生成随机码，生成二维码等，对安全性要求高，并不需要联网用</span><br><span class=\"line\">host：容器和物理机使用完全相同的网络栈</span><br><span class=\"line\">joined：容器使用另一个容器的网络栈 </span><br><span class=\"line\"># docker run -it --rm --name test --network container:web busybox sh</span><br><span class=\"line\">bridge：应用最广泛和默认的网络，必须要懂</span><br><span class=\"line\"># 当创建一个容器并运行会在物理机和容器内上出现一对网卡，物理机网卡没有ip是用 来链接创建容器内的网卡，当容器内要访问外部网络的时候   比如ping百度  数据从 容器内的网卡转到容器外的veth pair，然后这个网段由</span><br><span class=\"line\">docker0去与外界练习通信</span><br></pre></td></tr></table></figure>\n<h5 id=\"docker网络是怎么实现隔离的呢？\"><a href=\"#docker网络是怎么实现隔离的呢？\" class=\"headerlink\" title=\"docker网络是怎么实现隔离的呢？\"></a>docker网络是怎么实现隔离的呢？</h5><p>采用iptables防火墙进行隔离</p>\n<h5 id=\"嵌套旧容器运行新容器\"><a href=\"#嵌套旧容器运行新容器\" class=\"headerlink\" title=\"嵌套旧容器运行新容器\"></a>嵌套旧容器运行新容器</h5><p>运行一个基于http镜像的web容器</p>\n<p><img src=\"/images/pasted-92.png\" alt=\"upload successful\"><br>进入容器后查看IP（这里是查看不了的，因为httpd只是一个服务镜像，没有其他使用命令，属于纯净的服务镜像）</p>\n<p><img src=\"/images/pasted-93.png\" alt=\"upload successful\"><br>这时，我们应该怎样查看这个容器的IP地址呢？</p>\n<p>再次运行一个基于busybox镜像的web容器（busybox镜像所有基础命令可以使用）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it --rm --network container:web busybox</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-94.png\" alt=\"upload successful\"></p>\n<p>参数：</p>\n<blockquote>\n<p>–rm：容器停止后自动删除</p>\n</blockquote>\n<blockquote>\n<p>–network container:</p>\n</blockquote>\n<blockquote>\n<p>用于连接某台容器，使得两台容器使用同一个网络，也就是使用同一个IP<br>这时我们查看到的IP地址和web容器里的IP地址是相同的。</p>\n</blockquote>\n<p><img src=\"/images/pasted-95.png\" alt=\"upload successful\"></p>\n<h5 id=\"我们应该怎么样去查看容器和宿主机之间的网络连接呢？\"><a href=\"#我们应该怎么样去查看容器和宿主机之间的网络连接呢？\" class=\"headerlink\" title=\"我们应该怎么样去查看容器和宿主机之间的网络连接呢？\"></a>我们应该怎么样去查看容器和宿主机之间的网络连接呢？</h5><p>首先查看桥接信息</p>\n<p><img src=\"/images/pasted-96.png\" alt=\"upload successful\"></p>\n<p>进去容器内敲ip a（会有网卡信息标识）</p>\n<p><img src=\"/images/pasted-97.png\" alt=\"upload successful\"></p>\n<p>退出容器在宿主机敲ip a（找到21对应20的标识）</p>\n<p><img src=\"/images/pasted-98.png\" alt=\"upload successful\"></p>\n<h5 id=\"实现一个容器连接多个网卡的命令\"><a href=\"#实现一个容器连接多个网卡的命令\" class=\"headerlink\" title=\"实现一个容器连接多个网卡的命令\"></a>实现一个容器连接多个网卡的命令</h5><p>docker network connect 网卡名称 连接到哪个容器的名称</p>\n<p>例：<code>docker network connect my_net nginx</code></p>\n<p>作用：可以实现不同网络间通信</p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/images/pasted-90.png\" alt=\"upload successful\"></p>\n<p>通讯的前提：<br>一个网段=一个vlan=一个广播域</p>\n<h5 id=\"实现容器的底层技术：\"><a href=\"#实现容器的底层技术：\" class=\"headerlink\" title=\"实现容器的底层技术：\"></a>实现容器的底层技术：</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cgroup是实现资源的限制</span><br><span class=\"line\">namespace是实现资源的隔离（六项内容）：</span><br><span class=\"line\">  mount：容器内目录可以任意mount互相是不影响的</span><br><span class=\"line\">  uts：使容器拥有自己的主机名</span><br><span class=\"line\">  ipc：使容器拥有自己的共享内存和信号量不和host主机混在一起</span><br><span class=\"line\">  network：让每个容器拥有独立的ip、网卡、路由等资源</span><br><span class=\"line\">  user：让容器能自己管理用户，host不能看到容器内的用户</span><br><span class=\"line\">  pid：容器内的pid不同于host中对应进程的pid，容器中的pid=<span class=\"number\">1</span>的进程也不是host的init 进程。也就是说，容器拥有自己独立的一套pid</span><br><span class=\"line\">   重要的问题：因为container的pid=<span class=\"number\">1</span>的进程部署init，导致container无法使用systemd 管理程序</span><br><span class=\"line\">  解决方法：<span class=\"number\">1</span>、提权使<span class=\"number\">1</span>号进程是init/systemd； <span class=\"number\">2</span>、通过启动命令启动程序，不通过systemd <span class=\"number\">1</span>、提权：   管理程序</span><br><span class=\"line\">      docker run -it --restart always -d --name web  --privileged [需要提权的容器] /sbin/init</span><br><span class=\"line\">      <span class=\"number\">2</span>、通过启动命令来启动程序，不要通过systemd管理程序。每个systemd在启动程序 的时候都是用XXXX.sersvice文件内的Execstart文件</span><br></pre></td></tr></table></figure>\n\n<p>查询网桥信息：</p>\n<p>brctl show</p>\n<p><img src=\"/images/pasted-91.png\" alt=\"upload successful\"><br>docker的原生网络</p>\n<p>查看：docker network ls</p>\n<p>容器的原生网络</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">none：封闭意味着隔离，生成随机码，生成二维码等，对安全性要求高，并不需要联网用</span><br><span class=\"line\">host：容器和物理机使用完全相同的网络栈</span><br><span class=\"line\">joined：容器使用另一个容器的网络栈 </span><br><span class=\"line\"># docker run -it --rm --name test --network container:web busybox sh</span><br><span class=\"line\">bridge：应用最广泛和默认的网络，必须要懂</span><br><span class=\"line\"># 当创建一个容器并运行会在物理机和容器内上出现一对网卡，物理机网卡没有ip是用 来链接创建容器内的网卡，当容器内要访问外部网络的时候   比如ping百度  数据从 容器内的网卡转到容器外的veth pair，然后这个网段由</span><br><span class=\"line\">docker0去与外界练习通信</span><br></pre></td></tr></table></figure>\n<h5 id=\"docker网络是怎么实现隔离的呢？\"><a href=\"#docker网络是怎么实现隔离的呢？\" class=\"headerlink\" title=\"docker网络是怎么实现隔离的呢？\"></a>docker网络是怎么实现隔离的呢？</h5><p>采用iptables防火墙进行隔离</p>\n<h5 id=\"嵌套旧容器运行新容器\"><a href=\"#嵌套旧容器运行新容器\" class=\"headerlink\" title=\"嵌套旧容器运行新容器\"></a>嵌套旧容器运行新容器</h5><p>运行一个基于http镜像的web容器</p>\n<p><img src=\"/images/pasted-92.png\" alt=\"upload successful\"><br>进入容器后查看IP（这里是查看不了的，因为httpd只是一个服务镜像，没有其他使用命令，属于纯净的服务镜像）</p>\n<p><img src=\"/images/pasted-93.png\" alt=\"upload successful\"><br>这时，我们应该怎样查看这个容器的IP地址呢？</p>\n<p>再次运行一个基于busybox镜像的web容器（busybox镜像所有基础命令可以使用）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it --rm --network container:web busybox</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-94.png\" alt=\"upload successful\"></p>\n<p>参数：</p>\n<blockquote>\n<p>–rm：容器停止后自动删除</p>\n</blockquote>\n<blockquote>\n<p>–network container:</p>\n</blockquote>\n<blockquote>\n<p>用于连接某台容器，使得两台容器使用同一个网络，也就是使用同一个IP<br>这时我们查看到的IP地址和web容器里的IP地址是相同的。</p>\n</blockquote>\n<p><img src=\"/images/pasted-95.png\" alt=\"upload successful\"></p>\n<h5 id=\"我们应该怎么样去查看容器和宿主机之间的网络连接呢？\"><a href=\"#我们应该怎么样去查看容器和宿主机之间的网络连接呢？\" class=\"headerlink\" title=\"我们应该怎么样去查看容器和宿主机之间的网络连接呢？\"></a>我们应该怎么样去查看容器和宿主机之间的网络连接呢？</h5><p>首先查看桥接信息</p>\n<p><img src=\"/images/pasted-96.png\" alt=\"upload successful\"></p>\n<p>进去容器内敲ip a（会有网卡信息标识）</p>\n<p><img src=\"/images/pasted-97.png\" alt=\"upload successful\"></p>\n<p>退出容器在宿主机敲ip a（找到21对应20的标识）</p>\n<p><img src=\"/images/pasted-98.png\" alt=\"upload successful\"></p>\n<h5 id=\"实现一个容器连接多个网卡的命令\"><a href=\"#实现一个容器连接多个网卡的命令\" class=\"headerlink\" title=\"实现一个容器连接多个网卡的命令\"></a>实现一个容器连接多个网卡的命令</h5><p>docker network connect 网卡名称 连接到哪个容器的名称</p>\n<p>例：<code>docker network connect my_net nginx</code></p>\n<p>作用：可以实现不同网络间通信</p>\n"},{"title":"对容器进行cpu的使用控制","author":"Semaik.","date":"2020-09-27T06:50:00.000Z","_content":"##### 控制容器中cpu使用的优先级\n默认情况下所有的容器都平等的使用cpu，并没有限制，Docker可以通过内容进行限制\n\n**关键词**\n```java\n-c/--cpu-shares:控制cpu优先级\n--cpuset-cpus:指定使用哪块cpu\n```\n**实验环境**\n\n将计算机调整为单核cpu，内存4G\n\n**实验目的**\n\n启动多个容器，指定容器使用cpu的优先级\n\n**实验步骤**\n```java\n[root@localhost ~]# systemctl start docker\n```\n启动一个名为aa的容器，并指定cpu优先级为1024\n```java\n[root@localhost ~]# docker run -itd --name aa --cpu-shares 1024 centos /bin/bash\n196380b6bbb7a044e2aafec7059b37db573f9612f3705d93aa1d8975e94ffad7\n```\n在启动一个名为bb的容器，并指定cpu优先级为512\n```java\n[root@localhost ~]# docker run -itd --name bb --cpu-shares 512 centos /bin/bash\n03dad75a9447768480e758e044857d6306bd73b89bccb2725594ead830d38e28\n```\n我们可以在物理机的cgroup目录中看到限制容器使用cpu的优先级，需要用到以上启动容器时返回的容器id\n\n查看aa容器的CPU优先级\n```java\n[root@localhost ~]# cd /sys/fs/cgroup/cpu/docker/196...ad7\n 可以看到该目录中存放了，docker程序中，aa容器的所有cpu资源的控制项\n[root@localhost 196...ad7]# ls\ncgroup.clone_children  cpuacct.usage         cpu.rt_period_us   notify_on_release\ncgroup.event_control   cpuacct.usage_percpu  cpu.rt_runtime_us  tasks\ncgroup.procs           cpu.cfs_period_us     cpu.shares\ncpuacct.stat           cpu.cfs_quota_us      cpu.stat\n[root@localhost 196...ad7]# cat tasks\n3750  # 这个文件里面存放了这个容器在物理机运行的pid号\n[root@localhost 196...ad7]# ps aux | grep 3750\nroot   3750  0.0  0.0  11828  1656 pts/0  Ss+  08:29  0:00 /bin/bash\nroot   4369  0.0  0.0 112712   956 pts/2  R+   08:37  0:00 grep --color=auto 3750\n 查看该容器的cpu优先级\n\n[root@localhost 196...ad7]# cat cpu.shares\n1024\n```\n查看bb容器的cpu优先级\n```java\n同样是docker目录下的另一个容器\n[root@localhost 196...ad7]# cd ../03d...e28/\n[root@localhost 03d...e28]# cat cpu.shares\n512\n```\ndocker程序的cpu优先级\n```java\n[root@localhost 03d...e28]# cd ..\n[root@localhost docker]# cat cpu.shares \n1024  # docker在主机内的cpu优先级\n[root@localhost docker]# cat tasks\n```\n**注意目录结构**\n\n下载一个docker用来测试的镜像\n```java\n[root@localhost ~]# docker pull progrium/stress\n```\n使用测试镜像启动容器，用来测试查看cpu优先级\n\n`--cpu用来限制cpu工作线程的数量`\n```java\n[root@localhost ~]# docker run -itd --name cc -c 512 progrium/stress --cpu 1\n6cff87f45ac88f0a27a250f099dc46d4a2dcdc191f2599a73b3e649a5ed91e80\n[root@localhost ~]# docker run -itd --name dd -c 1024 progrium/stress --cpu 1\n2a3f49cccb8addc69684bf96d3d95fc438768d98d942c60cd6a5df05b435068a\n```\n使用top查看两个测试线程（stress ）的cpu使用率，也就是谁优先使用多少\n```java\n[root@localhost ~]# top\n 关键信息如下，一个66.8%，一个32.9%，两个加起来几乎等于100\n   PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND\n  4842 root      20   0    7304    100      0 R 66.8  0.0   1:25.19 stress \n  4789 root      20   0    7304     96      0 R 32.9  0.0   0:58.09 stress\n```\ncpu的优先级只有在多个容器使用时才生效，说明他俩会抢占cpu资源，如果只有一个容器，即使设置了cpu优先级，它也会把cpu资源尽可能多的去使用\n\n控制容器使用某块cpu\n分配第一个和第二个cpu给容器（--cpuset只适用于多核cpu时使用）\n\n第一个cpu从0起计算\n```java\ndocker run -it --name cpu --cpuset-cpus=\"0,1\" centos /bin/bash\n[root@8cb4e22abd77 /]# cat /sys/fs/cgroup/cpuset/cpuset.cpus\n0-1\n```\n","source":"_posts/对容器进行cpu的使用控制.md","raw":"title: 对容器进行cpu的使用控制\nauthor: Semaik.\ntags:\n  - Docker\ncategories:\n  - Docker\ndate: 2020-09-27 14:50:00\n---\n##### 控制容器中cpu使用的优先级\n默认情况下所有的容器都平等的使用cpu，并没有限制，Docker可以通过内容进行限制\n\n**关键词**\n```java\n-c/--cpu-shares:控制cpu优先级\n--cpuset-cpus:指定使用哪块cpu\n```\n**实验环境**\n\n将计算机调整为单核cpu，内存4G\n\n**实验目的**\n\n启动多个容器，指定容器使用cpu的优先级\n\n**实验步骤**\n```java\n[root@localhost ~]# systemctl start docker\n```\n启动一个名为aa的容器，并指定cpu优先级为1024\n```java\n[root@localhost ~]# docker run -itd --name aa --cpu-shares 1024 centos /bin/bash\n196380b6bbb7a044e2aafec7059b37db573f9612f3705d93aa1d8975e94ffad7\n```\n在启动一个名为bb的容器，并指定cpu优先级为512\n```java\n[root@localhost ~]# docker run -itd --name bb --cpu-shares 512 centos /bin/bash\n03dad75a9447768480e758e044857d6306bd73b89bccb2725594ead830d38e28\n```\n我们可以在物理机的cgroup目录中看到限制容器使用cpu的优先级，需要用到以上启动容器时返回的容器id\n\n查看aa容器的CPU优先级\n```java\n[root@localhost ~]# cd /sys/fs/cgroup/cpu/docker/196...ad7\n 可以看到该目录中存放了，docker程序中，aa容器的所有cpu资源的控制项\n[root@localhost 196...ad7]# ls\ncgroup.clone_children  cpuacct.usage         cpu.rt_period_us   notify_on_release\ncgroup.event_control   cpuacct.usage_percpu  cpu.rt_runtime_us  tasks\ncgroup.procs           cpu.cfs_period_us     cpu.shares\ncpuacct.stat           cpu.cfs_quota_us      cpu.stat\n[root@localhost 196...ad7]# cat tasks\n3750  # 这个文件里面存放了这个容器在物理机运行的pid号\n[root@localhost 196...ad7]# ps aux | grep 3750\nroot   3750  0.0  0.0  11828  1656 pts/0  Ss+  08:29  0:00 /bin/bash\nroot   4369  0.0  0.0 112712   956 pts/2  R+   08:37  0:00 grep --color=auto 3750\n 查看该容器的cpu优先级\n\n[root@localhost 196...ad7]# cat cpu.shares\n1024\n```\n查看bb容器的cpu优先级\n```java\n同样是docker目录下的另一个容器\n[root@localhost 196...ad7]# cd ../03d...e28/\n[root@localhost 03d...e28]# cat cpu.shares\n512\n```\ndocker程序的cpu优先级\n```java\n[root@localhost 03d...e28]# cd ..\n[root@localhost docker]# cat cpu.shares \n1024  # docker在主机内的cpu优先级\n[root@localhost docker]# cat tasks\n```\n**注意目录结构**\n\n下载一个docker用来测试的镜像\n```java\n[root@localhost ~]# docker pull progrium/stress\n```\n使用测试镜像启动容器，用来测试查看cpu优先级\n\n`--cpu用来限制cpu工作线程的数量`\n```java\n[root@localhost ~]# docker run -itd --name cc -c 512 progrium/stress --cpu 1\n6cff87f45ac88f0a27a250f099dc46d4a2dcdc191f2599a73b3e649a5ed91e80\n[root@localhost ~]# docker run -itd --name dd -c 1024 progrium/stress --cpu 1\n2a3f49cccb8addc69684bf96d3d95fc438768d98d942c60cd6a5df05b435068a\n```\n使用top查看两个测试线程（stress ）的cpu使用率，也就是谁优先使用多少\n```java\n[root@localhost ~]# top\n 关键信息如下，一个66.8%，一个32.9%，两个加起来几乎等于100\n   PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND\n  4842 root      20   0    7304    100      0 R 66.8  0.0   1:25.19 stress \n  4789 root      20   0    7304     96      0 R 32.9  0.0   0:58.09 stress\n```\ncpu的优先级只有在多个容器使用时才生效，说明他俩会抢占cpu资源，如果只有一个容器，即使设置了cpu优先级，它也会把cpu资源尽可能多的去使用\n\n控制容器使用某块cpu\n分配第一个和第二个cpu给容器（--cpuset只适用于多核cpu时使用）\n\n第一个cpu从0起计算\n```java\ndocker run -it --name cpu --cpuset-cpus=\"0,1\" centos /bin/bash\n[root@8cb4e22abd77 /]# cat /sys/fs/cgroup/cpuset/cpuset.cpus\n0-1\n```\n","slug":"对容器进行cpu的使用控制","published":1,"updated":"2020-09-27T06:54:14.057Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737m0028m3pvfbltdibx","content":"<h5 id=\"控制容器中cpu使用的优先级\"><a href=\"#控制容器中cpu使用的优先级\" class=\"headerlink\" title=\"控制容器中cpu使用的优先级\"></a>控制容器中cpu使用的优先级</h5><p>默认情况下所有的容器都平等的使用cpu，并没有限制，Docker可以通过内容进行限制</p>\n<p><strong>关键词</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-c/--cpu-shares:控制cpu优先级</span><br><span class=\"line\">--cpuset-cpus:指定使用哪块cpu</span><br></pre></td></tr></table></figure>\n<p><strong>实验环境</strong></p>\n<p>将计算机调整为单核cpu，内存4G</p>\n<p><strong>实验目的</strong></p>\n<p>启动多个容器，指定容器使用cpu的优先级</p>\n<p><strong>实验步骤</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# systemctl start docker</span><br></pre></td></tr></table></figure>\n<p>启动一个名为aa的容器，并指定cpu优先级为1024</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -itd --name aa --cpu-shares 1024 centos /bin/bash</span><br><span class=\"line\"><span class=\"number\">196380</span>b6bbb7a044e2aafec7059b37db573f9612f3705d93aa1d8975e94ffad7</span><br></pre></td></tr></table></figure>\n<p>在启动一个名为bb的容器，并指定cpu优先级为512</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -itd --name bb --cpu-shares 512 centos /bin/bash</span><br><span class=\"line\"><span class=\"number\">03d</span>ad75a9447768480e758e044857d6306bd73b89bccb2725594ead830d38e28</span><br></pre></td></tr></table></figure>\n<p>我们可以在物理机的cgroup目录中看到限制容器使用cpu的优先级，需要用到以上启动容器时返回的容器id</p>\n<p>查看aa容器的CPU优先级</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# cd /sys/fs/cgroup/cpu/docker/196...ad7</span><br><span class=\"line\"> 可以看到该目录中存放了，docker程序中，aa容器的所有cpu资源的控制项</span><br><span class=\"line\">[root@localhost 196...ad7]# ls</span><br><span class=\"line\">cgroup.clone_children  cpuacct.usage         cpu.rt_period_us   notify_on_release</span><br><span class=\"line\">cgroup.event_control   cpuacct.usage_percpu  cpu.rt_runtime_us  tasks</span><br><span class=\"line\">cgroup.procs           cpu.cfs_period_us     cpu.shares</span><br><span class=\"line\">cpuacct.stat           cpu.cfs_quota_us      cpu.stat</span><br><span class=\"line\">[root@localhost 196...ad7]# cat tasks</span><br><span class=\"line\">3750  # 这个文件里面存放了这个容器在物理机运行的pid号</span><br><span class=\"line\">[root@localhost 196...ad7]# ps aux | grep 3750</span><br><span class=\"line\">root   <span class=\"number\">3750</span>  <span class=\"number\">0.0</span>  <span class=\"number\">0.0</span>  <span class=\"number\">11828</span>  <span class=\"number\">1656</span> pts/<span class=\"number\">0</span>  Ss+  <span class=\"number\">08</span>:<span class=\"number\">29</span>  <span class=\"number\">0</span>:<span class=\"number\">00</span> /bin/bash</span><br><span class=\"line\">root   <span class=\"number\">4369</span>  <span class=\"number\">0.0</span>  <span class=\"number\">0.0</span> <span class=\"number\">112712</span>   <span class=\"number\">956</span> pts/<span class=\"number\">2</span>  R+   <span class=\"number\">08</span>:<span class=\"number\">37</span>  <span class=\"number\">0</span>:<span class=\"number\">00</span> grep --color=auto <span class=\"number\">3750</span></span><br><span class=\"line\"> 查看该容器的cpu优先级</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost 196...ad7]# cat cpu.shares</span><br><span class=\"line\"><span class=\"number\">1024</span></span><br></pre></td></tr></table></figure>\n<p>查看bb容器的cpu优先级</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">同样是docker目录下的另一个容器</span><br><span class=\"line\">[root@localhost 196...ad7]# cd ../03d...e28/</span><br><span class=\"line\">[root@localhost 03d...e28]# cat cpu.shares</span><br><span class=\"line\"><span class=\"number\">512</span></span><br></pre></td></tr></table></figure>\n<p>docker程序的cpu优先级</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost 03d...e28]# cd ..</span><br><span class=\"line\">[root@localhost docker]# cat cpu.shares </span><br><span class=\"line\">1024  # docker在主机内的cpu优先级</span><br><span class=\"line\">[root@localhost docker]# cat tasks</span><br></pre></td></tr></table></figure>\n<p><strong>注意目录结构</strong></p>\n<p>下载一个docker用来测试的镜像</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker pull progrium/stress</span><br></pre></td></tr></table></figure>\n<p>使用测试镜像启动容器，用来测试查看cpu优先级</p>\n<p><code>--cpu用来限制cpu工作线程的数量</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -itd --name cc -c 512 progrium/stress --cpu 1</span><br><span class=\"line\"><span class=\"number\">6</span>cff87f45ac88f0a27a250f099dc46d4a2dcdc191f2599a73b3e649a5ed91e80</span><br><span class=\"line\">[root@localhost ~]# docker run -itd --name dd -c 1024 progrium/stress --cpu 1</span><br><span class=\"line\"><span class=\"number\">2</span>a3f49cccb8addc69684bf96d3d95fc438768d98d942c60cd6a5df05b435068a</span><br></pre></td></tr></table></figure>\n<p>使用top查看两个测试线程（stress ）的cpu使用率，也就是谁优先使用多少</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# top</span><br><span class=\"line\"> 关键信息如下，一个<span class=\"number\">66.8</span>%，一个<span class=\"number\">32.9</span>%，两个加起来几乎等于<span class=\"number\">100</span></span><br><span class=\"line\">   PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND</span><br><span class=\"line\">  <span class=\"number\">4842</span> root      <span class=\"number\">20</span>   <span class=\"number\">0</span>    <span class=\"number\">7304</span>    <span class=\"number\">100</span>      <span class=\"number\">0</span> R <span class=\"number\">66.8</span>  <span class=\"number\">0.0</span>   <span class=\"number\">1</span>:<span class=\"number\">25.19</span> stress </span><br><span class=\"line\">  <span class=\"number\">4789</span> root      <span class=\"number\">20</span>   <span class=\"number\">0</span>    <span class=\"number\">7304</span>     <span class=\"number\">96</span>      <span class=\"number\">0</span> R <span class=\"number\">32.9</span>  <span class=\"number\">0.0</span>   <span class=\"number\">0</span>:<span class=\"number\">58.09</span> stress</span><br></pre></td></tr></table></figure>\n<p>cpu的优先级只有在多个容器使用时才生效，说明他俩会抢占cpu资源，如果只有一个容器，即使设置了cpu优先级，它也会把cpu资源尽可能多的去使用</p>\n<p>控制容器使用某块cpu<br>分配第一个和第二个cpu给容器（–cpuset只适用于多核cpu时使用）</p>\n<p>第一个cpu从0起计算</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it --name cpu --cpuset-cpus=<span class=\"string\">&quot;0,1&quot;</span> centos /bin/bash</span><br><span class=\"line\">[root@8cb4e22abd77 /]# cat /sys/fs/cgroup/cpuset/cpuset.cpus</span><br><span class=\"line\"><span class=\"number\">0</span>-<span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h5 id=\"控制容器中cpu使用的优先级\"><a href=\"#控制容器中cpu使用的优先级\" class=\"headerlink\" title=\"控制容器中cpu使用的优先级\"></a>控制容器中cpu使用的优先级</h5><p>默认情况下所有的容器都平等的使用cpu，并没有限制，Docker可以通过内容进行限制</p>\n<p><strong>关键词</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-c/--cpu-shares:控制cpu优先级</span><br><span class=\"line\">--cpuset-cpus:指定使用哪块cpu</span><br></pre></td></tr></table></figure>\n<p><strong>实验环境</strong></p>\n<p>将计算机调整为单核cpu，内存4G</p>\n<p><strong>实验目的</strong></p>\n<p>启动多个容器，指定容器使用cpu的优先级</p>\n<p><strong>实验步骤</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# systemctl start docker</span><br></pre></td></tr></table></figure>\n<p>启动一个名为aa的容器，并指定cpu优先级为1024</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -itd --name aa --cpu-shares 1024 centos /bin/bash</span><br><span class=\"line\"><span class=\"number\">196380</span>b6bbb7a044e2aafec7059b37db573f9612f3705d93aa1d8975e94ffad7</span><br></pre></td></tr></table></figure>\n<p>在启动一个名为bb的容器，并指定cpu优先级为512</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -itd --name bb --cpu-shares 512 centos /bin/bash</span><br><span class=\"line\"><span class=\"number\">03d</span>ad75a9447768480e758e044857d6306bd73b89bccb2725594ead830d38e28</span><br></pre></td></tr></table></figure>\n<p>我们可以在物理机的cgroup目录中看到限制容器使用cpu的优先级，需要用到以上启动容器时返回的容器id</p>\n<p>查看aa容器的CPU优先级</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# cd /sys/fs/cgroup/cpu/docker/196...ad7</span><br><span class=\"line\"> 可以看到该目录中存放了，docker程序中，aa容器的所有cpu资源的控制项</span><br><span class=\"line\">[root@localhost 196...ad7]# ls</span><br><span class=\"line\">cgroup.clone_children  cpuacct.usage         cpu.rt_period_us   notify_on_release</span><br><span class=\"line\">cgroup.event_control   cpuacct.usage_percpu  cpu.rt_runtime_us  tasks</span><br><span class=\"line\">cgroup.procs           cpu.cfs_period_us     cpu.shares</span><br><span class=\"line\">cpuacct.stat           cpu.cfs_quota_us      cpu.stat</span><br><span class=\"line\">[root@localhost 196...ad7]# cat tasks</span><br><span class=\"line\">3750  # 这个文件里面存放了这个容器在物理机运行的pid号</span><br><span class=\"line\">[root@localhost 196...ad7]# ps aux | grep 3750</span><br><span class=\"line\">root   <span class=\"number\">3750</span>  <span class=\"number\">0.0</span>  <span class=\"number\">0.0</span>  <span class=\"number\">11828</span>  <span class=\"number\">1656</span> pts/<span class=\"number\">0</span>  Ss+  <span class=\"number\">08</span>:<span class=\"number\">29</span>  <span class=\"number\">0</span>:<span class=\"number\">00</span> /bin/bash</span><br><span class=\"line\">root   <span class=\"number\">4369</span>  <span class=\"number\">0.0</span>  <span class=\"number\">0.0</span> <span class=\"number\">112712</span>   <span class=\"number\">956</span> pts/<span class=\"number\">2</span>  R+   <span class=\"number\">08</span>:<span class=\"number\">37</span>  <span class=\"number\">0</span>:<span class=\"number\">00</span> grep --color=auto <span class=\"number\">3750</span></span><br><span class=\"line\"> 查看该容器的cpu优先级</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost 196...ad7]# cat cpu.shares</span><br><span class=\"line\"><span class=\"number\">1024</span></span><br></pre></td></tr></table></figure>\n<p>查看bb容器的cpu优先级</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">同样是docker目录下的另一个容器</span><br><span class=\"line\">[root@localhost 196...ad7]# cd ../03d...e28/</span><br><span class=\"line\">[root@localhost 03d...e28]# cat cpu.shares</span><br><span class=\"line\"><span class=\"number\">512</span></span><br></pre></td></tr></table></figure>\n<p>docker程序的cpu优先级</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost 03d...e28]# cd ..</span><br><span class=\"line\">[root@localhost docker]# cat cpu.shares </span><br><span class=\"line\">1024  # docker在主机内的cpu优先级</span><br><span class=\"line\">[root@localhost docker]# cat tasks</span><br></pre></td></tr></table></figure>\n<p><strong>注意目录结构</strong></p>\n<p>下载一个docker用来测试的镜像</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker pull progrium/stress</span><br></pre></td></tr></table></figure>\n<p>使用测试镜像启动容器，用来测试查看cpu优先级</p>\n<p><code>--cpu用来限制cpu工作线程的数量</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -itd --name cc -c 512 progrium/stress --cpu 1</span><br><span class=\"line\"><span class=\"number\">6</span>cff87f45ac88f0a27a250f099dc46d4a2dcdc191f2599a73b3e649a5ed91e80</span><br><span class=\"line\">[root@localhost ~]# docker run -itd --name dd -c 1024 progrium/stress --cpu 1</span><br><span class=\"line\"><span class=\"number\">2</span>a3f49cccb8addc69684bf96d3d95fc438768d98d942c60cd6a5df05b435068a</span><br></pre></td></tr></table></figure>\n<p>使用top查看两个测试线程（stress ）的cpu使用率，也就是谁优先使用多少</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# top</span><br><span class=\"line\"> 关键信息如下，一个<span class=\"number\">66.8</span>%，一个<span class=\"number\">32.9</span>%，两个加起来几乎等于<span class=\"number\">100</span></span><br><span class=\"line\">   PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND</span><br><span class=\"line\">  <span class=\"number\">4842</span> root      <span class=\"number\">20</span>   <span class=\"number\">0</span>    <span class=\"number\">7304</span>    <span class=\"number\">100</span>      <span class=\"number\">0</span> R <span class=\"number\">66.8</span>  <span class=\"number\">0.0</span>   <span class=\"number\">1</span>:<span class=\"number\">25.19</span> stress </span><br><span class=\"line\">  <span class=\"number\">4789</span> root      <span class=\"number\">20</span>   <span class=\"number\">0</span>    <span class=\"number\">7304</span>     <span class=\"number\">96</span>      <span class=\"number\">0</span> R <span class=\"number\">32.9</span>  <span class=\"number\">0.0</span>   <span class=\"number\">0</span>:<span class=\"number\">58.09</span> stress</span><br></pre></td></tr></table></figure>\n<p>cpu的优先级只有在多个容器使用时才生效，说明他俩会抢占cpu资源，如果只有一个容器，即使设置了cpu优先级，它也会把cpu资源尽可能多的去使用</p>\n<p>控制容器使用某块cpu<br>分配第一个和第二个cpu给容器（–cpuset只适用于多核cpu时使用）</p>\n<p>第一个cpu从0起计算</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it --name cpu --cpuset-cpus=<span class=\"string\">&quot;0,1&quot;</span> centos /bin/bash</span><br><span class=\"line\">[root@8cb4e22abd77 /]# cat /sys/fs/cgroup/cpuset/cpuset.cpus</span><br><span class=\"line\"><span class=\"number\">0</span>-<span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n"},{"title":"对容器进行内存容量控制","author":"Semaik.","date":"2020-09-27T06:47:00.000Z","_content":"##### 对容器内存的限制\n内存分为：物理内存和swap内存\n\n**关键词**\n```java\n--memory：限制内存的使用容量\n--memory-swap：限制内存+swap的大小\n```\n启动一个限制内存使用的容器testa，如果不指定--memory-swap的话，默认它的大小和内存一样大\n```java\n[root@localhost ~]# docker run -itd --name testa -m 200M --memory-swap 300M centos /bin/bash\naa90dc55398b2f927c1111bcfa3090502a3b42c3eb538895a1ddadbe556fdf9d\n```\n进入容器testa中查看内存和swap大小，在容器中看到的其实也还是物理机的内存大小\n```java\n[root@localhost ~]# docker exec -it testa /bin/bash\n[root@aa90dc55398b /]# free -m\n              total        used        free      shared  buff/cache   available\nMem:           3770        1051         992          33        1726        2431\nSwap:          2047           0        2047\n```\n第二种查看，最为准确，在宿主机的cgroup中查看，内存大小为200M\n```java\n[root@localhost ~]# cat /sys/fs/cgroup/memory/docker/aa9...f9d/memory.limit_in_bytes \n209715200\n```\n还可以通过测试也能够测出来\n\n内存+swap总量是300M，内存占200M，所以swap是100M，启动容器运行\n\n测试使用280M是否可以正常运行，一直在输出说明正常\n```java\n[root@localhost ~]# docker run -it -m 200M --memory-swap 300M progrium/stress --vm 1 --vm-bytes 280M\nstress: info: [1] dispatching hogs: 0 cpu, 0 io, 1 vm, 0 hdd\nstress: dbug: [1] using backoff sleep of 3000us\nstress: dbug: [1] --> hogvm worker 1 [6] forked\nstress: dbug: [6] allocating 293601280 bytes ...\nstress: dbug: [6] touching bytes in strides of 4096 bytes ...\nstress: dbug: [6] freed 293601280 bytes\nstress: dbug: [6] allocating 293601280 bytes ...\nstress: dbug: [6] touching bytes in strides of 4096 bytes ...\n...\n```\n测试使用380M是否可以正常运行，自动跳出，则不能运行，说明380M超出了内存范围\n```java\n[root@localhost ~]# docker run -it -m 200M --memory-swap 300M progrium/stress --vm 1 --vm-bytes \n380M\nstress: info: [1] dispatching hogs: 0 cpu, 0 io, 1 vm, 0 hdd\nstress: dbug: [1] using backoff sleep of 3000us\nstress: dbug: [1] --> hogvm worker 1 [6] forked\nstress: dbug: [6] allocating 398458880 bytes ...\nstress: dbug: [6] touching bytes in strides of 4096 bytes ...\nstress: FAIL: [1] (416) <-- worker 6 got signal 9\nstress: WARN: [1] (418) now reaping child worker processes\nstress: FAIL: [1] (422) kill error: No such process\nstress: FAIL: [1] (452) failed run completed in 1s\n```","source":"_posts/对容器进行内存容量控制.md","raw":"title: 对容器进行内存容量控制\nauthor: Semaik.\ntags:\n  - Docker\ncategories:\n  - Docker\ndate: 2020-09-27 14:47:00\n---\n##### 对容器内存的限制\n内存分为：物理内存和swap内存\n\n**关键词**\n```java\n--memory：限制内存的使用容量\n--memory-swap：限制内存+swap的大小\n```\n启动一个限制内存使用的容器testa，如果不指定--memory-swap的话，默认它的大小和内存一样大\n```java\n[root@localhost ~]# docker run -itd --name testa -m 200M --memory-swap 300M centos /bin/bash\naa90dc55398b2f927c1111bcfa3090502a3b42c3eb538895a1ddadbe556fdf9d\n```\n进入容器testa中查看内存和swap大小，在容器中看到的其实也还是物理机的内存大小\n```java\n[root@localhost ~]# docker exec -it testa /bin/bash\n[root@aa90dc55398b /]# free -m\n              total        used        free      shared  buff/cache   available\nMem:           3770        1051         992          33        1726        2431\nSwap:          2047           0        2047\n```\n第二种查看，最为准确，在宿主机的cgroup中查看，内存大小为200M\n```java\n[root@localhost ~]# cat /sys/fs/cgroup/memory/docker/aa9...f9d/memory.limit_in_bytes \n209715200\n```\n还可以通过测试也能够测出来\n\n内存+swap总量是300M，内存占200M，所以swap是100M，启动容器运行\n\n测试使用280M是否可以正常运行，一直在输出说明正常\n```java\n[root@localhost ~]# docker run -it -m 200M --memory-swap 300M progrium/stress --vm 1 --vm-bytes 280M\nstress: info: [1] dispatching hogs: 0 cpu, 0 io, 1 vm, 0 hdd\nstress: dbug: [1] using backoff sleep of 3000us\nstress: dbug: [1] --> hogvm worker 1 [6] forked\nstress: dbug: [6] allocating 293601280 bytes ...\nstress: dbug: [6] touching bytes in strides of 4096 bytes ...\nstress: dbug: [6] freed 293601280 bytes\nstress: dbug: [6] allocating 293601280 bytes ...\nstress: dbug: [6] touching bytes in strides of 4096 bytes ...\n...\n```\n测试使用380M是否可以正常运行，自动跳出，则不能运行，说明380M超出了内存范围\n```java\n[root@localhost ~]# docker run -it -m 200M --memory-swap 300M progrium/stress --vm 1 --vm-bytes \n380M\nstress: info: [1] dispatching hogs: 0 cpu, 0 io, 1 vm, 0 hdd\nstress: dbug: [1] using backoff sleep of 3000us\nstress: dbug: [1] --> hogvm worker 1 [6] forked\nstress: dbug: [6] allocating 398458880 bytes ...\nstress: dbug: [6] touching bytes in strides of 4096 bytes ...\nstress: FAIL: [1] (416) <-- worker 6 got signal 9\nstress: WARN: [1] (418) now reaping child worker processes\nstress: FAIL: [1] (422) kill error: No such process\nstress: FAIL: [1] (452) failed run completed in 1s\n```","slug":"对容器进行内存容量控制","published":1,"updated":"2020-09-27T06:49:49.677Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737o002dm3pvgj3o40fw","content":"<h5 id=\"对容器内存的限制\"><a href=\"#对容器内存的限制\" class=\"headerlink\" title=\"对容器内存的限制\"></a>对容器内存的限制</h5><p>内存分为：物理内存和swap内存</p>\n<p><strong>关键词</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">--memory：限制内存的使用容量</span><br><span class=\"line\">--memory-swap：限制内存+swap的大小</span><br></pre></td></tr></table></figure>\n<p>启动一个限制内存使用的容器testa，如果不指定–memory-swap的话，默认它的大小和内存一样大</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -itd --name testa -m 200M --memory-swap 300M centos /bin/bash</span><br><span class=\"line\">aa90dc55398b2f927c1111bcfa3090502a3b42c3eb538895a1ddadbe556fdf9d</span><br></pre></td></tr></table></figure>\n<p>进入容器testa中查看内存和swap大小，在容器中看到的其实也还是物理机的内存大小</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker exec -it testa /bin/bash</span><br><span class=\"line\">[root@aa90dc55398b /]# free -m</span><br><span class=\"line\">              total        used        free      shared  buff/cache   available</span><br><span class=\"line\">Mem:           <span class=\"number\">3770</span>        <span class=\"number\">1051</span>         <span class=\"number\">992</span>          <span class=\"number\">33</span>        <span class=\"number\">1726</span>        <span class=\"number\">2431</span></span><br><span class=\"line\">Swap:          <span class=\"number\">2047</span>           <span class=\"number\">0</span>        <span class=\"number\">2047</span></span><br></pre></td></tr></table></figure>\n<p>第二种查看，最为准确，在宿主机的cgroup中查看，内存大小为200M</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# cat /sys/fs/cgroup/memory/docker/aa9...f9d/memory.limit_in_bytes </span><br><span class=\"line\"><span class=\"number\">209715200</span></span><br></pre></td></tr></table></figure>\n<p>还可以通过测试也能够测出来</p>\n<p>内存+swap总量是300M，内存占200M，所以swap是100M，启动容器运行</p>\n<p>测试使用280M是否可以正常运行，一直在输出说明正常</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -it -m 200M --memory-swap 300M progrium/stress --vm 1 --vm-bytes 280M</span><br><span class=\"line\">stress: info: [<span class=\"number\">1</span>] dispatching hogs: <span class=\"number\">0</span> cpu, <span class=\"number\">0</span> io, <span class=\"number\">1</span> vm, <span class=\"number\">0</span> hdd</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">1</span>] using backoff sleep of <span class=\"number\">3000</span>us</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">1</span>] --&gt; hogvm worker <span class=\"number\">1</span> [<span class=\"number\">6</span>] forked</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">6</span>] allocating <span class=\"number\">293601280</span> bytes ...</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">6</span>] touching bytes in strides of <span class=\"number\">4096</span> bytes ...</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">6</span>] freed <span class=\"number\">293601280</span> bytes</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">6</span>] allocating <span class=\"number\">293601280</span> bytes ...</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">6</span>] touching bytes in strides of <span class=\"number\">4096</span> bytes ...</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>测试使用380M是否可以正常运行，自动跳出，则不能运行，说明380M超出了内存范围</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -it -m 200M --memory-swap 300M progrium/stress --vm 1 --vm-bytes </span><br><span class=\"line\"><span class=\"number\">380</span>M</span><br><span class=\"line\">stress: info: [<span class=\"number\">1</span>] dispatching hogs: <span class=\"number\">0</span> cpu, <span class=\"number\">0</span> io, <span class=\"number\">1</span> vm, <span class=\"number\">0</span> hdd</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">1</span>] using backoff sleep of <span class=\"number\">3000</span>us</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">1</span>] --&gt; hogvm worker <span class=\"number\">1</span> [<span class=\"number\">6</span>] forked</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">6</span>] allocating <span class=\"number\">398458880</span> bytes ...</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">6</span>] touching bytes in strides of <span class=\"number\">4096</span> bytes ...</span><br><span class=\"line\">stress: FAIL: [<span class=\"number\">1</span>] (<span class=\"number\">416</span>) &lt;-- worker <span class=\"number\">6</span> got signal <span class=\"number\">9</span></span><br><span class=\"line\">stress: WARN: [<span class=\"number\">1</span>] (<span class=\"number\">418</span>) now reaping child worker processes</span><br><span class=\"line\">stress: FAIL: [<span class=\"number\">1</span>] (<span class=\"number\">422</span>) kill error: No such process</span><br><span class=\"line\">stress: FAIL: [<span class=\"number\">1</span>] (<span class=\"number\">452</span>) failed run completed in <span class=\"number\">1</span>s</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h5 id=\"对容器内存的限制\"><a href=\"#对容器内存的限制\" class=\"headerlink\" title=\"对容器内存的限制\"></a>对容器内存的限制</h5><p>内存分为：物理内存和swap内存</p>\n<p><strong>关键词</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">--memory：限制内存的使用容量</span><br><span class=\"line\">--memory-swap：限制内存+swap的大小</span><br></pre></td></tr></table></figure>\n<p>启动一个限制内存使用的容器testa，如果不指定–memory-swap的话，默认它的大小和内存一样大</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -itd --name testa -m 200M --memory-swap 300M centos /bin/bash</span><br><span class=\"line\">aa90dc55398b2f927c1111bcfa3090502a3b42c3eb538895a1ddadbe556fdf9d</span><br></pre></td></tr></table></figure>\n<p>进入容器testa中查看内存和swap大小，在容器中看到的其实也还是物理机的内存大小</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker exec -it testa /bin/bash</span><br><span class=\"line\">[root@aa90dc55398b /]# free -m</span><br><span class=\"line\">              total        used        free      shared  buff/cache   available</span><br><span class=\"line\">Mem:           <span class=\"number\">3770</span>        <span class=\"number\">1051</span>         <span class=\"number\">992</span>          <span class=\"number\">33</span>        <span class=\"number\">1726</span>        <span class=\"number\">2431</span></span><br><span class=\"line\">Swap:          <span class=\"number\">2047</span>           <span class=\"number\">0</span>        <span class=\"number\">2047</span></span><br></pre></td></tr></table></figure>\n<p>第二种查看，最为准确，在宿主机的cgroup中查看，内存大小为200M</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# cat /sys/fs/cgroup/memory/docker/aa9...f9d/memory.limit_in_bytes </span><br><span class=\"line\"><span class=\"number\">209715200</span></span><br></pre></td></tr></table></figure>\n<p>还可以通过测试也能够测出来</p>\n<p>内存+swap总量是300M，内存占200M，所以swap是100M，启动容器运行</p>\n<p>测试使用280M是否可以正常运行，一直在输出说明正常</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -it -m 200M --memory-swap 300M progrium/stress --vm 1 --vm-bytes 280M</span><br><span class=\"line\">stress: info: [<span class=\"number\">1</span>] dispatching hogs: <span class=\"number\">0</span> cpu, <span class=\"number\">0</span> io, <span class=\"number\">1</span> vm, <span class=\"number\">0</span> hdd</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">1</span>] using backoff sleep of <span class=\"number\">3000</span>us</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">1</span>] --&gt; hogvm worker <span class=\"number\">1</span> [<span class=\"number\">6</span>] forked</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">6</span>] allocating <span class=\"number\">293601280</span> bytes ...</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">6</span>] touching bytes in strides of <span class=\"number\">4096</span> bytes ...</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">6</span>] freed <span class=\"number\">293601280</span> bytes</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">6</span>] allocating <span class=\"number\">293601280</span> bytes ...</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">6</span>] touching bytes in strides of <span class=\"number\">4096</span> bytes ...</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>测试使用380M是否可以正常运行，自动跳出，则不能运行，说明380M超出了内存范围</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -it -m 200M --memory-swap 300M progrium/stress --vm 1 --vm-bytes </span><br><span class=\"line\"><span class=\"number\">380</span>M</span><br><span class=\"line\">stress: info: [<span class=\"number\">1</span>] dispatching hogs: <span class=\"number\">0</span> cpu, <span class=\"number\">0</span> io, <span class=\"number\">1</span> vm, <span class=\"number\">0</span> hdd</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">1</span>] using backoff sleep of <span class=\"number\">3000</span>us</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">1</span>] --&gt; hogvm worker <span class=\"number\">1</span> [<span class=\"number\">6</span>] forked</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">6</span>] allocating <span class=\"number\">398458880</span> bytes ...</span><br><span class=\"line\">stress: dbug: [<span class=\"number\">6</span>] touching bytes in strides of <span class=\"number\">4096</span> bytes ...</span><br><span class=\"line\">stress: FAIL: [<span class=\"number\">1</span>] (<span class=\"number\">416</span>) &lt;-- worker <span class=\"number\">6</span> got signal <span class=\"number\">9</span></span><br><span class=\"line\">stress: WARN: [<span class=\"number\">1</span>] (<span class=\"number\">418</span>) now reaping child worker processes</span><br><span class=\"line\">stress: FAIL: [<span class=\"number\">1</span>] (<span class=\"number\">422</span>) kill error: No such process</span><br><span class=\"line\">stress: FAIL: [<span class=\"number\">1</span>] (<span class=\"number\">452</span>) failed run completed in <span class=\"number\">1</span>s</span><br></pre></td></tr></table></figure>"},{"title":"对容器进行磁盘读写速率控制","author":"Semaik.","date":"2020-09-27T06:45:00.000Z","_content":"##### 对容器磁盘读写进行控制\n**关键词**\n```java\n--blkil-weight：硬盘优先级，谁先使用硬盘\nbps/iops：bps是每秒读写的数据量，iops是每秒的io次数\n都有利于提升数据读取的速度，要么单次读取数据大，要么读取数据小但是次数多\n--device-read-bps：磁盘每秒读取速度\n--device-write-bps：磁盘每秒写入速度\n--device-read-iops：磁盘每秒io读取速度\n--device-write-iops：磁盘每秒io写入速度\n```\n###### 控制一\n启动一个容器，并限制该容器在磁盘的写入速度为30MB/s\n```java\n[root@localhost ~]# docker run -it --device-write-bps /dev/sda:30MB centos /bin/bash\n```\n使用dd命令测试，发现写入速率为29.9MB/s\n```java\n[root@34b03090013e /]# time dd if=dev/zero of=test.out bs=1M count=800 oflag=direct \n 测试硬盘性能，读取1M的数据，读取800次\n800+0 records in\n800+0 records out\n838860800 bytes (839 MB) copied, 28.0896 s, 29.9 MB/s\n \nreal\t0m28.217s\nuser\t0m0.006s\nsys\t0m1.566s\n```\n启动一个没有限制磁盘写入的容器，进行相同的测试，写入速率为1.2GB/s，这是正常的写入速率\n```java\n[root@localhost ~]# docker run -it centos /bin/bash\n[root@54e235363474 /]# time dd if=dev/zero of=test.out bs=1M count=800 oflag=direct \n800+0 records in\n800+0 records out\n838860800 bytes (839 MB) copied, 0.715951 s, 1.2 GB/s\n \nreal\t0m0.718s\nuser\t0m0.000s\nsys\t0m0.633s\n```\n###### 控制二\n创建并允许一个容器，使它对硬盘的每秒读写速度不超过100MB\n```java\n[root@localhost ~]# docker run -it --device-read-bps /dev/sda:100MB --device-write-bps /dev/sda:100MB centos /bin/bash\n[root@5e5f92eb145e /]# time dd if=/dev/zero of=test.out bs=1M count=800 oflag=direct \n800+0 records in\n800+0 records out\n838860800 bytes (839 MB) copied, 7.9597 s, 105 MB/s\n \nreal\t0m7.963s\nuser\t0m0.005s\nsys\t0m1.966s\n```","source":"_posts/对容器进行磁盘读写速率控制.md","raw":"title: 对容器进行磁盘读写速率控制\nauthor: Semaik.\ntags:\n  - Docker\ncategories:\n  - Docker\ndate: 2020-09-27 14:45:00\n---\n##### 对容器磁盘读写进行控制\n**关键词**\n```java\n--blkil-weight：硬盘优先级，谁先使用硬盘\nbps/iops：bps是每秒读写的数据量，iops是每秒的io次数\n都有利于提升数据读取的速度，要么单次读取数据大，要么读取数据小但是次数多\n--device-read-bps：磁盘每秒读取速度\n--device-write-bps：磁盘每秒写入速度\n--device-read-iops：磁盘每秒io读取速度\n--device-write-iops：磁盘每秒io写入速度\n```\n###### 控制一\n启动一个容器，并限制该容器在磁盘的写入速度为30MB/s\n```java\n[root@localhost ~]# docker run -it --device-write-bps /dev/sda:30MB centos /bin/bash\n```\n使用dd命令测试，发现写入速率为29.9MB/s\n```java\n[root@34b03090013e /]# time dd if=dev/zero of=test.out bs=1M count=800 oflag=direct \n 测试硬盘性能，读取1M的数据，读取800次\n800+0 records in\n800+0 records out\n838860800 bytes (839 MB) copied, 28.0896 s, 29.9 MB/s\n \nreal\t0m28.217s\nuser\t0m0.006s\nsys\t0m1.566s\n```\n启动一个没有限制磁盘写入的容器，进行相同的测试，写入速率为1.2GB/s，这是正常的写入速率\n```java\n[root@localhost ~]# docker run -it centos /bin/bash\n[root@54e235363474 /]# time dd if=dev/zero of=test.out bs=1M count=800 oflag=direct \n800+0 records in\n800+0 records out\n838860800 bytes (839 MB) copied, 0.715951 s, 1.2 GB/s\n \nreal\t0m0.718s\nuser\t0m0.000s\nsys\t0m0.633s\n```\n###### 控制二\n创建并允许一个容器，使它对硬盘的每秒读写速度不超过100MB\n```java\n[root@localhost ~]# docker run -it --device-read-bps /dev/sda:100MB --device-write-bps /dev/sda:100MB centos /bin/bash\n[root@5e5f92eb145e /]# time dd if=/dev/zero of=test.out bs=1M count=800 oflag=direct \n800+0 records in\n800+0 records out\n838860800 bytes (839 MB) copied, 7.9597 s, 105 MB/s\n \nreal\t0m7.963s\nuser\t0m0.005s\nsys\t0m1.966s\n```","slug":"对容器进行磁盘读写速率控制","published":1,"updated":"2020-09-27T06:46:43.594Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737p002gm3pv469l4os2","content":"<h5 id=\"对容器磁盘读写进行控制\"><a href=\"#对容器磁盘读写进行控制\" class=\"headerlink\" title=\"对容器磁盘读写进行控制\"></a>对容器磁盘读写进行控制</h5><p><strong>关键词</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">--blkil-weight：硬盘优先级，谁先使用硬盘</span><br><span class=\"line\">bps/iops：bps是每秒读写的数据量，iops是每秒的io次数</span><br><span class=\"line\">都有利于提升数据读取的速度，要么单次读取数据大，要么读取数据小但是次数多</span><br><span class=\"line\">--device-read-bps：磁盘每秒读取速度</span><br><span class=\"line\">--device-write-bps：磁盘每秒写入速度</span><br><span class=\"line\">--device-read-iops：磁盘每秒io读取速度</span><br><span class=\"line\">--device-write-iops：磁盘每秒io写入速度</span><br></pre></td></tr></table></figure>\n<h6 id=\"控制一\"><a href=\"#控制一\" class=\"headerlink\" title=\"控制一\"></a>控制一</h6><p>启动一个容器，并限制该容器在磁盘的写入速度为30MB/s</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -it --device-write-bps /dev/sda:30MB centos /bin/bash</span><br></pre></td></tr></table></figure>\n<p>使用dd命令测试，发现写入速率为29.9MB/s</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@34b03090013e /]# time dd if=dev/zero of=test.out bs=1M count=800 oflag=direct </span><br><span class=\"line\"> 测试硬盘性能，读取<span class=\"number\">1</span>M的数据，读取<span class=\"number\">800</span>次</span><br><span class=\"line\"><span class=\"number\">800</span>+<span class=\"number\">0</span> records in</span><br><span class=\"line\"><span class=\"number\">800</span>+<span class=\"number\">0</span> records out</span><br><span class=\"line\"><span class=\"number\">838860800</span> bytes (<span class=\"number\">839</span> MB) copied, <span class=\"number\">28.0896</span> s, <span class=\"number\">29.9</span> MB/s</span><br><span class=\"line\"> </span><br><span class=\"line\">real\t<span class=\"number\">0</span>m28.<span class=\"number\">217</span>s</span><br><span class=\"line\">user\t<span class=\"number\">0</span>m0.<span class=\"number\">006</span>s</span><br><span class=\"line\">sys\t<span class=\"number\">0</span>m1.<span class=\"number\">566</span>s</span><br></pre></td></tr></table></figure>\n<p>启动一个没有限制磁盘写入的容器，进行相同的测试，写入速率为1.2GB/s，这是正常的写入速率</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -it centos /bin/bash</span><br><span class=\"line\">[root@54e235363474 /]# time dd if=dev/zero of=test.out bs=1M count=800 oflag=direct </span><br><span class=\"line\"><span class=\"number\">800</span>+<span class=\"number\">0</span> records in</span><br><span class=\"line\"><span class=\"number\">800</span>+<span class=\"number\">0</span> records out</span><br><span class=\"line\"><span class=\"number\">838860800</span> bytes (<span class=\"number\">839</span> MB) copied, <span class=\"number\">0.715951</span> s, <span class=\"number\">1.2</span> GB/s</span><br><span class=\"line\"> </span><br><span class=\"line\">real\t<span class=\"number\">0</span>m0.<span class=\"number\">718</span>s</span><br><span class=\"line\">user\t<span class=\"number\">0</span>m0.<span class=\"number\">000</span>s</span><br><span class=\"line\">sys\t<span class=\"number\">0</span>m0.<span class=\"number\">633</span>s</span><br></pre></td></tr></table></figure>\n<h6 id=\"控制二\"><a href=\"#控制二\" class=\"headerlink\" title=\"控制二\"></a>控制二</h6><p>创建并允许一个容器，使它对硬盘的每秒读写速度不超过100MB</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -it --device-read-bps /dev/sda:100MB --device-write-bps /dev/sda:100MB centos /bin/bash</span><br><span class=\"line\">[root@5e5f92eb145e /]# time dd if=/dev/zero of=test.out bs=1M count=800 oflag=direct </span><br><span class=\"line\"><span class=\"number\">800</span>+<span class=\"number\">0</span> records in</span><br><span class=\"line\"><span class=\"number\">800</span>+<span class=\"number\">0</span> records out</span><br><span class=\"line\"><span class=\"number\">838860800</span> bytes (<span class=\"number\">839</span> MB) copied, <span class=\"number\">7.9597</span> s, <span class=\"number\">105</span> MB/s</span><br><span class=\"line\"> </span><br><span class=\"line\">real\t<span class=\"number\">0</span>m7.<span class=\"number\">963</span>s</span><br><span class=\"line\">user\t<span class=\"number\">0</span>m0.<span class=\"number\">005</span>s</span><br><span class=\"line\">sys\t<span class=\"number\">0</span>m1.<span class=\"number\">966</span>s</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h5 id=\"对容器磁盘读写进行控制\"><a href=\"#对容器磁盘读写进行控制\" class=\"headerlink\" title=\"对容器磁盘读写进行控制\"></a>对容器磁盘读写进行控制</h5><p><strong>关键词</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">--blkil-weight：硬盘优先级，谁先使用硬盘</span><br><span class=\"line\">bps/iops：bps是每秒读写的数据量，iops是每秒的io次数</span><br><span class=\"line\">都有利于提升数据读取的速度，要么单次读取数据大，要么读取数据小但是次数多</span><br><span class=\"line\">--device-read-bps：磁盘每秒读取速度</span><br><span class=\"line\">--device-write-bps：磁盘每秒写入速度</span><br><span class=\"line\">--device-read-iops：磁盘每秒io读取速度</span><br><span class=\"line\">--device-write-iops：磁盘每秒io写入速度</span><br></pre></td></tr></table></figure>\n<h6 id=\"控制一\"><a href=\"#控制一\" class=\"headerlink\" title=\"控制一\"></a>控制一</h6><p>启动一个容器，并限制该容器在磁盘的写入速度为30MB/s</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -it --device-write-bps /dev/sda:30MB centos /bin/bash</span><br></pre></td></tr></table></figure>\n<p>使用dd命令测试，发现写入速率为29.9MB/s</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@34b03090013e /]# time dd if=dev/zero of=test.out bs=1M count=800 oflag=direct </span><br><span class=\"line\"> 测试硬盘性能，读取<span class=\"number\">1</span>M的数据，读取<span class=\"number\">800</span>次</span><br><span class=\"line\"><span class=\"number\">800</span>+<span class=\"number\">0</span> records in</span><br><span class=\"line\"><span class=\"number\">800</span>+<span class=\"number\">0</span> records out</span><br><span class=\"line\"><span class=\"number\">838860800</span> bytes (<span class=\"number\">839</span> MB) copied, <span class=\"number\">28.0896</span> s, <span class=\"number\">29.9</span> MB/s</span><br><span class=\"line\"> </span><br><span class=\"line\">real\t<span class=\"number\">0</span>m28.<span class=\"number\">217</span>s</span><br><span class=\"line\">user\t<span class=\"number\">0</span>m0.<span class=\"number\">006</span>s</span><br><span class=\"line\">sys\t<span class=\"number\">0</span>m1.<span class=\"number\">566</span>s</span><br></pre></td></tr></table></figure>\n<p>启动一个没有限制磁盘写入的容器，进行相同的测试，写入速率为1.2GB/s，这是正常的写入速率</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -it centos /bin/bash</span><br><span class=\"line\">[root@54e235363474 /]# time dd if=dev/zero of=test.out bs=1M count=800 oflag=direct </span><br><span class=\"line\"><span class=\"number\">800</span>+<span class=\"number\">0</span> records in</span><br><span class=\"line\"><span class=\"number\">800</span>+<span class=\"number\">0</span> records out</span><br><span class=\"line\"><span class=\"number\">838860800</span> bytes (<span class=\"number\">839</span> MB) copied, <span class=\"number\">0.715951</span> s, <span class=\"number\">1.2</span> GB/s</span><br><span class=\"line\"> </span><br><span class=\"line\">real\t<span class=\"number\">0</span>m0.<span class=\"number\">718</span>s</span><br><span class=\"line\">user\t<span class=\"number\">0</span>m0.<span class=\"number\">000</span>s</span><br><span class=\"line\">sys\t<span class=\"number\">0</span>m0.<span class=\"number\">633</span>s</span><br></pre></td></tr></table></figure>\n<h6 id=\"控制二\"><a href=\"#控制二\" class=\"headerlink\" title=\"控制二\"></a>控制二</h6><p>创建并允许一个容器，使它对硬盘的每秒读写速度不超过100MB</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker run -it --device-read-bps /dev/sda:100MB --device-write-bps /dev/sda:100MB centos /bin/bash</span><br><span class=\"line\">[root@5e5f92eb145e /]# time dd if=/dev/zero of=test.out bs=1M count=800 oflag=direct </span><br><span class=\"line\"><span class=\"number\">800</span>+<span class=\"number\">0</span> records in</span><br><span class=\"line\"><span class=\"number\">800</span>+<span class=\"number\">0</span> records out</span><br><span class=\"line\"><span class=\"number\">838860800</span> bytes (<span class=\"number\">839</span> MB) copied, <span class=\"number\">7.9597</span> s, <span class=\"number\">105</span> MB/s</span><br><span class=\"line\"> </span><br><span class=\"line\">real\t<span class=\"number\">0</span>m7.<span class=\"number\">963</span>s</span><br><span class=\"line\">user\t<span class=\"number\">0</span>m0.<span class=\"number\">005</span>s</span><br><span class=\"line\">sys\t<span class=\"number\">0</span>m1.<span class=\"number\">966</span>s</span><br></pre></td></tr></table></figure>"},{"title":"强制修改Linux系统的Root密码的办法","author":"Semaik.","date":"2020-09-18T08:17:00.000Z","_content":"##### 1.在Linux 的引导界面按 E 键来进入内核编辑界面\n![upload successful](/images/test0.png)\n\n##### 2.按键盘下键，找到Linux16这一行，然后在最后边加入 rd.break命令，然后按Ctrl+X来重启修改过的内核!\n![upload successful](/images/test1.png)\n##### 3. 之后进入“紧急求援模式”\n\n   输入以下命令（输入完一行回车！）\n\n   mount -o remount,rw /sysroot\n\n   chroot /sysroot\n\n   passwd    # 当输入完这一行会系统会让你输入新密码和确认新密码，按照系统提示输入即可！\n\n   touch /.autorelabel\n\n   exit\n\n   reboot\n![upload successful](/images/test2.png)\n##### 4.接着等待重启以后就可以使用root账号了","source":"_posts/强制修改Linux系统的Root密码的办法.md","raw":"title: 强制修改Linux系统的Root密码的办法\nauthor: Semaik.\ntags:\n  - Linux\ncategories:\n  - Linux\n  - ''\ndate: 2020-09-18 16:17:00\n---\n##### 1.在Linux 的引导界面按 E 键来进入内核编辑界面\n![upload successful](/images/test0.png)\n\n##### 2.按键盘下键，找到Linux16这一行，然后在最后边加入 rd.break命令，然后按Ctrl+X来重启修改过的内核!\n![upload successful](/images/test1.png)\n##### 3. 之后进入“紧急求援模式”\n\n   输入以下命令（输入完一行回车！）\n\n   mount -o remount,rw /sysroot\n\n   chroot /sysroot\n\n   passwd    # 当输入完这一行会系统会让你输入新密码和确认新密码，按照系统提示输入即可！\n\n   touch /.autorelabel\n\n   exit\n\n   reboot\n![upload successful](/images/test2.png)\n##### 4.接着等待重启以后就可以使用root账号了","slug":"强制修改Linux系统的Root密码的办法","published":1,"updated":"2020-09-18T12:45:46.610Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737q002km3pvhq8u3v3w","content":"<h5 id=\"1-在Linux-的引导界面按-E-键来进入内核编辑界面\"><a href=\"#1-在Linux-的引导界面按-E-键来进入内核编辑界面\" class=\"headerlink\" title=\"1.在Linux 的引导界面按 E 键来进入内核编辑界面\"></a>1.在Linux 的引导界面按 E 键来进入内核编辑界面</h5><p><img src=\"/images/test0.png\" alt=\"upload successful\"></p>\n<h5 id=\"2-按键盘下键，找到Linux16这一行，然后在最后边加入-rd-break命令，然后按Ctrl-X来重启修改过的内核\"><a href=\"#2-按键盘下键，找到Linux16这一行，然后在最后边加入-rd-break命令，然后按Ctrl-X来重启修改过的内核\" class=\"headerlink\" title=\"2.按键盘下键，找到Linux16这一行，然后在最后边加入 rd.break命令，然后按Ctrl+X来重启修改过的内核!\"></a>2.按键盘下键，找到Linux16这一行，然后在最后边加入 rd.break命令，然后按Ctrl+X来重启修改过的内核!</h5><p><img src=\"/images/test1.png\" alt=\"upload successful\"></p>\n<h5 id=\"3-之后进入“紧急求援模式”\"><a href=\"#3-之后进入“紧急求援模式”\" class=\"headerlink\" title=\"3. 之后进入“紧急求援模式”\"></a>3. 之后进入“紧急求援模式”</h5><p>   输入以下命令（输入完一行回车！）</p>\n<p>   mount -o remount,rw /sysroot</p>\n<p>   chroot /sysroot</p>\n<p>   passwd    # 当输入完这一行会系统会让你输入新密码和确认新密码，按照系统提示输入即可！</p>\n<p>   touch /.autorelabel</p>\n<p>   exit</p>\n<p>   reboot<br><img src=\"/images/test2.png\" alt=\"upload successful\"></p>\n<h5 id=\"4-接着等待重启以后就可以使用root账号了\"><a href=\"#4-接着等待重启以后就可以使用root账号了\" class=\"headerlink\" title=\"4.接着等待重启以后就可以使用root账号了\"></a>4.接着等待重启以后就可以使用root账号了</h5>","site":{"data":{}},"excerpt":"","more":"<h5 id=\"1-在Linux-的引导界面按-E-键来进入内核编辑界面\"><a href=\"#1-在Linux-的引导界面按-E-键来进入内核编辑界面\" class=\"headerlink\" title=\"1.在Linux 的引导界面按 E 键来进入内核编辑界面\"></a>1.在Linux 的引导界面按 E 键来进入内核编辑界面</h5><p><img src=\"/images/test0.png\" alt=\"upload successful\"></p>\n<h5 id=\"2-按键盘下键，找到Linux16这一行，然后在最后边加入-rd-break命令，然后按Ctrl-X来重启修改过的内核\"><a href=\"#2-按键盘下键，找到Linux16这一行，然后在最后边加入-rd-break命令，然后按Ctrl-X来重启修改过的内核\" class=\"headerlink\" title=\"2.按键盘下键，找到Linux16这一行，然后在最后边加入 rd.break命令，然后按Ctrl+X来重启修改过的内核!\"></a>2.按键盘下键，找到Linux16这一行，然后在最后边加入 rd.break命令，然后按Ctrl+X来重启修改过的内核!</h5><p><img src=\"/images/test1.png\" alt=\"upload successful\"></p>\n<h5 id=\"3-之后进入“紧急求援模式”\"><a href=\"#3-之后进入“紧急求援模式”\" class=\"headerlink\" title=\"3. 之后进入“紧急求援模式”\"></a>3. 之后进入“紧急求援模式”</h5><p>   输入以下命令（输入完一行回车！）</p>\n<p>   mount -o remount,rw /sysroot</p>\n<p>   chroot /sysroot</p>\n<p>   passwd    # 当输入完这一行会系统会让你输入新密码和确认新密码，按照系统提示输入即可！</p>\n<p>   touch /.autorelabel</p>\n<p>   exit</p>\n<p>   reboot<br><img src=\"/images/test2.png\" alt=\"upload successful\"></p>\n<h5 id=\"4-接着等待重启以后就可以使用root账号了\"><a href=\"#4-接着等待重启以后就可以使用root账号了\" class=\"headerlink\" title=\"4.接着等待重启以后就可以使用root账号了\"></a>4.接着等待重启以后就可以使用root账号了</h5>"},{"title":"本地MySQL数据库迁移到阿里云RDS","author":"Semaik.","date":"2020-09-11T07:29:00.000Z","_content":"##### 连接本地数据库\n```ruby\nmysql -h localhost -u root -p\n```\n\n##### 创建账号\n> 首先要在本地创建一个用来迁移的帐号，并给这个帐号设置权限。\n```ruby\nCREATE USER 'username'@'host' IDENTIFIED BY 'password';\n```\n> sername：待创建的账号。\n> host：允许该账号登录的主机，如果允许该账号从任意主机登录数据库，可以使用百分号（%）\n> password：账号的密码。 \n\nEG：\n```ruby\n# 例如，创建一个账号，账号名为dtsmigration\n# 密码为Dts123456，并允许从任意主机登录数据库，命令如下。\nCREATE USER 'dtsmigration'@'%' IDENTIFIED BY 'Dts123456';\n```\n\n##### 用户授权\n```ruby\nGRANT privileges ON databasename.tablename TO 'username'@'host' WITH GRANT OPTION;\n```\n>privileges：授予该账号的操作权限，如SELECT、INSERT、UPDATE等，如果要授予该账号所有权限则使用ALL。\ndatabasename：数据库名。如果要授予该账号具备所有数据库的操作权限，则使用星号（）。\ntablename：表名。如果要授予该账号具备所有表的操作权限，则使用星号（）。\nusername：待授权的账号。\nhost：允许该账号登录的主机，如果允许该账号从任意主机登录，则使用百分号（%）。\n>WITH GRANT OPTION：授予该账号使用GRANT命令的权限，该参数为可选。\n   \nEG:\n```ruby\n# 授予dtsmigration账号具备所有数据库和表的所有权限\n# 并允许从任意主机登录数据库，命令如下。\nGRANT ALL ON *.* TO 'dtsmigration'@'%';\n```\n   \n### 本地数据库状态\n##### 1.确认源库的binlog是否开启\n```ruby\nshow global variables like \"log_bin\";\n```\n###### 不是的话配置一下my.cnf\n```ruby\nlog_bin=mysql_bin\nbinlog_format=row\nserver_id=2 //设置大于1的整数\nbinlog_row_image=full     **//当自建MySQL的版本大于5.6时，则必须设置该项**\n```\n###### 修改之后重启MySQL\n```ruby\nsystemctl restart mysql\n```\n##### 2.确认源库的binlog格式为row模式\n```ruby\nshow global variables like \"binlog_format\";\n```\n###### 不是的话配置一下\n```ruby\nset global binlog_format=ROW;\n```\n##### 3.当地mysql版本大等于5.6.2时，确认源库的binlog_row_image=full\n```ruby\nshow global variables like \"binlog_row_image\";\n```\n###### 不是的话配置一下\n```ruby\nset global binlog_row_image=full;\n```\n##### 进行迁移\n>阿里云官方文档\n[https://help.aliyun.com/document_detail/126875.html?spm=a2c4g.11186623.2.10.14554b43IHTNie](https://help.aliyun.com/document_detail/126875.html?spm=a2c4g.11186623.2.10.14554b43IHTNie)\n需要先设置一下网关\n[https://help.aliyun.com/document_detail/159587.html?spm=5176.10695662.1996646101.searchclickresult.1de2d223X9cjTe](https://help.aliyun.com/document_detail/159587.html?spm=5176.10695662.1996646101.searchclickresult.1de2d223X9cjTe)\n注意设置好网关之后要使用无公网:Port的数据库（通过数据库网关DG接入）\n\n","source":"_posts/本地MySQL数据库迁移到阿里云RDS.md","raw":"title: 本地MySQL数据库迁移到阿里云RDS\nauthor: Semaik.\ntags:\n  - Linux\ncategories:\n  - Linux\ndate: 2020-09-11 15:29:00\n---\n##### 连接本地数据库\n```ruby\nmysql -h localhost -u root -p\n```\n\n##### 创建账号\n> 首先要在本地创建一个用来迁移的帐号，并给这个帐号设置权限。\n```ruby\nCREATE USER 'username'@'host' IDENTIFIED BY 'password';\n```\n> sername：待创建的账号。\n> host：允许该账号登录的主机，如果允许该账号从任意主机登录数据库，可以使用百分号（%）\n> password：账号的密码。 \n\nEG：\n```ruby\n# 例如，创建一个账号，账号名为dtsmigration\n# 密码为Dts123456，并允许从任意主机登录数据库，命令如下。\nCREATE USER 'dtsmigration'@'%' IDENTIFIED BY 'Dts123456';\n```\n\n##### 用户授权\n```ruby\nGRANT privileges ON databasename.tablename TO 'username'@'host' WITH GRANT OPTION;\n```\n>privileges：授予该账号的操作权限，如SELECT、INSERT、UPDATE等，如果要授予该账号所有权限则使用ALL。\ndatabasename：数据库名。如果要授予该账号具备所有数据库的操作权限，则使用星号（）。\ntablename：表名。如果要授予该账号具备所有表的操作权限，则使用星号（）。\nusername：待授权的账号。\nhost：允许该账号登录的主机，如果允许该账号从任意主机登录，则使用百分号（%）。\n>WITH GRANT OPTION：授予该账号使用GRANT命令的权限，该参数为可选。\n   \nEG:\n```ruby\n# 授予dtsmigration账号具备所有数据库和表的所有权限\n# 并允许从任意主机登录数据库，命令如下。\nGRANT ALL ON *.* TO 'dtsmigration'@'%';\n```\n   \n### 本地数据库状态\n##### 1.确认源库的binlog是否开启\n```ruby\nshow global variables like \"log_bin\";\n```\n###### 不是的话配置一下my.cnf\n```ruby\nlog_bin=mysql_bin\nbinlog_format=row\nserver_id=2 //设置大于1的整数\nbinlog_row_image=full     **//当自建MySQL的版本大于5.6时，则必须设置该项**\n```\n###### 修改之后重启MySQL\n```ruby\nsystemctl restart mysql\n```\n##### 2.确认源库的binlog格式为row模式\n```ruby\nshow global variables like \"binlog_format\";\n```\n###### 不是的话配置一下\n```ruby\nset global binlog_format=ROW;\n```\n##### 3.当地mysql版本大等于5.6.2时，确认源库的binlog_row_image=full\n```ruby\nshow global variables like \"binlog_row_image\";\n```\n###### 不是的话配置一下\n```ruby\nset global binlog_row_image=full;\n```\n##### 进行迁移\n>阿里云官方文档\n[https://help.aliyun.com/document_detail/126875.html?spm=a2c4g.11186623.2.10.14554b43IHTNie](https://help.aliyun.com/document_detail/126875.html?spm=a2c4g.11186623.2.10.14554b43IHTNie)\n需要先设置一下网关\n[https://help.aliyun.com/document_detail/159587.html?spm=5176.10695662.1996646101.searchclickresult.1de2d223X9cjTe](https://help.aliyun.com/document_detail/159587.html?spm=5176.10695662.1996646101.searchclickresult.1de2d223X9cjTe)\n注意设置好网关之后要使用无公网:Port的数据库（通过数据库网关DG接入）\n\n","slug":"本地MySQL数据库迁移到阿里云RDS","published":1,"updated":"2020-09-11T07:33:24.994Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737r002nm3pv0xn65ktv","content":"<h5 id=\"连接本地数据库\"><a href=\"#连接本地数据库\" class=\"headerlink\" title=\"连接本地数据库\"></a>连接本地数据库</h5><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql -h localhost -u root -p</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"创建账号\"><a href=\"#创建账号\" class=\"headerlink\" title=\"创建账号\"></a>创建账号</h5><blockquote>\n<p>首先要在本地创建一个用来迁移的帐号，并给这个帐号设置权限。</p>\n</blockquote>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE USER <span class=\"string\">&#x27;username&#x27;</span>@<span class=\"string\">&#x27;host&#x27;</span> IDENTIFIED BY <span class=\"string\">&#x27;password&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>sername：待创建的账号。<br>host：允许该账号登录的主机，如果允许该账号从任意主机登录数据库，可以使用百分号（%）<br>password：账号的密码。 </p>\n</blockquote>\n<p>EG：</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 例如，创建一个账号，账号名为dtsmigration</span></span><br><span class=\"line\"><span class=\"comment\"># 密码为Dts123456，并允许从任意主机登录数据库，命令如下。</span></span><br><span class=\"line\">CREATE USER <span class=\"string\">&#x27;dtsmigration&#x27;</span>@<span class=\"string\">&#x27;%&#x27;</span> IDENTIFIED BY <span class=\"string\">&#x27;Dts123456&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"用户授权\"><a href=\"#用户授权\" class=\"headerlink\" title=\"用户授权\"></a>用户授权</h5><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GRANT privileges ON databasename.tablename TO <span class=\"string\">&#x27;username&#x27;</span>@<span class=\"string\">&#x27;host&#x27;</span> WITH GRANT OPTION;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>privileges：授予该账号的操作权限，如SELECT、INSERT、UPDATE等，如果要授予该账号所有权限则使用ALL。<br>databasename：数据库名。如果要授予该账号具备所有数据库的操作权限，则使用星号（）。<br>tablename：表名。如果要授予该账号具备所有表的操作权限，则使用星号（）。<br>username：待授权的账号。<br>host：允许该账号登录的主机，如果允许该账号从任意主机登录，则使用百分号（%）。<br>WITH GRANT OPTION：授予该账号使用GRANT命令的权限，该参数为可选。</p>\n</blockquote>\n<p>EG:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 授予dtsmigration账号具备所有数据库和表的所有权限</span></span><br><span class=\"line\"><span class=\"comment\"># 并允许从任意主机登录数据库，命令如下。</span></span><br><span class=\"line\">GRANT ALL ON *.* TO <span class=\"string\">&#x27;dtsmigration&#x27;</span>@<span class=\"string\">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"本地数据库状态\"><a href=\"#本地数据库状态\" class=\"headerlink\" title=\"本地数据库状态\"></a>本地数据库状态</h3><h5 id=\"1-确认源库的binlog是否开启\"><a href=\"#1-确认源库的binlog是否开启\" class=\"headerlink\" title=\"1.确认源库的binlog是否开启\"></a>1.确认源库的binlog是否开启</h5><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show global variables like <span class=\"string\">&quot;log_bin&quot;</span>;</span><br></pre></td></tr></table></figure>\n<h6 id=\"不是的话配置一下my-cnf\"><a href=\"#不是的话配置一下my-cnf\" class=\"headerlink\" title=\"不是的话配置一下my.cnf\"></a>不是的话配置一下my.cnf</h6><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">log_bin=mysql_bin</span><br><span class=\"line\">binlog_format=row</span><br><span class=\"line\">server_id=<span class=\"number\">2</span> /<span class=\"regexp\">/设置大于1的整数</span></span><br><span class=\"line\"><span class=\"regexp\">binlog_row_image=full     **/</span><span class=\"regexp\">/当自建MySQL的版本大于5.6时，则必须设置该项**</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"修改之后重启MySQL\"><a href=\"#修改之后重启MySQL\" class=\"headerlink\" title=\"修改之后重启MySQL\"></a>修改之后重启MySQL</h6><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart mysql</span><br></pre></td></tr></table></figure>\n<h5 id=\"2-确认源库的binlog格式为row模式\"><a href=\"#2-确认源库的binlog格式为row模式\" class=\"headerlink\" title=\"2.确认源库的binlog格式为row模式\"></a>2.确认源库的binlog格式为row模式</h5><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show global variables like <span class=\"string\">&quot;binlog_format&quot;</span>;</span><br></pre></td></tr></table></figure>\n<h6 id=\"不是的话配置一下\"><a href=\"#不是的话配置一下\" class=\"headerlink\" title=\"不是的话配置一下\"></a>不是的话配置一下</h6><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set global binlog_format=ROW;</span><br></pre></td></tr></table></figure>\n<h5 id=\"3-当地mysql版本大等于5-6-2时，确认源库的binlog-row-image-full\"><a href=\"#3-当地mysql版本大等于5-6-2时，确认源库的binlog-row-image-full\" class=\"headerlink\" title=\"3.当地mysql版本大等于5.6.2时，确认源库的binlog_row_image=full\"></a>3.当地mysql版本大等于5.6.2时，确认源库的binlog_row_image=full</h5><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show global variables like <span class=\"string\">&quot;binlog_row_image&quot;</span>;</span><br></pre></td></tr></table></figure>\n<h6 id=\"不是的话配置一下-1\"><a href=\"#不是的话配置一下-1\" class=\"headerlink\" title=\"不是的话配置一下\"></a>不是的话配置一下</h6><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set global binlog_row_image=full;</span><br></pre></td></tr></table></figure>\n<h5 id=\"进行迁移\"><a href=\"#进行迁移\" class=\"headerlink\" title=\"进行迁移\"></a>进行迁移</h5><blockquote>\n<p>阿里云官方文档<br><a href=\"https://help.aliyun.com/document_detail/126875.html?spm=a2c4g.11186623.2.10.14554b43IHTNie\">https://help.aliyun.com/document_detail/126875.html?spm=a2c4g.11186623.2.10.14554b43IHTNie</a><br>需要先设置一下网关<br><a href=\"https://help.aliyun.com/document_detail/159587.html?spm=5176.10695662.1996646101.searchclickresult.1de2d223X9cjTe\">https://help.aliyun.com/document_detail/159587.html?spm=5176.10695662.1996646101.searchclickresult.1de2d223X9cjTe</a><br>注意设置好网关之后要使用无公网:Port的数据库（通过数据库网关DG接入）</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h5 id=\"连接本地数据库\"><a href=\"#连接本地数据库\" class=\"headerlink\" title=\"连接本地数据库\"></a>连接本地数据库</h5><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql -h localhost -u root -p</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"创建账号\"><a href=\"#创建账号\" class=\"headerlink\" title=\"创建账号\"></a>创建账号</h5><blockquote>\n<p>首先要在本地创建一个用来迁移的帐号，并给这个帐号设置权限。</p>\n</blockquote>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE USER <span class=\"string\">&#x27;username&#x27;</span>@<span class=\"string\">&#x27;host&#x27;</span> IDENTIFIED BY <span class=\"string\">&#x27;password&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>sername：待创建的账号。<br>host：允许该账号登录的主机，如果允许该账号从任意主机登录数据库，可以使用百分号（%）<br>password：账号的密码。 </p>\n</blockquote>\n<p>EG：</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 例如，创建一个账号，账号名为dtsmigration</span></span><br><span class=\"line\"><span class=\"comment\"># 密码为Dts123456，并允许从任意主机登录数据库，命令如下。</span></span><br><span class=\"line\">CREATE USER <span class=\"string\">&#x27;dtsmigration&#x27;</span>@<span class=\"string\">&#x27;%&#x27;</span> IDENTIFIED BY <span class=\"string\">&#x27;Dts123456&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"用户授权\"><a href=\"#用户授权\" class=\"headerlink\" title=\"用户授权\"></a>用户授权</h5><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GRANT privileges ON databasename.tablename TO <span class=\"string\">&#x27;username&#x27;</span>@<span class=\"string\">&#x27;host&#x27;</span> WITH GRANT OPTION;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>privileges：授予该账号的操作权限，如SELECT、INSERT、UPDATE等，如果要授予该账号所有权限则使用ALL。<br>databasename：数据库名。如果要授予该账号具备所有数据库的操作权限，则使用星号（）。<br>tablename：表名。如果要授予该账号具备所有表的操作权限，则使用星号（）。<br>username：待授权的账号。<br>host：允许该账号登录的主机，如果允许该账号从任意主机登录，则使用百分号（%）。<br>WITH GRANT OPTION：授予该账号使用GRANT命令的权限，该参数为可选。</p>\n</blockquote>\n<p>EG:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 授予dtsmigration账号具备所有数据库和表的所有权限</span></span><br><span class=\"line\"><span class=\"comment\"># 并允许从任意主机登录数据库，命令如下。</span></span><br><span class=\"line\">GRANT ALL ON *.* TO <span class=\"string\">&#x27;dtsmigration&#x27;</span>@<span class=\"string\">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"本地数据库状态\"><a href=\"#本地数据库状态\" class=\"headerlink\" title=\"本地数据库状态\"></a>本地数据库状态</h3><h5 id=\"1-确认源库的binlog是否开启\"><a href=\"#1-确认源库的binlog是否开启\" class=\"headerlink\" title=\"1.确认源库的binlog是否开启\"></a>1.确认源库的binlog是否开启</h5><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show global variables like <span class=\"string\">&quot;log_bin&quot;</span>;</span><br></pre></td></tr></table></figure>\n<h6 id=\"不是的话配置一下my-cnf\"><a href=\"#不是的话配置一下my-cnf\" class=\"headerlink\" title=\"不是的话配置一下my.cnf\"></a>不是的话配置一下my.cnf</h6><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">log_bin=mysql_bin</span><br><span class=\"line\">binlog_format=row</span><br><span class=\"line\">server_id=<span class=\"number\">2</span> /<span class=\"regexp\">/设置大于1的整数</span></span><br><span class=\"line\"><span class=\"regexp\">binlog_row_image=full     **/</span><span class=\"regexp\">/当自建MySQL的版本大于5.6时，则必须设置该项**</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"修改之后重启MySQL\"><a href=\"#修改之后重启MySQL\" class=\"headerlink\" title=\"修改之后重启MySQL\"></a>修改之后重启MySQL</h6><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart mysql</span><br></pre></td></tr></table></figure>\n<h5 id=\"2-确认源库的binlog格式为row模式\"><a href=\"#2-确认源库的binlog格式为row模式\" class=\"headerlink\" title=\"2.确认源库的binlog格式为row模式\"></a>2.确认源库的binlog格式为row模式</h5><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show global variables like <span class=\"string\">&quot;binlog_format&quot;</span>;</span><br></pre></td></tr></table></figure>\n<h6 id=\"不是的话配置一下\"><a href=\"#不是的话配置一下\" class=\"headerlink\" title=\"不是的话配置一下\"></a>不是的话配置一下</h6><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set global binlog_format=ROW;</span><br></pre></td></tr></table></figure>\n<h5 id=\"3-当地mysql版本大等于5-6-2时，确认源库的binlog-row-image-full\"><a href=\"#3-当地mysql版本大等于5-6-2时，确认源库的binlog-row-image-full\" class=\"headerlink\" title=\"3.当地mysql版本大等于5.6.2时，确认源库的binlog_row_image=full\"></a>3.当地mysql版本大等于5.6.2时，确认源库的binlog_row_image=full</h5><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show global variables like <span class=\"string\">&quot;binlog_row_image&quot;</span>;</span><br></pre></td></tr></table></figure>\n<h6 id=\"不是的话配置一下-1\"><a href=\"#不是的话配置一下-1\" class=\"headerlink\" title=\"不是的话配置一下\"></a>不是的话配置一下</h6><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set global binlog_row_image=full;</span><br></pre></td></tr></table></figure>\n<h5 id=\"进行迁移\"><a href=\"#进行迁移\" class=\"headerlink\" title=\"进行迁移\"></a>进行迁移</h5><blockquote>\n<p>阿里云官方文档<br><a href=\"https://help.aliyun.com/document_detail/126875.html?spm=a2c4g.11186623.2.10.14554b43IHTNie\">https://help.aliyun.com/document_detail/126875.html?spm=a2c4g.11186623.2.10.14554b43IHTNie</a><br>需要先设置一下网关<br><a href=\"https://help.aliyun.com/document_detail/159587.html?spm=5176.10695662.1996646101.searchclickresult.1de2d223X9cjTe\">https://help.aliyun.com/document_detail/159587.html?spm=5176.10695662.1996646101.searchclickresult.1de2d223X9cjTe</a><br>注意设置好网关之后要使用无公网:Port的数据库（通过数据库网关DG接入）</p>\n</blockquote>\n"},{"title":"解决在Docker容器中不能使用system管理","author":"Semaik.","date":"2020-09-27T07:00:00.000Z","_content":"**例：httpd服务**\n\n![upload successful](/images/pasted-85.png)\n```java\n[root@a4120181b4d3 /]# systemctl start httpd\n报错：Failed to get D-Bus connection: Operation not permitted\n```\n \n**解决方法一：**\n\n运行容器时提权\n```java\ndocker run -tid --name centos_1 --privileged=true centos:latest /sbin/init\n```\n>-privileged：提权操作\n\n**解决方法二：**\n进入配置文件\n\nvi /usr/lib/systemd/system/httpd.service\n\n![upload successful](/images/pasted-86.png)\n复制/usr/sbin/httpd\n\n启动httpd服务\n\n![upload successful](/images/pasted-87.png)\n\n![upload successful](/images/pasted-88.png)","source":"_posts/解决在Docker容器中不能使用system管理.md","raw":"title: 解决在Docker容器中不能使用system管理\nauthor: Semaik.\ntags:\n  - Docker\ncategories: []\ndate: 2020-09-27 15:00:00\n---\n**例：httpd服务**\n\n![upload successful](/images/pasted-85.png)\n```java\n[root@a4120181b4d3 /]# systemctl start httpd\n报错：Failed to get D-Bus connection: Operation not permitted\n```\n \n**解决方法一：**\n\n运行容器时提权\n```java\ndocker run -tid --name centos_1 --privileged=true centos:latest /sbin/init\n```\n>-privileged：提权操作\n\n**解决方法二：**\n进入配置文件\n\nvi /usr/lib/systemd/system/httpd.service\n\n![upload successful](/images/pasted-86.png)\n复制/usr/sbin/httpd\n\n启动httpd服务\n\n![upload successful](/images/pasted-87.png)\n\n![upload successful](/images/pasted-88.png)","slug":"解决在Docker容器中不能使用system管理","published":1,"updated":"2020-09-27T07:02:51.353Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737s002qm3pva72og8dt","content":"<p><strong>例：httpd服务</strong></p>\n<p><img src=\"/images/pasted-85.png\" alt=\"upload successful\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@a4120181b4d3 /]# systemctl start httpd</span><br><span class=\"line\">报错：Failed to get D-Bus connection: Operation not permitted</span><br></pre></td></tr></table></figure>\n\n<p><strong>解决方法一：</strong></p>\n<p>运行容器时提权</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -tid --name centos_1 --privileged=<span class=\"keyword\">true</span> centos:latest /sbin/init</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>-privileged：提权操作</p>\n</blockquote>\n<p><strong>解决方法二：</strong><br>进入配置文件</p>\n<p>vi /usr/lib/systemd/system/httpd.service</p>\n<p><img src=\"/images/pasted-86.png\" alt=\"upload successful\"><br>复制/usr/sbin/httpd</p>\n<p>启动httpd服务</p>\n<p><img src=\"/images/pasted-87.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-88.png\" alt=\"upload successful\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p><strong>例：httpd服务</strong></p>\n<p><img src=\"/images/pasted-85.png\" alt=\"upload successful\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@a4120181b4d3 /]# systemctl start httpd</span><br><span class=\"line\">报错：Failed to get D-Bus connection: Operation not permitted</span><br></pre></td></tr></table></figure>\n\n<p><strong>解决方法一：</strong></p>\n<p>运行容器时提权</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -tid --name centos_1 --privileged=<span class=\"keyword\">true</span> centos:latest /sbin/init</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>-privileged：提权操作</p>\n</blockquote>\n<p><strong>解决方法二：</strong><br>进入配置文件</p>\n<p>vi /usr/lib/systemd/system/httpd.service</p>\n<p><img src=\"/images/pasted-86.png\" alt=\"upload successful\"><br>复制/usr/sbin/httpd</p>\n<p>启动httpd服务</p>\n<p><img src=\"/images/pasted-87.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-88.png\" alt=\"upload successful\"></p>\n"},{"title":"Tomcat","author":"Semaik.","date":"2020-09-18T11:02:00.000Z","_content":"##### Tomcat 是什么?\nTomcat 由JAVA语言开发的Java容器，实现了对 Servlet 和 JSP 的支持，并提供了作为Web服务器的一些特有功能，Tomcat是一种类似于IIS、Apache Http的Web服务端程序， Tomcat 本身也内含了一个 HTTP 服务器，它也可以被视作一个单独的 Web 服务器。也就是Web容器。\n\n\nServlet：是应用在服务端的小程序，由JAVA语言编写，本身支持各种JAVA相关的请求，但是大多用于接收web服务发来的请求，与数据库交互并将响应交给web服务\n\n\n\n\nJDK：JAVA开发工具包。\n\n常用工具：\n\n>Java：运行编译后的类文件\n\n>Jar：对类文件进行打包\n\n>Javac：对源文件中的注释提取文档\n\n>Jconsole：远程连接工具\n\n>Jre：JAVA运行环境\n\n##### 部署tomcat\n配置Java环境\n\n解压软件包\n```\n# tar zxf jdk-8u201-linux-x64.tar.gz\n```\n将jdk解压后的目录移动到/usr/local/起名为java\n```\n# mv /root/jdk1.8.0_201/ /usr/local/java\n```\n删除原先的旧java\n```\n# rm -rf /usr/bin/java\n```\n配置Java环境变量\n```\n# echo 'export JAVA_HOME=/usr/local/java\n# 设置jre（Jave Runtime Environment：java运行时环境）的安装目录变量\n> export JRE_HOME=/usr/local/java/jre/\n# 设置类文件路径，冒号代表加的意思，引用以上设置的变量\n> export CLASSPATH=$JAVA_HOME/lib:$JRE_HOME/lib\n# 最后一行，相当于windows系统的命令环境变量，就是新添了两个java以及jre的命令变量\n# $PATH代表原有的环境变量，使用变量复用\n> export PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin' >> /etc/profile\n```\n加载编写的profile文件\n```\n# source /etc/profile\n```\n查看版本号\n```\n# java -version\njava version \"1.8.0_201\"\nJava(TM) SE Runtime Environment (build 1.8.0_201-b09)\nJava HotSpot(TM) 64-Bit Server VM (build 25.201-b09, mixed mode)\n```\n安装Tomcat\n```\ntar zxf apache-tomcat-8.5.35.tar.gz \nmv apache-tomcat-8.5.35 /usr/local/tomcat\n```\n启动服务：`/usr/local/tomcat/bin/startup.sh`\n\n停止服务：`/usr/local/tomcat/bin/shutdown.sh`\n\n> 8080：接收客户端请求\n\n> 8005：用于接收shutdown指令\n\n> 8009：用于tomcat接受其他web服务发来的请求\n\nserver.xml主配置文件\n```\nvi /usr/local/tomcat/conf/server.xml\n<Server port=\"8005\" shutdown=\"SHUTDOWN\"></Server>\nport：server模块监听的端口号，可以自定义，只有端口号不冲突，为-1时表示不接受关闭指令\nshutdown：server模块接收到的参数指定的指令时就关闭tomcat程序\n\n<Service name=\"Catalina\"></Service>\nname：指定该servie的名字，可以有多个service通过名字来区分\n\n<Connector port=\"8080\" protocol=\"HTTP/1.1\"\n           connectionTimeout=\"20000\"\n           redirectPort=\"8443\" /></Connector>\n<Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\" />\nport：tomcat对客户端开放的端口号，8080是用于接收客户端发送的http请求，8009是用于tomcat接受其他web服务发来的请求\nprotocol：客户端连接tomcat使用的协议，AJP协议用于tomcat与其他web服务建立连接使用的\nconnectionTimeout：与tomcat的连接超时时间，单位毫秒\nredirectPort：当tomcat配置为https时，如果客户端仍然使用http协议访问，强制对客户端使用的协议转换为https，并将端口转换为8443\n\n<Engine name=\"Catalina\" defaultHost=\"localhost\"></Engine>\nname：该engine的名字，如果有多个service用来区分不同的引擎，并在日志中通过 名字进行标识\ndefault Host：引擎接受请求通过客户端请求的URL的IP/域名/主机名部分匹配Host模块，如果没有匹配到的则把请求交给defaultHost指定的主机处理，所以必须要有一个Host模块的主机名为defaultHost指定的名字\n\n<Host name=\"localhost\"  appBase=\"webapps\"\n          unpackWARs=\"true\" autoDeploy=\"true\">\n<Context path=”/test” docBase=”/haha”></Context>\n</Host>\nname：该host也就是虚拟主机对应的名字，用来engine对客户端访问的url中的主机部分进行匹配\nappBase：该虚拟主机对应的站点目录，webapps是一个相对路径，其绝对路径为“/usr/local/tomcat/webapps”\npath：客户端访问的URL指定的名字如果是/test那么客户端要找的数据对应的位置就在/haha目录下\ndocBase：web应用存放位置\n<Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\"\n               prefix=\"localhost_access_log\" suffix=\".txt\"\n               pattern=\"%h %l %u %t &quot;%r&quot; %s %b\" />\nDirectory：指定访问日志存放的位置，logs是相对路径，绝对路径为“/usr/local/tomcat/logs”\nPrefix：指定访问日志文件的前缀\nSuffix：指定访问日志文件的后缀\nPattern：指定日志文件的格式\n- %h：记录发送该请求的主机的IP地址，可能是客户端的IP，可能是代理服务器的IP（谁最终将请求交给tomcat，这里就是谁的IP）\n- %l：记录该请求使用的逻辑用户，如果没有就用-表示\n- %u：记录该请求的真实用户，如果没有则用-表示\n- %t：记录该请求的发送时间\n- %quot；：表示“”引号\n- %r：记录请求的请求行\n- %s：记录对该请求响应的状态码\t\n- %b：记录该请求相应的字节数\n- %D：记录该请求响应的时间，可以用来测试tomcat的性能\n```\n##### Tomcat多实例\n> 通过修改不同tomcat结点的配置文件中的端口来启动不同的tomcat实例\n\n示例一：\n```\ntar zxf apache-tomcat-8.5.33.tar.gz\ncp /root/apache-tomcat-8.5.33 /usr/local/tomcat\nsh /usr/local/tomcat/bin/startup.sh\t\t//启动第一个实例\nnetstat -anpt | grep java\t\t//查看到监听了三个端口8080、8005、8009\n```\n示例二：\n\n```\ncp /root/apache-tomcat-8.5.33 /usr/local/tomcat2\nvim /usr/local/tomcat2/conf/server.xml\n修改：\n<Server port=\"8006\" shutdown=\"SHUTDOWN\">\t\t//修改接收shutdown指令的端口\n<Connector port=\"8081\" protocol=\"HTTP/1.1\"\t\t//修改接收客户端请求的端口\n<Connector port=\"8010\" protocol=\"AJP/1.3\" redirectPort=\"8443\" />\t\t//修改接收其他web服务发送请求的端口\nsh /usr/local/tomcat2/bin/startup.sh\t\t//启动第二个实例\nnetstat -anpt | grep java\t\t//可以看到实例二所监听的端口8081、8006、8010\n```\n###### 验证：\n通过访问这两个tomcat节点，可以在这两个节点的站点目录下添加不同的文件来访问\n\n添加示例一测试文件：\n```\nmkdir /usr/local/tomcat/webapps/1\necho wo shi shi li yi > /usr/local/tomcat/webapps/1/1.jsp\n```\n添加示例二测试文件：\n```\nmkdir /usr/local/tomcat2/webapps/2\necho wo shi shi li er > /usr/local/tomcat2/webapps/2/2.jsp\n```\n访问：\n![upload successful](/images/timg2.png)\n\n##### Tomcat多虚拟主机\n\n在hosts文件中添加域名\n```java\n# vim /etc/hosts\n```\n![upload successful](/images/pasted-41.png)\n\n再一个tomcat实例中添加多个Host模块，匹配多个站点目录供客户端访问\n\n修改server.xml主配置文件\n```java\n# vim /usr/local/tomcat/conf/server.xml\n```\n![upload successful](/images/pasted-42.png)\n```java\n<Host name=\"www.one.com\" appBase=\"/one\"></Host>\t\t//客户端如果访问的url域名为www.one.com，则匹配的站点目录为/one\n        <Host name=\"www.two.com\" appBase=\"/two\">\t\t//客户端如果访问的url域名为www.two.com，则匹配的站点目录为/two\n        </Host>\n```\n重启服务\n```java\n# sh /usr/local/tomcat/bin/shutdown.sh && sh /usr/local/tomcat/bin/startup.sh\n```\n创建站点目录/one和/two，并添加web应用\n```java\n# mkdir -p /one/o\n# echo one > /one/o/aa.jsp\n# mkdir -p /two/t\n# echo two > /two/t/bb.jsp\n```\n在默认的webapps站点目录下创建目录cc，并添加web应用\n```java\n# mkdir /usr/local/tomcat/webapps/three\n# echo nin ben ci fang wen de ye mian lai zi zhan dian mu lu wei webapps xia > /usr/local/tomcat/webapps/three/cc.jsp\n```\n验证：\n\n```java\n# curl www.one.com:8080/o/aa.jsp\none\n# curl www.two.com:8080/t/bb.jsp\ntwo\n```\n访问www.three.com:8080/three/cc.jsp`（本次访问的url在配置文件中没有指定域名所对应的站点目录，所以访问该域名的内容来自tomcat默认的站点目录webapps下的three的web应用）`\n```java\n# curl www.three.com:8080/three/cc.jsp\nnin ben ci fang wen de ye mian lai zi zhan dian mu lu wei webapps xia\n```\n\n##### 自定义web应用的访问位置\n修改配置文件\n```java\n# vim /usr/local/tomcat/conf/server.xml\n```\n\n![upload successful](/images/pasted-44.png)\n> 如果客户端访问的url中域名为www.two.com则匹配到的站点目录为/two\n如果客户端访问的url中域名为www.two.com:8080/myself，则匹配的站点目录为/self\n\n重启服务\n```java\n# sh /usr/local/tomcat/bin/shutdown.sh && sh /usr/local/tomcat/bin/startup.sh\n\n```\n创建/self站点目录\n```java\n# mkdir /self\n# echo this is myself > /self/self.jsp\n```\n访问\n```java\n# curl www.two.com:8080/t/bb.jsp\ntwo\n# curl www.two.com:8080/myself/self.jsp\nmyself\n```\n##### 编写内存测试页面\n```java\nmkdir /one/memtest\nvim /one/memtest/meminfo.jsp\n<%\nRuntime rtm = Runtime.getRuntime();\t\t# 获取运行时间\nlong mm = rtm.maxMemory()/1024/1024;\t# 给JVM分配的最大内存\nlong tm = rtm.totalMemory()/1024/1024;\t# Java程序用掉的JVM内存\nlong fm = rtm.freeMemory()/1024/1024;\t# 给JVM分配完后剩余的内存\n\nout.println(\"memory info:<br>\");\nout.println(\"jvm max memory:\"+mm+\"MB\"+\"<br>\");\nout.println(\"jvm used:\"+tm+\"MB\"+\"<br>\");\nout.println(\"system free:\"+fm+\"MB\"+\"<br>\");\nout.println(\"can be used:\"+(mm+fm-tm)+\"MB\"+\"<br>\");\n%>\n```\n访问测试：\n\n![upload successful](/images/pasted-45.png)\n\n##### 远程监控tomcat性能\n编写脚本\n```java\n# vim /usr/local/tomcat/bin/catalina.sh\n添加：（309行）\nJAVA_OPTS=\"$JAVA_OPTS -Djava.rmi.server.hostname=1.1.1.1\"\t# 指定被连接的主机的IP/主机名/域名\nJAVA_OPTS=\"$JAVA_OPTS -Dcom.sun.management.jmxremote.port=9000\"\t# 指定被连接的主机的端口\nJAVA_OPTS=\"$JAVA_OPTS -Dcom.sun.management.jmxremote.authenticate=true\"\t# 指定连接时使用的身份验证\nJAVA_OPTS=\"$JAVA_OPTS -Dcom.sun.management.jmxremote.ssl=false\"\t# 指定连接时使用的身份验证\n```\n\n![upload successful](/images/pasted-46.png)\n\n设置用于远程连接的用户和密码\n```\n# cp /usr/local/java/jre/lib/management/jmxremote.password.template /usr/local/java/jre/lib/management/jmxremote.password\n# vim  /usr/local/java/jre/lib/management/jmxremote.password\n取消注释：\n 用户名\t\t  密码\nmonitorRole\t\t123456\ncontrolRole\t\t123456\n```\n\n对password文件提权\n```java\n# chmod 600 /usr/local/java/jre/lib/management/jmxremote.password\n```\n重启服务：\n```java\nsh /usr/local/tomcat/bin/shutdown.sh && /usr/local/tomcat/bin/startup.sh\n```\n\n![upload successful](/images/pasted-47.png)\n\n放行防火墙（不行就关闭防火墙）\n```java\n# firewall-cmd --add-port=8080/tcp\n# firewall-cmd --add-port=8005/tcp\n# firewall-cmd --add-port=8009/tcp\n# firewall-cmd --add-port=9000/tcp\n# setenforce 0\n```\n打开一台虚拟机（只需要部署JDK）\n\n远程连接\n\njconsole\n\n![upload successful](/images/pasted-48.png)\n\n![upload successful](/images/pasted-49.png)\n\n![upload successful](/images/pasted-50.png)\n\n##### 自定义错误页面\n\n初次访问一个不存在的错误页面结果\n\n![upload successful](/images/pasted-51.png)\n修改web页面配置文件\n```java\n# vim /usr/local/tomcat/conf/web.xml\n添加：（117行）\n<error-page>\n        <error-code>404</error-code>\n        <location>/notfound.jsp</location>\t# 指定错误页面的文件\n</error-page>\n```\n编写要返回给客户端的错误页面\n```java\n# vim /usr/local/tomcat/webapps/ROOT/notfound.jsp\nNot Found！\n```\n重启服务\n```java\n# cd /usr/local/tomcat/bin/\n# ./shutdown.sh\n# ./startup.sh\n```\n如提示报错：（显示地址被占用）\n\n![upload successful](/images/pasted-53.png)\n\n![upload successful](/images/pasted-54.png)\n\n直接杀死相关的进程号就OK！\n\nkill -9 50831\n\n再次关闭、启动就OK！\n\n测试访问：（访问一个不存在的页面）\n```java\n# curl 127.0.0.1:8080/zx.jsp\nNot Found!\n```\n\n##### 通过web页面来管理虚拟主机\n\n将打包好的web应用bdqnweb.war拷贝到宿主目录下\n\n![upload successful](/images/pasted-55.png)\n\n修改配置文件\n```java\n取消注释并设置可访问管理界面的用户（最后）\n# vim /usr/local/tomcat/conf/tomcat-users.xml\n<role rolename=\"admin-gui\"/>\t# 设置可以访问host-manager这个web应用的html的权限\n<role rolename=\"admin-script\"/>\t# 设置可以访问txt类型页面的权限\n<user username=\"aa\" password=\"123.com\" roles=\"admin-gui,admin-script\"/>\t# 添加用户aa密码为123.com，拥有admin-gui和admin-script两个权限\n```\n重启服务\n```java\n# sh /usr/local/tomcat/bin/shutdown.sh && sh /usr/local/tomcat/bin/startup.sh\n```\n验证\n\n>访问管理虚拟主机页面并添加虚拟主机\n```java\nfirefox 127.0.0.1:8080/host-manager\n```\n\n![upload successful](/images/pasted-56.png)\n\n![upload successful](/images/pasted-57.png)\n\n![upload successful](/images/pasted-58.png)\n创建www.test.com域名所对应的站点目录，并添加web应用\n```java\n# mkdir -p /test/app1\n# echo www.test.com > /test/app1/test.jsp\n```\n修改hosts文件添加域名\n```java\n# echo \"1.1.1.1 www.test.com\" >> /etc/hosts\n```\n验证：\n```java\n# curl www.test.com:8080/app1/test.jsp\nwww.test.com\n```\n设置允许其他地址访问`Host-manager管理界面`（`默认地址为127.0.0.1可访问`）\n\n><u>如果使用本机的物理IP访问**host-manager**管理界面是不可以访问的因为在配置文件中没有指定其他IP访问管理界面，所以在配置文件中可以指定其他IP允许访问管理界面</u>\n  \n```java\nvim /usr/local/tomcat/webapps/host-manager/META-INF/context.xml\n```\n\n![upload successful](/images/pasted-59.png)\n\n>在正则表达式里面“点”为任意所有的意思，所以在这里需要用“\\”这个符号进行转义（`^.*$代表允许所有地址可访问`）\n\n重启服务\n```java\n# sh /usr/local/tomcat/bin/shutdown.sh && sh /usr/local/tomcat/bin/startup.sh\n\n```\n验证\n```java\nfirefox 1.1.1.1:8080/host-manager\n```\n\n![upload successful](/images/pasted-60.png)\n\n![upload successful](/images/pasted-61.png)\n访问成功！！！\n\n><u>重启服务后在管理界面添加的虚拟主机域名会消失，因为重启后服务会读取配置文件中的数据，在管理界面添加的虚拟主机不记录在配置文件中，所以会消失，但是消失的虚拟主机所对应的数据还在，只是虚拟主机的域名不存在。</u>\n\n>访问manager控制界面（如果虚拟主机和发布web应用一起做的话一起修改tomcat-users配置文件，如果先做虚拟主机在做发布web应用中间在重启服务，虚拟主机就会消失，建议一起修改配置文件）\n\n在配置文件中3yy，p复制粘贴这三行并修改\n```java\nvim /usr/local/tomcat/conf/tomcat-users.xml\n<role rolename=\"manager-gui\"/>\t# 设置可以访问manager这个web应用的html权限\n<role rolename=\"manager-script\"/>\t# 设置可以访问txt类型页面的权限\n<user username=\"bb\" password=\"123.com\" roles=\"manager-gui,manager-script\"/>\t# 添加可以访问的用户bb，密码为123.聪明，拥有manager-gui和manager-script两个权限 \n```\n\n![upload successful](/images/pasted-62.png)\n重启服务\n```java\n# sh /usr/local/tomcat/bin/shutdown.sh && sh /usr/local/tomcat/bin/startup.sh\n```\n访问\n```java\nfirefox 127.0.0.1:8080/manager\n```\n\n![upload successful](/images/pasted-63.png)\n###### 第一种发布web应用方式\n\n![upload successful](/images/pasted-64.png)\n\n![upload successful](/images/pasted-65.png)\n\n![upload successful](/images/pasted-68.png)\n**发布成功后顶部显示OK**\n\n![upload successful](/images/pasted-69.png)\n\n当然在tomcat的默认站点目录webapps下会生成一个bdqnweb应用\n\n![upload successful](/images/pasted-70.png)\n\n访问bdqnweb应用\n```java\nfirefox 127.0.0.1:8080/bdqnweb/\n```\n\n![upload successful](/images/pasted-71.png)\n\n###### 第二种发布方式\n\n![upload successful](/images/pasted-72.png)\n**发布成功后顶部显示OK**\n\n\n![upload successful](/images/pasted-73.png)\n/hello不需要在webapps目录下提前创建，发布成功后会自动生成\n\n![upload successful](/images/pasted-74.png)\n访问\n```java\n# curl 127.0.0.1:8080/hello\nHello World!\n```\n设置允许其他地址访问**manager**管理界面（`默认地址为127.0.0.1可访问`）\n修改配置文件\n```java\nvim /usr/local/tomcat/webapps/manager/META-INF/context.xml\n```\n\n![upload successful](/images/pasted-75.png)\n\n**（^.*$代表允许所有地址可访问）**\n\n重启服务\n```java\n# sh /usr/local/tomcat/bin/shutdown.sh && sh /usr/local/tomcat/bin/startup.sh\n```\n验证访问\n\n![upload successful](/images/pasted-76.png)\n\n\n![upload successful](/images/pasted-77.png)\n\n##### JVM常用内存优化参数\n```java\n# vim /usr/local/tomcat/bin/catalina.sh\n添加：\nJAVA_OPTS=\"-server -Xms512M -Xmx512M -XX:NewSize=300M -XX:OldSize=100M -XX:SurvivorRatio=2\"\n-Xms512：指定JVM初始化分配的内存\n-Xmx512：指定JVM最大获取到的内存\n-XX:NewSize=300M：指定新生代的内存容量\n-XX:OldSize=100M：指定年老代的内存容量\n-XX:SurvivorRatio=2：指定Survivor与Eden的占比\n#-XX:PermSize：指定持久代的容量\n#-XX:PermMaxSize：指定持久代的最大容量\n#-XX:NewMaxSize：指定新生代的最大内存容量\n```\n指定线程池\n```java\n# vim /usr/local/tomcat/conf/server.xml\n修改：去掉注释（56行）\n指定线程池，名字为threadpool，最大可开启线程数量为150个，最下空闲进程数量4个\n    <Executor name=\"threadPool\" namePrefix=\"catalina-exec-\"\n        maxThreads=\"150\" minSpareThreads=\"4\"/>\n连接器引用指定名字对应的线程池\n    <Connector port=\"8080\" protocol=\"HTTP/1.1\"\n        executor=\"threadPool\"\n               connectionTimeout=\"20000\"\n               redirectPort=\"8443\" />\n```\n重启服务\n```java\n# sh /usr/local/tomcat/bin/shutdown.sh && sh /usr/local/tomcat/bin/startup.sh\n\n```\n验证访问\n```java\n# firefox www.new.com:8080/manager\n```\n\n![upload successful](/images/pasted-78.png)\n\n![upload successful](/images/pasted-79.png)\n","source":"_posts/Tomcat.md","raw":"title: Tomcat\nauthor: Semaik.\ntags:\n  - 微服务\ncategories:\n  - 微服务\ndate: 2020-09-18 19:02:00\n---\n##### Tomcat 是什么?\nTomcat 由JAVA语言开发的Java容器，实现了对 Servlet 和 JSP 的支持，并提供了作为Web服务器的一些特有功能，Tomcat是一种类似于IIS、Apache Http的Web服务端程序， Tomcat 本身也内含了一个 HTTP 服务器，它也可以被视作一个单独的 Web 服务器。也就是Web容器。\n\n\nServlet：是应用在服务端的小程序，由JAVA语言编写，本身支持各种JAVA相关的请求，但是大多用于接收web服务发来的请求，与数据库交互并将响应交给web服务\n\n\n\n\nJDK：JAVA开发工具包。\n\n常用工具：\n\n>Java：运行编译后的类文件\n\n>Jar：对类文件进行打包\n\n>Javac：对源文件中的注释提取文档\n\n>Jconsole：远程连接工具\n\n>Jre：JAVA运行环境\n\n##### 部署tomcat\n配置Java环境\n\n解压软件包\n```\n# tar zxf jdk-8u201-linux-x64.tar.gz\n```\n将jdk解压后的目录移动到/usr/local/起名为java\n```\n# mv /root/jdk1.8.0_201/ /usr/local/java\n```\n删除原先的旧java\n```\n# rm -rf /usr/bin/java\n```\n配置Java环境变量\n```\n# echo 'export JAVA_HOME=/usr/local/java\n# 设置jre（Jave Runtime Environment：java运行时环境）的安装目录变量\n> export JRE_HOME=/usr/local/java/jre/\n# 设置类文件路径，冒号代表加的意思，引用以上设置的变量\n> export CLASSPATH=$JAVA_HOME/lib:$JRE_HOME/lib\n# 最后一行，相当于windows系统的命令环境变量，就是新添了两个java以及jre的命令变量\n# $PATH代表原有的环境变量，使用变量复用\n> export PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin' >> /etc/profile\n```\n加载编写的profile文件\n```\n# source /etc/profile\n```\n查看版本号\n```\n# java -version\njava version \"1.8.0_201\"\nJava(TM) SE Runtime Environment (build 1.8.0_201-b09)\nJava HotSpot(TM) 64-Bit Server VM (build 25.201-b09, mixed mode)\n```\n安装Tomcat\n```\ntar zxf apache-tomcat-8.5.35.tar.gz \nmv apache-tomcat-8.5.35 /usr/local/tomcat\n```\n启动服务：`/usr/local/tomcat/bin/startup.sh`\n\n停止服务：`/usr/local/tomcat/bin/shutdown.sh`\n\n> 8080：接收客户端请求\n\n> 8005：用于接收shutdown指令\n\n> 8009：用于tomcat接受其他web服务发来的请求\n\nserver.xml主配置文件\n```\nvi /usr/local/tomcat/conf/server.xml\n<Server port=\"8005\" shutdown=\"SHUTDOWN\"></Server>\nport：server模块监听的端口号，可以自定义，只有端口号不冲突，为-1时表示不接受关闭指令\nshutdown：server模块接收到的参数指定的指令时就关闭tomcat程序\n\n<Service name=\"Catalina\"></Service>\nname：指定该servie的名字，可以有多个service通过名字来区分\n\n<Connector port=\"8080\" protocol=\"HTTP/1.1\"\n           connectionTimeout=\"20000\"\n           redirectPort=\"8443\" /></Connector>\n<Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\" />\nport：tomcat对客户端开放的端口号，8080是用于接收客户端发送的http请求，8009是用于tomcat接受其他web服务发来的请求\nprotocol：客户端连接tomcat使用的协议，AJP协议用于tomcat与其他web服务建立连接使用的\nconnectionTimeout：与tomcat的连接超时时间，单位毫秒\nredirectPort：当tomcat配置为https时，如果客户端仍然使用http协议访问，强制对客户端使用的协议转换为https，并将端口转换为8443\n\n<Engine name=\"Catalina\" defaultHost=\"localhost\"></Engine>\nname：该engine的名字，如果有多个service用来区分不同的引擎，并在日志中通过 名字进行标识\ndefault Host：引擎接受请求通过客户端请求的URL的IP/域名/主机名部分匹配Host模块，如果没有匹配到的则把请求交给defaultHost指定的主机处理，所以必须要有一个Host模块的主机名为defaultHost指定的名字\n\n<Host name=\"localhost\"  appBase=\"webapps\"\n          unpackWARs=\"true\" autoDeploy=\"true\">\n<Context path=”/test” docBase=”/haha”></Context>\n</Host>\nname：该host也就是虚拟主机对应的名字，用来engine对客户端访问的url中的主机部分进行匹配\nappBase：该虚拟主机对应的站点目录，webapps是一个相对路径，其绝对路径为“/usr/local/tomcat/webapps”\npath：客户端访问的URL指定的名字如果是/test那么客户端要找的数据对应的位置就在/haha目录下\ndocBase：web应用存放位置\n<Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\"\n               prefix=\"localhost_access_log\" suffix=\".txt\"\n               pattern=\"%h %l %u %t &quot;%r&quot; %s %b\" />\nDirectory：指定访问日志存放的位置，logs是相对路径，绝对路径为“/usr/local/tomcat/logs”\nPrefix：指定访问日志文件的前缀\nSuffix：指定访问日志文件的后缀\nPattern：指定日志文件的格式\n- %h：记录发送该请求的主机的IP地址，可能是客户端的IP，可能是代理服务器的IP（谁最终将请求交给tomcat，这里就是谁的IP）\n- %l：记录该请求使用的逻辑用户，如果没有就用-表示\n- %u：记录该请求的真实用户，如果没有则用-表示\n- %t：记录该请求的发送时间\n- %quot；：表示“”引号\n- %r：记录请求的请求行\n- %s：记录对该请求响应的状态码\t\n- %b：记录该请求相应的字节数\n- %D：记录该请求响应的时间，可以用来测试tomcat的性能\n```\n##### Tomcat多实例\n> 通过修改不同tomcat结点的配置文件中的端口来启动不同的tomcat实例\n\n示例一：\n```\ntar zxf apache-tomcat-8.5.33.tar.gz\ncp /root/apache-tomcat-8.5.33 /usr/local/tomcat\nsh /usr/local/tomcat/bin/startup.sh\t\t//启动第一个实例\nnetstat -anpt | grep java\t\t//查看到监听了三个端口8080、8005、8009\n```\n示例二：\n\n```\ncp /root/apache-tomcat-8.5.33 /usr/local/tomcat2\nvim /usr/local/tomcat2/conf/server.xml\n修改：\n<Server port=\"8006\" shutdown=\"SHUTDOWN\">\t\t//修改接收shutdown指令的端口\n<Connector port=\"8081\" protocol=\"HTTP/1.1\"\t\t//修改接收客户端请求的端口\n<Connector port=\"8010\" protocol=\"AJP/1.3\" redirectPort=\"8443\" />\t\t//修改接收其他web服务发送请求的端口\nsh /usr/local/tomcat2/bin/startup.sh\t\t//启动第二个实例\nnetstat -anpt | grep java\t\t//可以看到实例二所监听的端口8081、8006、8010\n```\n###### 验证：\n通过访问这两个tomcat节点，可以在这两个节点的站点目录下添加不同的文件来访问\n\n添加示例一测试文件：\n```\nmkdir /usr/local/tomcat/webapps/1\necho wo shi shi li yi > /usr/local/tomcat/webapps/1/1.jsp\n```\n添加示例二测试文件：\n```\nmkdir /usr/local/tomcat2/webapps/2\necho wo shi shi li er > /usr/local/tomcat2/webapps/2/2.jsp\n```\n访问：\n![upload successful](/images/timg2.png)\n\n##### Tomcat多虚拟主机\n\n在hosts文件中添加域名\n```java\n# vim /etc/hosts\n```\n![upload successful](/images/pasted-41.png)\n\n再一个tomcat实例中添加多个Host模块，匹配多个站点目录供客户端访问\n\n修改server.xml主配置文件\n```java\n# vim /usr/local/tomcat/conf/server.xml\n```\n![upload successful](/images/pasted-42.png)\n```java\n<Host name=\"www.one.com\" appBase=\"/one\"></Host>\t\t//客户端如果访问的url域名为www.one.com，则匹配的站点目录为/one\n        <Host name=\"www.two.com\" appBase=\"/two\">\t\t//客户端如果访问的url域名为www.two.com，则匹配的站点目录为/two\n        </Host>\n```\n重启服务\n```java\n# sh /usr/local/tomcat/bin/shutdown.sh && sh /usr/local/tomcat/bin/startup.sh\n```\n创建站点目录/one和/two，并添加web应用\n```java\n# mkdir -p /one/o\n# echo one > /one/o/aa.jsp\n# mkdir -p /two/t\n# echo two > /two/t/bb.jsp\n```\n在默认的webapps站点目录下创建目录cc，并添加web应用\n```java\n# mkdir /usr/local/tomcat/webapps/three\n# echo nin ben ci fang wen de ye mian lai zi zhan dian mu lu wei webapps xia > /usr/local/tomcat/webapps/three/cc.jsp\n```\n验证：\n\n```java\n# curl www.one.com:8080/o/aa.jsp\none\n# curl www.two.com:8080/t/bb.jsp\ntwo\n```\n访问www.three.com:8080/three/cc.jsp`（本次访问的url在配置文件中没有指定域名所对应的站点目录，所以访问该域名的内容来自tomcat默认的站点目录webapps下的three的web应用）`\n```java\n# curl www.three.com:8080/three/cc.jsp\nnin ben ci fang wen de ye mian lai zi zhan dian mu lu wei webapps xia\n```\n\n##### 自定义web应用的访问位置\n修改配置文件\n```java\n# vim /usr/local/tomcat/conf/server.xml\n```\n\n![upload successful](/images/pasted-44.png)\n> 如果客户端访问的url中域名为www.two.com则匹配到的站点目录为/two\n如果客户端访问的url中域名为www.two.com:8080/myself，则匹配的站点目录为/self\n\n重启服务\n```java\n# sh /usr/local/tomcat/bin/shutdown.sh && sh /usr/local/tomcat/bin/startup.sh\n\n```\n创建/self站点目录\n```java\n# mkdir /self\n# echo this is myself > /self/self.jsp\n```\n访问\n```java\n# curl www.two.com:8080/t/bb.jsp\ntwo\n# curl www.two.com:8080/myself/self.jsp\nmyself\n```\n##### 编写内存测试页面\n```java\nmkdir /one/memtest\nvim /one/memtest/meminfo.jsp\n<%\nRuntime rtm = Runtime.getRuntime();\t\t# 获取运行时间\nlong mm = rtm.maxMemory()/1024/1024;\t# 给JVM分配的最大内存\nlong tm = rtm.totalMemory()/1024/1024;\t# Java程序用掉的JVM内存\nlong fm = rtm.freeMemory()/1024/1024;\t# 给JVM分配完后剩余的内存\n\nout.println(\"memory info:<br>\");\nout.println(\"jvm max memory:\"+mm+\"MB\"+\"<br>\");\nout.println(\"jvm used:\"+tm+\"MB\"+\"<br>\");\nout.println(\"system free:\"+fm+\"MB\"+\"<br>\");\nout.println(\"can be used:\"+(mm+fm-tm)+\"MB\"+\"<br>\");\n%>\n```\n访问测试：\n\n![upload successful](/images/pasted-45.png)\n\n##### 远程监控tomcat性能\n编写脚本\n```java\n# vim /usr/local/tomcat/bin/catalina.sh\n添加：（309行）\nJAVA_OPTS=\"$JAVA_OPTS -Djava.rmi.server.hostname=1.1.1.1\"\t# 指定被连接的主机的IP/主机名/域名\nJAVA_OPTS=\"$JAVA_OPTS -Dcom.sun.management.jmxremote.port=9000\"\t# 指定被连接的主机的端口\nJAVA_OPTS=\"$JAVA_OPTS -Dcom.sun.management.jmxremote.authenticate=true\"\t# 指定连接时使用的身份验证\nJAVA_OPTS=\"$JAVA_OPTS -Dcom.sun.management.jmxremote.ssl=false\"\t# 指定连接时使用的身份验证\n```\n\n![upload successful](/images/pasted-46.png)\n\n设置用于远程连接的用户和密码\n```\n# cp /usr/local/java/jre/lib/management/jmxremote.password.template /usr/local/java/jre/lib/management/jmxremote.password\n# vim  /usr/local/java/jre/lib/management/jmxremote.password\n取消注释：\n 用户名\t\t  密码\nmonitorRole\t\t123456\ncontrolRole\t\t123456\n```\n\n对password文件提权\n```java\n# chmod 600 /usr/local/java/jre/lib/management/jmxremote.password\n```\n重启服务：\n```java\nsh /usr/local/tomcat/bin/shutdown.sh && /usr/local/tomcat/bin/startup.sh\n```\n\n![upload successful](/images/pasted-47.png)\n\n放行防火墙（不行就关闭防火墙）\n```java\n# firewall-cmd --add-port=8080/tcp\n# firewall-cmd --add-port=8005/tcp\n# firewall-cmd --add-port=8009/tcp\n# firewall-cmd --add-port=9000/tcp\n# setenforce 0\n```\n打开一台虚拟机（只需要部署JDK）\n\n远程连接\n\njconsole\n\n![upload successful](/images/pasted-48.png)\n\n![upload successful](/images/pasted-49.png)\n\n![upload successful](/images/pasted-50.png)\n\n##### 自定义错误页面\n\n初次访问一个不存在的错误页面结果\n\n![upload successful](/images/pasted-51.png)\n修改web页面配置文件\n```java\n# vim /usr/local/tomcat/conf/web.xml\n添加：（117行）\n<error-page>\n        <error-code>404</error-code>\n        <location>/notfound.jsp</location>\t# 指定错误页面的文件\n</error-page>\n```\n编写要返回给客户端的错误页面\n```java\n# vim /usr/local/tomcat/webapps/ROOT/notfound.jsp\nNot Found！\n```\n重启服务\n```java\n# cd /usr/local/tomcat/bin/\n# ./shutdown.sh\n# ./startup.sh\n```\n如提示报错：（显示地址被占用）\n\n![upload successful](/images/pasted-53.png)\n\n![upload successful](/images/pasted-54.png)\n\n直接杀死相关的进程号就OK！\n\nkill -9 50831\n\n再次关闭、启动就OK！\n\n测试访问：（访问一个不存在的页面）\n```java\n# curl 127.0.0.1:8080/zx.jsp\nNot Found!\n```\n\n##### 通过web页面来管理虚拟主机\n\n将打包好的web应用bdqnweb.war拷贝到宿主目录下\n\n![upload successful](/images/pasted-55.png)\n\n修改配置文件\n```java\n取消注释并设置可访问管理界面的用户（最后）\n# vim /usr/local/tomcat/conf/tomcat-users.xml\n<role rolename=\"admin-gui\"/>\t# 设置可以访问host-manager这个web应用的html的权限\n<role rolename=\"admin-script\"/>\t# 设置可以访问txt类型页面的权限\n<user username=\"aa\" password=\"123.com\" roles=\"admin-gui,admin-script\"/>\t# 添加用户aa密码为123.com，拥有admin-gui和admin-script两个权限\n```\n重启服务\n```java\n# sh /usr/local/tomcat/bin/shutdown.sh && sh /usr/local/tomcat/bin/startup.sh\n```\n验证\n\n>访问管理虚拟主机页面并添加虚拟主机\n```java\nfirefox 127.0.0.1:8080/host-manager\n```\n\n![upload successful](/images/pasted-56.png)\n\n![upload successful](/images/pasted-57.png)\n\n![upload successful](/images/pasted-58.png)\n创建www.test.com域名所对应的站点目录，并添加web应用\n```java\n# mkdir -p /test/app1\n# echo www.test.com > /test/app1/test.jsp\n```\n修改hosts文件添加域名\n```java\n# echo \"1.1.1.1 www.test.com\" >> /etc/hosts\n```\n验证：\n```java\n# curl www.test.com:8080/app1/test.jsp\nwww.test.com\n```\n设置允许其他地址访问`Host-manager管理界面`（`默认地址为127.0.0.1可访问`）\n\n><u>如果使用本机的物理IP访问**host-manager**管理界面是不可以访问的因为在配置文件中没有指定其他IP访问管理界面，所以在配置文件中可以指定其他IP允许访问管理界面</u>\n  \n```java\nvim /usr/local/tomcat/webapps/host-manager/META-INF/context.xml\n```\n\n![upload successful](/images/pasted-59.png)\n\n>在正则表达式里面“点”为任意所有的意思，所以在这里需要用“\\”这个符号进行转义（`^.*$代表允许所有地址可访问`）\n\n重启服务\n```java\n# sh /usr/local/tomcat/bin/shutdown.sh && sh /usr/local/tomcat/bin/startup.sh\n\n```\n验证\n```java\nfirefox 1.1.1.1:8080/host-manager\n```\n\n![upload successful](/images/pasted-60.png)\n\n![upload successful](/images/pasted-61.png)\n访问成功！！！\n\n><u>重启服务后在管理界面添加的虚拟主机域名会消失，因为重启后服务会读取配置文件中的数据，在管理界面添加的虚拟主机不记录在配置文件中，所以会消失，但是消失的虚拟主机所对应的数据还在，只是虚拟主机的域名不存在。</u>\n\n>访问manager控制界面（如果虚拟主机和发布web应用一起做的话一起修改tomcat-users配置文件，如果先做虚拟主机在做发布web应用中间在重启服务，虚拟主机就会消失，建议一起修改配置文件）\n\n在配置文件中3yy，p复制粘贴这三行并修改\n```java\nvim /usr/local/tomcat/conf/tomcat-users.xml\n<role rolename=\"manager-gui\"/>\t# 设置可以访问manager这个web应用的html权限\n<role rolename=\"manager-script\"/>\t# 设置可以访问txt类型页面的权限\n<user username=\"bb\" password=\"123.com\" roles=\"manager-gui,manager-script\"/>\t# 添加可以访问的用户bb，密码为123.聪明，拥有manager-gui和manager-script两个权限 \n```\n\n![upload successful](/images/pasted-62.png)\n重启服务\n```java\n# sh /usr/local/tomcat/bin/shutdown.sh && sh /usr/local/tomcat/bin/startup.sh\n```\n访问\n```java\nfirefox 127.0.0.1:8080/manager\n```\n\n![upload successful](/images/pasted-63.png)\n###### 第一种发布web应用方式\n\n![upload successful](/images/pasted-64.png)\n\n![upload successful](/images/pasted-65.png)\n\n![upload successful](/images/pasted-68.png)\n**发布成功后顶部显示OK**\n\n![upload successful](/images/pasted-69.png)\n\n当然在tomcat的默认站点目录webapps下会生成一个bdqnweb应用\n\n![upload successful](/images/pasted-70.png)\n\n访问bdqnweb应用\n```java\nfirefox 127.0.0.1:8080/bdqnweb/\n```\n\n![upload successful](/images/pasted-71.png)\n\n###### 第二种发布方式\n\n![upload successful](/images/pasted-72.png)\n**发布成功后顶部显示OK**\n\n\n![upload successful](/images/pasted-73.png)\n/hello不需要在webapps目录下提前创建，发布成功后会自动生成\n\n![upload successful](/images/pasted-74.png)\n访问\n```java\n# curl 127.0.0.1:8080/hello\nHello World!\n```\n设置允许其他地址访问**manager**管理界面（`默认地址为127.0.0.1可访问`）\n修改配置文件\n```java\nvim /usr/local/tomcat/webapps/manager/META-INF/context.xml\n```\n\n![upload successful](/images/pasted-75.png)\n\n**（^.*$代表允许所有地址可访问）**\n\n重启服务\n```java\n# sh /usr/local/tomcat/bin/shutdown.sh && sh /usr/local/tomcat/bin/startup.sh\n```\n验证访问\n\n![upload successful](/images/pasted-76.png)\n\n\n![upload successful](/images/pasted-77.png)\n\n##### JVM常用内存优化参数\n```java\n# vim /usr/local/tomcat/bin/catalina.sh\n添加：\nJAVA_OPTS=\"-server -Xms512M -Xmx512M -XX:NewSize=300M -XX:OldSize=100M -XX:SurvivorRatio=2\"\n-Xms512：指定JVM初始化分配的内存\n-Xmx512：指定JVM最大获取到的内存\n-XX:NewSize=300M：指定新生代的内存容量\n-XX:OldSize=100M：指定年老代的内存容量\n-XX:SurvivorRatio=2：指定Survivor与Eden的占比\n#-XX:PermSize：指定持久代的容量\n#-XX:PermMaxSize：指定持久代的最大容量\n#-XX:NewMaxSize：指定新生代的最大内存容量\n```\n指定线程池\n```java\n# vim /usr/local/tomcat/conf/server.xml\n修改：去掉注释（56行）\n指定线程池，名字为threadpool，最大可开启线程数量为150个，最下空闲进程数量4个\n    <Executor name=\"threadPool\" namePrefix=\"catalina-exec-\"\n        maxThreads=\"150\" minSpareThreads=\"4\"/>\n连接器引用指定名字对应的线程池\n    <Connector port=\"8080\" protocol=\"HTTP/1.1\"\n        executor=\"threadPool\"\n               connectionTimeout=\"20000\"\n               redirectPort=\"8443\" />\n```\n重启服务\n```java\n# sh /usr/local/tomcat/bin/shutdown.sh && sh /usr/local/tomcat/bin/startup.sh\n\n```\n验证访问\n```java\n# firefox www.new.com:8080/manager\n```\n\n![upload successful](/images/pasted-78.png)\n\n![upload successful](/images/pasted-79.png)\n","slug":"Tomcat","published":1,"updated":"2020-09-25T02:52:13.964Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh2r737w0033m3pvczad2s9l","content":"<h5 id=\"Tomcat-是什么\"><a href=\"#Tomcat-是什么\" class=\"headerlink\" title=\"Tomcat 是什么?\"></a>Tomcat 是什么?</h5><p>Tomcat 由JAVA语言开发的Java容器，实现了对 Servlet 和 JSP 的支持，并提供了作为Web服务器的一些特有功能，Tomcat是一种类似于IIS、Apache Http的Web服务端程序， Tomcat 本身也内含了一个 HTTP 服务器，它也可以被视作一个单独的 Web 服务器。也就是Web容器。</p>\n<p>Servlet：是应用在服务端的小程序，由JAVA语言编写，本身支持各种JAVA相关的请求，但是大多用于接收web服务发来的请求，与数据库交互并将响应交给web服务</p>\n<p>JDK：JAVA开发工具包。</p>\n<p>常用工具：</p>\n<blockquote>\n<p>Java：运行编译后的类文件</p>\n</blockquote>\n<blockquote>\n<p>Jar：对类文件进行打包</p>\n</blockquote>\n<blockquote>\n<p>Javac：对源文件中的注释提取文档</p>\n</blockquote>\n<blockquote>\n<p>Jconsole：远程连接工具</p>\n</blockquote>\n<blockquote>\n<p>Jre：JAVA运行环境</p>\n</blockquote>\n<h5 id=\"部署tomcat\"><a href=\"#部署tomcat\" class=\"headerlink\" title=\"部署tomcat\"></a>部署tomcat</h5><p>配置Java环境</p>\n<p>解压软件包</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># <span class=\"selector-tag\">tar</span> <span class=\"selector-tag\">zxf</span> <span class=\"selector-tag\">jdk-8u201-linux-x64</span><span class=\"selector-class\">.tar</span><span class=\"selector-class\">.gz</span></span><br></pre></td></tr></table></figure>\n<p>将jdk解压后的目录移动到/usr/local/起名为java</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mv <span class=\"regexp\">/root/</span>jdk1.<span class=\"number\">8.0</span>_201<span class=\"regexp\">/ /u</span>sr<span class=\"regexp\">/local/</span>java</span><br></pre></td></tr></table></figure>\n<p>删除原先的旧java</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># rm -rf <span class=\"regexp\">/usr/</span>bin/java</span><br></pre></td></tr></table></figure>\n<p>配置Java环境变量</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># echo &#x27;export JAVA_HOME=/usr/local/java</span></span><br><span class=\"line\"><span class=\"comment\"># 设置jre（Jave Runtime Environment：java运行时环境）的安装目录变量</span></span><br><span class=\"line\">&gt; <span class=\"builtin-name\">export</span> <span class=\"attribute\">JRE_HOME</span>=/usr/local/java/jre/</span><br><span class=\"line\"><span class=\"comment\"># 设置类文件路径，冒号代表加的意思，引用以上设置的变量</span></span><br><span class=\"line\">&gt; <span class=\"builtin-name\">export</span> <span class=\"attribute\">CLASSPATH</span>=<span class=\"variable\">$JAVA_HOME</span>/lib:$JRE_HOME/lib</span><br><span class=\"line\"><span class=\"comment\"># 最后一行，相当于windows系统的命令环境变量，就是新添了两个java以及jre的命令变量</span></span><br><span class=\"line\"><span class=\"comment\"># $PATH代表原有的环境变量，使用变量复用</span></span><br><span class=\"line\">&gt; <span class=\"builtin-name\">export</span> <span class=\"attribute\">PATH</span>=<span class=\"variable\">$PATH</span>:$JAVA_HOME/bin:$JRE_HOME/bin&#x27; &gt;&gt; /etc/profile</span><br></pre></td></tr></table></figure>\n<p>加载编写的profile文件</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># <span class=\"keyword\">source</span> <span class=\"regexp\">/etc/</span>profile</span><br></pre></td></tr></table></figure>\n<p>查看版本号</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># java -version</span></span><br><span class=\"line\">java version <span class=\"string\">&quot;1.8.0_201&quot;</span></span><br><span class=\"line\">Java(TM) SE Runtime Environment (build 1.8.0_201-b09)</span><br><span class=\"line\">Java HotSpot(TM) 64-Bit<span class=\"built_in\"> Server </span>VM (build 25.201-b09, mixed mode)</span><br></pre></td></tr></table></figure>\n<p>安装Tomcat</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">tar</span> zxf apache-tomcat-<span class=\"number\">8</span>.<span class=\"number\">5</span>.<span class=\"number\">35</span>.tar.gz </span><br><span class=\"line\"><span class=\"attribute\">mv</span> apache-tomcat-<span class=\"number\">8</span>.<span class=\"number\">5</span>.<span class=\"number\">35</span> /usr/local/tomcat</span><br></pre></td></tr></table></figure>\n<p>启动服务：<code>/usr/local/tomcat/bin/startup.sh</code></p>\n<p>停止服务：<code>/usr/local/tomcat/bin/shutdown.sh</code></p>\n<blockquote>\n<p>8080：接收客户端请求</p>\n</blockquote>\n<blockquote>\n<p>8005：用于接收shutdown指令</p>\n</blockquote>\n<blockquote>\n<p>8009：用于tomcat接受其他web服务发来的请求</p>\n</blockquote>\n<p>server.xml主配置文件</p>\n<figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /usr/local/tomcat/conf/server.xml</span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Server</span> <span class=\"attr\">port</span>=<span class=\"string\">&quot;8005&quot;</span> <span class=\"attr\">shutdown</span>=<span class=\"string\">&quot;SHUTDOWN&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Server</span>&gt;</span></span></span><br><span class=\"line\">port：server模块监听的端口号，可以自定义，只有端口号不冲突，为-<span class=\"number\">1</span>时表示不接受关闭指令</span><br><span class=\"line\">shutdown：server模块接收到的参数指定的指令时就关闭tomcat程序</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Service</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Catalina&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Service</span>&gt;</span></span></span><br><span class=\"line\">name：指定该servie的名字，可以有多个service通过名字来区分</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;Connector port=<span class=\"string\">&quot;8080&quot;</span> protocol=<span class=\"string\">&quot;HTTP/1.1&quot;</span></span><br><span class=\"line\">           connectionTimeout=<span class=\"string\">&quot;20000&quot;</span></span><br><span class=\"line\">           redirectPort=<span class=\"string\">&quot;8443&quot;</span> /&gt;&lt;/Connector&gt;</span><br><span class=\"line\">&lt;Connector port=<span class=\"string\">&quot;8009&quot;</span> protocol=<span class=\"string\">&quot;AJP/1.3&quot;</span> redirectPort=<span class=\"string\">&quot;8443&quot;</span> /&gt;</span><br><span class=\"line\">port：tomcat对客户端开放的端口号，<span class=\"number\">8080</span>是用于接收客户端发送的http请求，<span class=\"number\">8009</span>是用于tomcat接受其他web服务发来的请求</span><br><span class=\"line\">protocol：客户端连接tomcat使用的协议，AJP协议用于tomcat与其他web服务建立连接使用的</span><br><span class=\"line\">connectionTimeout：与tomcat的连接超时时间，单位毫秒</span><br><span class=\"line\">redirectPort：当tomcat配置为https时，如果客户端仍然使用http协议访问，强制对客户端使用的协议转换为https，并将端口转换为<span class=\"number\">8443</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Engine</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Catalina&quot;</span> <span class=\"attr\">defaultHost</span>=<span class=\"string\">&quot;localhost&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Engine</span>&gt;</span></span></span><br><span class=\"line\">name：该engine的名字，如果有多个service用来区分不同的引擎，并在日志中通过 名字进行标识</span><br><span class=\"line\"><span class=\"keyword\">default</span> Host：引擎接受请求通过客户端请求的URL的IP/域名/主机名部分匹配Host模块，如果没有匹配到的则把请求交给defaultHost指定的主机处理，所以必须要有一个Host模块的主机名为defaultHost指定的名字</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;Host<span class=\"built_in\"> name</span>=<span class=\"string\">&quot;localhost&quot;</span>  appBase=<span class=\"string\">&quot;webapps&quot;</span></span><br><span class=\"line\">          unpackWARs=<span class=\"string\">&quot;true&quot;</span> autoDeploy=<span class=\"string\">&quot;true&quot;</span>&gt;</span><br><span class=\"line\">&lt;Context<span class=\"built_in\"> path</span>=”/test” docBase=”/haha”&gt;&lt;/Context&gt;</span><br><span class=\"line\">&lt;/Host&gt;</span><br><span class=\"line\">name：该host也就是虚拟主机对应的名字，用来engine对客户端访问的url中的主机部分进行匹配</span><br><span class=\"line\">appBase：该虚拟主机对应的站点目录，webapps是一个相对路径，其绝对路径为“/usr/local/tomcat/webapps”</span><br><span class=\"line\">path：客户端访问的URL指定的名字如果是/test那么客户端要找的数据对应的位置就在/haha目录下</span><br><span class=\"line\">docBase：web应用存放位置</span><br><span class=\"line\">&lt;Valve className=<span class=\"string\">&quot;org.apache.catalina.valves.AccessLogValve&quot;</span> directory=<span class=\"string\">&quot;logs&quot;</span></span><br><span class=\"line\">               prefix=<span class=\"string\">&quot;localhost_access_log&quot;</span> suffix=<span class=\"string\">&quot;.txt&quot;</span></span><br><span class=\"line\">               pattern=<span class=\"string\">&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot;</span> /&gt;</span><br><span class=\"line\">Directory：指定访问日志存放的位置，logs是相对路径，绝对路径为“/usr/local/tomcat/logs”</span><br><span class=\"line\">Prefix：指定访问日志文件的前缀</span><br><span class=\"line\">Suffix：指定访问日志文件的后缀</span><br><span class=\"line\">Pattern：指定日志文件的格式</span><br><span class=\"line\">- <span class=\"meta\">%h</span>：记录发送该请求的主机的IP地址，可能是客户端的IP，可能是代理服务器的IP（谁最终将请求交给tomcat，这里就是谁的IP）</span><br><span class=\"line\">- <span class=\"meta\">%l</span>：记录该请求使用的逻辑用户，如果没有就用-表示</span><br><span class=\"line\">- <span class=\"meta\">%u</span>：记录该请求的真实用户，如果没有则用-表示</span><br><span class=\"line\">- <span class=\"meta\">%t</span>：记录该请求的发送时间</span><br><span class=\"line\">- <span class=\"meta\">%quot</span>；：表示“”引号</span><br><span class=\"line\">- <span class=\"meta\">%r</span>：记录请求的请求行</span><br><span class=\"line\">- <span class=\"meta\">%s</span>：记录对该请求响应的状态码\t</span><br><span class=\"line\">- <span class=\"meta\">%b</span>：记录该请求相应的字节数</span><br><span class=\"line\">- <span class=\"meta\">%D</span>：记录该请求响应的时间，可以用来测试tomcat的性能</span><br></pre></td></tr></table></figure>\n<h5 id=\"Tomcat多实例\"><a href=\"#Tomcat多实例\" class=\"headerlink\" title=\"Tomcat多实例\"></a>Tomcat多实例</h5><blockquote>\n<p>通过修改不同tomcat结点的配置文件中的端口来启动不同的tomcat实例</p>\n</blockquote>\n<p>示例一：</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">tar</span> zxf apache-tomcat-<span class=\"number\">8</span>.<span class=\"number\">5</span>.<span class=\"number\">33</span>.tar.gz</span><br><span class=\"line\"><span class=\"attribute\">cp</span> /root/apache-tomcat-<span class=\"number\">8</span>.<span class=\"number\">5</span>.<span class=\"number\">33</span> /usr/local/tomcat</span><br><span class=\"line\"><span class=\"attribute\">sh</span> /usr/local/tomcat/bin/startup.sh\t\t//启动第一个实例</span><br><span class=\"line\"><span class=\"attribute\">netstat</span> -anpt | grep java\t\t//查看到监听了三个端口<span class=\"number\">8080</span>、<span class=\"number\">8005</span>、<span class=\"number\">8009</span></span><br></pre></td></tr></table></figure>\n<p>示例二：</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp <span class=\"regexp\">/root/</span>apache-tomcat<span class=\"number\">-8.5</span><span class=\"number\">.33</span> <span class=\"regexp\">/usr/</span>local/tomcat2</span><br><span class=\"line\">vim <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/tomcat2/</span>conf/server.xml</span><br><span class=\"line\">修改：</span><br><span class=\"line\">&lt;Server port=<span class=\"string\">&quot;8006&quot;</span> shutdown=<span class=\"string\">&quot;SHUTDOWN&quot;</span>&gt;\t\t<span class=\"comment\">//修改接收shutdown指令的端口</span></span><br><span class=\"line\">&lt;Connector port=<span class=\"string\">&quot;8081&quot;</span> protocol=<span class=\"string\">&quot;HTTP/1.1&quot;</span>\t\t<span class=\"comment\">//修改接收客户端请求的端口</span></span><br><span class=\"line\">&lt;Connector port=<span class=\"string\">&quot;8010&quot;</span> protocol=<span class=\"string\">&quot;AJP/1.3&quot;</span> redirectPort=<span class=\"string\">&quot;8443&quot;</span> <span class=\"regexp\">/&gt;\t\t/</span>/修改接收其他web服务发送请求的端口</span><br><span class=\"line\">sh <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/tomcat2/</span>bin<span class=\"regexp\">/startup.sh\t\t/</span>/启动第二个实例</span><br><span class=\"line\">netstat -anpt | grep java\t\t<span class=\"comment\">//可以看到实例二所监听的端口8081、8006、8010</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"验证：\"><a href=\"#验证：\" class=\"headerlink\" title=\"验证：\"></a>验证：</h6><p>通过访问这两个tomcat节点，可以在这两个节点的站点目录下添加不同的文件来访问</p>\n<p>添加示例一测试文件：</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/tomcat/</span>webapps/<span class=\"number\">1</span></span><br><span class=\"line\">echo wo shi shi li yi &gt; <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/tomcat/</span>webapps<span class=\"regexp\">/1/</span><span class=\"number\">1</span>.jsp</span><br></pre></td></tr></table></figure>\n<p>添加示例二测试文件：</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/tomcat2/</span>webapps/<span class=\"number\">2</span></span><br><span class=\"line\">echo wo shi shi li er &gt; <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/tomcat2/</span>webapps<span class=\"regexp\">/2/</span><span class=\"number\">2</span>.jsp</span><br></pre></td></tr></table></figure>\n<p>访问：<br><img src=\"/images/timg2.png\" alt=\"upload successful\"></p>\n<h5 id=\"Tomcat多虚拟主机\"><a href=\"#Tomcat多虚拟主机\" class=\"headerlink\" title=\"Tomcat多虚拟主机\"></a>Tomcat多虚拟主机</h5><p>在hosts文件中添加域名</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /etc/hosts</span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/pasted-41.png\" alt=\"upload successful\"></p>\n<p>再一个tomcat实例中添加多个Host模块，匹配多个站点目录供客户端访问</p>\n<p>修改server.xml主配置文件</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /usr/local/tomcat/conf/server.xml</span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/pasted-42.png\" alt=\"upload successful\"></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Host name=&quot;www.one.com&quot; appBase=&quot;/one&quot;&gt;&lt;/Host&gt;\t\t//客户端如果访问的url域名为www.one.com，则匹配的站点目录为/one</span><br><span class=\"line\">        &lt;Host name=<span class=\"string\">&quot;www.two.com&quot;</span> appBase=<span class=\"string\">&quot;/two&quot;</span>&gt;\t\t<span class=\"comment\">//客户端如果访问的url域名为www.two.com，则匹配的站点目录为/two</span></span><br><span class=\"line\">        &lt;/Host&gt;</span><br></pre></td></tr></table></figure>\n<p>重启服务</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sh /usr/local/tomcat/bin/shutdown.sh &amp;&amp; sh /usr/local/tomcat/bin/startup.sh</span><br></pre></td></tr></table></figure>\n<p>创建站点目录/one和/two，并添加web应用</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mkdir -p /one/o</span><br><span class=\"line\"># echo one &gt; /one/o/aa.jsp</span><br><span class=\"line\"># mkdir -p /two/t</span><br><span class=\"line\"># echo two &gt; /two/t/bb.jsp</span><br></pre></td></tr></table></figure>\n<p>在默认的webapps站点目录下创建目录cc，并添加web应用</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mkdir /usr/local/tomcat/webapps/three</span><br><span class=\"line\"># echo nin ben ci fang wen de ye mian lai zi zhan dian mu lu wei webapps xia &gt; /usr/local/tomcat/webapps/three/cc.jsp</span><br></pre></td></tr></table></figure>\n<p>验证：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># curl www.one.com:8080/o/aa.jsp</span><br><span class=\"line\">one</span><br><span class=\"line\"># curl www.two.com:8080/t/bb.jsp</span><br><span class=\"line\">two</span><br></pre></td></tr></table></figure>\n<p>访问<a href=\"http://www.three.com:8080/three/cc.jsp%60%EF%BC%88%E6%9C%AC%E6%AC%A1%E8%AE%BF%E9%97%AE%E7%9A%84url%E5%9C%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9A%E5%9F%9F%E5%90%8D%E6%89%80%E5%AF%B9%E5%BA%94%E7%9A%84%E7%AB%99%E7%82%B9%E7%9B%AE%E5%BD%95%EF%BC%8C%E6%89%80%E4%BB%A5%E8%AE%BF%E9%97%AE%E8%AF%A5%E5%9F%9F%E5%90%8D%E7%9A%84%E5%86%85%E5%AE%B9%E6%9D%A5%E8%87%AAtomcat%E9%BB%98%E8%AE%A4%E7%9A%84%E7%AB%99%E7%82%B9%E7%9B%AE%E5%BD%95webapps%E4%B8%8B%E7%9A%84three%E7%9A%84web%E5%BA%94%E7%94%A8%EF%BC%89%60\">www.three.com:8080/three/cc.jsp`（本次访问的url在配置文件中没有指定域名所对应的站点目录，所以访问该域名的内容来自tomcat默认的站点目录webapps下的three的web应用）`</a></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># curl www.three.com:8080/three/cc.jsp</span><br><span class=\"line\">nin ben ci fang wen de ye mian lai zi zhan dian mu lu wei webapps xia</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"自定义web应用的访问位置\"><a href=\"#自定义web应用的访问位置\" class=\"headerlink\" title=\"自定义web应用的访问位置\"></a>自定义web应用的访问位置</h5><p>修改配置文件</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /usr/local/tomcat/conf/server.xml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-44.png\" alt=\"upload successful\"></p>\n<blockquote>\n<p>如果客户端访问的url中域名为<a href=\"http://www.two.com则匹配到的站点目录为/two\">www.two.com则匹配到的站点目录为/two</a><br>如果客户端访问的url中域名为<a href=\"http://www.two.com:8080/myself%EF%BC%8C%E5%88%99%E5%8C%B9%E9%85%8D%E7%9A%84%E7%AB%99%E7%82%B9%E7%9B%AE%E5%BD%95%E4%B8%BA/self\">www.two.com:8080/myself，则匹配的站点目录为/self</a></p>\n</blockquote>\n<p>重启服务</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sh /usr/local/tomcat/bin/shutdown.sh &amp;&amp; sh /usr/local/tomcat/bin/startup.sh</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>创建/self站点目录</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mkdir /self</span><br><span class=\"line\"># echo this is myself &gt; /self/self.jsp</span><br></pre></td></tr></table></figure>\n<p>访问</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># curl www.two.com:8080/t/bb.jsp</span><br><span class=\"line\">two</span><br><span class=\"line\"># curl www.two.com:8080/myself/self.jsp</span><br><span class=\"line\">myself</span><br></pre></td></tr></table></figure>\n<h5 id=\"编写内存测试页面\"><a href=\"#编写内存测试页面\" class=\"headerlink\" title=\"编写内存测试页面\"></a>编写内存测试页面</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir /one/memtest</span><br><span class=\"line\">vim /one/memtest/meminfo.jsp</span><br><span class=\"line\">&lt;%</span><br><span class=\"line\">Runtime rtm = Runtime.getRuntime();\t\t# 获取运行时间</span><br><span class=\"line\">long mm = rtm.maxMemory()/1024/1024;\t# 给JVM分配的最大内存</span><br><span class=\"line\">long tm = rtm.totalMemory()/1024/1024;\t# Java程序用掉的JVM内存</span><br><span class=\"line\">long fm = rtm.freeMemory()/1024/1024;\t# 给JVM分配完后剩余的内存</span><br><span class=\"line\"></span><br><span class=\"line\">out.println(<span class=\"string\">&quot;memory info:&lt;br&gt;&quot;</span>);</span><br><span class=\"line\">out.println(<span class=\"string\">&quot;jvm max memory:&quot;</span>+mm+<span class=\"string\">&quot;MB&quot;</span>+<span class=\"string\">&quot;&lt;br&gt;&quot;</span>);</span><br><span class=\"line\">out.println(<span class=\"string\">&quot;jvm used:&quot;</span>+tm+<span class=\"string\">&quot;MB&quot;</span>+<span class=\"string\">&quot;&lt;br&gt;&quot;</span>);</span><br><span class=\"line\">out.println(<span class=\"string\">&quot;system free:&quot;</span>+fm+<span class=\"string\">&quot;MB&quot;</span>+<span class=\"string\">&quot;&lt;br&gt;&quot;</span>);</span><br><span class=\"line\">out.println(<span class=\"string\">&quot;can be used:&quot;</span>+(mm+fm-tm)+<span class=\"string\">&quot;MB&quot;</span>+<span class=\"string\">&quot;&lt;br&gt;&quot;</span>);</span><br><span class=\"line\">%&gt;</span><br></pre></td></tr></table></figure>\n<p>访问测试：</p>\n<p><img src=\"/images/pasted-45.png\" alt=\"upload successful\"></p>\n<h5 id=\"远程监控tomcat性能\"><a href=\"#远程监控tomcat性能\" class=\"headerlink\" title=\"远程监控tomcat性能\"></a>远程监控tomcat性能</h5><p>编写脚本</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /usr/local/tomcat/bin/catalina.sh</span><br><span class=\"line\">添加：（<span class=\"number\">309</span>行）</span><br><span class=\"line\">JAVA_OPTS=&quot;$JAVA_OPTS -Djava.rmi.server.hostname=1.1.1.1&quot;\t# 指定被连接的主机的IP/主机名/域名</span><br><span class=\"line\">JAVA_OPTS=&quot;$JAVA_OPTS -Dcom.sun.management.jmxremote.port=9000&quot;\t# 指定被连接的主机的端口</span><br><span class=\"line\">JAVA_OPTS=&quot;$JAVA_OPTS -Dcom.sun.management.jmxremote.authenticate=true&quot;\t# 指定连接时使用的身份验证</span><br><span class=\"line\">JAVA_OPTS=&quot;$JAVA_OPTS -Dcom.sun.management.jmxremote.ssl=false&quot;\t# 指定连接时使用的身份验证</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-46.png\" alt=\"upload successful\"></p>\n<p>设置用于远程连接的用户和密码</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cp <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/java/</span>jre<span class=\"regexp\">/lib/m</span>anagement<span class=\"regexp\">/jmxremote.password.template /u</span>sr<span class=\"regexp\">/local/</span>java<span class=\"regexp\">/jre/</span>lib<span class=\"regexp\">/management/</span>jmxremote.password</span><br><span class=\"line\"># vim  <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/java/</span>jre<span class=\"regexp\">/lib/m</span>anagement/jmxremote.password</span><br><span class=\"line\">取消注释：</span><br><span class=\"line\"> 用户名\t\t  密码</span><br><span class=\"line\">monitorRole\t\t<span class=\"number\">123456</span></span><br><span class=\"line\">controlRole\t\t<span class=\"number\">123456</span></span><br></pre></td></tr></table></figure>\n\n<p>对password文件提权</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># chmod 600 /usr/local/java/jre/lib/management/jmxremote.password</span><br></pre></td></tr></table></figure>\n<p>重启服务：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh /usr/local/tomcat/bin/shutdown.sh &amp;&amp; /usr/local/tomcat/bin/startup.sh</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-47.png\" alt=\"upload successful\"></p>\n<p>放行防火墙（不行就关闭防火墙）</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># firewall-cmd --add-port=8080/tcp</span><br><span class=\"line\"># firewall-cmd --add-port=8005/tcp</span><br><span class=\"line\"># firewall-cmd --add-port=8009/tcp</span><br><span class=\"line\"># firewall-cmd --add-port=9000/tcp</span><br><span class=\"line\"># setenforce 0</span><br></pre></td></tr></table></figure>\n<p>打开一台虚拟机（只需要部署JDK）</p>\n<p>远程连接</p>\n<p>jconsole</p>\n<p><img src=\"/images/pasted-48.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-49.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-50.png\" alt=\"upload successful\"></p>\n<h5 id=\"自定义错误页面\"><a href=\"#自定义错误页面\" class=\"headerlink\" title=\"自定义错误页面\"></a>自定义错误页面</h5><p>初次访问一个不存在的错误页面结果</p>\n<p><img src=\"/images/pasted-51.png\" alt=\"upload successful\"><br>修改web页面配置文件</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /usr/local/tomcat/conf/web.xml</span><br><span class=\"line\">添加：（<span class=\"number\">117</span>行）</span><br><span class=\"line\">&lt;error-page&gt;</span><br><span class=\"line\">        &lt;error-code&gt;404&lt;/error-code&gt;</span><br><span class=\"line\">        &lt;location&gt;/notfound.jsp&lt;/location&gt;\t# 指定错误页面的文件</span><br><span class=\"line\">&lt;/error-page&gt;</span><br></pre></td></tr></table></figure>\n<p>编写要返回给客户端的错误页面</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /usr/local/tomcat/webapps/ROOT/notfound.jsp</span><br><span class=\"line\">Not Found！</span><br></pre></td></tr></table></figure>\n<p>重启服务</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cd /usr/local/tomcat/bin/</span><br><span class=\"line\"># ./shutdown.sh</span><br><span class=\"line\"># ./startup.sh</span><br></pre></td></tr></table></figure>\n<p>如提示报错：（显示地址被占用）</p>\n<p><img src=\"/images/pasted-53.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-54.png\" alt=\"upload successful\"></p>\n<p>直接杀死相关的进程号就OK！</p>\n<p>kill -9 50831</p>\n<p>再次关闭、启动就OK！</p>\n<p>测试访问：（访问一个不存在的页面）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># curl 127.0.0.1:8080/zx.jsp</span><br><span class=\"line\">Not Found!</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"通过web页面来管理虚拟主机\"><a href=\"#通过web页面来管理虚拟主机\" class=\"headerlink\" title=\"通过web页面来管理虚拟主机\"></a>通过web页面来管理虚拟主机</h5><p>将打包好的web应用bdqnweb.war拷贝到宿主目录下</p>\n<p><img src=\"/images/pasted-55.png\" alt=\"upload successful\"></p>\n<p>修改配置文件</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">取消注释并设置可访问管理界面的用户（最后）</span><br><span class=\"line\"># vim /usr/local/tomcat/conf/tomcat-users.xml</span><br><span class=\"line\">&lt;role rolename=&quot;admin-gui&quot;/&gt;\t# 设置可以访问host-manager这个web应用的html的权限</span><br><span class=\"line\">&lt;role rolename=&quot;admin-script&quot;/&gt;\t# 设置可以访问txt类型页面的权限</span><br><span class=\"line\">&lt;user username=&quot;aa&quot; password=&quot;123.com&quot; roles=&quot;admin-gui,admin-script&quot;/&gt;\t# 添加用户aa密码为123.com，拥有admin-gui和admin-script两个权限</span><br></pre></td></tr></table></figure>\n<p>重启服务</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sh /usr/local/tomcat/bin/shutdown.sh &amp;&amp; sh /usr/local/tomcat/bin/startup.sh</span><br></pre></td></tr></table></figure>\n<p>验证</p>\n<blockquote>\n<p>访问管理虚拟主机页面并添加虚拟主机</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firefox <span class=\"number\">127.0</span>.<span class=\"number\">0.1</span>:<span class=\"number\">8080</span>/host-manager</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-56.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-57.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-58.png\" alt=\"upload successful\"><br>创建<a href=\"http://www.test.com域名所对应的站点目录,并添加web应用/\">www.test.com域名所对应的站点目录，并添加web应用</a></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mkdir -p /test/app1</span><br><span class=\"line\"># echo www.test.com &gt; /test/app1/test.jsp</span><br></pre></td></tr></table></figure>\n<p>修改hosts文件添加域名</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># echo &quot;1.1.1.1 www.test.com&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>\n<p>验证：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># curl www.test.com:8080/app1/test.jsp</span><br><span class=\"line\">www.test.com</span><br></pre></td></tr></table></figure>\n<p>设置允许其他地址访问<code>Host-manager管理界面</code>（<code>默认地址为127.0.0.1可访问</code>）</p>\n<blockquote>\n<p><u>如果使用本机的物理IP访问<strong>host-manager</strong>管理界面是不可以访问的因为在配置文件中没有指定其他IP访问管理界面，所以在配置文件中可以指定其他IP允许访问管理界面</u></p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /usr/local/tomcat/webapps/host-manager/META-INF/context.xml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-59.png\" alt=\"upload successful\"></p>\n<blockquote>\n<p>在正则表达式里面“点”为任意所有的意思，所以在这里需要用“\\”这个符号进行转义（<code>^.*$代表允许所有地址可访问</code>）</p>\n</blockquote>\n<p>重启服务</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sh /usr/local/tomcat/bin/shutdown.sh &amp;&amp; sh /usr/local/tomcat/bin/startup.sh</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>验证</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firefox <span class=\"number\">1.1</span>.<span class=\"number\">1.1</span>:<span class=\"number\">8080</span>/host-manager</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-60.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-61.png\" alt=\"upload successful\"><br>访问成功！！！</p>\n<blockquote>\n<p><u>重启服务后在管理界面添加的虚拟主机域名会消失，因为重启后服务会读取配置文件中的数据，在管理界面添加的虚拟主机不记录在配置文件中，所以会消失，但是消失的虚拟主机所对应的数据还在，只是虚拟主机的域名不存在。</u></p>\n</blockquote>\n<blockquote>\n<p>访问manager控制界面（如果虚拟主机和发布web应用一起做的话一起修改tomcat-users配置文件，如果先做虚拟主机在做发布web应用中间在重启服务，虚拟主机就会消失，建议一起修改配置文件）</p>\n</blockquote>\n<p>在配置文件中3yy，p复制粘贴这三行并修改</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /usr/local/tomcat/conf/tomcat-users.xml</span><br><span class=\"line\">&lt;role rolename=&quot;manager-gui&quot;/&gt;\t# 设置可以访问manager这个web应用的html权限</span><br><span class=\"line\">&lt;role rolename=&quot;manager-script&quot;/&gt;\t# 设置可以访问txt类型页面的权限</span><br><span class=\"line\">&lt;user username=&quot;bb&quot; password=&quot;123.com&quot; roles=&quot;manager-gui,manager-script&quot;/&gt;\t# 添加可以访问的用户bb，密码为123.聪明，拥有manager-gui和manager-script两个权限 </span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-62.png\" alt=\"upload successful\"><br>重启服务</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sh /usr/local/tomcat/bin/shutdown.sh &amp;&amp; sh /usr/local/tomcat/bin/startup.sh</span><br></pre></td></tr></table></figure>\n<p>访问</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firefox <span class=\"number\">127.0</span>.<span class=\"number\">0.1</span>:<span class=\"number\">8080</span>/manager</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-63.png\" alt=\"upload successful\"></p>\n<h6 id=\"第一种发布web应用方式\"><a href=\"#第一种发布web应用方式\" class=\"headerlink\" title=\"第一种发布web应用方式\"></a>第一种发布web应用方式</h6><p><img src=\"/images/pasted-64.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-65.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-68.png\" alt=\"upload successful\"><br><strong>发布成功后顶部显示OK</strong></p>\n<p><img src=\"/images/pasted-69.png\" alt=\"upload successful\"></p>\n<p>当然在tomcat的默认站点目录webapps下会生成一个bdqnweb应用</p>\n<p><img src=\"/images/pasted-70.png\" alt=\"upload successful\"></p>\n<p>访问bdqnweb应用</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firefox <span class=\"number\">127.0</span>.<span class=\"number\">0.1</span>:<span class=\"number\">8080</span>/bdqnweb/</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-71.png\" alt=\"upload successful\"></p>\n<h6 id=\"第二种发布方式\"><a href=\"#第二种发布方式\" class=\"headerlink\" title=\"第二种发布方式\"></a>第二种发布方式</h6><p><img src=\"/images/pasted-72.png\" alt=\"upload successful\"><br><strong>发布成功后顶部显示OK</strong></p>\n<p><img src=\"/images/pasted-73.png\" alt=\"upload successful\"><br>/hello不需要在webapps目录下提前创建，发布成功后会自动生成</p>\n<p><img src=\"/images/pasted-74.png\" alt=\"upload successful\"><br>访问</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># curl 127.0.0.1:8080/hello</span><br><span class=\"line\">Hello World!</span><br></pre></td></tr></table></figure>\n<p>设置允许其他地址访问<strong>manager</strong>管理界面（<code>默认地址为127.0.0.1可访问</code>）<br>修改配置文件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /usr/local/tomcat/webapps/manager/META-INF/context.xml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-75.png\" alt=\"upload successful\"></p>\n<p>*<em>（^.</em>$代表允许所有地址可访问）**</p>\n<p>重启服务</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sh /usr/local/tomcat/bin/shutdown.sh &amp;&amp; sh /usr/local/tomcat/bin/startup.sh</span><br></pre></td></tr></table></figure>\n<p>验证访问</p>\n<p><img src=\"/images/pasted-76.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-77.png\" alt=\"upload successful\"></p>\n<h5 id=\"JVM常用内存优化参数\"><a href=\"#JVM常用内存优化参数\" class=\"headerlink\" title=\"JVM常用内存优化参数\"></a>JVM常用内存优化参数</h5><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /usr/local/tomcat/bin/catalina.sh</span><br><span class=\"line\">添加：</span><br><span class=\"line\">JAVA_OPTS=<span class=\"string\">&quot;-server -Xms512M -Xmx512M -XX:NewSize=300M -XX:OldSize=100M -XX:SurvivorRatio=2&quot;</span></span><br><span class=\"line\">-Xms512：指定JVM初始化分配的内存</span><br><span class=\"line\">-Xmx512：指定JVM最大获取到的内存</span><br><span class=\"line\">-XX:NewSize=<span class=\"number\">300</span>M：指定新生代的内存容量</span><br><span class=\"line\">-XX:OldSize=<span class=\"number\">100</span>M：指定年老代的内存容量</span><br><span class=\"line\">-XX:SurvivorRatio=<span class=\"number\">2</span>：指定Survivor与Eden的占比</span><br><span class=\"line\">#-XX:PermSize：指定持久代的容量</span><br><span class=\"line\">#-XX:PermMaxSize：指定持久代的最大容量</span><br><span class=\"line\">#-XX:NewMaxSize：指定新生代的最大内存容量</span><br></pre></td></tr></table></figure>\n<p>指定线程池</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /usr/local/tomcat/conf/server.xml</span><br><span class=\"line\">修改：去掉注释（<span class=\"number\">56</span>行）</span><br><span class=\"line\">指定线程池，名字为threadpool，最大可开启线程数量为<span class=\"number\">150</span>个，最下空闲进程数量<span class=\"number\">4</span>个</span><br><span class=\"line\">    &lt;Executor name=<span class=\"string\">&quot;threadPool&quot;</span> namePrefix=<span class=\"string\">&quot;catalina-exec-&quot;</span></span><br><span class=\"line\">        maxThreads=<span class=\"string\">&quot;150&quot;</span> minSpareThreads=<span class=\"string\">&quot;4&quot;</span>/&gt;</span><br><span class=\"line\">连接器引用指定名字对应的线程池</span><br><span class=\"line\">    &lt;Connector port=<span class=\"string\">&quot;8080&quot;</span> protocol=<span class=\"string\">&quot;HTTP/1.1&quot;</span></span><br><span class=\"line\">        executor=<span class=\"string\">&quot;threadPool&quot;</span></span><br><span class=\"line\">               connectionTimeout=<span class=\"string\">&quot;20000&quot;</span></span><br><span class=\"line\">               redirectPort=<span class=\"string\">&quot;8443&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>\n<p>重启服务</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sh /usr/local/tomcat/bin/shutdown.sh &amp;&amp; sh /usr/local/tomcat/bin/startup.sh</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>验证访问</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># firefox www.new.com:8080/manager</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-78.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-79.png\" alt=\"upload successful\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h5 id=\"Tomcat-是什么\"><a href=\"#Tomcat-是什么\" class=\"headerlink\" title=\"Tomcat 是什么?\"></a>Tomcat 是什么?</h5><p>Tomcat 由JAVA语言开发的Java容器，实现了对 Servlet 和 JSP 的支持，并提供了作为Web服务器的一些特有功能，Tomcat是一种类似于IIS、Apache Http的Web服务端程序， Tomcat 本身也内含了一个 HTTP 服务器，它也可以被视作一个单独的 Web 服务器。也就是Web容器。</p>\n<p>Servlet：是应用在服务端的小程序，由JAVA语言编写，本身支持各种JAVA相关的请求，但是大多用于接收web服务发来的请求，与数据库交互并将响应交给web服务</p>\n<p>JDK：JAVA开发工具包。</p>\n<p>常用工具：</p>\n<blockquote>\n<p>Java：运行编译后的类文件</p>\n</blockquote>\n<blockquote>\n<p>Jar：对类文件进行打包</p>\n</blockquote>\n<blockquote>\n<p>Javac：对源文件中的注释提取文档</p>\n</blockquote>\n<blockquote>\n<p>Jconsole：远程连接工具</p>\n</blockquote>\n<blockquote>\n<p>Jre：JAVA运行环境</p>\n</blockquote>\n<h5 id=\"部署tomcat\"><a href=\"#部署tomcat\" class=\"headerlink\" title=\"部署tomcat\"></a>部署tomcat</h5><p>配置Java环境</p>\n<p>解压软件包</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># <span class=\"selector-tag\">tar</span> <span class=\"selector-tag\">zxf</span> <span class=\"selector-tag\">jdk-8u201-linux-x64</span><span class=\"selector-class\">.tar</span><span class=\"selector-class\">.gz</span></span><br></pre></td></tr></table></figure>\n<p>将jdk解压后的目录移动到/usr/local/起名为java</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mv <span class=\"regexp\">/root/</span>jdk1.<span class=\"number\">8.0</span>_201<span class=\"regexp\">/ /u</span>sr<span class=\"regexp\">/local/</span>java</span><br></pre></td></tr></table></figure>\n<p>删除原先的旧java</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># rm -rf <span class=\"regexp\">/usr/</span>bin/java</span><br></pre></td></tr></table></figure>\n<p>配置Java环境变量</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># echo &#x27;export JAVA_HOME=/usr/local/java</span></span><br><span class=\"line\"><span class=\"comment\"># 设置jre（Jave Runtime Environment：java运行时环境）的安装目录变量</span></span><br><span class=\"line\">&gt; <span class=\"builtin-name\">export</span> <span class=\"attribute\">JRE_HOME</span>=/usr/local/java/jre/</span><br><span class=\"line\"><span class=\"comment\"># 设置类文件路径，冒号代表加的意思，引用以上设置的变量</span></span><br><span class=\"line\">&gt; <span class=\"builtin-name\">export</span> <span class=\"attribute\">CLASSPATH</span>=<span class=\"variable\">$JAVA_HOME</span>/lib:$JRE_HOME/lib</span><br><span class=\"line\"><span class=\"comment\"># 最后一行，相当于windows系统的命令环境变量，就是新添了两个java以及jre的命令变量</span></span><br><span class=\"line\"><span class=\"comment\"># $PATH代表原有的环境变量，使用变量复用</span></span><br><span class=\"line\">&gt; <span class=\"builtin-name\">export</span> <span class=\"attribute\">PATH</span>=<span class=\"variable\">$PATH</span>:$JAVA_HOME/bin:$JRE_HOME/bin&#x27; &gt;&gt; /etc/profile</span><br></pre></td></tr></table></figure>\n<p>加载编写的profile文件</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># <span class=\"keyword\">source</span> <span class=\"regexp\">/etc/</span>profile</span><br></pre></td></tr></table></figure>\n<p>查看版本号</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># java -version</span></span><br><span class=\"line\">java version <span class=\"string\">&quot;1.8.0_201&quot;</span></span><br><span class=\"line\">Java(TM) SE Runtime Environment (build 1.8.0_201-b09)</span><br><span class=\"line\">Java HotSpot(TM) 64-Bit<span class=\"built_in\"> Server </span>VM (build 25.201-b09, mixed mode)</span><br></pre></td></tr></table></figure>\n<p>安装Tomcat</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">tar</span> zxf apache-tomcat-<span class=\"number\">8</span>.<span class=\"number\">5</span>.<span class=\"number\">35</span>.tar.gz </span><br><span class=\"line\"><span class=\"attribute\">mv</span> apache-tomcat-<span class=\"number\">8</span>.<span class=\"number\">5</span>.<span class=\"number\">35</span> /usr/local/tomcat</span><br></pre></td></tr></table></figure>\n<p>启动服务：<code>/usr/local/tomcat/bin/startup.sh</code></p>\n<p>停止服务：<code>/usr/local/tomcat/bin/shutdown.sh</code></p>\n<blockquote>\n<p>8080：接收客户端请求</p>\n</blockquote>\n<blockquote>\n<p>8005：用于接收shutdown指令</p>\n</blockquote>\n<blockquote>\n<p>8009：用于tomcat接受其他web服务发来的请求</p>\n</blockquote>\n<p>server.xml主配置文件</p>\n<figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /usr/local/tomcat/conf/server.xml</span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Server</span> <span class=\"attr\">port</span>=<span class=\"string\">&quot;8005&quot;</span> <span class=\"attr\">shutdown</span>=<span class=\"string\">&quot;SHUTDOWN&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Server</span>&gt;</span></span></span><br><span class=\"line\">port：server模块监听的端口号，可以自定义，只有端口号不冲突，为-<span class=\"number\">1</span>时表示不接受关闭指令</span><br><span class=\"line\">shutdown：server模块接收到的参数指定的指令时就关闭tomcat程序</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Service</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Catalina&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Service</span>&gt;</span></span></span><br><span class=\"line\">name：指定该servie的名字，可以有多个service通过名字来区分</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;Connector port=<span class=\"string\">&quot;8080&quot;</span> protocol=<span class=\"string\">&quot;HTTP/1.1&quot;</span></span><br><span class=\"line\">           connectionTimeout=<span class=\"string\">&quot;20000&quot;</span></span><br><span class=\"line\">           redirectPort=<span class=\"string\">&quot;8443&quot;</span> /&gt;&lt;/Connector&gt;</span><br><span class=\"line\">&lt;Connector port=<span class=\"string\">&quot;8009&quot;</span> protocol=<span class=\"string\">&quot;AJP/1.3&quot;</span> redirectPort=<span class=\"string\">&quot;8443&quot;</span> /&gt;</span><br><span class=\"line\">port：tomcat对客户端开放的端口号，<span class=\"number\">8080</span>是用于接收客户端发送的http请求，<span class=\"number\">8009</span>是用于tomcat接受其他web服务发来的请求</span><br><span class=\"line\">protocol：客户端连接tomcat使用的协议，AJP协议用于tomcat与其他web服务建立连接使用的</span><br><span class=\"line\">connectionTimeout：与tomcat的连接超时时间，单位毫秒</span><br><span class=\"line\">redirectPort：当tomcat配置为https时，如果客户端仍然使用http协议访问，强制对客户端使用的协议转换为https，并将端口转换为<span class=\"number\">8443</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Engine</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Catalina&quot;</span> <span class=\"attr\">defaultHost</span>=<span class=\"string\">&quot;localhost&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Engine</span>&gt;</span></span></span><br><span class=\"line\">name：该engine的名字，如果有多个service用来区分不同的引擎，并在日志中通过 名字进行标识</span><br><span class=\"line\"><span class=\"keyword\">default</span> Host：引擎接受请求通过客户端请求的URL的IP/域名/主机名部分匹配Host模块，如果没有匹配到的则把请求交给defaultHost指定的主机处理，所以必须要有一个Host模块的主机名为defaultHost指定的名字</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;Host<span class=\"built_in\"> name</span>=<span class=\"string\">&quot;localhost&quot;</span>  appBase=<span class=\"string\">&quot;webapps&quot;</span></span><br><span class=\"line\">          unpackWARs=<span class=\"string\">&quot;true&quot;</span> autoDeploy=<span class=\"string\">&quot;true&quot;</span>&gt;</span><br><span class=\"line\">&lt;Context<span class=\"built_in\"> path</span>=”/test” docBase=”/haha”&gt;&lt;/Context&gt;</span><br><span class=\"line\">&lt;/Host&gt;</span><br><span class=\"line\">name：该host也就是虚拟主机对应的名字，用来engine对客户端访问的url中的主机部分进行匹配</span><br><span class=\"line\">appBase：该虚拟主机对应的站点目录，webapps是一个相对路径，其绝对路径为“/usr/local/tomcat/webapps”</span><br><span class=\"line\">path：客户端访问的URL指定的名字如果是/test那么客户端要找的数据对应的位置就在/haha目录下</span><br><span class=\"line\">docBase：web应用存放位置</span><br><span class=\"line\">&lt;Valve className=<span class=\"string\">&quot;org.apache.catalina.valves.AccessLogValve&quot;</span> directory=<span class=\"string\">&quot;logs&quot;</span></span><br><span class=\"line\">               prefix=<span class=\"string\">&quot;localhost_access_log&quot;</span> suffix=<span class=\"string\">&quot;.txt&quot;</span></span><br><span class=\"line\">               pattern=<span class=\"string\">&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot;</span> /&gt;</span><br><span class=\"line\">Directory：指定访问日志存放的位置，logs是相对路径，绝对路径为“/usr/local/tomcat/logs”</span><br><span class=\"line\">Prefix：指定访问日志文件的前缀</span><br><span class=\"line\">Suffix：指定访问日志文件的后缀</span><br><span class=\"line\">Pattern：指定日志文件的格式</span><br><span class=\"line\">- <span class=\"meta\">%h</span>：记录发送该请求的主机的IP地址，可能是客户端的IP，可能是代理服务器的IP（谁最终将请求交给tomcat，这里就是谁的IP）</span><br><span class=\"line\">- <span class=\"meta\">%l</span>：记录该请求使用的逻辑用户，如果没有就用-表示</span><br><span class=\"line\">- <span class=\"meta\">%u</span>：记录该请求的真实用户，如果没有则用-表示</span><br><span class=\"line\">- <span class=\"meta\">%t</span>：记录该请求的发送时间</span><br><span class=\"line\">- <span class=\"meta\">%quot</span>；：表示“”引号</span><br><span class=\"line\">- <span class=\"meta\">%r</span>：记录请求的请求行</span><br><span class=\"line\">- <span class=\"meta\">%s</span>：记录对该请求响应的状态码\t</span><br><span class=\"line\">- <span class=\"meta\">%b</span>：记录该请求相应的字节数</span><br><span class=\"line\">- <span class=\"meta\">%D</span>：记录该请求响应的时间，可以用来测试tomcat的性能</span><br></pre></td></tr></table></figure>\n<h5 id=\"Tomcat多实例\"><a href=\"#Tomcat多实例\" class=\"headerlink\" title=\"Tomcat多实例\"></a>Tomcat多实例</h5><blockquote>\n<p>通过修改不同tomcat结点的配置文件中的端口来启动不同的tomcat实例</p>\n</blockquote>\n<p>示例一：</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">tar</span> zxf apache-tomcat-<span class=\"number\">8</span>.<span class=\"number\">5</span>.<span class=\"number\">33</span>.tar.gz</span><br><span class=\"line\"><span class=\"attribute\">cp</span> /root/apache-tomcat-<span class=\"number\">8</span>.<span class=\"number\">5</span>.<span class=\"number\">33</span> /usr/local/tomcat</span><br><span class=\"line\"><span class=\"attribute\">sh</span> /usr/local/tomcat/bin/startup.sh\t\t//启动第一个实例</span><br><span class=\"line\"><span class=\"attribute\">netstat</span> -anpt | grep java\t\t//查看到监听了三个端口<span class=\"number\">8080</span>、<span class=\"number\">8005</span>、<span class=\"number\">8009</span></span><br></pre></td></tr></table></figure>\n<p>示例二：</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp <span class=\"regexp\">/root/</span>apache-tomcat<span class=\"number\">-8.5</span><span class=\"number\">.33</span> <span class=\"regexp\">/usr/</span>local/tomcat2</span><br><span class=\"line\">vim <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/tomcat2/</span>conf/server.xml</span><br><span class=\"line\">修改：</span><br><span class=\"line\">&lt;Server port=<span class=\"string\">&quot;8006&quot;</span> shutdown=<span class=\"string\">&quot;SHUTDOWN&quot;</span>&gt;\t\t<span class=\"comment\">//修改接收shutdown指令的端口</span></span><br><span class=\"line\">&lt;Connector port=<span class=\"string\">&quot;8081&quot;</span> protocol=<span class=\"string\">&quot;HTTP/1.1&quot;</span>\t\t<span class=\"comment\">//修改接收客户端请求的端口</span></span><br><span class=\"line\">&lt;Connector port=<span class=\"string\">&quot;8010&quot;</span> protocol=<span class=\"string\">&quot;AJP/1.3&quot;</span> redirectPort=<span class=\"string\">&quot;8443&quot;</span> <span class=\"regexp\">/&gt;\t\t/</span>/修改接收其他web服务发送请求的端口</span><br><span class=\"line\">sh <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/tomcat2/</span>bin<span class=\"regexp\">/startup.sh\t\t/</span>/启动第二个实例</span><br><span class=\"line\">netstat -anpt | grep java\t\t<span class=\"comment\">//可以看到实例二所监听的端口8081、8006、8010</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"验证：\"><a href=\"#验证：\" class=\"headerlink\" title=\"验证：\"></a>验证：</h6><p>通过访问这两个tomcat节点，可以在这两个节点的站点目录下添加不同的文件来访问</p>\n<p>添加示例一测试文件：</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/tomcat/</span>webapps/<span class=\"number\">1</span></span><br><span class=\"line\">echo wo shi shi li yi &gt; <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/tomcat/</span>webapps<span class=\"regexp\">/1/</span><span class=\"number\">1</span>.jsp</span><br></pre></td></tr></table></figure>\n<p>添加示例二测试文件：</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/tomcat2/</span>webapps/<span class=\"number\">2</span></span><br><span class=\"line\">echo wo shi shi li er &gt; <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/tomcat2/</span>webapps<span class=\"regexp\">/2/</span><span class=\"number\">2</span>.jsp</span><br></pre></td></tr></table></figure>\n<p>访问：<br><img src=\"/images/timg2.png\" alt=\"upload successful\"></p>\n<h5 id=\"Tomcat多虚拟主机\"><a href=\"#Tomcat多虚拟主机\" class=\"headerlink\" title=\"Tomcat多虚拟主机\"></a>Tomcat多虚拟主机</h5><p>在hosts文件中添加域名</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /etc/hosts</span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/pasted-41.png\" alt=\"upload successful\"></p>\n<p>再一个tomcat实例中添加多个Host模块，匹配多个站点目录供客户端访问</p>\n<p>修改server.xml主配置文件</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /usr/local/tomcat/conf/server.xml</span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/pasted-42.png\" alt=\"upload successful\"></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Host name=&quot;www.one.com&quot; appBase=&quot;/one&quot;&gt;&lt;/Host&gt;\t\t//客户端如果访问的url域名为www.one.com，则匹配的站点目录为/one</span><br><span class=\"line\">        &lt;Host name=<span class=\"string\">&quot;www.two.com&quot;</span> appBase=<span class=\"string\">&quot;/two&quot;</span>&gt;\t\t<span class=\"comment\">//客户端如果访问的url域名为www.two.com，则匹配的站点目录为/two</span></span><br><span class=\"line\">        &lt;/Host&gt;</span><br></pre></td></tr></table></figure>\n<p>重启服务</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sh /usr/local/tomcat/bin/shutdown.sh &amp;&amp; sh /usr/local/tomcat/bin/startup.sh</span><br></pre></td></tr></table></figure>\n<p>创建站点目录/one和/two，并添加web应用</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mkdir -p /one/o</span><br><span class=\"line\"># echo one &gt; /one/o/aa.jsp</span><br><span class=\"line\"># mkdir -p /two/t</span><br><span class=\"line\"># echo two &gt; /two/t/bb.jsp</span><br></pre></td></tr></table></figure>\n<p>在默认的webapps站点目录下创建目录cc，并添加web应用</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mkdir /usr/local/tomcat/webapps/three</span><br><span class=\"line\"># echo nin ben ci fang wen de ye mian lai zi zhan dian mu lu wei webapps xia &gt; /usr/local/tomcat/webapps/three/cc.jsp</span><br></pre></td></tr></table></figure>\n<p>验证：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># curl www.one.com:8080/o/aa.jsp</span><br><span class=\"line\">one</span><br><span class=\"line\"># curl www.two.com:8080/t/bb.jsp</span><br><span class=\"line\">two</span><br></pre></td></tr></table></figure>\n<p>访问<a href=\"http://www.three.com:8080/three/cc.jsp%60%EF%BC%88%E6%9C%AC%E6%AC%A1%E8%AE%BF%E9%97%AE%E7%9A%84url%E5%9C%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9A%E5%9F%9F%E5%90%8D%E6%89%80%E5%AF%B9%E5%BA%94%E7%9A%84%E7%AB%99%E7%82%B9%E7%9B%AE%E5%BD%95%EF%BC%8C%E6%89%80%E4%BB%A5%E8%AE%BF%E9%97%AE%E8%AF%A5%E5%9F%9F%E5%90%8D%E7%9A%84%E5%86%85%E5%AE%B9%E6%9D%A5%E8%87%AAtomcat%E9%BB%98%E8%AE%A4%E7%9A%84%E7%AB%99%E7%82%B9%E7%9B%AE%E5%BD%95webapps%E4%B8%8B%E7%9A%84three%E7%9A%84web%E5%BA%94%E7%94%A8%EF%BC%89%60\">www.three.com:8080/three/cc.jsp`（本次访问的url在配置文件中没有指定域名所对应的站点目录，所以访问该域名的内容来自tomcat默认的站点目录webapps下的three的web应用）`</a></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># curl www.three.com:8080/three/cc.jsp</span><br><span class=\"line\">nin ben ci fang wen de ye mian lai zi zhan dian mu lu wei webapps xia</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"自定义web应用的访问位置\"><a href=\"#自定义web应用的访问位置\" class=\"headerlink\" title=\"自定义web应用的访问位置\"></a>自定义web应用的访问位置</h5><p>修改配置文件</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /usr/local/tomcat/conf/server.xml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-44.png\" alt=\"upload successful\"></p>\n<blockquote>\n<p>如果客户端访问的url中域名为<a href=\"http://www.two.com则匹配到的站点目录为/two\">www.two.com则匹配到的站点目录为/two</a><br>如果客户端访问的url中域名为<a href=\"http://www.two.com:8080/myself%EF%BC%8C%E5%88%99%E5%8C%B9%E9%85%8D%E7%9A%84%E7%AB%99%E7%82%B9%E7%9B%AE%E5%BD%95%E4%B8%BA/self\">www.two.com:8080/myself，则匹配的站点目录为/self</a></p>\n</blockquote>\n<p>重启服务</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sh /usr/local/tomcat/bin/shutdown.sh &amp;&amp; sh /usr/local/tomcat/bin/startup.sh</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>创建/self站点目录</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mkdir /self</span><br><span class=\"line\"># echo this is myself &gt; /self/self.jsp</span><br></pre></td></tr></table></figure>\n<p>访问</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># curl www.two.com:8080/t/bb.jsp</span><br><span class=\"line\">two</span><br><span class=\"line\"># curl www.two.com:8080/myself/self.jsp</span><br><span class=\"line\">myself</span><br></pre></td></tr></table></figure>\n<h5 id=\"编写内存测试页面\"><a href=\"#编写内存测试页面\" class=\"headerlink\" title=\"编写内存测试页面\"></a>编写内存测试页面</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir /one/memtest</span><br><span class=\"line\">vim /one/memtest/meminfo.jsp</span><br><span class=\"line\">&lt;%</span><br><span class=\"line\">Runtime rtm = Runtime.getRuntime();\t\t# 获取运行时间</span><br><span class=\"line\">long mm = rtm.maxMemory()/1024/1024;\t# 给JVM分配的最大内存</span><br><span class=\"line\">long tm = rtm.totalMemory()/1024/1024;\t# Java程序用掉的JVM内存</span><br><span class=\"line\">long fm = rtm.freeMemory()/1024/1024;\t# 给JVM分配完后剩余的内存</span><br><span class=\"line\"></span><br><span class=\"line\">out.println(<span class=\"string\">&quot;memory info:&lt;br&gt;&quot;</span>);</span><br><span class=\"line\">out.println(<span class=\"string\">&quot;jvm max memory:&quot;</span>+mm+<span class=\"string\">&quot;MB&quot;</span>+<span class=\"string\">&quot;&lt;br&gt;&quot;</span>);</span><br><span class=\"line\">out.println(<span class=\"string\">&quot;jvm used:&quot;</span>+tm+<span class=\"string\">&quot;MB&quot;</span>+<span class=\"string\">&quot;&lt;br&gt;&quot;</span>);</span><br><span class=\"line\">out.println(<span class=\"string\">&quot;system free:&quot;</span>+fm+<span class=\"string\">&quot;MB&quot;</span>+<span class=\"string\">&quot;&lt;br&gt;&quot;</span>);</span><br><span class=\"line\">out.println(<span class=\"string\">&quot;can be used:&quot;</span>+(mm+fm-tm)+<span class=\"string\">&quot;MB&quot;</span>+<span class=\"string\">&quot;&lt;br&gt;&quot;</span>);</span><br><span class=\"line\">%&gt;</span><br></pre></td></tr></table></figure>\n<p>访问测试：</p>\n<p><img src=\"/images/pasted-45.png\" alt=\"upload successful\"></p>\n<h5 id=\"远程监控tomcat性能\"><a href=\"#远程监控tomcat性能\" class=\"headerlink\" title=\"远程监控tomcat性能\"></a>远程监控tomcat性能</h5><p>编写脚本</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /usr/local/tomcat/bin/catalina.sh</span><br><span class=\"line\">添加：（<span class=\"number\">309</span>行）</span><br><span class=\"line\">JAVA_OPTS=&quot;$JAVA_OPTS -Djava.rmi.server.hostname=1.1.1.1&quot;\t# 指定被连接的主机的IP/主机名/域名</span><br><span class=\"line\">JAVA_OPTS=&quot;$JAVA_OPTS -Dcom.sun.management.jmxremote.port=9000&quot;\t# 指定被连接的主机的端口</span><br><span class=\"line\">JAVA_OPTS=&quot;$JAVA_OPTS -Dcom.sun.management.jmxremote.authenticate=true&quot;\t# 指定连接时使用的身份验证</span><br><span class=\"line\">JAVA_OPTS=&quot;$JAVA_OPTS -Dcom.sun.management.jmxremote.ssl=false&quot;\t# 指定连接时使用的身份验证</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-46.png\" alt=\"upload successful\"></p>\n<p>设置用于远程连接的用户和密码</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cp <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/java/</span>jre<span class=\"regexp\">/lib/m</span>anagement<span class=\"regexp\">/jmxremote.password.template /u</span>sr<span class=\"regexp\">/local/</span>java<span class=\"regexp\">/jre/</span>lib<span class=\"regexp\">/management/</span>jmxremote.password</span><br><span class=\"line\"># vim  <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/java/</span>jre<span class=\"regexp\">/lib/m</span>anagement/jmxremote.password</span><br><span class=\"line\">取消注释：</span><br><span class=\"line\"> 用户名\t\t  密码</span><br><span class=\"line\">monitorRole\t\t<span class=\"number\">123456</span></span><br><span class=\"line\">controlRole\t\t<span class=\"number\">123456</span></span><br></pre></td></tr></table></figure>\n\n<p>对password文件提权</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># chmod 600 /usr/local/java/jre/lib/management/jmxremote.password</span><br></pre></td></tr></table></figure>\n<p>重启服务：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh /usr/local/tomcat/bin/shutdown.sh &amp;&amp; /usr/local/tomcat/bin/startup.sh</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-47.png\" alt=\"upload successful\"></p>\n<p>放行防火墙（不行就关闭防火墙）</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># firewall-cmd --add-port=8080/tcp</span><br><span class=\"line\"># firewall-cmd --add-port=8005/tcp</span><br><span class=\"line\"># firewall-cmd --add-port=8009/tcp</span><br><span class=\"line\"># firewall-cmd --add-port=9000/tcp</span><br><span class=\"line\"># setenforce 0</span><br></pre></td></tr></table></figure>\n<p>打开一台虚拟机（只需要部署JDK）</p>\n<p>远程连接</p>\n<p>jconsole</p>\n<p><img src=\"/images/pasted-48.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-49.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-50.png\" alt=\"upload successful\"></p>\n<h5 id=\"自定义错误页面\"><a href=\"#自定义错误页面\" class=\"headerlink\" title=\"自定义错误页面\"></a>自定义错误页面</h5><p>初次访问一个不存在的错误页面结果</p>\n<p><img src=\"/images/pasted-51.png\" alt=\"upload successful\"><br>修改web页面配置文件</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /usr/local/tomcat/conf/web.xml</span><br><span class=\"line\">添加：（<span class=\"number\">117</span>行）</span><br><span class=\"line\">&lt;error-page&gt;</span><br><span class=\"line\">        &lt;error-code&gt;404&lt;/error-code&gt;</span><br><span class=\"line\">        &lt;location&gt;/notfound.jsp&lt;/location&gt;\t# 指定错误页面的文件</span><br><span class=\"line\">&lt;/error-page&gt;</span><br></pre></td></tr></table></figure>\n<p>编写要返回给客户端的错误页面</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /usr/local/tomcat/webapps/ROOT/notfound.jsp</span><br><span class=\"line\">Not Found！</span><br></pre></td></tr></table></figure>\n<p>重启服务</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cd /usr/local/tomcat/bin/</span><br><span class=\"line\"># ./shutdown.sh</span><br><span class=\"line\"># ./startup.sh</span><br></pre></td></tr></table></figure>\n<p>如提示报错：（显示地址被占用）</p>\n<p><img src=\"/images/pasted-53.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-54.png\" alt=\"upload successful\"></p>\n<p>直接杀死相关的进程号就OK！</p>\n<p>kill -9 50831</p>\n<p>再次关闭、启动就OK！</p>\n<p>测试访问：（访问一个不存在的页面）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># curl 127.0.0.1:8080/zx.jsp</span><br><span class=\"line\">Not Found!</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"通过web页面来管理虚拟主机\"><a href=\"#通过web页面来管理虚拟主机\" class=\"headerlink\" title=\"通过web页面来管理虚拟主机\"></a>通过web页面来管理虚拟主机</h5><p>将打包好的web应用bdqnweb.war拷贝到宿主目录下</p>\n<p><img src=\"/images/pasted-55.png\" alt=\"upload successful\"></p>\n<p>修改配置文件</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">取消注释并设置可访问管理界面的用户（最后）</span><br><span class=\"line\"># vim /usr/local/tomcat/conf/tomcat-users.xml</span><br><span class=\"line\">&lt;role rolename=&quot;admin-gui&quot;/&gt;\t# 设置可以访问host-manager这个web应用的html的权限</span><br><span class=\"line\">&lt;role rolename=&quot;admin-script&quot;/&gt;\t# 设置可以访问txt类型页面的权限</span><br><span class=\"line\">&lt;user username=&quot;aa&quot; password=&quot;123.com&quot; roles=&quot;admin-gui,admin-script&quot;/&gt;\t# 添加用户aa密码为123.com，拥有admin-gui和admin-script两个权限</span><br></pre></td></tr></table></figure>\n<p>重启服务</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sh /usr/local/tomcat/bin/shutdown.sh &amp;&amp; sh /usr/local/tomcat/bin/startup.sh</span><br></pre></td></tr></table></figure>\n<p>验证</p>\n<blockquote>\n<p>访问管理虚拟主机页面并添加虚拟主机</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firefox <span class=\"number\">127.0</span>.<span class=\"number\">0.1</span>:<span class=\"number\">8080</span>/host-manager</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-56.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-57.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-58.png\" alt=\"upload successful\"><br>创建<a href=\"http://www.test.com域名所对应的站点目录,并添加web应用/\">www.test.com域名所对应的站点目录，并添加web应用</a></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mkdir -p /test/app1</span><br><span class=\"line\"># echo www.test.com &gt; /test/app1/test.jsp</span><br></pre></td></tr></table></figure>\n<p>修改hosts文件添加域名</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># echo &quot;1.1.1.1 www.test.com&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>\n<p>验证：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># curl www.test.com:8080/app1/test.jsp</span><br><span class=\"line\">www.test.com</span><br></pre></td></tr></table></figure>\n<p>设置允许其他地址访问<code>Host-manager管理界面</code>（<code>默认地址为127.0.0.1可访问</code>）</p>\n<blockquote>\n<p><u>如果使用本机的物理IP访问<strong>host-manager</strong>管理界面是不可以访问的因为在配置文件中没有指定其他IP访问管理界面，所以在配置文件中可以指定其他IP允许访问管理界面</u></p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /usr/local/tomcat/webapps/host-manager/META-INF/context.xml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-59.png\" alt=\"upload successful\"></p>\n<blockquote>\n<p>在正则表达式里面“点”为任意所有的意思，所以在这里需要用“\\”这个符号进行转义（<code>^.*$代表允许所有地址可访问</code>）</p>\n</blockquote>\n<p>重启服务</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sh /usr/local/tomcat/bin/shutdown.sh &amp;&amp; sh /usr/local/tomcat/bin/startup.sh</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>验证</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firefox <span class=\"number\">1.1</span>.<span class=\"number\">1.1</span>:<span class=\"number\">8080</span>/host-manager</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-60.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-61.png\" alt=\"upload successful\"><br>访问成功！！！</p>\n<blockquote>\n<p><u>重启服务后在管理界面添加的虚拟主机域名会消失，因为重启后服务会读取配置文件中的数据，在管理界面添加的虚拟主机不记录在配置文件中，所以会消失，但是消失的虚拟主机所对应的数据还在，只是虚拟主机的域名不存在。</u></p>\n</blockquote>\n<blockquote>\n<p>访问manager控制界面（如果虚拟主机和发布web应用一起做的话一起修改tomcat-users配置文件，如果先做虚拟主机在做发布web应用中间在重启服务，虚拟主机就会消失，建议一起修改配置文件）</p>\n</blockquote>\n<p>在配置文件中3yy，p复制粘贴这三行并修改</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /usr/local/tomcat/conf/tomcat-users.xml</span><br><span class=\"line\">&lt;role rolename=&quot;manager-gui&quot;/&gt;\t# 设置可以访问manager这个web应用的html权限</span><br><span class=\"line\">&lt;role rolename=&quot;manager-script&quot;/&gt;\t# 设置可以访问txt类型页面的权限</span><br><span class=\"line\">&lt;user username=&quot;bb&quot; password=&quot;123.com&quot; roles=&quot;manager-gui,manager-script&quot;/&gt;\t# 添加可以访问的用户bb，密码为123.聪明，拥有manager-gui和manager-script两个权限 </span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-62.png\" alt=\"upload successful\"><br>重启服务</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sh /usr/local/tomcat/bin/shutdown.sh &amp;&amp; sh /usr/local/tomcat/bin/startup.sh</span><br></pre></td></tr></table></figure>\n<p>访问</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firefox <span class=\"number\">127.0</span>.<span class=\"number\">0.1</span>:<span class=\"number\">8080</span>/manager</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-63.png\" alt=\"upload successful\"></p>\n<h6 id=\"第一种发布web应用方式\"><a href=\"#第一种发布web应用方式\" class=\"headerlink\" title=\"第一种发布web应用方式\"></a>第一种发布web应用方式</h6><p><img src=\"/images/pasted-64.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-65.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-68.png\" alt=\"upload successful\"><br><strong>发布成功后顶部显示OK</strong></p>\n<p><img src=\"/images/pasted-69.png\" alt=\"upload successful\"></p>\n<p>当然在tomcat的默认站点目录webapps下会生成一个bdqnweb应用</p>\n<p><img src=\"/images/pasted-70.png\" alt=\"upload successful\"></p>\n<p>访问bdqnweb应用</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firefox <span class=\"number\">127.0</span>.<span class=\"number\">0.1</span>:<span class=\"number\">8080</span>/bdqnweb/</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-71.png\" alt=\"upload successful\"></p>\n<h6 id=\"第二种发布方式\"><a href=\"#第二种发布方式\" class=\"headerlink\" title=\"第二种发布方式\"></a>第二种发布方式</h6><p><img src=\"/images/pasted-72.png\" alt=\"upload successful\"><br><strong>发布成功后顶部显示OK</strong></p>\n<p><img src=\"/images/pasted-73.png\" alt=\"upload successful\"><br>/hello不需要在webapps目录下提前创建，发布成功后会自动生成</p>\n<p><img src=\"/images/pasted-74.png\" alt=\"upload successful\"><br>访问</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># curl 127.0.0.1:8080/hello</span><br><span class=\"line\">Hello World!</span><br></pre></td></tr></table></figure>\n<p>设置允许其他地址访问<strong>manager</strong>管理界面（<code>默认地址为127.0.0.1可访问</code>）<br>修改配置文件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /usr/local/tomcat/webapps/manager/META-INF/context.xml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-75.png\" alt=\"upload successful\"></p>\n<p>*<em>（^.</em>$代表允许所有地址可访问）**</p>\n<p>重启服务</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sh /usr/local/tomcat/bin/shutdown.sh &amp;&amp; sh /usr/local/tomcat/bin/startup.sh</span><br></pre></td></tr></table></figure>\n<p>验证访问</p>\n<p><img src=\"/images/pasted-76.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-77.png\" alt=\"upload successful\"></p>\n<h5 id=\"JVM常用内存优化参数\"><a href=\"#JVM常用内存优化参数\" class=\"headerlink\" title=\"JVM常用内存优化参数\"></a>JVM常用内存优化参数</h5><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /usr/local/tomcat/bin/catalina.sh</span><br><span class=\"line\">添加：</span><br><span class=\"line\">JAVA_OPTS=<span class=\"string\">&quot;-server -Xms512M -Xmx512M -XX:NewSize=300M -XX:OldSize=100M -XX:SurvivorRatio=2&quot;</span></span><br><span class=\"line\">-Xms512：指定JVM初始化分配的内存</span><br><span class=\"line\">-Xmx512：指定JVM最大获取到的内存</span><br><span class=\"line\">-XX:NewSize=<span class=\"number\">300</span>M：指定新生代的内存容量</span><br><span class=\"line\">-XX:OldSize=<span class=\"number\">100</span>M：指定年老代的内存容量</span><br><span class=\"line\">-XX:SurvivorRatio=<span class=\"number\">2</span>：指定Survivor与Eden的占比</span><br><span class=\"line\">#-XX:PermSize：指定持久代的容量</span><br><span class=\"line\">#-XX:PermMaxSize：指定持久代的最大容量</span><br><span class=\"line\">#-XX:NewMaxSize：指定新生代的最大内存容量</span><br></pre></td></tr></table></figure>\n<p>指定线程池</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vim /usr/local/tomcat/conf/server.xml</span><br><span class=\"line\">修改：去掉注释（<span class=\"number\">56</span>行）</span><br><span class=\"line\">指定线程池，名字为threadpool，最大可开启线程数量为<span class=\"number\">150</span>个，最下空闲进程数量<span class=\"number\">4</span>个</span><br><span class=\"line\">    &lt;Executor name=<span class=\"string\">&quot;threadPool&quot;</span> namePrefix=<span class=\"string\">&quot;catalina-exec-&quot;</span></span><br><span class=\"line\">        maxThreads=<span class=\"string\">&quot;150&quot;</span> minSpareThreads=<span class=\"string\">&quot;4&quot;</span>/&gt;</span><br><span class=\"line\">连接器引用指定名字对应的线程池</span><br><span class=\"line\">    &lt;Connector port=<span class=\"string\">&quot;8080&quot;</span> protocol=<span class=\"string\">&quot;HTTP/1.1&quot;</span></span><br><span class=\"line\">        executor=<span class=\"string\">&quot;threadPool&quot;</span></span><br><span class=\"line\">               connectionTimeout=<span class=\"string\">&quot;20000&quot;</span></span><br><span class=\"line\">               redirectPort=<span class=\"string\">&quot;8443&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>\n<p>重启服务</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sh /usr/local/tomcat/bin/shutdown.sh &amp;&amp; sh /usr/local/tomcat/bin/startup.sh</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>验证访问</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># firefox www.new.com:8080/manager</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/pasted-78.png\" alt=\"upload successful\"></p>\n<p><img src=\"/images/pasted-79.png\" alt=\"upload successful\"></p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"ckh2r736p0001m3pv368p54pv","category_id":"ckh2r736t0004m3pv0jykckfh","_id":"ckh2r736z000fm3pv2a7q2uuv"},{"post_id":"ckh2r736u0007m3pv711bfuzl","category_id":"ckh2r736x000am3pvbeym20c4","_id":"ckh2r7373000mm3pvemi02j7u"},{"post_id":"ckh2r736v0008m3pv25mw4lxw","category_id":"ckh2r736x000am3pvbeym20c4","_id":"ckh2r7375000rm3pvdxliey9v"},{"post_id":"ckh2r736w0009m3pv6zzh3x1z","category_id":"ckh2r7373000lm3pvh3jtagzl","_id":"ckh2r7378000xm3pv19cf2x14"},{"post_id":"ckh2r7376000um3pv5s171mt6","category_id":"ckh2r7373000lm3pvh3jtagzl","_id":"ckh2r737a0014m3pv6we5d772"},{"post_id":"ckh2r736x000dm3pv3clg43u9","category_id":"ckh2r7375000sm3pv8e3s1hrf","_id":"ckh2r737b0018m3pvd58e4mte"},{"post_id":"ckh2r7371000im3pv6mwlhc5b","category_id":"ckh2r7375000sm3pv8e3s1hrf","_id":"ckh2r737c001dm3pvbmw8dxww"},{"post_id":"ckh2r737a0017m3pvd3tc0cka","category_id":"ckh2r7373000lm3pvh3jtagzl","_id":"ckh2r737e001im3pvhzfedk4v"},{"post_id":"ckh2r7372000km3pvcq014byo","category_id":"ckh2r7375000sm3pv8e3s1hrf","_id":"ckh2r737f001nm3pve2tq9id0"},{"post_id":"ckh2r737c001fm3pve6nfew20","category_id":"ckh2r7373000lm3pvh3jtagzl","_id":"ckh2r737g001qm3pvbltv4o40"},{"post_id":"ckh2r7374000om3pvgkieagsa","category_id":"ckh2r7375000sm3pv8e3s1hrf","_id":"ckh2r737h001vm3pvgaxu50yu"},{"post_id":"ckh2r737d001hm3pvezmeh2de","category_id":"ckh2r7373000lm3pvh3jtagzl","_id":"ckh2r737i001ym3pv1ujaek2y"},{"post_id":"ckh2r737e001mm3pv7n5ddfe9","category_id":"ckh2r7375000sm3pv8e3s1hrf","_id":"ckh2r737l0022m3pvgzcmb4cg"},{"post_id":"ckh2r7375000qm3pv0co8a370","category_id":"ckh2r7375000sm3pv8e3s1hrf","_id":"ckh2r737m0026m3pvblve837j"},{"post_id":"ckh2r7377000wm3pv1t5e6u11","category_id":"ckh2r737g001sm3pv7rh2ce7e","_id":"ckh2r737n002am3pvcd5tar2x"},{"post_id":"ckh2r737k0021m3pv113ua68a","category_id":"ckh2r7373000lm3pvh3jtagzl","_id":"ckh2r737p002em3pvffdg4is9"},{"post_id":"ckh2r737l0025m3pv9th4c0rv","category_id":"ckh2r7375000sm3pv8e3s1hrf","_id":"ckh2r737q002hm3pv5tx892hh"},{"post_id":"ckh2r73780011m3pv5i111tpq","category_id":"ckh2r737g001sm3pv7rh2ce7e","_id":"ckh2r737r002lm3pvd9isglom"},{"post_id":"ckh2r737m0028m3pvfbltdibx","category_id":"ckh2r7375000sm3pv8e3s1hrf","_id":"ckh2r737s002om3pvd3fp80v2"},{"post_id":"ckh2r737o002dm3pvgj3o40fw","category_id":"ckh2r7375000sm3pv8e3s1hrf","_id":"ckh2r737t002rm3pv00d75dho"},{"post_id":"ckh2r737h001um3pv0kms7nsx","category_id":"ckh2r737n0029m3pv0a2396zs","_id":"ckh2r737u002tm3pvd4kydkk7"},{"post_id":"ckh2r737p002gm3pv469l4os2","category_id":"ckh2r7375000sm3pv8e3s1hrf","_id":"ckh2r737u002vm3pv7vkna13p"},{"post_id":"ckh2r737q002km3pvhq8u3v3w","category_id":"ckh2r7373000lm3pvh3jtagzl","_id":"ckh2r737u002xm3pvhf8b44ux"},{"post_id":"ckh2r737r002nm3pv0xn65ktv","category_id":"ckh2r7373000lm3pvh3jtagzl","_id":"ckh2r737u002zm3pv3f73fsvm"},{"post_id":"ckh2r737w0033m3pvczad2s9l","category_id":"ckh2r737y0034m3pv4bp8eet5","_id":"ckh2r73810037m3pv2k1x821n"}],"PostTag":[{"post_id":"ckh2r736p0001m3pv368p54pv","tag_id":"ckh2r736u0005m3pvgm342gl4","_id":"ckh2r736x000cm3pvg5m9efg4"},{"post_id":"ckh2r736u0007m3pv711bfuzl","tag_id":"ckh2r736x000bm3pv794cepd3","_id":"ckh2r7372000jm3pv49r165lt"},{"post_id":"ckh2r736v0008m3pv25mw4lxw","tag_id":"ckh2r736x000bm3pv794cepd3","_id":"ckh2r7374000pm3pvf9jucfh1"},{"post_id":"ckh2r736w0009m3pv6zzh3x1z","tag_id":"ckh2r7373000nm3pvd5m54qoq","_id":"ckh2r7377000vm3pvbtmtcvua"},{"post_id":"ckh2r7376000um3pv5s171mt6","tag_id":"ckh2r7373000nm3pvd5m54qoq","_id":"ckh2r7378000ym3pvfdx8g7b9"},{"post_id":"ckh2r736x000dm3pv3clg43u9","tag_id":"ckh2r7376000tm3pv97nr850l","_id":"ckh2r73790012m3pv4uq70028"},{"post_id":"ckh2r736y000em3pvbzpl0wov","tag_id":"ckh2r7376000tm3pv97nr850l","_id":"ckh2r737b0019m3pv1ncb4ar1"},{"post_id":"ckh2r73790013m3pv7gpx31om","tag_id":"ckh2r7373000nm3pvd5m54qoq","_id":"ckh2r737c001bm3pv8yfq0ld7"},{"post_id":"ckh2r737a0017m3pvd3tc0cka","tag_id":"ckh2r7373000nm3pvd5m54qoq","_id":"ckh2r737d001gm3pv863jbqd4"},{"post_id":"ckh2r7371000im3pv6mwlhc5b","tag_id":"ckh2r7376000tm3pv97nr850l","_id":"ckh2r737e001jm3pv5a03e3tg"},{"post_id":"ckh2r737c001fm3pve6nfew20","tag_id":"ckh2r7373000nm3pvd5m54qoq","_id":"ckh2r737f001om3pv227m3cqi"},{"post_id":"ckh2r7372000km3pvcq014byo","tag_id":"ckh2r7376000tm3pv97nr850l","_id":"ckh2r737g001rm3pvgwupf76m"},{"post_id":"ckh2r737d001hm3pvezmeh2de","tag_id":"ckh2r7373000nm3pvd5m54qoq","_id":"ckh2r737i001wm3pv53lz0i88"},{"post_id":"ckh2r737e001mm3pv7n5ddfe9","tag_id":"ckh2r7376000tm3pv97nr850l","_id":"ckh2r737i001zm3pv2yav9esx"},{"post_id":"ckh2r7374000om3pvgkieagsa","tag_id":"ckh2r7376000tm3pv97nr850l","_id":"ckh2r737l0024m3pv86bf2gzz"},{"post_id":"ckh2r7375000qm3pv0co8a370","tag_id":"ckh2r7376000tm3pv97nr850l","_id":"ckh2r737m0027m3pv4t4ggxno"},{"post_id":"ckh2r737i001xm3pv10z31ggr","tag_id":"ckh2r7376000tm3pv97nr850l","_id":"ckh2r737o002cm3pveptp7trx"},{"post_id":"ckh2r737k0021m3pv113ua68a","tag_id":"ckh2r7373000nm3pvd5m54qoq","_id":"ckh2r737p002fm3pv3o2lhhzu"},{"post_id":"ckh2r737l0025m3pv9th4c0rv","tag_id":"ckh2r7376000tm3pv97nr850l","_id":"ckh2r737q002jm3pv1vz77rwp"},{"post_id":"ckh2r7377000wm3pv1t5e6u11","tag_id":"ckh2r737i0020m3pvfz1c49dj","_id":"ckh2r737r002mm3pvfbci0mti"},{"post_id":"ckh2r737m0028m3pvfbltdibx","tag_id":"ckh2r7376000tm3pv97nr850l","_id":"ckh2r737s002pm3pvazf0hn46"},{"post_id":"ckh2r737o002dm3pvgj3o40fw","tag_id":"ckh2r7376000tm3pv97nr850l","_id":"ckh2r737t002sm3pvcxkfhgq7"},{"post_id":"ckh2r73780011m3pv5i111tpq","tag_id":"ckh2r737i0020m3pvfz1c49dj","_id":"ckh2r737u002um3pvg5zdf5af"},{"post_id":"ckh2r737p002gm3pv469l4os2","tag_id":"ckh2r7376000tm3pv97nr850l","_id":"ckh2r737u002wm3pv6lfhfmpc"},{"post_id":"ckh2r737q002km3pvhq8u3v3w","tag_id":"ckh2r7373000nm3pvd5m54qoq","_id":"ckh2r737u002ym3pv200v7lug"},{"post_id":"ckh2r737h001um3pv0kms7nsx","tag_id":"ckh2r737q002im3pv1t7582nx","_id":"ckh2r737u0030m3pv5vct04kn"},{"post_id":"ckh2r737r002nm3pv0xn65ktv","tag_id":"ckh2r7373000nm3pvd5m54qoq","_id":"ckh2r737u0031m3pv3qcnduu9"},{"post_id":"ckh2r737s002qm3pva72og8dt","tag_id":"ckh2r7376000tm3pv97nr850l","_id":"ckh2r737u0032m3pvf6m7bj3w"},{"post_id":"ckh2r737w0033m3pvczad2s9l","tag_id":"ckh2r73810035m3pvhdza4tu4","_id":"ckh2r73810036m3pvhj4c56t9"}],"Tag":[{"name":"高可用","_id":"ckh2r736u0005m3pvgm342gl4"},{"name":"Ansible","_id":"ckh2r736x000bm3pv794cepd3"},{"name":"Linux","_id":"ckh2r7373000nm3pvd5m54qoq"},{"name":"Docker","_id":"ckh2r7376000tm3pv97nr850l"},{"name":"Hexo","_id":"ckh2r737i0020m3pvfz1c49dj"},{"name":"Kubetnetes","_id":"ckh2r737q002im3pv1t7582nx"},{"name":"微服务","_id":"ckh2r73810035m3pvhdza4tu4"}]}}